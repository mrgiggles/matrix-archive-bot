<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-03-02</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-03-02<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-03-01" class="nav-link"><span>prev</span></a>
<a href="2023-03-03" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Mar 02 2023 06:23:53 GMT-0800 (Pacific Standard Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@gijs:mozilla.org">gijs</span>&gt;</div></td><td class="msg-cell">If I'm in DOM C++ code and I have a jsvalue, what's the right way to check if it points to a DOM element?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Mar 02 2023 06:24:05 GMT-0800 (Pacific Standard Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@gijs:mozilla.org">gijs</span>&gt;</div></td><td class="msg-cell">(and get an <code>Element</code> or <code>Fragment</code> or <code>nsIContent</code> reference or similar)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Mar 02 2023 06:33:28 GMT-0800 (Pacific Standard Time)">14:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">gijs</span>: check if it's an object and then UNWRAP_OBJECT like <a href="https://searchfox.org/mozilla-central/source/dom/base/StructuredCloneHolder.cpp#1049">https://searchfox.org/mozilla-central/source/dom/base/StructuredCloneHolder.cpp#1049</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Mar 02 2023 07:05:36 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@gijs:mozilla.org">gijs</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Ms2ger</span>: neat, will give that a shot. Thanks!</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Mar 02 2023 07:05:54 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">ðŸ™‡</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Mar 02 2023 10:31:15 GMT-0800 (Pacific Standard Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">wulf</span>: My team is building PythonMonkey, <a href="https://github.com/Distributive-Network/PythonMonkey">https://github.com/Distributive-Network/PythonMonkey</a>, which you might be interested in</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Mar 02 2023 10:36:26 GMT-0800 (Pacific Standard Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">Hey Folks - I just popped in pick brains wrt TypedArray representation. Provided there is no JS running, is it dangerous to mutate the backing stores in C-land for this data?
(what about if there IS JS running, on another thread?)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Mar 02 2023 10:37:31 GMT-0800 (Pacific Standard Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">we no longer support running JS on another thread that is accessing the same objects, other than the data of a SharedArrayBuffer.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Mar 02 2023 10:38:28 GMT-0800 (Pacific Standard Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and it is dangerous to mutate the backing stores if you're doing anything that might GC. Unless you allocated the backing store yourself, eg with an external ArrayBuffer.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Mar 02 2023 10:39:07 GMT-0800 (Pacific Standard Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(the problem is that small typed arrays might store their data directly in the object, and that object could move during a minor GC or compacting major GC)</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Mar 02 2023 10:43:36 GMT-0800 (Pacific Standard Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I said the thread thing badly. Currently, a SpiderMonkey runtime is on a single thread only. It cannot share data with runtimes on other threads without serializing &amp; deserializing so that they are not accessing each other's objects.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Mar 02 2023 10:44:28 GMT-0800 (Pacific Standard Time)">18:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-12">sfink</span>: Thanks. I was thinking about accessing the data from C while JS is running on another thread - so only one thread of JS. Although - really, only one thread of JS per process now? Did Firefox move to a multiprocess model?</p>
<p>Excellent advice re hazards of doing anything with backing stores I didn't allocate -- thanks. Figuring out how to do that performantly is going to be interesting.</p>
</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Mar 02 2023 10:44:38 GMT-0800 (Pacific Standard Time)">18:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">AH - thanks for clarification, this makes more sense :)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Mar 02 2023 10:46:22 GMT-0800 (Pacific Standard Time)">18:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Firefox did go multiprocess (the Fission project), but there can still be several runtimes per process, for the various types of Workers and worklets and whatever. They mostly just postMessage each other to talk.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Mar 02 2023 10:50:21 GMT-0800 (Pacific Standard Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">We have <a href="https://searchfox.org/mozilla-central/rev/a94fc6d9ececbf64a995d7ce9dc6eba0ffad7b67/js/public/ArrayBuffer.h#72-121">scary comments</a> saying you shouldn't touch the data in an ArrayBuffer created with <code>JS::NewExternalArrayBuffer</code>, but I'm not sure why. Anyway, <code>JS::NewArrayBufferWithUserOwnedContents</code> ought to work fine.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Mar 02 2023 10:56:09 GMT-0800 (Pacific Standard Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><p>Nice, thanks! :)  Last I looked at this, we had plugins out of process but that was it......glancing at the Fission page, it looks like a Very Good Idea.</p>
<p>Looks like I'm going to have to do some reading around TypedArray allocation internals. Externally-allocated (user owned) sounds straightforward, but I also want direct metal access to backing stores for script-allocated stuff... I can go through the JS api for property access for small ones, but big ones really need to be no-copy for my usecase.  I can, at least, make sure that no JS is running when I do this.  I could probably also restrict myself to a read-only, copy-on-write approach to this memory.</p>
<p>I bet the scary comments are related in part to interaction with JIT code, which I'm sure has unfettered access to the backing stores under many conditions. <em>hmm</em>.</p>
</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Mar 02 2023 11:02:31 GMT-0800 (Pacific Standard Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Oh right, I guess the comment probably assumes that JS code could run. You definitely don't want to be modifying it then. I can't think of any problem with accessing it when JS is not running.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Mar 02 2023 13:44:24 GMT-0800 (Pacific Standard Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">I hear you should use PropertyKey over JsId, is it this? <a href="https://searchfox.org/mozilla-central/source/js/public/PropertySpec.h">https://searchfox.org/mozilla-central/source/js/public/PropertySpec.h</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Mar 02 2023 13:45:20 GMT-0800 (Pacific Standard Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">actually nevermind, it's an alias apparently</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Mar 02 2023 13:48:47 GMT-0800 (Pacific Standard Time)">21:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">if I use <code>js::GetPropertyKeys</code> on a JS object, how are you supposed to obtain the actual key name as a string? I've been checking properties[i].isString() and apparently it is not a string so I'm unable to use <code>toString</code><br>Ideally I want to obtain the property name and the value assigned to the property in an object.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Mar 02 2023 13:57:19 GMT-0800 (Pacific Standard Time)">21:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">A property key can have several different forms <a href="https://searchfox.org/mozilla-central/rev/a94fc6d9ececbf64a995d7ce9dc6eba0ffad7b67/js/src/jsfriendapi.h#583-595">https://searchfox.org/mozilla-central/rev/a94fc6d9ececbf64a995d7ce9dc6eba0ffad7b67/js/src/jsfriendapi.h#583-595</a> </td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Mar 02 2023 13:58:46 GMT-0800 (Pacific Standard Time)">21:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">You could use IdToValue and ToString. It partly depends what you want to happen for <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol">Symbols</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Mar 02 2023 14:14:07 GMT-0800 (Pacific Standard Time)">22:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Symbols scare me</td></tr>

</tbody></table></div></div></div>
</body></html>