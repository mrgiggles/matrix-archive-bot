<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-05-12</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-05-12<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-05-11" class="nav-link"><span>prev</span></a>
<a href="2021-05-13" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue May 11 2021 21:21:08 GMT-0700 (Pacific Daylight Time)">04:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell"><p>is there document  to visit tree using "ParseNodeVisitor" or its sub class?  i want to get the call function name.</p>
<pre><code>class XssVisitor : public ParseNodeVisitor&lt;XssVisitor&gt; {
...
bool visitCallExpr(BinaryNode* pn){
 // how to get call function name here?
 printf("%s\n", "call expr");
 CallExpr = true;
 return ParseNodeVisitor::visitCallExpr(pn);
}
</code></pre>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue May 11 2021 23:15:15 GMT-0700 (Pacific Daylight Time)">06:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">leveryd</span>: there's basic document above the class  <a href="https://searchfox.org/mozilla-central/rev/6b099d836c882bc155d2ef285e0ad0ab9f5038f6/js/src/frontend/ParseNodeVisitor.h#20-51">https://searchfox.org/mozilla-central/rev/6b099d836c882bc155d2ef285e0ad0ab9f5038f6/js/src/frontend/ParseNodeVisitor.h#20-51</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue May 11 2021 23:17:50 GMT-0700 (Pacific Daylight Time)">06:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p><span class="nick-9">leveryd</span>: there's basic document above the class  <a href="https://searchfox.org/mozilla-central/rev/6b099d836c882bc155d2ef285e0ad0ab9f5038f6/js/src/frontend/ParseNodeVisitor.h#20-51">https://searchfox.org/mozilla-central/rev/6b099d836c882bc155d2ef285e0ad0ab9f5038f6/js/src/frontend/ParseNodeVisitor.h#20-51</a></p>
</blockquote>
<p>i have read it, but i can not get useful information about how to get "call function" name in above code.</p>
</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue May 11 2021 23:18:37 GMT-0700 (Pacific Daylight Time)">06:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what do you mean by "call function name" ?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue May 11 2021 23:21:07 GMT-0700 (Pacific Daylight Time)">06:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell"><p>Javascript code</p>
<pre><code>alert(111);
funcname();
</code></pre>
<p>i want to know the function name such as "alert" and "funcname".</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue May 11 2021 23:21:38 GMT-0700 (Pacific Daylight Time)">06:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I see</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue May 11 2021 23:22:07 GMT-0700 (Pacific Daylight Time)">06:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, first, you need to define a method for call expression</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue May 11 2021 23:23:09 GMT-0700 (Pacific Daylight Time)">06:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">each method has "visit + ParseNodeKind" name</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue May 11 2021 23:23:15 GMT-0700 (Pacific Daylight Time)">06:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/6b099d836c882bc155d2ef285e0ad0ab9f5038f6/js/src/frontend/ParseNodeVisitor.h#77-82">https://searchfox.org/mozilla-central/rev/6b099d836c882bc155d2ef285e0ad0ab9f5038f6/js/src/frontend/ParseNodeVisitor.h#77-82</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue May 11 2021 23:23:43 GMT-0700 (Pacific Daylight Time)">06:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">each ParseNode kind is defined in ParseNode.h</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue May 11 2021 23:23:50 GMT-0700 (Pacific Daylight Time)">06:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/ParseNode.h#517">https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/ParseNode.h#517</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue May 11 2021 23:23:50 GMT-0700 (Pacific Daylight Time)">06:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">yes, i just use "visitCallExpr". you can see my code above.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue May 11 2021 23:24:14 GMT-0700 (Pacific Daylight Time)">06:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue May 11 2021 23:24:21 GMT-0700 (Pacific Daylight Time)">06:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue May 11 2021 23:24:32 GMT-0700 (Pacific Daylight Time)">06:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, in the method, you need to check if the callee is a name</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue May 11 2021 23:24:48 GMT-0700 (Pacific Daylight Time)">06:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">callee is <code>left</code> of <code>BinaryNode</code></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue May 11 2021 23:24:51 GMT-0700 (Pacific Daylight Time)">06:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">yes, i have a function name blacklist.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue May 11 2021 23:25:32 GMT-0700 (Pacific Daylight Time)">06:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the callee is a identifier reference, it's <code>Name</code> node</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue May 11 2021 23:26:10 GMT-0700 (Pacific Daylight Time)">06:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">oh, i will try it later.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue May 11 2021 23:26:15 GMT-0700 (Pacific Daylight Time)">06:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, <code>pn-&gt;left-&gt;is&lt;NameNode&gt;()</code> will be <code>true</code></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue May 11 2021 23:26:47 GMT-0700 (Pacific Daylight Time)">06:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>NameNode</code> is subclass of <code>ParseNode</code></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue May 11 2021 23:26:59 GMT-0700 (Pacific Daylight Time)">06:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/ParseNode.h#880">https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/ParseNode.h#880</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue May 11 2021 23:28:18 GMT-0700 (Pacific Daylight Time)">06:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">i see</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue May 11 2021 23:29:10 GMT-0700 (Pacific Daylight Time)">06:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and it's <code>name()</code> method returns the actual text of the identifier</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue May 11 2021 23:29:44 GMT-0700 (Pacific Daylight Time)">06:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in <code>TaggedParserAtomIndex</code> encoding, that is compilation unit local index for given string</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue May 11 2021 23:31:14 GMT-0700 (Pacific Daylight Time)">06:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/ParserAtom.h#59">https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/ParserAtom.h#59</a></td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue May 11 2021 23:33:19 GMT-0700 (Pacific Daylight Time)">06:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, that's managed by <code>ParserAtomsTable</code>, in <code>ExtensibleCompilationStencil</code></td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue May 11 2021 23:35:06 GMT-0700 (Pacific Daylight Time)">06:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, currently there's no direct way to compare <code>TaggedParserAtomIndex</code> with arbitrary string</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue May 11 2021 23:35:48 GMT-0700 (Pacific Daylight Time)">06:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">simple way would be convert it into <code>UniqueChars</code> by <code>ParserAtomsTable::toNewUTF8CharsZ</code> and compare it with the arbitrary string</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue May 11 2021 23:54:57 GMT-0700 (Pacific Daylight Time)">06:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>simple way would be convert it into <code>UniqueChars</code> by <code>ParserAtomsTable::toNewUTF8CharsZ</code> and compare it with the arbitrary string</p>
</blockquote>
<p>which file define "UniqueChars" class?</p>
</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue May 11 2021 23:55:57 GMT-0700 (Pacific Daylight Time)">06:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">you can search for definition in searchfox</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue May 11 2021 23:55:59 GMT-0700 (Pacific Daylight Time)">06:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/search?q=UniqueChars&amp;path=">https://searchfox.org/mozilla-central/search?q=UniqueChars&amp;path=</a></td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed May 12 2021 01:24:15 GMT-0700 (Pacific Daylight Time)">08:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell">hmm, is it possible to build SM without rust? I see that <code>--disable-rust</code> flag is gone, for what we are using rust in SM? <span class="nick-15">arai</span></td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed May 12 2021 01:30:11 GMT-0700 (Pacific Daylight Time)">08:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">wasm maybe?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed May 12 2021 01:36:19 GMT-0700 (Pacific Daylight Time)">08:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell">sorry for pushing, needs to investigate more into libjsrust :)</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed May 12 2021 02:53:51 GMT-0700 (Pacific Daylight Time)">09:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Don't we rely on rust for different encoding kinds?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed May 12 2021 03:26:06 GMT-0700 (Pacific Daylight Time)">10:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-15">arai</span>: am i wrong to call api? it print "debug1" and does not print "debug2". and the app has core dump.</p>
<pre><code>bool visitCallExpr(BinaryNode* pn){
 if (pn-&gt;left()-&gt;is&lt;NameNode&gt;()!=true){
   return ParseNodeVisitor::visitCallExpr(pn);
 }

 js::LifoAlloc alloc(1024);
 ParserAtomsTable atomTable(cx-&gt;runtime(), alloc);
 printf("debug1\n");
 JS::UniqueChars output = atomTable.toNewUTF8CharsZ(cx, static_cast&lt;NameNode*&gt;(pn-&gt;left())-&gt;name());  // core dump here
 printf("debug2\n");
 
 return ParseNodeVisitor::visitCallExpr(pn);
}
</code></pre>
</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed May 12 2021 03:26:46 GMT-0700 (Pacific Daylight Time)">10:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">the complet code is on <a href="https://gist.github.com/leveryd/c2953eab188542e4baac0d7a99b1df14">https://gist.github.com/leveryd/c2953eab188542e4baac0d7a99b1df14</a></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed May 12 2021 03:27:03 GMT-0700 (Pacific Daylight Time)">10:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">leveryd</span>: you need to retrieve <code>ParserAtomsTable</code> instance from the current compilation</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed May 12 2021 03:27:18 GMT-0700 (Pacific Daylight Time)">10:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">otherwise it doesn't contain not-well-known atoms</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed May 12 2021 03:28:02 GMT-0700 (Pacific Daylight Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">all strings (including names) encountered during parsing are accumulated into the <code>ParserAtomsTable</code> instance, and it assigns index for it</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed May 12 2021 03:29:50 GMT-0700 (Pacific Daylight Time)">10:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">where do you instantiate <code>XssVisitor</code>?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed May 12 2021 03:29:54 GMT-0700 (Pacific Daylight Time)">10:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">i have no concept about "atoms" . how can i make <code>ParserAtomsTable</code> instance from the current compilation?</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed May 12 2021 03:30:04 GMT-0700 (Pacific Daylight Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">no, you don't make</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed May 12 2021 03:30:12 GMT-0700 (Pacific Daylight Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it's already there, as long as it's during compilation</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed May 12 2021 03:32:40 GMT-0700 (Pacific Daylight Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">atom is a string that's guaranteed to be unique.  so, the comparison between 2 atoms can be done by comparing pointer, or index here</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed May 12 2021 03:33:33 GMT-0700 (Pacific Daylight Time)">10:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">oh, i call XssVisitor::visit in "reflect_parse" function, so how can i get the <code>ParserAtomsTable</code> instance?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed May 12 2021 03:34:08 GMT-0700 (Pacific Daylight Time)">10:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">do you mean this C++ function? <a href="https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/builtin/ReflectParse.cpp#3733">https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/builtin/ReflectParse.cpp#3733</a></td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed May 12 2021 03:34:35 GMT-0700 (Pacific Daylight Time)">10:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed May 12 2021 03:35:03 GMT-0700 (Pacific Daylight Time)">10:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it's here <a href="https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/CompilationStencil.h#678">https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/js/src/frontend/CompilationStencil.h#678</a></td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed May 12 2021 03:35:24 GMT-0700 (Pacific Daylight Time)">10:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, <code>ExtensibleCompilationStencil</code> has that field, and <code>CompilationState</code> is a subclass of it</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed May 12 2021 03:35:41 GMT-0700 (Pacific Daylight Time)">10:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and <code>reflect_parse</code> has <code>CompilationState</code> instance on the stack (local variable)</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed May 12 2021 03:36:10 GMT-0700 (Pacific Daylight Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, pass its pointer/reference to <code>XssVisitor</code></td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed May 12 2021 03:38:37 GMT-0700 (Pacific Daylight Time)">10:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@leveryd:mozilla.org">leveryd</span>&gt;</div></td><td class="msg-cell">i see, i will try it later</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed May 12 2021 05:07:38 GMT-0700 (Pacific Daylight Time)">12:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@pavelp:mozilla.org">pavelp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: i've registered new account - sploitem@gmail.com</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed May 12 2021 08:58:11 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell">Hey! I have silly question: is there a way to get the owner JSContext from a JSObject? It doesn't seem the case unless it's saved on the private data, but just asking in case I'm missing something obvious.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed May 12 2021 09:07:40 GMT-0700 (Pacific Daylight Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">JSObject -&gt; Realm get's you reasonably close</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed May 12 2021 09:08:49 GMT-0700 (Pacific Daylight Time)">16:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">the types of "owner JSContext" we encounter for objects are 1) process main-thread. 2) off-thread-parse realm. 3) worker main-thread</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed May 12 2021 09:09:03 GMT-0700 (Pacific Daylight Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(the off-thread parse stuff is being phased out)</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed May 12 2021 09:09:50 GMT-0700 (Pacific Daylight Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">if you are already on main-thread, then there is really only the one JSContext</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed May 12 2021 09:10:43 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(so it probably depends on why you want a JSContext from an object and if there is actual a different level of abstraction you want)</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Wed May 12 2021 09:11:41 GMT-0700 (Pacific Daylight Time)">16:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">Marco Trevisan</span>: Looking at functions signatures [of our public API], I only found 2 functions which are retuning a JSContext*. Usually the JSContext is the thing you want to carry around everywhere.</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Wed May 12 2021 09:12:59 GMT-0700 (Pacific Daylight Time)">16:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">Marco Trevisan</span>: Looking at functions signatures [of our public API], I only found 2 functions which are retuning a JSContext*. Usually the JSContext is the thing you want to carry around everywhere.</blockquote></mx-reply>yeah, but in embedding we may not have the ability to carry it everywhere when using callbacks which don't have proper ability to destroy the data you passed... so ending up leaking</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Wed May 12 2021 09:13:39 GMT-0700 (Pacific Daylight Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell">so, I can save it around, but I was wondering if there was a way to avoid it but looks like it's not possible</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Wed May 12 2021 09:23:43 GMT-0700 (Pacific Daylight Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Gecko stashes it away (maybe in TLS?) <a href="https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/dom/script/ScriptSettings.cpp#284">https://searchfox.org/mozilla-central/rev/27722db2f164add7047d7db03169966cb806e927/dom/script/ScriptSettings.cpp#284</a></td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Wed May 12 2021 09:34:24 GMT-0700 (Pacific Daylight Time)">16:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell">a nice danger namespace :-D</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Wed May 12 2021 09:37:50 GMT-0700 (Pacific Daylight Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Gecko is full of <code>AutoJSAPI</code> calls to help it out, and under the covers is that danger method</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Wed May 12 2021 09:39:18 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">SpiderMonkey has a TlsContext::Get() internally, but we don't expose it to embedders</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Wed May 12 2021 09:40:03 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(probably because we keep changing our mind on how JSContext and JS::Runtime are divided up or shared..)</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Wed May 12 2021 09:41:35 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">Marco Trevisan</span>: there is an assert you can use to <em>check</em> if you got the right answer:  <code>JS_AbortIfWrongThread(cx)</code></td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Wed May 12 2021 09:41:59 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Note, the TlsContext is only used internally for the JIT, to recover the JSContext* pointer without having to carry it as argument of every JIT-ed functions.</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Wed May 12 2021 09:42:20 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">Marco Trevisan</span>: there is an assert you can use to <em>check</em> if you got the right answer:  <code>JS_AbortIfWrongThread(cx)</code></blockquote></mx-reply>Yeah, well that's the point...</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Wed May 12 2021 09:42:55 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell">we may get events happening on threads different from the one where the context is, and getting the owner context may be annoying</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Wed May 12 2021 09:43:34 GMT-0700 (Pacific Daylight Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">reading the object from the wrong thread will get you in trouble, generally</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Wed May 12 2021 09:44:34 GMT-0700 (Pacific Daylight Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Our GC is not a concurrent GC, it will not support having a mutating thread different than the marking thread.</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Wed May 12 2021 09:45:19 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell">yeah, indeed...</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Wed May 12 2021 09:45:43 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@3v1n0:mozilla.org">Marco Trevisan</span>&gt;</div></td><td class="msg-cell">getting thigs back in order may be complicated, but well i've options... I just wanted to see if I can avoided to save those pointer bytes.. :)</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Wed May 12 2021 10:12:45 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">oh, tomorrow is a holiday?</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Wed May 12 2021 10:13:03 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">(for germany)</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Wed May 12 2021 10:13:12 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">hm... in case anyone needs me, i might be offline?</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Wed May 12 2021 10:14:08 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">... it is a holiday</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Wed May 12 2021 10:17:03 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Same in France</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Wed May 12 2021 10:17:15 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Trying to come up with hypotheses around Bug 1707979 and family... Nothing reasonable yet.</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Wed May 12 2021 10:17:17 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Wed May 12 2021 10:17:18 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1707979">https://bugzil.la/1707979</a> — NEW (nobody) — Crash in [@ js::frontend::GeneralParser&lt;T&gt;::statementListItem]</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Wed May 12 2021 15:00:38 GMT-0700 (Pacific Daylight Time)">22:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Early investigation on adding static class blocks; prototype parsing is mostly working, but BCE is totally off so far; doing this right is probably going to involve some fairly invasive refactoring in the parser to make all the class field stuff a little more uniform if possible</td></tr>

</tbody></table></div></div></div>
</body></html>