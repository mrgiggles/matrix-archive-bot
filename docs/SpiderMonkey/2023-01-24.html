<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-01-24</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-01-24<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-01-23" class="nav-link"><span>prev</span></a>
<a href="2023-01-25" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jan 24 2023 03:51:19 GMT-0800 (Pacific Standard Time)">11:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Do we have some helper to get string data out of JSRope without flattening? And even to get the data to an existing buffer, so that no allocations would happen.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jan 24 2023 05:11:08 GMT-0800 (Pacific Standard Time)">13:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: sounds like you want something like <code>JSRope::copyCharsInternal</code> or <code>StringSegmentRange</code></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jan 24 2023 05:11:54 GMT-0800 (Pacific Standard Time)">13:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I think <span class="nick-15">tcampbell</span> was looking into the rope atomization thing a while ago too so he might have a patch for this already</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jan 24 2023 05:12:16 GMT-0800 (Pacific Standard Time)">13:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">right</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jan 24 2023 05:13:15 GMT-0800 (Pacific Standard Time)">13:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">I was just debugging this a tiny bit, and looks like 1/3 of the strings passed to atomization are JSRopes when running sp2 react-todo</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jan 24 2023 05:15:22 GMT-0800 (Pacific Standard Time)">13:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">JSRope::copyCharsInternal seems to allocate. StringSegmentRange looks promising </td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jan 24 2023 05:16:04 GMT-0800 (Pacific Standard Time)">13:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah that is a lot of flattening we could potentially avoid</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jan 24 2023 06:23:24 GMT-0800 (Pacific Standard Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@mconley:mozilla.org">mconley</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: Congratulations on closing out bug 1247687!</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jan 24 2023 06:23:26 GMT-0800 (Pacific Standard Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1247687">https://bugzil.la/1247687</a> — RESOLVED (yulia) — Implement worker modules</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jan 24 2023 06:27:12 GMT-0800 (Pacific Standard Time)">14:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">Thanks! Looks like it may stick this time! I am still looking at it with a bit of side eye...</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jan 24 2023 06:53:07 GMT-0800 (Pacific Standard Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell">Is there a way to figure out how many operands each JSOp takes?  something like <a href="https://searchfox.org/mozilla-central/source/js/src/jit/LIR.h#901">https://searchfox.org/mozilla-central/source/js/src/jit/LIR.h#901</a> but for JSOp?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jan 24 2023 07:14:08 GMT-0800 (Pacific Standard Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">denispal</span>: do you mean the stack slots? see <a href="https://searchfox.org/mozilla-central/rev/cf3af6bb6657278880f8baf38435eeb8f2d5d86c/js/src/vm/BytecodeUtil.h#331-333">here</a>. For most ops it's statically known but a few ops are variadic and we need to read the operand</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jan 24 2023 07:16:38 GMT-0800 (Pacific Standard Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: ah interesting.  I want to add operands info to the jitdump, but not sure how many stack values to look at for JSOp opcodes</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jan 24 2023 07:16:44 GMT-0800 (Pacific Standard Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell">I guess that should tell me?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jan 24 2023 07:17:20 GMT-0800 (Pacific Standard Time)">15:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yes I think so</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jan 24 2023 07:18:01 GMT-0800 (Pacific Standard Time)">15:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell">perfect, ty!</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jan 24 2023 07:37:57 GMT-0800 (Pacific Standard Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: yeah, I'm still looking into the rope thing. I had mixed results so I need to continue tuning more. There is a bit of complexity traversing ropes since we normally do in-place mutation and other tricks. Relevant bugs are under Bug 1803803</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jan 24 2023 07:37:58 GMT-0800 (Pacific Standard Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1803803">https://bugzil.la/1803803</a> — NEW (nobody) — [meta] JS Perf Experiments - Atoms and Strings</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jan 24 2023 11:54:19 GMT-0800 (Pacific Standard Time)">19:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">It doesn't look like we have a review group for spidermonkey: <a href="https://firefox-source-docs.mozilla.org/contributing/reviews.html#review-groups">https://firefox-source-docs.mozilla.org/contributing/reviews.html#review-groups</a>. It came up today that it might be useful to have one for large reviews like Temporal (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1519167">https://bugzilla.mozilla.org/show_bug.cgi?id=1519167</a>) to make it easier to coordinate reviews across multiple people. This could also make life easier for external contributors. Any thoughts on this?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jan 24 2023 11:57:50 GMT-0800 (Pacific Standard Time)">19:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">dminor</span>: I believe that <span class="nick-2">mgaudet</span> looked into this in the past. I didn't remember why we abandoned it</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jan 24 2023 12:13:09 GMT-0800 (Pacific Standard Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Last time I looked into it, we were using bugzlila for review, and support was not great.

Today I definitely think we should look into it again, we will likely have much more success, even the support that we have have in tooling (phabricator)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jan 24 2023 12:27:41 GMT-0800 (Pacific Standard Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@dale:mozilla.org">Dale</span>&gt;</div></td><td class="msg-cell">Question from a random discussion, is there any proposals to add some form of sleep / wait / delay into Promises? (ie settimeout, but promise)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jan 24 2023 12:33:32 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Dale</span>: Off the top of my head I can't really think of anything -- but partially this a side effect of the notion of time not really existing in the spec (everything in the spec really talks in terms of "jobs" which are enqueued onto job queues owned by the embedding host; it is the host responsibility to then kick jobs off at appropriate times)</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jan 24 2023 12:33:55 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">So if that were under consideration, it would have to be done as some part of web spec </td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jan 24 2023 12:35:17 GMT-0800 (Pacific Standard Time)">20:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(I know it's something I've wanted before, so I definitely understand a desire for it; <code>new Promise((r) =&gt; { setTimeout(x, r);}</code> isn't super satisfying (and IIRC there's some pain in getting it right that I may  be skating over)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jan 24 2023 12:36:38 GMT-0800 (Pacific Standard Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@dale:mozilla.org">Dale</span>&gt;</div></td><td class="msg-cell">lol yeh we were discussing how we have a need to write that code almost daily, thanks for the insight </td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Jan 24 2023 12:41:22 GMT-0800 (Pacific Standard Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(IMO would be a very nice addition to the HTML spec, where I think it would have to belong, but others may disagree :P) </td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Jan 24 2023 12:52:59 GMT-0800 (Pacific Standard Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">I filed <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1812153">https://bugzilla.mozilla.org/show_bug.cgi?id=1812153</a> to create a reviewers group for spidermonkey in phabricator. I left needinfos for Jan, Ted and Yulia to sign off on the membership, but if anyone else has any comments (or objections!) please comment in that bug.</td></tr>

</tbody></table></div></div></div>
</body></html>