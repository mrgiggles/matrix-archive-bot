<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-09-03</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-09-03<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-09-02" class="nav-link"><span>prev</span></a>
<a href="2024-09-04" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Sep 03 2024 03:15:55 GMT-0700 (Pacific Daylight Time)">10:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">Hi folks. I am working on intergrating the newest version of the onnx runtime that runs in WASM, and it works but I have something that gets nuts in the JS JIT, eats GBs of ram and locks <code>about:memory</code> so I can't inspect. I can profile though: <a href="https://share.firefox.dev/4g6ZrQh">https://share.firefox.dev/4g6ZrQh</a> -- seems to be a backtracking issue in <code>js::wasm::IonCompileFunctions</code> -- I have no idea how to investigate further...</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Sep 03 2024 03:26:44 GMT-0700 (Pacific Daylight Time)">10:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">The profile looks like a loop in our register allocator, would you be able to bisect if this is a recent issue?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Sep 03 2024 03:28:50 GMT-0700 (Pacific Daylight Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/3cb31675aeffd10f1f6ae7c40e24b254da7798e5/js/src/jit/BacktrackingAllocator.cpp#3713-3723">https://searchfox.org/mozilla-central/rev/3cb31675aeffd10f1f6ae7c40e24b254da7798e5/js/src/jit/BacktrackingAllocator.cpp#3713-3723</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Sep 03 2024 03:30:42 GMT-0700 (Pacific Daylight Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: Do you have a link to the newwest version of the onnx runtime? Also <span class="nick-1">jseward</span> might be the best person to figure out quickly what is going wrong.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Sep 03 2024 03:36:23 GMT-0700 (Pacific Daylight Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I will try to bisect thanks. I have a patch where I move to that lib and steps to reproduce.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Sep 03 2024 03:38:11 GMT-0700 (Pacific Daylight Time)">10:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">you could try a debug build to see if it fails any assertions</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Sep 03 2024 03:43:52 GMT-0700 (Pacific Daylight Time)">10:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I did run it in debug and had the same problem and no assertion happened. Just a deadlock warning when I ran about:memory report</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Sep 03 2024 03:44:10 GMT-0700 (Pacific Daylight Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I will add an issue to track all the info</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Sep 03 2024 04:21:03 GMT-0700 (Pacific Daylight Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: are you sure it's really an infinite loop?  could it be just that the RA takes a long time -- it is known to do that sometimes</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Sep 03 2024 04:21:15 GMT-0700 (Pacific Daylight Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell">Anyways, if you can file a bug i'll take a look</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Sep 03 2024 04:24:41 GMT-0700 (Pacific Daylight Time)">11:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-13">Tarek</span>: are you sure it's really an infinite loop?  could it be just that the RA takes a long time -- it is known to do that sometimes</blockquote></mx-reply>I don't know if it's infinite, but it was running for 5 minutes at 100% until my callback to kill the worker kicks in.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Sep 03 2024 04:25:02 GMT-0700 (Pacific Daylight Time)">11:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell">Mhm that's ungood</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Sep 03 2024 04:25:31 GMT-0700 (Pacific Daylight Time)">11:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">But the code still worksâ€¦ so I am confused</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Sep 03 2024 04:26:30 GMT-0700 (Pacific Daylight Time)">11:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell">That's probably because it got compiled by the wasm baseline compiler no problem, and runs; and you're seeing the Ion (optimised) compilation in the background</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Sep 03 2024 04:27:02 GMT-0700 (Pacific Daylight Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">Makes sense. Is there an option to deactivate ion ?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Sep 03 2024 04:27:38 GMT-0700 (Pacific Daylight Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell">javascript.options.wasm_optimizingjit; set that to false</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Sep 03 2024 04:28:05 GMT-0700 (Pacific Daylight Time)">11:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">Ok will try just curious to see what happens. Will also file the bug. Thx</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Sep 03 2024 06:34:38 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">jseward</span>: added <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1916442">https://bugzilla.mozilla.org/show_bug.cgi?id=1916442</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Sep 03 2024 06:35:47 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><code>javascript.options.wasm_optimizingjit</code> to <code>false</code> fixes the issue</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Sep 03 2024 08:16:55 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@bvisness:mozilla.org">bvisness</span>&gt;</div></td><td class="msg-cell">Within the jit-test system, how can we restrict the parallelism of certain tests? I'm particularly looking at the slew of memory64 resource exhaustion failures: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1914577">https://bugzilla.mozilla.org/show_bug.cgi?id=1914577</a></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Sep 03 2024 08:17:21 GMT-0700 (Pacific Daylight Time)">15:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@bvisness:mozilla.org">bvisness</span>&gt;</div></td><td class="msg-cell">I think it's reasonable to run these tests sequentially, since there's not that many, and several of them will indeed want to chew up address space</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Sep 03 2024 08:18:13 GMT-0700 (Pacific Daylight Time)">15:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@bvisness:mozilla.org">bvisness</span>&gt;</div></td><td class="msg-cell">(in fact, running them on my linux machine used to cause processes to randomly die, until Julian helped me set up zram)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Sep 03 2024 08:33:38 GMT-0700 (Pacific Daylight Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell">when you say "restrict the parallelism of certain tests", do you mean "stop the jit_tests script running some many threads in parallel at certain times" ?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Sep 03 2024 08:35:15 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mgaudet:mozilla.org">mgaudet|ooo-back-tuesday</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">bvisness</span>: Yes: <a href="https://searchfox.org/mozilla-central/source/js/src/tests/lib/tasks_unix.py#215">https://searchfox.org/mozilla-central/source/js/src/tests/lib/tasks_unix.py#215</a> is the routine to start editing</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Sep 03 2024 08:35:15 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell">I wonder if we could make it so that the JS directives line at the start of each test could say "I am a big-resource test", and have the jit_tests script wait for all running test processes to terminate before starting the test</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Sep 03 2024 08:35:44 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mgaudet:mozilla.org">mgaudet|ooo-back-tuesday</span>&gt;</div></td><td class="msg-cell">and yeah, I think a <code>sequential</code> directive makes sense</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Sep 03 2024 08:40:50 GMT-0700 (Pacific Daylight Time)">15:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jseward:mozilla.org">jseward</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: can you make available the .wasm file it was trying to compile at the time?  We can just profile the shell compiling it, which will be easier that dealing with the whole browser.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Sep 03 2024 08:56:56 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">bvisness</span>: Yes: <a href="https://searchfox.org/mozilla-central/source/js/src/tests/lib/tasks_unix.py#215">https://searchfox.org/mozilla-central/source/js/src/tests/lib/tasks_unix.py#215</a> is the routine to start editing</blockquote></mx-reply><p>Side note, there' a windows version of this too that will also need editing.</p>
<p>On the plus side, if you can pipe things through enough, this will be shared between jstests and jit-tests.</p>
<p>Probably need parsing in each harness though to set the appropriate bits on tasks -- I have most of this paged out at the moment, but if you want some help here feel free to ask because I think this is good and we should do it</p>
</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Sep 03 2024 09:04:05 GMT-0700 (Pacific Daylight Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">for sure</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Sep 03 2024 09:06:00 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">added links to the issue</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Sep 03 2024 09:49:32 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: Once upon a time we used to only do off-thread compilation if bodies crossed a certain size threshold, but we got rid of that (as near as I can tell by the code) -- We came to the conclusion that this was too finicky and prone to main-thread jank?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Sep 03 2024 09:55:32 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: I don't remember this was different before but it sounds plausible. Even for small compilations we do quite a lot of work but it could be interesting to measure this</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Sep 03 2024 09:56:18 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: Yeah, the only predicate now is</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Sep 03 2024 09:56:20 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/jit/Ion.cpp#1729-1756">https://searchfox.org/mozilla-central/source/js/src/jit/Ion.cpp#1729-1756</a></td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Sep 03 2024 09:56:30 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">which is whether or not it's enabled (sorry multiline accidental enter :P) </td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Sep 03 2024 09:59:53 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Congratulations to <span class="nick-5">jon4t4n</span> for getting the JSON Modules browser integration merged. It's been a huge long road!</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Sep 03 2024 14:17:29 GMT-0700 (Pacific Daylight Time)">21:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Are there any code examples for the use of frontent::Stencil ?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Sep 03 2024 14:18:04 GMT-0700 (Pacific Daylight Time)">21:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Or maybe I should say the various Stencil classes</td></tr>

</tbody></table></div></div></div>
</body></html>