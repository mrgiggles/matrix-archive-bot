<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-11-03</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-11-03<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-11-02" class="nav-link"><span>prev</span></a>
<a href="2023-11-04" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Nov 02 2023 21:08:32 GMT-0700 (Pacific Daylight Time)">04:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Not quite sure I get but I want to check if all latin-1 strings are guaranteed to be between 0x00&lt;char&lt;0xFF and in utf-16 strings, there'll always be at least one u16 codepoint &gt; 0xFF</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Nov 02 2023 21:39:21 GMT-0700 (Pacific Daylight Time)">04:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm not sure if I understand the sentence, but we call single byte <code>0x00</code>-<code>0xFF</code> range as "Latin1" in API, and that range directly maps to <code>\u0000</code>-<code>\u00FF</code> range in UTF-16 ("TwoBytes" in API)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Nov 02 2023 22:02:23 GMT-0700 (Pacific Daylight Time)">05:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Can a TwoByte string ever have only 0x00-0xFF bytes (but not stored as Latin1)?<br>Will all TwoByte strings have at least one codepoint greater than 0xFF (I'm confused about surrogates basically)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Nov 02 2023 22:09:53 GMT-0700 (Pacific Daylight Time)">05:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, I think I understand the question.  being <code>TwoBytes</code> string doesn't guarantee that there's non-latin1 in the string content.  ASCII-only string can also be represented as <code>TwoBytes</code> string</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Nov 02 2023 22:12:31 GMT-0700 (Pacific Daylight Time)">05:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you're looking into specific API, it can have more rules (such as, it tries to use minimal representation, it always use TwoBytes, etc)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 02 2023 22:13:11 GMT-0700 (Pacific Daylight Time)">05:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">which API or struct are you thinking about?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 02 2023 22:18:19 GMT-0700 (Pacific Daylight Time)">05:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, what do you mean with surrogates?  is it about the surrogate pair (<code>\uD800</code>-<code>\uDFFF</code>)?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 02 2023 22:30:40 GMT-0700 (Pacific Daylight Time)">05:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if you're looking into specific API, it can have more rules (such as, it tries to use minimal representation, it always use TwoBytes, etc)</blockquote></mx-reply>Currently, I'm working on atob/btoa, since it operates on codepoints between 0x00 and 0xFF</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 02 2023 22:31:27 GMT-0700 (Pacific Daylight Time)">05:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">and also possibly looking at webidl's <code>ByteString</code>, though not yet</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 02 2023 22:32:30 GMT-0700 (Pacific Daylight Time)">05:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">which <code>atob</code> implementation?  is it in your embedding?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 02 2023 22:32:44 GMT-0700 (Pacific Daylight Time)">05:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">In my embedding yes</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 02 2023 22:34:20 GMT-0700 (Pacific Daylight Time)">05:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is the context that you're trying to implement <code>atob</code>, and now you're looking at how to extract or generate JSString data there?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 02 2023 22:34:43 GMT-0700 (Pacific Daylight Time)">05:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Extraction is the concern</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Nov 02 2023 22:36:11 GMT-0700 (Pacific Daylight Time)">05:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, so, the question is that "whether the underlying representation of <code>JSString</code> passed to <code>atob</code> can always be Latin1 or not" ?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Nov 02 2023 22:38:54 GMT-0700 (Pacific Daylight Time)">05:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">for encoding purposes, I want Latin1 (since its a byte sequence), I was wondering if I could just error on non-Latin1 strings which makes the implementation much easier</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Nov 02 2023 22:39:20 GMT-0700 (Pacific Daylight Time)">05:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in general we don't assume the underlying representation when operating on strings, but write a template function which can operate on both, and branch on "has-latin1" condition (<code>JS::StringHasLatin1Chars</code> in the API)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Nov 02 2023 22:40:09 GMT-0700 (Pacific Daylight Time)">05:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">example in <a href="https://searchfox.org/mozilla-central/rev/99a9eed20cf195b8ff815604876b6fb73ca5ecd7/dom/bindings/BindingUtils.h#1385">BindingUtils.h</a></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Nov 02 2023 22:41:50 GMT-0700 (Pacific Daylight Time)">05:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Vaguely related: Does the case where a TwoByte has only Latin1 characters have to do with subslicing a TwoByte string that originally had non-Latin1 characters?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Nov 02 2023 22:45:08 GMT-0700 (Pacific Daylight Time)">05:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, it can create a JSDependentString that points the original TwoBytes string</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Nov 02 2023 22:45:30 GMT-0700 (Pacific Daylight Time)">05:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you have SpiderMonkey shell, you can use <code>dumpStringRepresentation</code> function to investigate the string representation</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Nov 02 2023 22:47:18 GMT-0700 (Pacific Daylight Time)">05:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">anyway, unless you can guarantee that the <code>atob</code> input always comes <em>directly</em> from the <code>btoa</code> (that always uses latin1), I'd suggest supporting both latin1 and twobytes as input for <code>atob</code></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Nov 02 2023 22:48:48 GMT-0700 (Pacific Daylight Time)">05:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I definitely will, I was mostly just checking if I needed to</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Nov 03 2023 09:37:47 GMT-0700 (Pacific Daylight Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the string creation functions will normally scan the string to check whether it's latin1, but there are "...DontDeflate" variants (eg <code>JS::NewStringCopyNDontDeflate</code> and <code>JS_NewUCStringDontDeflate</code>) that will always produce a TwoBytes string. So generally speaking, no you can't assume TwoByte strings are not latin1, not even if you ignore dependent strings.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Nov 03 2023 10:25:54 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">I assume <a href="https://searchfox.org/mozilla-central/rev/8acfbe4ba09b46b91c862dc2fbc064d4fc1bac9a/js/public/MapAndSet.h#62-63">https://searchfox.org/mozilla-central/rev/8acfbe4ba09b46b91c862dc2fbc064d4fc1bac9a/js/public/MapAndSet.h#62-63</a> sets rval to true if something was deleted?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Nov 03 2023 10:42:37 GMT-0700 (Pacific Daylight Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: yes</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Nov 03 2023 12:49:46 GMT-0700 (Pacific Daylight Time)">19:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell">I have a bit of a puzzle I am trying to figure out, relating to JSScript/Stencil initialization, if anyone would like to investigate - I'm not getting far myself.  The puzzle is basically that at a certain point we are observing that the filename associated with a ScriptSourceObject is mangled - it's been bit flipped probably due to faulty hardware.  But what we don't know if this is going to cause problems further down execution, or if at this point the filename is just a peice of metadata we're carrying around but not using for any real purpose. <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1859046#c2">https://bugzilla.mozilla.org/show_bug.cgi?id=1859046#c2</a></td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Nov 03 2023 14:30:42 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">tjr</span>: We do use the filename for things like the debugger, for error stacks in JS, etc. For some system js (which may be in your set of resource:// urls), there are cases where we fetch the source from the onmi.ja_ again and that would explode. So I guess there are a few cases were bad things will happen after that bit flip, but I don't believe we expect and immediate and spectacular demise of the process. If your question is essentially: "will failing on 'pesource://' urls cause more harm than allowing them?" then the answer is probably that process is better off being killed off</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Nov 03 2023 14:56:42 GMT-0700 (Pacific Daylight Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell">Hm.  I wish I had some idea about whether or not these users had a mostly functioning Firefox and it crashed occasionally; or if it basically never works for them, so no worries </td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Nov 03 2023 16:43:22 GMT-0700 (Pacific Daylight Time)">23:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Anyone knows what jsreftests are? What do they actually run, is it whole Gecko + Spidermonkey or just js shell or something?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Nov 03 2023 16:45:33 GMT-0700 (Pacific Daylight Time)">23:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">and in which process are those tests run?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Nov 03 2023 16:47:06 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to my understanding, jsreftest is <a href="https://searchfox.org/mozilla-central/source/js/src/tests">jstest</a> running on the reftest harness</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Nov 03 2023 16:47:58 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(maybe I'm wrong)</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Nov 03 2023 16:48:34 GMT-0700 (Pacific Daylight Time)">23:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">ah, based on a log that seems to be the case, thanks</td></tr>

</tbody></table></div></div></div>
</body></html>