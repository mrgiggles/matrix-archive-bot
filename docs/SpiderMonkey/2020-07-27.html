<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-07-27</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-07-27<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-07-26" class="nav-link"><span>prev</span></a>
<a href="2020-07-28" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Jul 26 2020 19:28:07 GMT-0700 (Pacific Daylight Time)">02:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: thank you for your help and patience, mission accomplished :)</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Jul 26 2020 19:28:11 GMT-0700 (Pacific Daylight Time)">02:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">congrats!</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jul 27 2020 07:08:50 GMT-0700 (Pacific Daylight Time)">14:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">avandolder</span>: <a href="https://docs.google.com/document/d/19UA2L1UDKOhrt7AO-CcKqTb1WZVRquCPYgMDPB8oHbY/edit?usp=sharing">https://docs.google.com/document/d/19UA2L1UDKOhrt7AO-CcKqTb1WZVRquCPYgMDPB8oHbY/edit?usp=sharing</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jul 27 2020 07:43:12 GMT-0700 (Pacific Daylight Time)">14:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">hey everyone!
another small question: during interrupt callback (i.e. JS_RequestInterruptCallback) is it possible to stop script execution of a specific realm? Usage scenario: slow/hanging script detection/suspension.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jul 27 2020 08:04:08 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">TheQwertiest</span>: it will simply stop the one which is currently running, the callback could check the stack to know which realm is on top of the stack and resume its execution if this is not the right one.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jul 27 2020 08:04:37 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">It does not have the capabilities of adding extra conditions on the interrupt.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jul 27 2020 08:16:59 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: I see, thanks for the info!</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jul 27 2020 08:17:52 GMT-0700 (Pacific Daylight Time)">15:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">given that a callstack can have frames from multiple realms, what would it mean to stop execution of a single realm?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jul 27 2020 08:21:24 GMT-0700 (Pacific Daylight Time)">15:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I have no idea, JS does not have a clear definition for what it means to stop the execution.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jul 27 2020 08:22:47 GMT-0700 (Pacific Daylight Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I guess the best you can have is uncatchable exceptions, in which case I wonder, are we still running finally code?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jul 27 2020 08:33:13 GMT-0700 (Pacific Daylight Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">no, <code>finally</code> gets skipped</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jul 27 2020 08:33:40 GMT-0700 (Pacific Daylight Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">It seems strange that we don't have a <code>throwUncatchableException()</code> test function</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jul 27 2020 08:34:32 GMT-0700 (Pacific Daylight Time)">15:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I can add one. I'm not sure whether it should be in <code>--fuzzing-safe</code>, though -- it might mess up the harnesses</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jul 27 2020 08:56:51 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ah! There already is one, it's just called <code>terminate</code></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jul 27 2020 11:01:34 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> What are the limits of data that can be accessed in a <code>finalize</code> handler? Say you had some data on another object that can be cleared when this object is deleted. Right now Debugger instances do a lot of this by having its own <code>DebugAPI::sweepAll</code>, and I'm curious if that is something that could be simplified or made to use fewer special-cased APIs.</blockquote></mx-reply><p>I want to revisit this question. Is the primary issue that you'd run the risk of accessing something that was already finalized? If the thing I want to access is a <code>JSScript</code> referenced by an object, are JSObject finalizers guaranteed to run before JSScript finalizers?</p>
<p>Basically what I'm curious about doing is <code>script-&gt;setHasDebugScript(nullptr);</code> when an object is finalized. Right now we do this via <code>DebugAPI::sweepAll</code> and as far as I can tell, <em>if</em> objects are finalized first, we could remove <code>sweepAll</code> in favor of some reference counting and running the logic from a finalizer. I don't have a good sense for whether the current <code>sweepAll</code> approach is desirable and consistent with other parts of SpiderMonkey, or whether the Debugger's <code>sweepAll</code> is kind of a weird thing that others would want to remove too.</p>
</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jul 27 2020 11:07:36 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Anyone who's worked on fields or function name-setting more recently than I have might be interested in bug 1655405.  I'm slightly rusty on function name setting, so I'm not sure if this is the <em>only</em> way we could hit this, or if this is an entirely new way of hitting this and we just want to relax the assertion in <code>js::SetFunctionName</code> and the assertion in <code>NameToFunctionName</code> to accommodate bigints.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jul 27 2020 11:07:43 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1655405">https://bugzil.la/1655405</a> — NEW (nobody) — Assertion failure: name.isString() || name.isSymbol() || name.isNumber(), at vm/JSFunction.cpp:2446 with Class and BigInt</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jul 27 2020 11:12:14 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: what is the state of WritableStreams + piping?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jul 27 2020 11:13:07 GMT-0700 (Pacific Daylight Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">loganfsmyth</span>: generally speaking, we've been trying to minimize the number of other things accessed in finalizers. It causes various problems. But in this particular example, foreground-finalized objects <em>are</em> guaranteed to be finalized before scripts. This is assuming they're in the same zone sweep group, which I suspect is enforced for Debuggee stuff already?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jul 27 2020 11:13:22 GMT-0700 (Pacific Daylight Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">this is very much <span class="nick-4">jonco</span> territory, though. I never get the ordering constraints right.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jul 27 2020 11:14:08 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">alright, got it</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jul 27 2020 11:14:37 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span> do you have any opinion on <code>DebugAPI::sweepAll</code> as an approach to handling cleanup of debugger objects, vs finalizers?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jul 27 2020 11:15:59 GMT-0700 (Pacific Daylight Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: I'm figuring out how to recognize/act on <code>AbortRequest</code> instances supplied by the embedding.  Right now I think I can <em>detect</em> them by having the embedding supply a <code>JSClass*</code> for it, similar to what we do for the embedding supplying a class for <code>Window</code> or maybe <code>WindowProxy</code>.  Still figuring how to do the "add an action" operation for it.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Jul 27 2020 11:16:15 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I just remember that <code>sweepAll</code> had various reasons for existing. It may be that enough of them have been eliminated at this point, that it could be reconsidered?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Jul 27 2020 11:16:44 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">there are various comments within <code>sweepAll</code> talking about why it needs to happen before finalization. Are they still valid?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Jul 27 2020 11:17:10 GMT-0700 (Pacific Daylight Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: okay strange. So these AbortRequests aren't implemented in SpiderMonkey?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Jul 27 2020 11:17:18 GMT-0700 (Pacific Daylight Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">inter-object finalization ordering is not guaranteed</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Jul 27 2020 11:18:40 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I've been tossing around ideas in my head, right now there's other stuff that would need to change too</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Jul 27 2020 11:18:49 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I've always somewhat blindly assumed that <code>Debugger</code> has enough weirdness that it will need <em>some</em> level of special-casing.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Jul 27 2020 11:18:57 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">The exact order of destroying the datastructures the debugger uses would have to be handled via refcounting instead of iterating WeakMaps in<code>sweepAll</code></td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Jul 27 2020 11:19:27 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: They are not, they're a DOM thing with all sorts of DOM dependencies.  I guess the shell will have to define a mockup class for them, to enable shell-based testing.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Jul 27 2020 11:19:52 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">the link out to JSScript and Realm for the <code>isDebuggee</code> and <code>hasDebugScript</code> flags are the main pieces I can see that require special handling</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Jul 27 2020 11:20:11 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">and Realm isn't a GCThing so at least toggling a flag on that during a finalizer seems workable</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Jul 27 2020 11:20:18 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">so the JSScript side is the main one I was unsure about</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Jul 27 2020 11:20:40 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the area I mostly run into is with weakmap marking, where <code>DebuggerWeakMap</code> is the only thing that has its keys in different zones than the map. Which means that if you're not collecting the map's zone but are collecting the key zone, you won't see the edge through the weakmap entry at all. (Everything else relies on the CCW map for this.)</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Jul 27 2020 11:20:40 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">assuming I'm understanding Realms right</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Jul 27 2020 11:21:16 GMT-0700 (Pacific Daylight Time)">18:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I think all of that could be simplified if I tried hard enough</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Jul 27 2020 11:21:45 GMT-0700 (Pacific Daylight Time)">18:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: for that SetFunctionName bug, this should be relevant: <a href="https://tc39.es/proposal-class-fields/#sec-setfunctionname">https://tc39.es/proposal-class-fields/#sec-setfunctionname</a></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Jul 27 2020 11:22:06 GMT-0700 (Pacific Daylight Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Realms aren't GC things, but they can be collected during GC, so you have to be somewhat careful.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Jul 27 2020 11:22:16 GMT-0700 (Pacific Daylight Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">actually no, I wonder where bigint is converted to string or something like that</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Jul 27 2020 11:22:23 GMT-0700 (Pacific Daylight Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(in fact, we have a <code>Rooted&lt;Realm*&gt;</code> instantiation)</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Jul 27 2020 11:23:10 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Can a Realm be destroyed during JSObject* finalization?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Jul 27 2020 11:23:37 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I thought I had vaguely remembered <code>var obj = { 2n: function() {} };</code> as setting a function name, but maybe that's just our un-visible extension for debugging and such.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Jul 27 2020 11:23:49 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">no. Or at least, that would seem very unlikely to me. A Realm only dies when it's empty. Lemme look up where they are swept...</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Jul 27 2020 11:23:55 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Maybe class fields <em>are</em> the first place where bigints can be the name of a function.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Jul 27 2020 11:24:05 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">(at least one set dynamically)</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon Jul 27 2020 11:25:51 GMT-0700 (Pacific Daylight Time)">18:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ok, you're safe there. Realms are deleted during <code>sweepZones</code>, which only happens after all finalization (foreground and background) is complete.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon Jul 27 2020 11:26:10 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: I think the spec treats bigint literals like numeric literal, so it should be a string per spec?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon Jul 27 2020 11:26:21 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><a href="https://tc39.es/ecma262/#sec-object-initializer-static-semantics-propname">https://tc39.es/ecma262/#sec-object-initializer-static-semantics-propname</a></td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon Jul 27 2020 11:26:59 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: perfect</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon Jul 27 2020 11:27:34 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Yeah, I meant the input to determining function name could be bigint.</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon Jul 27 2020 11:28:42 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and <code>DebugAPI::findSweepGroupEdges</code> ensures that debuggees are debuggers are swept in the same group, so it looks to me like you can rely on foreground object finalization happening before script finalization.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon Jul 27 2020 11:29:11 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the relevant objects being finalized here are <code>Debugger.Object</code>s or <code>Debugger.Script</code>s, I hope, not arbitrary objects?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon Jul 27 2020 11:29:25 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(because arbitrary objects might not be finalized at all, or be finalized in the background)</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon Jul 27 2020 11:31:07 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">this entire exploration started on my side by wanting to try to use normal CCWs so that the Debugger objects wouldn't need the sweepGroup or special WeakMap logic</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon Jul 27 2020 11:31:51 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">so in this case, my question from earlier is basically, if I tried to introduce a DebugScriptObject to act as a debuggee-realm wrapper around JSScript, could it clear its <code>hasDebugScript</code> flag when the object is finalized</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon Jul 27 2020 11:32:04 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Hrm, this spec looks like it doesn't canonicalize numbers or bigints into strings before it sets an anonymous function's name in that bug's syntax, i.e. this is a spec bug.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon Jul 27 2020 11:32:22 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">then Debugger.Script could just have a CCW referencing the <code>DebugScriptObject</code></td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon Jul 27 2020 11:32:52 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: I couldn't actually figure out where the actual relevant SetFunctionName call happens</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon Jul 27 2020 11:33:11 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ah! Ok. That resolves all of my concerns. Though there's probably lots I'm not thinking of.</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon Jul 27 2020 11:33:59 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I think it's a great idea. Whether it'll work, I can't say with any confidence. ;-)</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon Jul 27 2020 11:34:04 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Via leaps of faith, I think it's probably <a href="https://tc39.es/proposal-class-fields/#sec-define-field">https://tc39.es/proposal-class-fields/#sec-define-field</a> where <code>fieldRecord.[[Name]]</code> is the result of evaluating the field name -- and so a number or bigint is going to be there having that type, not string.</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon Jul 27 2020 11:34:17 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I could have cheated too hard to reach that conclusion, but it doesn't seem too likely.</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon Jul 27 2020 11:34:29 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I agree that it would be wonderful to remove this special-casing.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon Jul 27 2020 11:35:24 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I think all this would also let me get rid of <a href="https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/js/src/vm/Runtime.h#506">https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/js/src/vm/Runtime.h#506</a> which I'd love</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Mon Jul 27 2020 11:35:53 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">So [[Name]] is probably set here <a href="https://tc39.es/proposal-class-fields/#runtime-semantics-class-field-definition-evaluation">https://tc39.es/proposal-class-fields/#runtime-semantics-class-field-definition-evaluation</a></td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Mon Jul 27 2020 11:36:10 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I think you are right, this doesn't use the "string" interpretation</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Mon Jul 27 2020 11:37:03 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">tcampbell|pto</span> was grumbling about scripts requiring foreground finalization just for things like code coverage and the debugger (and maybe one other?). But I wouldn't worry about that.</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Mon Jul 27 2020 11:38:07 GMT-0700 (Pacific Daylight Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I have not dug into coverage data yet, but it's possible that stuff could end up stored the same way I'd ideally want to handle the debugger data</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Mon Jul 27 2020 11:38:58 GMT-0700 (Pacific Daylight Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">doesn't your scheme rely on scripts remaining foreground finalized?</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Mon Jul 27 2020 11:39:50 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I don't think I have a good grasp on why they are foreground right now, I'll have to look into that</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Mon Jul 27 2020 11:41:26 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">seems like there's a list of reasons:  coverage, script counts, debugger, profiler, vtune, jit scripts</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Mon Jul 27 2020 11:42:15 GMT-0700 (Pacific Daylight Time)">18:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh, hm. Never mind, your scheme only needs the scripts to be finalized after your DebugScriptObjects. So it would be fine even if they were background finalized.</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Mon Jul 27 2020 11:42:27 GMT-0700 (Pacific Daylight Time)">18:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">oh yeah right now it has <a href="https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/js/src/vm/JSScript.cpp#629">https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/js/src/vm/JSScript.cpp#629</a> right now</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Mon Jul 27 2020 11:42:37 GMT-0700 (Pacific Daylight Time)">18:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I think I'd end up removing that</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Mon Jul 27 2020 11:42:46 GMT-0700 (Pacific Daylight Time)">18:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">right</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Mon Jul 27 2020 11:42:59 GMT-0700 (Pacific Daylight Time)">18:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">so you'd actually make it easier to stop foreground finalizing them</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Mon Jul 27 2020 11:43:09 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">sounds like</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Mon Jul 27 2020 11:47:03 GMT-0700 (Pacific Daylight Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Filed <a href="https://github.com/tc39/proposal-class-fields/issues/314">https://github.com/tc39/proposal-class-fields/issues/314</a> for the general concern.</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Mon Jul 27 2020 12:43:50 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Or, I just misread, and we can change a couple asserts and be done with it.</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Mon Jul 27 2020 12:58:28 GMT-0700 (Pacific Daylight Time)">19:58</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span></div></td><td class="msg-cell">mutters about tests</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Mon Jul 27 2020 12:59:00 GMT-0700 (Pacific Daylight Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">How is there not an upstream test for this already 😕</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Mon Jul 27 2020 13:00:12 GMT-0700 (Pacific Daylight Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Are there tests for fields?</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Mon Jul 27 2020 13:00:48 GMT-0700 (Pacific Daylight Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">¯_(ツ)_/¯</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Mon Jul 27 2020 13:01:04 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">If there's a proposal implemented in multiple engines, surely there are tests too...</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Mon Jul 27 2020 13:30:04 GMT-0700 (Pacific Daylight Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@avandolder:mozilla.org">avandolder</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-6">jorendorff</span>: from what I can tell, the function which emits field initializers into a constructor, <code>emitInitializeInstanceFields</code>, has no context of the current class being emitted, and only knows length of the <code>.initializers</code> array. So if I want to insert bytecode to stamp the private methods in a similar way, i think I either need to either</p>
<ul>
<li>pass all the information (names and index they correspond to) about the private methods on the class through a bunch of layers</li>
<li>store the information on the <code>BytecodeEmitter</code> directly</li>
<li>or, and I'm not sure if this is really possible, store the code to stamp a private method inside a lambda in <code>.initializers</code>, and let <code>emitInitializeInstanceFields</code> emit the same bytecode for them as it already does for fields</li>
</ul>
</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Mon Jul 27 2020 14:03:20 GMT-0700 (Pacific Daylight Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ok, what does it mean when a page has 600-800MB each of Call, Array, Function, and Object objects? (And nothing else that is remotely as large.) Are those closures piling up?</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Mon Jul 27 2020 14:05:51 GMT-0700 (Pacific Daylight Time)">21:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I need to find some good victim to needinfo. (This is bug 1653088.)</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Mon Jul 27 2020 14:05:54 GMT-0700 (Pacific Daylight Time)">21:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1653088">https://bugzil.la/1653088</a> — NEW (nobody) — Performance issue on <a href="http://voice.google.com">voice.google.com</a> - Site can hang from seconds to minutes</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Mon Jul 27 2020 14:06:12 GMT-0700 (Pacific Daylight Time)">21:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">they're all live, fwiw</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Mon Jul 27 2020 14:09:19 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">sometime between ESR68 and ESR78 it became impossible to use <code>JS_DefineProperties()</code> on an object whose JSClass has a resolve operation, was that intentional?</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Mon Jul 27 2020 14:09:57 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">(you can no longer add <code>JSPROP_RESOLVING</code> to a JSPropertySpec because the flags field is private, and it asserts if you try to construct it with that flag)</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Mon Jul 27 2020 14:17:47 GMT-0700 (Pacific Daylight Time)">21:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it looks like <code>JSPROP_RESOLVING</code> is supposed to only be an internal recursion avoidance mechanism. Does anything break if you just don't pass it?</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Mon Jul 27 2020 14:19:53 GMT-0700 (Pacific Daylight Time)">21:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">hm, the MDN page says hooks must pass it. Is your <code>JS_DefineProperties</code> call within a hook?</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Mon Jul 27 2020 14:22:12 GMT-0700 (Pacific Daylight Time)">21:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">I haven't recently tried, but back when I added that code it would go into an infinite loop if I didn't pass <code>JSPROP_RESOLVING</code>. I can check if it still does that :-)</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Mon Jul 27 2020 14:22:41 GMT-0700 (Pacific Daylight Time)">21:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it kinda looks like it's still required, but only when your invocation is from within the hook</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Mon Jul 27 2020 14:23:15 GMT-0700 (Pacific Daylight Time)">21:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">I'll check that and get back to you</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Mon Jul 27 2020 14:30:11 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: at least in esr68, it's still required when defining properties outside the hook, if your resolve hook might try to access one of the properties that you're pre-defining.</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Mon Jul 27 2020 14:30:57 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">it looks like I can remove <code>JSPROP_RESOLVING</code> from this particular <code>JS_DefineProperties()</code> call with no ill effects, but I'm a bit nervous about that since it leaves an evil trap lurking for future changes</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Mon Jul 27 2020 14:31:34 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">bleh. Yeah, seems painful.</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Mon Jul 27 2020 14:34:49 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: queued some patches for landing (which land right at my EOD of course :P) Quite happy with some recent design improvements. </td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Mon Jul 27 2020 14:34:52 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Mon Jul 27 2020 14:52:13 GMT-0700 (Pacific Daylight Time)">21:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">Is making the assumption that all ParseTasks which start on some runtime stay with that runtime until the end?  I.e. I can carry a JSRumtime* on the ParseTask and reliably use it for all operations related to that task?</td></tr>

</tbody></table></div></div></div>
</body></html>