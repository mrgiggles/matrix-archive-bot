<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-07-19</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-07-19<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-07-18" class="nav-link"><span>prev</span></a>
<a href="2023-07-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Jul 19 2023 02:51:18 GMT-0700 (Pacific Daylight Time)">09:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">For structured cloning, there is a spec but does it define the data format or are we free to use whatever clever representation we like?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Jul 19 2023 02:59:49 GMT-0700 (Pacific Daylight Time)">09:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">in general web specs describe how things should behave, not how they are to be implemented. as long as the observable behaviour matches the spec it's fine</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Jul 19 2023 03:00:21 GMT-0700 (Pacific Daylight Time)">10:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">(that's the theory -- bad implementations and incomplete specs and bugs that the web rely on exist)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Jul 19 2023 03:01:22 GMT-0700 (Pacific Daylight Time)">10:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">e.g. if the spec says "copy xxx and yyy" and you implement it with copy-on-write because that saves a lot of time in the common case, it's valid</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Jul 19 2023 04:19:21 GMT-0700 (Pacific Daylight Time)">11:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for structured cloning we also need to be able to read data from older versions, so we also try to make it easy to extend later</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jul 19 2023 06:33:39 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'm wondering whether we can avoid repeatedly serialising the same property name strings over and over</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jul 19 2023 07:31:07 GMT-0700 (Pacific Daylight Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">good point, that'd be nice to optimize</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jul 19 2023 08:13:58 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><h1>Context</h1>
<p>JSContext were introduced in HelperThread as a way to handle Parsing in additional threads named Helpers. The content produced by these threads were produced in their own zones which were then merged back into the zone of the requester.</p>
<p>Work had been done on the GC side the remove the zone merging, and Stencil ground work challenged the fact that the Parser required the GC, but the parsers still remained dependent on having a JSContext around.</p>
<h1>What changed?</h1>
<p>Lately, with the work from Bryan and Arai, with the introduction of the FrontendContext and the removal of the JSContext from HelperThread Task, we now have plenty of tasks which are able to run out of the main thread, and even without a JSContext / JSRuntime around.</p>
<h1>What are the implications?</h1>
<p>This first thing is that this simplifies the JSContext, which no longer has to check whether it can access the JSRuntime, or whether it is called on the Main thread or not.</p>
<p>In addition, our parsing tasks, delazification tasks, compilations tasks are now future proof candidates for moving to a different threading mechanism. In sight, Gecko's TaskController.<br>While the TaskController is still young, being rooted in Gecko offer appealing prospects, such as a better thread scheduling policy and the ability to put some tasks on hold to schedule more urgent tasks.<br>Interrupting tasks temporarily can have multiple benefits, such as in cases of long compilation, delazifications or even maybe enable some form of streaming parsing.</p>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jul 19 2023 10:51:56 GMT-0700 (Pacific Daylight Time)">17:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> For structured cloning, there is a spec but does it define the data format or are we free to use whatever clever representation we like?</blockquote></mx-reply>To add to what padenot and jandem said:</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jul 19 2023 10:52:08 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><ul>
<li>we must maintain backward compatibility of the forStorage formats (scope==DifferentProcess in the code)</li>
</ul>
</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jul 19 2023 10:52:22 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><ul>
<li>we must follow exact sequence of operations in the spec. <code>var x; x = {a: 1, get b() { x.c = 2; delete x.a; return 3; }}</code> has to end up with <code>{a: 1, b: 3}</code></li>
</ul>
</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jul 19 2023 10:52:45 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><ul>
<li>not everything is forStorage. We could consider a very different format for things that never need to be boiled down to a sequence of bytes.</li>
</ul>
</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jul 19 2023 10:53:09 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">There is a lot of flexibility within those constraints. Backwards compatibility can be a bit painful, we don't want to embed too much of our current data representations. (Though I'm somewhat tempted to serialize Shapes to optimize object representations.)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jul 19 2023 11:16:38 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">chromium bug for a JIT zero day from April is public now which might be interesting to read over. <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1432210">https://bugs.chromium.org/p/chromium/issues/detail?id=1432210</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jul 19 2023 11:19:49 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>We can probably fix this by breaking the JS spec</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jul 19 2023 12:00:41 GMT-0700 (Pacific Daylight Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: Do you happen to know why 16 is the maximum number of fixed slots in an object?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jul 19 2023 12:02:04 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">when the High Priest of Zogthwump bequeathed the Spider Reliquary of Monkeys to the original disciples, he... uh, never mind. No, I don't.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jul 19 2023 12:03:24 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I guess not a lot of those objects fit into a 4KB page, so maybe that was getting close to a point of diminishing returns?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jul 19 2023 12:03:57 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">4KB arena, I guess is what I mean</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jul 19 2023 12:06:36 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><code>4096 / sizeof(JSObject_Slots16)</code> is 28</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jul 19 2023 12:08:24 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(there's a 40 byte header too, but that doesn't change the <code>28</code>)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jul 19 2023 12:32:16 GMT-0700 (Pacific Daylight Time)">19:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: Hypothetically speaking, if we wanted to allocate objects with more fixed slots (maybe in a special dynamically sized arena, instead of adding <code>JSObjects_Slots32/64/128/etc</code>), what fraction of the GC would immediately explode?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jul 19 2023 12:33:02 GMT-0700 (Pacific Daylight Time)">19:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">("4096 / sizeof(JSObject_Slots16) is 28" is a very believable explanation, btw)</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jul 19 2023 12:33:34 GMT-0700 (Pacific Daylight Time)">19:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I've already noticed that shapes can't represent objects with more than <a href="https://searchfox.org/mozilla-central/source/js/src/vm/Shape.h#337">31 fixed slots</a></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jul 19 2023 12:36:54 GMT-0700 (Pacific Daylight Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Hm. We use masking to get to an Arena header, but that would still work because it's a header. I think there are some Arena-granularity bitmaps in the chunk header or footer that would need to be reworked. I believe there are some constexprs that use ArenaSize to calculate things, which could get tricky. The definitions are already somewhat recursive, like the number of arenas in a chunk depends on the space available after subtracting the size of the bitmaps, that depend on the number of arenas in a chunk.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jul 19 2023 12:39:34 GMT-0700 (Pacific Daylight Time)">19:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">there's an <code>ArenasPerPage</code> that is used in the memory management stuff, which wouldn't work very well if the answer were 1/4 or whatever.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jul 19 2023 12:40:09 GMT-0700 (Pacific Daylight Time)">19:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">though perhaps we ought to be using 64KB pages everywhere in the first place...</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jul 19 2023 12:40:48 GMT-0700 (Pacific Daylight Time)">19:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Does everything in the GC currently use 4K chunks?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jul 19 2023 12:41:37 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(we have something called a "chunk" which is 1MB, btw)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jul 19 2023 12:42:52 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I think so? On OSX, I think the system page size is 64KB iirc. <span class="nick-13">@allstarschh</span> did the work to support that, but I think it kind of fakes it to look like a bunch of 4KB pages. So it's not <em>really</em> 4KB at the base level.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Jul 19 2023 12:44:20 GMT-0700 (Pacific Daylight Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I may be mixing up platforms.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Jul 19 2023 12:45:38 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">Hey, I was trying to reuse a property descriptor to define multiple property aliases, so basically I was doing <code>JS_GetOwnPropertyDescriptorById</code> to get the property that was already defined and then use that descriptor to re-define a new one via <code>JS_DefinePropertyById</code>... However, while the property seems to be defined the getters and setters are defintely not being considered... Is this somehting not supported?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Jul 19 2023 12:48:11 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">so basically this snippet <a href="https://www.pastery.net/mrepkm/">https://www.pastery.net/mrepkm/</a></td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Jul 19 2023 12:48:25 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Bleh, I was a ways off. <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1660006">https://bugzilla.mozilla.org/show_bug.cgi?id=1660006</a> is about 16KB pages on OSX on ARM64.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Jul 19 2023 12:48:49 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that's where <code>ArenasPerPage</code> appeared.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Jul 19 2023 12:58:32 GMT-0700 (Pacific Daylight Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">same reusing just the getters/setters as per <code>JS_DefinePropertyById(cx, obj, id, rooted_desc.getter(), rooted_desc.setter(), flags);</code></td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Jul 19 2023 12:59:56 GMT-0700 (Pacific Daylight Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> same reusing just the getters/setters as per <code>JS_DefinePropertyById(cx, obj, id, rooted_desc.getter(), rooted_desc.setter(), flags);</code></blockquote></mx-reply>you should use the overload that takes  <code>JS::Handle&lt;JS::PropertyDescriptor&gt;</code> directly</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Jul 19 2023 13:00:35 GMT-0700 (Pacific Daylight Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">yes that's what I did (see the pasted snipped above) first</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Jul 19 2023 13:01:00 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">but for some reason setters/getters are not invoked</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Jul 19 2023 13:01:05 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">no?</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Jul 19 2023 13:01:19 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">nope</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Jul 19 2023 13:01:33 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/vm/PropertyAndElement.cpp#60">https://searchfox.org/mozilla-central/source/js/src/vm/PropertyAndElement.cpp#60</a></td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Jul 19 2023 13:01:42 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">are you trying to make an object where if you do <code>obj.name1 = 7</code>, you want <code>obj.name2</code> to evaluate to <code>7</code>? What do you mean by "property aliases"?</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Jul 19 2023 13:01:54 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">oh I see</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Jul 19 2023 13:02:56 GMT-0700 (Pacific Daylight Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">sfink: yeah, that... now for values that's basically the same I can imagine</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Jul 19 2023 13:03:41 GMT-0700 (Pacific Daylight Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">sfink: but when it comes to more complex properties, where I have getter/setter objects with added data, I wanted to try to reuse the ones I've instead of defininig multiple doing the same</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Jul 19 2023 13:05:42 GMT-0700 (Pacific Daylight Time)">20:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">SM doesn't allow multiple names for the same property store. I would expect the getter/setter ones to be easier, since they don't need to share a store.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Jul 19 2023 13:11:02 GMT-0700 (Pacific Daylight Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">sfink: I see, but then why reusing the desc setter/getter to create a property instead wouldn't work either?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Jul 19 2023 13:11:31 GMT-0700 (Pacific Daylight Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">no that should totally work</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Jul 19 2023 13:12:07 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">How do you know it doesn't work? Is the getter/setter not invoked?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Jul 19 2023 13:12:22 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">What is the result of Object.getOwnPropertyDescriptor on the copied prop?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Jul 19 2023 13:15:31 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">evilpie: oh, I check that... The setters/getters are c++ funcs eventually and well... I don't get that called. Also in this case the setter is calling a C library that should emit a signal and that doesn't come as soon I try this</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Jul 19 2023 13:15:42 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">Ideally I'd just like to do as <a href="https://www.pastery.net/bqgqnh/">https://www.pastery.net/bqgqnh/</a></td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Jul 19 2023 13:15:48 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">but from the c++ side..</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Jul 19 2023 13:16:06 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">actually just to be sure, what is your spidermonkey version?</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Jul 19 2023 13:19:24 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">102</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Jul 19 2023 15:11:22 GMT-0700 (Pacific Daylight Time)">22:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">evilpie: I found the issue, I wasn't marking the property as "resolved" -_-</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Jul 19 2023 16:39:51 GMT-0700 (Pacific Daylight Time)">23:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: so I've been looking at dynamic slots thing in v8 some more</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed Jul 19 2023 16:40:25 GMT-0700 (Pacific Daylight Time)">23:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: and the object that we're working with is not a regular JS object, but instead a FunctionContext</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed Jul 19 2023 16:40:36 GMT-0700 (Pacific Daylight Time)">23:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">are FunctionContext's resizable?</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed Jul 19 2023 16:41:46 GMT-0700 (Pacific Daylight Time)">23:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I don't know about FunctionContext, but if that's the same as our CallObject, I believe you can define new properties with <code>eval</code></td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Wed Jul 19 2023 16:42:18 GMT-0700 (Pacific Daylight Time)">23:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">It would be uncommon, though</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Wed Jul 19 2023 16:42:25 GMT-0700 (Pacific Daylight Time)">23:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">can you give an example of how to do that?</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Wed Jul 19 2023 16:44:13 GMT-0700 (Pacific Daylight Time)">23:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">it seems like this talking about that kind of thing: <a href="https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:v8/src/objects/contexts.h;l=474;drc=a328097ef1d47f51e76917b80110863037f4f744">https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:v8/src/objects/contexts.h;l=474;drc=a328097ef1d47f51e76917b80110863037f4f744</a></td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Wed Jul 19 2023 16:46:34 GMT-0700 (Pacific Daylight Time)">23:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-14">jrmuizel</span>: I think something like</p>
<pre><code>var x = 1;
function foo(s) {eval(s); return () =&gt; print(x); }
foo("var x = 2")()
</code></pre>
<p>might do it, although I haven't popped it open in a debugger to verify</p>
</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Wed Jul 19 2023 16:47:25 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">We also have a bunch of code to handle the ability of the debugger to evaluate an arbitrary expression in an arbitrary stack frame</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Wed Jul 19 2023 16:47:36 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">None of these paths is hot, though</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Wed Jul 19 2023 16:48:36 GMT-0700 (Pacific Daylight Time)">23:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Call objects and other environment objects are generally going to have a fixed size</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Wed Jul 19 2023 16:48:55 GMT-0700 (Pacific Daylight Time)">23:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The problem is that the GC is not set up to allocate arbitrarily large fixed-size objects</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Wed Jul 19 2023 16:50:11 GMT-0700 (Pacific Daylight Time)">23:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">What do we do for arrays?</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Wed Jul 19 2023 16:50:27 GMT-0700 (Pacific Daylight Time)">23:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">We allocate an out-of-line elements array</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Wed Jul 19 2023 16:50:46 GMT-0700 (Pacific Daylight Time)">23:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">I guess that makes sense</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Wed Jul 19 2023 16:51:00 GMT-0700 (Pacific Daylight Time)">23:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(By "arbitrarily large fixed size objects" I mean "arbitrarily large fixed size objects where all the data is stored inline")</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Wed Jul 19 2023 16:52:02 GMT-0700 (Pacific Daylight Time)">23:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Wed Jul 19 2023 16:59:34 GMT-0700 (Pacific Daylight Time)">23:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell"><code>JS_EncodeStringToUTF8</code> is deprecated, but I can't find any proper replacement for it... Any suggestion? Like alternative implies allocation from the caller iirc.</td></tr>

</tbody></table></div></div></div>
</body></html>