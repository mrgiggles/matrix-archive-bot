<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-08-06</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-08-06<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-08-05" class="nav-link"><span>prev</span></a>
<a href="2022-08-07" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Aug 05 2022 20:16:03 GMT-0700 (Pacific Daylight Time)">03:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><p>when I try to submit a new patch the phabricator had an older one and prevents me from submitting the new one.</p>
<pre><code class="language-Phabricator">  - You can not request review of this revision because it has already been closed. You can only request review of open revisions.```
</code></pre>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Aug 05 2022 20:16:59 GMT-0700 (Pacific Daylight Time)">03:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Mohamed Atef</span>: by default, <code>moz-phab</code> submits all changesets between mozilla-central and your tip</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Aug 05 2022 20:17:59 GMT-0700 (Pacific Daylight Time)">03:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: the patch works fine<br>but this assertion fails when I run the tests: <a href="https://searchfox.org/mozilla-central/rev/d28f7751c47d75699c6ab1afd4852ad84ebb7399/js/src/frontend/ParseNode.h#826">https://searchfox.org/mozilla-central/rev/d28f7751c47d75699c6ab1afd4852ad84ebb7399/js/src/frontend/ParseNode.h#826</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Aug 05 2022 20:18:01 GMT-0700 (Pacific Daylight Time)">03:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in general, it's better updating to mozilla-central before starting working on new bug</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Aug 05 2022 20:18:31 GMT-0700 (Pacific Daylight Time)">03:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you've already created new changeset, then you can rebase it onto central</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Aug 05 2022 20:18:42 GMT-0700 (Pacific Daylight Time)">03:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://www.mercurial-scm.org/wiki/RebaseExtension">https://www.mercurial-scm.org/wiki/RebaseExtension</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Aug 05 2022 20:19:25 GMT-0700 (Pacific Daylight Time)">03:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Mohamed Atef</span>: what's the backtrace for the assertion failure?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Aug 05 2022 20:20:39 GMT-0700 (Pacific Daylight Time)">03:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">Assertion failure: NodeType::test(<em>this), at /home/mohamed/Desktop/mozilla-unified/js/src/frontend/ParseNode.h:826<br>#01: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ef20cf]<br>#02: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ef59c5]<br>#03: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ed9fbb]<br>#04: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1edfe8a]<br>#05: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ee3e74]<br>#06: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ee3ad2]<br>#07: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ed99e0]<br>#08: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1eeb5ef]<br>#09: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ed9d71]<br>#10: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1edd251]<br>#11: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1f07674]<br>#12: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ef8089]<br>#13: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1ecdc4b]<br>#14: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x18ba890]<br>#15: JS::CompileUtf8File(JSContext</em>, JS::ReadOnlyCompileOptions const&amp;, _IO_FILE*)[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x18bb8a4]<br>#16: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1687c29]<br>#17: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1687562]<br>#18: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1649eae]<br>#19: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1643fd4]<br>#20: ???[/lib/x86_64-linux-gnu/<a href="http://libc.so">libc.so</a>.6 +0x29d90]<br>#21: __libc_start_main[/lib/x86_64-linux-gnu/<a href="http://libc.so">libc.so</a>.6 +0x29e40]<br>#22: ???[/home/mohamed/Desktop/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js +0x1638989]<br>#23: ??? (???:???)<br>Exit code: -11<br>FAIL - 1659595.js</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Aug 05 2022 20:21:48 GMT-0700 (Pacific Daylight Time)">03:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Can you run it in debugger?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Aug 05 2022 20:21:56 GMT-0700 (Pacific Daylight Time)">03:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Aug 05 2022 20:21:59 GMT-0700 (Pacific Daylight Time)">03:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">which test fails?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Aug 05 2022 20:22:08 GMT-0700 (Pacific Daylight Time)">03:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the test has command-line option to run it under debugger</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Aug 05 2022 20:22:40 GMT-0700 (Pacific Daylight Time)">03:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">Is there any docs about debugging spidermonkey?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Aug 05 2022 20:23:46 GMT-0700 (Pacific Daylight Time)">03:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm not sure if there's any up-to-date one</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Aug 05 2022 20:25:04 GMT-0700 (Pacific Daylight Time)">03:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">should I check this assertion in the computed names too</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Aug 05 2022 20:25:06 GMT-0700 (Pacific Daylight Time)">03:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/4a15041348e08fb0d6f5726015c32861e663fbfe/js/src/frontend/BytecodeEmitter.cpp#8874">https://searchfox.org/mozilla-central/rev/4a15041348e08fb0d6f5726015c32861e663fbfe/js/src/frontend/BytecodeEmitter.cpp#8874</a></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Aug 05 2022 20:26:14 GMT-0700 (Pacific Daylight Time)">03:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you're running <code>./mach jstests</code> or <code>./mach jit-test</code>, you can pass <code>--debugger DEBUGGER_NAME</code> parameter to run test in debugger</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Aug 05 2022 20:32:20 GMT-0700 (Pacific Daylight Time)">03:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><del>about the <code>accessorType</code> assertion, I think it must be moved to <code>if (propVal-&gt;isDirectRHSAnonFunction()) {</code>'s block</del></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Aug 05 2022 20:33:03 GMT-0700 (Pacific Daylight Time)">03:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">err, maybe I'm wrong</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Aug 05 2022 20:49:38 GMT-0700 (Pacific Daylight Time)">03:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">it fails.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Aug 05 2022 20:50:09 GMT-0700 (Pacific Daylight Time)">03:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">should I upload the patch,so you can comment there?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Aug 05 2022 20:50:44 GMT-0700 (Pacific Daylight Time)">03:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, please upload it</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Aug 05 2022 20:55:22 GMT-0700 (Pacific Daylight Time)">03:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, the assertion about <code>accessorType</code> is the following. it's inside <code>propVal-&gt;isDirectRHSAnonFunction()</code> condition, it means the value is anonymous function at that point.  if the property key is either number or string, and the property is one of method definition or getter or setter, the function already has name.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Aug 05 2022 20:56:05 GMT-0700 (Pacific Daylight Time)">03:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">e.g. <code>({ foo() {} })</code></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Aug 05 2022 20:56:25 GMT-0700 (Pacific Daylight Time)">03:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, if it's still anonymous function, it means the property is <code>foo: function() {}</code> style</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Aug 05 2022 20:56:38 GMT-0700 (Pacific Daylight Time)">03:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and it's not getter or setter</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Aug 05 2022 20:57:30 GMT-0700 (Pacific Daylight Time)">03:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Then, for <code>ComputedName</code> and <code>BigIntExpr</code> cases, we don't set the function's name at compile-time, and even if it's method or getter/setter, the function is still anonymous</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Aug 05 2022 20:58:46 GMT-0700 (Pacific Daylight Time)">03:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Then, whether to assert <code>accessorType</code> there depends on what the patch does for method/getter/setter cases</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Sat Aug 06 2022 09:55:02 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><a href="https://phabricator.services.mozilla.com/D153889">https://phabricator.services.mozilla.com/D153889</a></td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Sat Aug 06 2022 09:55:28 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">it fails in this test: dis(() =&gt; ({ [10]: function() {} }));</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Sat Aug 06 2022 09:55:45 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">I couldn't find the reason</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Sat Aug 06 2022 09:56:00 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">let me look into it</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Sat Aug 06 2022 09:56:17 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">have you got assertion failure?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Sat Aug 06 2022 09:58:29 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-8">Mohamed Atef</span>: so, it fails here <a href="https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/ParseNode.h#826">https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/ParseNode.h#826</a></p>
<pre><code class="language-cpp">MOZ_ASSERT(NodeType::test(*this));
</code></pre>
</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Sat Aug 06 2022 09:59:51 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>in this line <a href="https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/BytecodeEmitter.cpp#9209">https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/BytecodeEmitter.cpp#9209</a></p>
<pre><code class="language-cpp">double numValue = key-&gt;as&lt;NumericLiteral&gt;().value();
</code></pre>
</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Sat Aug 06 2022 10:01:58 GMT-0700 (Pacific Daylight Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it's inside <code>BytecodeEmitter::emitPropertyListObjLiteral</code> function, that's for emitting object literal where the set of properties is statically known</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Sat Aug 06 2022 10:04:34 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><a href="https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/BytecodeEmitter.cpp#10043-10044,10049,10067">https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/BytecodeEmitter.cpp#10043-10044,10049,10067</a></p>
<pre><code class="language-cpp">isPropertyListObjLiteralCompatible(objNode, &amp;useObjLiteralValues,
                                   &amp;useObjLiteral);
...
if (useObjLiteral) {
...
  if (!emitPropertyListObjLiteral(objNode, op, useObjLiteralValues)) {
</code></pre>
</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Sat Aug 06 2022 10:05:47 GMT-0700 (Pacific Daylight Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, the patch modifies <code>isPropertyListObjLiteralCompatible</code></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Sat Aug 06 2022 10:06:30 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and it now returns <code>useObjLiteral=true</code> for computed property</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Sat Aug 06 2022 10:09:58 GMT-0700 (Pacific Daylight Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">object literal is emitted in 3 ways, for optimization purpose.  The most unoptimized case is <code>JSOp::NewInit</code> (create empty object) +<code>JSOp::InitElem</code> (define property) for each.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Sat Aug 06 2022 10:11:50 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the set of properties is statically known, it uses <code>JSOp::NewObject</code> instead of <code>JSOp::NewInit</code>.  This way the newly created object already has <a href="https://searchfox.org/mozilla-central/source/js/src/vm/Shape.h#44">"shape"</a> for the known properties, and access is optimized</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Sat Aug 06 2022 10:13:09 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> It should be sufficient to support promises and implement the normal module hooks defined in js/public/Modules.h. JS::ModuleEvaluate now returns a promise.</blockquote></mx-reply>sorry, did not notice your reply. Does this apply to esr91 as well?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Sat Aug 06 2022 10:14:25 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, if the object literal is singleton, that means, if the code is executed only once (e.g. it's at top-level script, outside of loop), and there's only one instance, it uses <code>JSOp::Object</code>, that pushes object with known property keys and values, and <code>JSOp::InitElem</code> is not used</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Sat Aug 06 2022 10:15:50 GMT-0700 (Pacific Daylight Time)">17:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>dis(() =&gt; ({ [x]: 10 }))</code> shows <code>NewInit</code> case, and <code>dis(() =&gt; ({ x: 10 }))</code> shows <code>NewObject</code> case</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Sat Aug 06 2022 10:16:10 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and <code>({x: 10}); dis();</code> shows <code>Object</code> case</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Sat Aug 06 2022 10:16:30 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(<code>dis()</code> without parameter shows bytecode for currently executed script</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Sat Aug 06 2022 10:17:22 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, before the patch, computed property case uses <code>NewInit</code>.  and after the patch, given <code>isPropertyListObjLiteralCompatible</code> returns <code>useObjLiteral=true</code>, it tries to use <code>NewObject</code></td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Sat Aug 06 2022 10:18:14 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and <code>NewObject</code> and <code>Object</code> is handled in <code>BytecodeEmitter::emitPropertyListObjLiteral</code> method, and the method also needs to support computed property case</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Sat Aug 06 2022 10:18:33 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Currently, the method assumes the property is either string or number</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Sat Aug 06 2022 10:18:42 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><a href="https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/BytecodeEmitter.cpp#9164-9165,9185,9189,9208-9209">https://searchfox.org/mozilla-central/rev/675d6b7b04c4a802493d29632ee45f6e036a5702/js/src/frontend/BytecodeEmitter.cpp#9164-9165,9185,9189,9208-9209</a></p>
<pre><code class="language-cpp">bool BytecodeEmitter::emitPropertyListObjLiteral(ListNode* obj, JSOp op,
                                                 bool useObjLiteralValues) {
...
  for (ParseNode* propdef : obj-&gt;contents()) {
...
    if (key-&gt;is&lt;NameNode&gt;()) {
...
    } else {
      double numValue = key-&gt;as&lt;NumericLiteral&gt;().value();
</code></pre>
</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Sat Aug 06 2022 10:18:56 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, the loop handles only <code>NameNode</code> and <code>NumericLiteral</code></td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Sat Aug 06 2022 10:19:04 GMT-0700 (Pacific Daylight Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and you need to add <code>ComputedName</code> branch</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Sat Aug 06 2022 10:27:24 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hm, I guess, the patch is touching 2 separate things.  supporting computed property for anonymous function name, and supporting computed property for object literal optimization</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Sat Aug 06 2022 10:28:04 GMT-0700 (Pacific Daylight Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it might be better splitting the patch into 2, for each, unless those 2 depends each other</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Sat Aug 06 2022 10:29:16 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Mohamed Atef</span>: does it pass if you revert the change to <code>IsDestructuringRestExclusionSetObjLiteralCompatible</code>, <code>BytecodeEmitter::emitDestructuringObjRestExclusionSet</code>, and <code>BytecodeEmitter::isPropertyListObjLiteralCompatible</code> ?</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Sat Aug 06 2022 10:29:55 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">I will check now.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Sat Aug 06 2022 10:30:42 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if it works, then it's better focusing to function name part in the first patch. and then work on the object literal part in followup bug</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Sat Aug 06 2022 10:43:51 GMT-0700 (Pacific Daylight Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">it works, Iuploaded It </td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Sat Aug 06 2022 10:43:58 GMT-0700 (Pacific Daylight Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><a href="https://phabricator.services.mozilla.com/D153889">https://phabricator.services.mozilla.com/D153889</a></td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Sat Aug 06 2022 10:44:16 GMT-0700 (Pacific Daylight Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">I left a comment // Should we assert here for accessorType == AccessorType::None</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Sat Aug 06 2022 10:44:36 GMT-0700 (Pacific Daylight Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, I'll review it.  meanwhile, can you try adding some testcases?</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Sat Aug 06 2022 10:44:48 GMT-0700 (Pacific Daylight Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to verify that function name is properly set</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Sat Aug 06 2022 10:47:29 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">you mean regression tests, or test it locally?</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Sat Aug 06 2022 10:48:48 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">test file, in js/src/tests/non262/Function</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Sat Aug 06 2022 10:51:15 GMT-0700 (Pacific Daylight Time)">17:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">here's example <a href="https://searchfox.org/mozilla-central/source/js/src/tests/non262/Function/configurable-length-builtins.js">https://searchfox.org/mozilla-central/source/js/src/tests/non262/Function/configurable-length-builtins.js</a></td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Sat Aug 06 2022 10:52:06 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://firefox-source-docs.mozilla.org/js/test.html">https://firefox-source-docs.mozilla.org/js/test.html</a></td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Sat Aug 06 2022 11:54:30 GMT-0700 (Pacific Daylight Time)">18:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Mohamed Atef</span>: posted comment. Good find about <code>accessorType</code> assertion.  it's actually important there</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Sat Aug 06 2022 12:10:43 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(and we should've had detailed comment for each step, when which case is supposed to be handled...)</td></tr>

</tbody></table></div></div></div>
</body></html>