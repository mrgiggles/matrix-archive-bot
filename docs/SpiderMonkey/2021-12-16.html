<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-12-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-12-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-12-15" class="nav-link"><span>prev</span></a>
<a href="2021-12-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Dec 15 2021 17:35:10 GMT-0800 (Pacific Standard Time)">01:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">So I have a crash where I call JS::UTF8CharsToNewTwoByteCharsZ is returning nullptr. How can I figure out what's going on?
The string passed in is fairly large but it's straight ASCII</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Dec 15 2021 19:45:52 GMT-0800 (Pacific Standard Time)">03:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell"><p>Actually I figured out what the issue was for myself: The dev wrote a test that uses <a href="https://google.com">https://google.com</a> as a dummy target to fetch from with libcurl.</p>
<p>As it turns out, <a href="http://google.com">google.com</a> is garbage: curl <a href="https://www.google.com">https://www.google.com</a> | iconv -f UTF-8 -o /dev/null<br>prints the error <strong>iconv: illegal input sequence at position 12466</strong></p>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Dec 15 2021 19:47:12 GMT-0800 (Pacific Standard Time)">03:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">It isn't even good UTF16: curl <a href="https://www.google.com">https://www.google.com</a> | iconv -f UTF-16 -o /dev/null<br>returns <strong>iconv: incomplete character or shift sequence at end of buffer</strong></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Dec 15 2021 20:09:47 GMT-0800 (Pacific Standard Time)">04:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">do we have testsuite that verifies an assertion failure happens for unexpected input?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Dec 15 2021 20:12:50 GMT-0800 (Pacific Standard Time)">04:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>:  in reference to garbage UTF-8?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Dec 15 2021 20:13:56 GMT-0800 (Pacific Standard Time)">04:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">I'm using JS78 as it happens. We're going to stick with that until we release the code</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Dec 15 2021 20:14:08 GMT-0800 (Pacific Standard Time)">04:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">err, it's different context, but it's also coincidentally about UTF-8 handling too</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Dec 15 2021 20:14:16 GMT-0800 (Pacific Standard Time)">04:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Haha</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Dec 15 2021 20:14:39 GMT-0800 (Pacific Standard Time)">04:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">yeah I don't know what the 'graceful' recovery from bad UTF-8 is.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Dec 15 2021 20:15:26 GMT-0800 (Pacific Standard Time)">04:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">As it happens our CGI segfaulted because it just assumed it could always convert text to UTF16 to pass into the SpiderMonkey interpreter environment.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Dec 15 2021 20:15:58 GMT-0800 (Pacific Standard Time)">04:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, some API assumes the input is valid UTF-8/UTF-16</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Dec 15 2021 20:16:29 GMT-0800 (Pacific Standard Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and I wanted to write a testcase that passing invalid sequence hits assertion failure</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Dec 15 2021 20:16:53 GMT-0800 (Pacific Standard Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Well I know a good source of garbage: <a href="https://www.google.com">https://www.google.com</a></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Dec 15 2021 20:17:00 GMT-0800 (Pacific Standard Time)">04:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">üòÅ</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Dec 15 2021 20:18:05 GMT-0800 (Pacific Standard Time)">04:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">I switched from using <strong>UTF8CharsToNewTwoByteCharsZ</strong> to <strong>LossyUTF8CharsToNewTwoByteCharsZ</strong></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Dec 15 2021 20:18:37 GMT-0800 (Pacific Standard Time)">04:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">because I'd rather have the web page look goofy in the browser than for the CGI to abort in mid-request.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Dec 15 2021 20:19:31 GMT-0800 (Pacific Standard Time)">04:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">It's actually really difficult to see when a site returns bad UTF8</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Dec 15 2021 20:22:34 GMT-0800 (Pacific Standard Time)">04:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, if the input sequence can contain invalid sequence, <code>LossyUTF8CharsToNewTwoByteCharsZ</code> would be the simplest option</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Dec 15 2021 20:23:59 GMT-0800 (Pacific Standard Time)">04:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there are more UTF-8 handling functions in mozilla/Utf8.h</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Dec 15 2021 20:25:07 GMT-0800 (Pacific Standard Time)">04:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">What's weird is that iconv barfs out on the output of <a href="http://google.com">google.com</a> but the only weird character I can see is a non-breaking space \240</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Dec 16 2021 01:39:05 GMT-0800 (Pacific Standard Time)">09:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell">Hi, Loongson Technology developed a new RISC ISA named LoongArch, and we have ported SpiderMonkey v97 to LoongArch64 platform, see <a href="https://discourse.mozilla.org/t/porting-spidermonkey-to-loongarch64/90292">Porting SpiderMonkey to LoongArch64</a>.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Dec 16 2021 02:39:56 GMT-0800 (Pacific Standard Time)">10:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><p>When I try to <code>moz-phab</code> submit a new patch I see an error that I have never seen before:</p>
<pre><code>Phabricator Error: array_walk_recursive() expects parameter 1 to be array, null given
</code></pre>
<p>Does anyone know what I might be doing wrong?</p>
</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Dec 16 2021 02:43:51 GMT-0800 (Pacific Standard Time)">10:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">nicolo-ribaudo</span> I haven't seen that.  people in <a href="https://matrix.to/#/#conduit:mozilla.org">#conduit:mozilla.org</a> would know better</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Dec 16 2021 03:37:16 GMT-0800 (Pacific Standard Time)">11:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell">LoongArch looks ... fairly interesting.  There are bounds checking instruction and bounds-checked loads and stores.  There are going to be some interesting problems with wasm because no alignment can be assumed with wasm memory accesses, but JS might benefit more easily.  Looking forward to seeing some code.  Bug 1746350 for those who want to follow along.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Dec 16 2021 03:37:17 GMT-0800 (Pacific Standard Time)">11:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1746350">https://bugzil.la/1746350</a> ‚Äî UNCONFIRMED (nobody) ‚Äî [meta] LoongArch64 support in SpiderMonkey</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Dec 16 2021 03:44:00 GMT-0800 (Pacific Standard Time)">11:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@mstange:mozilla.org">mstange</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> anyway, my initial impression is that it's feeling like a pretty major improvement. Is it expensive or something? Or do you need testimonials? I'm wondering why you're asking and what you'd like to get from us.</blockquote></mx-reply>Thank you! I'm mostly looking for testimonials. It is somewhat expensive (symbolication times for local builds are now always 10-20 seconds or so) but I'm not planning on turning it off unless people start to complain loudly. It's just that it was a lot of work to implement it, and I'm looking for ways to measure the benefits.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Dec 16 2021 03:59:39 GMT-0800 (Pacific Standard Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> LoongArch looks ... fairly interesting.  There are bounds checking instruction and bounds-checked loads and stores.  There are going to be some interesting problems with wasm because no alignment can be assumed with wasm memory accesses, but JS might benefit more easily.  Looking forward to seeing some code.  Bug 1746350 for those who want to follow along.</blockquote></mx-reply>I haven't use those bounds-checked loads and stores instructions yet. To reduce the work, LoongArch64 port is kind of based on mips64 and arm64 ports, so the implementation is not the best yet. I will submit it ASAP after some cleanup work.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Dec 16 2021 03:59:54 GMT-0800 (Pacific Standard Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell">sounds good!</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Dec 16 2021 04:39:37 GMT-0800 (Pacific Standard Time)">12:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">zjiaz</span>: Thanks for doing this work! Just getting it to work is a huge task.  I also recommend running the jsapi-tests, especially the callWithABI test case, which should verify that the most ABI calls generated by the JIT are working as expected.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Dec 16 2021 04:54:23 GMT-0800 (Pacific Standard Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell">Seem fine, got <code>Passed: ran 775 tests.</code>, one less than arm64, which is <code>testAssemblerBuffer_ARM64</code>.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Dec 16 2021 04:55:22 GMT-0800 (Pacific Standard Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell">Although I find that mips64 now have a failure.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Dec 16 2021 04:56:58 GMT-0800 (Pacific Standard Time)">12:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell">I will try to fix it.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Dec 16 2021 09:00:56 GMT-0800 (Pacific Standard Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">zjiaz</span>: so, uh, how do you pronounce "LoongArch64"?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Dec 16 2021 09:12:18 GMT-0800 (Pacific Standard Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">with a Loong O?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Dec 16 2021 09:34:25 GMT-0800 (Pacific Standard Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: if you want a real answer, <a href="https://translate.google.com/?sl=auto&amp;tl=zh-CN&amp;text=dragon&amp;op=translate">https://translate.google.com/?sl=auto&amp;tl=zh-CN&amp;text=dragon&amp;op=translate</a></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Dec 16 2021 09:41:35 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">thanks, I actually was curious</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Dec 16 2021 09:45:29 GMT-0800 (Pacific Standard Time)">17:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: can I have your input for <a href="https://phabricator.services.mozilla.com/D133619#4350943">https://phabricator.services.mozilla.com/D133619#4350943</a> ?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Dec 16 2021 09:46:29 GMT-0800 (Pacific Standard Time)">17:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">are you going to use <code>AutoSuppressNurseryCellAlloc</code> ?  if not, the remaining consumer is testcase only, and I'm thinking about removing it (if I can come up with other way to test the same thing without it)</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Dec 16 2021 09:47:57 GMT-0800 (Pacific Standard Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: replied. I'm ok with removing it.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Dec 16 2021 09:48:02 GMT-0800 (Pacific Standard Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thank you :)</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Dec 16 2021 11:08:40 GMT-0800 (Pacific Standard Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span><span class="nick-10">jandem</span> All the new uploads to the R&amp;T stack are because I removed Boxes after the feedback at yesterday's tc39 meeting (removed part 10 + the box usages in the next commits)</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Dec 16 2021 11:52:33 GMT-0800 (Pacific Standard Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: I have to run for a few hours, but to save me some churn I'm going to leave behind a quick question to my future reviewer: which do you prefer for exposing constructors on our various JSString subtypes: (1) a public static placementNew() function calling a private constructor, or (2) a protected constructor with a messy <code>template &lt;typename Blort, typename Blat, typename AllowGC&gt; friend js::AllocateMeSomeStringPlease(JSContext* cx, size_t phaseOfMoon)</code>?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Dec 16 2021 11:53:00 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(it's not that big of a deal to switch from one to the other, but if you have an immediate preference, it'll prevent me from crawling down the wrong rabbit hole)</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Dec 16 2021 12:09:10 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I'm not sure if that is a trick question but generally I'll lean to the non-template answer</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Dec 16 2021 12:27:37 GMT-0800 (Pacific Standard Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it's more of a friend vs single-purpose API entry, it's just that the friend here would most naturally be a template.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Dec 16 2021 12:46:50 GMT-0800 (Pacific Standard Time)">20:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">mgaudet</span><span class="nick-10">jandem</span> All the new uploads to the R&amp;T stack are because I removed Boxes after the feedback at yesterday's tc39 meeting (removed part 10 + the box usages in the next commits)</blockquote></mx-reply>Sounds good; if you've got an up to-date try push after your changes I'm OK with landing this week -- I'm gone after tomorrow</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Dec 16 2021 12:50:03 GMT-0800 (Pacific Standard Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I think for this case, member function probably is my preference.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Dec 16 2021 12:50:51 GMT-0800 (Pacific Standard Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">For StencilXDR I was in favour of doing friend class because stencil-xdr is a reasonable and standalone concept, while here the concept is "this type does bad things and should feel bad"</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Dec 16 2021 12:51:27 GMT-0800 (Pacific Standard Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">but this is a bit more of a hand-wavey emotional argument than anything prinicipled :p</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Dec 16 2021 13:04:48 GMT-0800 (Pacific Standard Time)">21:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(For those following along, the context is that since we never actually <code>new</code> types like JSString but instead do silly things with reinterpre-t_cast in the GC, clang doesn't emit debug metadata for the <code>JSString</code> type anymore which is pretty annoying for debugging)</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Dec 16 2021 13:05:48 GMT-0800 (Pacific Standard Time)">21:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The immediate workaround if you are running into this is to use the <code>-fstandalone-debug</code> clang flag, but fixing some of our shenanigans is probably best long term</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Dec 16 2021 14:42:38 GMT-0800 (Pacific Standard Time)">22:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: First pass of review feedback on DOM Streams patches done.  Everything else will almost certainly have to wait until 2022... </td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Dec 16 2021 14:42:40 GMT-0800 (Pacific Standard Time)">22:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>

</tbody></table></div></div></div>
</body></html>