<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-02-19</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-02-19<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-02-18" class="nav-link"><span>prev</span></a>
<a href="2021-02-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Feb 18 2021 17:46:32 GMT-0800 (Pacific Standard Time)">01:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">that's a relief.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Feb 18 2021 17:46:51 GMT-0800 (Pacific Standard Time)">01:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">yeah, at one point it was "specified" that we were going to expose the destructuring arguments to the debugger, but uh</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Feb 18 2021 17:47:04 GMT-0800 (Pacific Standard Time)">01:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">did not seem like a great use of time once we got down to writing code</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Feb 18 2021 17:48:48 GMT-0800 (Pacific Standard Time)">01:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">sdetar</span>: I was thinking today about the crash reports we occasionally get that are unactionable and how we don't know if it's bad DRAM, solar flares, a bug in our code, a gc hazard...</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Feb 18 2021 17:49:21 GMT-0800 (Pacific Standard Time)">01:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">sdetar</span>: and it just occurred to me, it would be funny if crash dumps contained the price of the machine where they occurred</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Feb 18 2021 17:49:27 GMT-0800 (Pacific Standard Time)">01:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">slightly privacy-violating</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Feb 18 2021 17:50:18 GMT-0800 (Pacific Standard Time)">01:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">but it would be so helpful to know a random FoldConstants crash happened on a $125 refurb chromebook</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Feb 19 2021 02:30:11 GMT-0800 (Pacific Standard Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@lbe:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">I'm currently profiling spidermonkey with a valgrind-style heap-tracer. one of the issues I ran into is LifoAlloc, as the tracer is unware of the allocation/free functions. manually adding tracing support for LifoAlloc is not an issue. are there any other instances of custom memory allocators used in firefox, particularly spidermonkey?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Feb 19 2021 03:00:20 GMT-0800 (Pacific Standard Time)">11:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: there's GC allocation</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Feb 19 2021 03:01:13 GMT-0800 (Pacific Standard Time)">11:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: you may be able to add instrumentation in the functions defined in gc/GCProbes.h</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Feb 19 2021 03:07:26 GMT-0800 (Pacific Standard Time)">11:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@lbe:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">I'll look into that, thanks</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Feb 19 2021 07:20:24 GMT-0800 (Pacific Standard Time)">15:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">...Come to think of it, maybe we do have information about what kind of RAM is in the machine... or at least how many cores it has ...which correlate with what I really want to know, which is "is this <em>really</em> a bitflip"</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Feb 19 2021 07:22:51 GMT-0800 (Pacific Standard Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I often lookup CPU model numbers to find manufacture date..</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Feb 19 2021 07:52:20 GMT-0800 (Pacific Standard Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: on this line of code: <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#3279">https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#3279</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Feb 19 2021 07:53:41 GMT-0800 (Pacific Standard Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The source of that flag is <a href="https://searchfox.org/mozilla-central/search?q=symbol:_ZN2js8frontend11FunctionBox21setMemberInitializersENS_18MemberInitializersE&amp;redirect=false">https://searchfox.org/mozilla-central/search?q=symbol:_ZN2js8frontend11FunctionBox21setMemberInitializersENS_18MemberInitializersE&amp;redirect=false</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Feb 19 2021 07:54:24 GMT-0800 (Pacific Standard Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: mmmm, this is what I'm asking -- that can't be the only source.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Feb 19 2021 07:54:53 GMT-0800 (Pacific Standard Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">because</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Feb 19 2021 07:55:05 GMT-0800 (Pacific Standard Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">that method also sets the MemberInitializers, which would make this redundant</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Feb 19 2021 07:55:09 GMT-0800 (Pacific Standard Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">it must be that the flag is copied to this nested standalone lazy function that we're now compiling</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Feb 19 2021 07:55:11 GMT-0800 (Pacific Standard Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">from its parent</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Feb 19 2021 07:55:15 GMT-0800 (Pacific Standard Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">without also copying the MemberInitializers</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Feb 19 2021 07:55:27 GMT-0800 (Pacific Standard Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/frontend/SharedContext.cpp#144">https://searchfox.org/mozilla-central/source/js/src/frontend/SharedContext.cpp#144</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Feb 19 2021 07:55:51 GMT-0800 (Pacific Standard Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">That's the one. thanks</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Feb 19 2021 07:56:16 GMT-0800 (Pacific Standard Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, sorry that is super easy to lose in searchfox and is a critical part of delazification</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Feb 19 2021 07:57:07 GMT-0800 (Pacific Standard Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">immutableFlags are computed in initial parse and are actually immutable through execution and delazification</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Feb 19 2021 08:12:45 GMT-0800 (Pacific Standard Time)">16:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">It's easy to lose because flags are an integer in one place and a bit in the next. Maybe if the flag type were a struct with a bunch of bitfields instead... it would still be copied and serialized as a single n-bit unit though :-\</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Feb 19 2021 08:13:08 GMT-0800 (Pacific Standard Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">it is weird, but feels like progress, to even be thinking about coding for searchfoxability</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Feb 19 2021 08:14:03 GMT-0800 (Pacific Standard Time)">16:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">The macros didn't help searchfox help me</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Feb 19 2021 08:19:17 GMT-0800 (Pacific Standard Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dana:mozilla.org">dana</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: I have some follow-up questions from what we talked about yesterday if you're around</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Feb 19 2021 08:22:01 GMT-0800 (Pacific Standard Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: If a type isn't mentioned in StencilXdr, can I assume it isn't serialized/deserialized in the bytecode cache? Specifically, MemberInitializers</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Feb 19 2021 08:22:34 GMT-0800 (Pacific Standard Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">some types are serialized in a big slab, but I didn't think MemberInitializers was one of them</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Feb 19 2021 08:22:45 GMT-0800 (Pacific Standard Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">dana</span>: Yulia is currently streaming live on Twitch</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Feb 19 2021 08:22:50 GMT-0800 (Pacific Standard Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><a href="https://www.twitch.tv/codehag">https://www.twitch.tv/codehag</a></td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Feb 19 2021 08:24:33 GMT-0800 (Pacific Standard Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dana:mozilla.org">dana</span>&gt;</div></td><td class="msg-cell">ah - thanks!</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Feb 19 2021 08:39:41 GMT-0800 (Pacific Standard Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/Stencil.h#878">https://searchfox.org/mozilla-central/source/js/src/frontend/Stencil.h#878</a></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Feb 19 2021 09:43:06 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">dana</span>: im back but brain dead</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Feb 19 2021 09:43:11 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">is it ok if we look on monday?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Feb 19 2021 09:55:16 GMT-0800 (Pacific Standard Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: Apparently we have a non-halting thread on Android: <a href="https://treeherder.mozilla.org/logviewer?job_id=330541272&amp;repo=try&amp;lineNumber=5244">https://treeherder.mozilla.org/logviewer?job_id=330541272&amp;repo=try&amp;lineNumber=5244</a> (timeout reports pthread_join being on the stack)</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Feb 19 2021 09:56:27 GMT-0800 (Pacific Standard Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">The stack is printed with a modification I made to the JS shell, so this is not the timeout command, and rr did not reported any races while spawning it 20000 times with the chaos mode.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Feb 19 2021 09:57:08 GMT-0800 (Pacific Standard Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">So, for reasons that I cna't explain the <code>pthread_join</code> hang was not present before the modification, but is reported now.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Feb 19 2021 10:01:54 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dana:mozilla.org">dana</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: works for me - talk to you then!</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Feb 19 2021 11:28:58 GMT-0800 (Pacific Standard Time)">19:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: I've been occasionally seeing what seems like spurious oom exceptions coming from spidermonkey in crashes etc. I'm curious if you have any insight into what might be causing them?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Feb 19 2021 11:34:55 GMT-0800 (Pacific Standard Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nika</span>: we do currently have a 4GB GC heap limit I think. There are also "uncatchable" OOMs when they happen during a critical step</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Feb 19 2021 11:35:17 GMT-0800 (Pacific Standard Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">"uncatchable" OOMs?</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Feb 19 2021 11:35:30 GMT-0800 (Pacific Standard Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Those uncatachable OOMs can be actionable if we see them a lot.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri Feb 19 2021 11:35:45 GMT-0800 (Pacific Standard Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">I didn't realize the GC heap was limited to 4GB - is that per-realm or global?</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri Feb 19 2021 11:35:53 GMT-0800 (Pacific Standard Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">process I think</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri Feb 19 2021 11:36:00 GMT-0800 (Pacific Standard Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">woah</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Feb 19 2021 11:36:13 GMT-0800 (Pacific Standard Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I don't remember what it includes</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Feb 19 2021 11:36:41 GMT-0800 (Pacific Standard Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">GC things point to C++ allocations which would not be part of the limit</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Feb 19 2021 11:36:58 GMT-0800 (Pacific Standard Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">so that could potentially explain how I'm seeing OOMs from allocating e.g. small JS reflectors?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Feb 19 2021 11:37:05 GMT-0800 (Pacific Standard Time)">19:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">if the process is near the 4GB limit</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Feb 19 2021 11:39:02 GMT-0800 (Pacific Standard Time)">19:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Feb 19 2021 11:39:13 GMT-0800 (Pacific Standard Time)">19:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">do you have an example?</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Feb 19 2021 11:41:16 GMT-0800 (Pacific Standard Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">A while back we were running into issues where deserializing structured clone data in JSWindowActors was failing, and we noticed they were very small types (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1563825">https://bugzilla.mozilla.org/show_bug.cgi?id=1563825</a>)</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Feb 19 2021 11:41:26 GMT-0800 (Pacific Standard Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">and I recently got cc-ed on <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1645865">https://bugzilla.mozilla.org/show_bug.cgi?id=1645865</a></td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Feb 19 2021 11:42:42 GMT-0800 (Pacific Standard Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">the first one theoretically could be something other than ooms (though based on the messages it's apparently related to, it seems unlikely that e.g. a<code>{foo: false}</code> would fail to deserialize any other way), and the second one I think should only be able to fail if there was an oom</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Feb 19 2021 11:42:50 GMT-0800 (Pacific Standard Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">because it's just minting wrappers around native types</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Feb 19 2021 11:44:12 GMT-0800 (Pacific Standard Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">I don't suppose we record GC heap usage somewhere which is visible to a crash report?</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Feb 19 2021 11:46:43 GMT-0800 (Pacific Standard Time)">19:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">crash reports can include memory reports</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Feb 19 2021 11:46:46 GMT-0800 (Pacific Standard Time)">19:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">here is a concrete example of the uncatchable OOM case. This wouldn't return to caller though <a href="https://searchfox.org/mozilla-central/rev/281009d3b7e1e1496b9524d5478ff4f0b7369573/js/src/gc/Nursery.cpp#704-712">https://searchfox.org/mozilla-central/rev/281009d3b7e1e1496b9524d5478ff4f0b7369573/js/src/gc/Nursery.cpp#704-712</a></td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Feb 19 2021 11:47:06 GMT-0800 (Pacific Standard Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">mmm, so probably not what we're seeing</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Feb 19 2021 11:47:25 GMT-0800 (Pacific Standard Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">but the memory report aren't always there for some reason, and we only record them periodically, so it memory spikes up and we crash there's no record of it.</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Feb 19 2021 11:51:12 GMT-0800 (Pacific Standard Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nika</span>: did you look at the pernosco trace for the second one? I just hit the button to refresh it</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Feb 19 2021 11:57:19 GMT-0800 (Pacific Standard Time)">19:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">oh, I somehow missed that that existed oops </td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri Feb 19 2021 11:57:25 GMT-0800 (Pacific Standard Time)">19:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">so no :p</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri Feb 19 2021 11:57:40 GMT-0800 (Pacific Standard Time)">19:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: A victim is you! Can you take a quick look at the pernosco trace in an hour or so when it loads and see if the nullptr came from spidermonkey and where?</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri Feb 19 2021 11:57:53 GMT-0800 (Pacific Standard Time)">19:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Bug 1645865</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Fri Feb 19 2021 11:57:55 GMT-0800 (Pacific Standard Time)">19:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1645865">https://bugzil.la/1645865</a> — NEW (nobody) — MOZ_CRASH("Unhandlable OOM while clearing document dependent slots.") [@ nsGlobalWindowInner::InitDocumentDependentState]</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Fri Feb 19 2021 11:58:11 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I'm suspicous that it is OOM and not some other exception</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Fri Feb 19 2021 11:58:24 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">definitely</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Fri Feb 19 2021 11:58:30 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">that's my suspicion too</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Fri Feb 19 2021 11:58:44 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">but I couldn't figure out what it owuld be</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Fri Feb 19 2021 11:59:20 GMT-0800 (Pacific Standard Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">some wrapper security check? dunno</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Fri Feb 19 2021 12:01:25 GMT-0800 (Pacific Standard Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">random other question: I'm guessing at least some of the reason why crash reports don't include native JS stacks is because keeping track of that information in a way which would be safe to read from the minidump generator is probably difficult</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Fri Feb 19 2021 12:01:35 GMT-0800 (Pacific Standard Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">or expensive</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Fri Feb 19 2021 12:03:04 GMT-0800 (Pacific Standard Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">probably privacy too</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Fri Feb 19 2021 12:03:19 GMT-0800 (Pacific Standard Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">Well, we wouldn't include arbitrary frames - just system-privileged ones</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Fri Feb 19 2021 12:03:20 GMT-0800 (Pacific Standard Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">but yes, js-stacks need a lot of metadata to traverse</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Fri Feb 19 2021 12:03:39 GMT-0800 (Pacific Standard Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">I mean, at dumping time we have the entire process' address space</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Fri Feb 19 2021 12:04:01 GMT-0800 (Pacific Standard Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">so theoretically I think we should have the metadata available?</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Fri Feb 19 2021 12:04:04 GMT-0800 (Pacific Standard Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">a crashing process isn't known for its data-structure integrity..</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Fri Feb 19 2021 12:04:17 GMT-0800 (Pacific Standard Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">It is something that could be explored, yeah</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Fri Feb 19 2021 12:04:22 GMT-0800 (Pacific Standard Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">This is true, we'd have to make it resillient to corruption</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Fri Feb 19 2021 12:04:39 GMT-0800 (Pacific Standard Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">like, if it's a memory corruption crash, we obviously don't want to start walking through the JS heap</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Fri Feb 19 2021 12:05:26 GMT-0800 (Pacific Standard Time)">20:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">It'd be super useful even if we only even try to collect them after seeing a null-deref/MOZ_CRASH</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Fri Feb 19 2021 12:21:04 GMT-0800 (Pacific Standard Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Oops sorry I didn't label myself as pto. Out hiking right now. Gone forthe day</td></tr>

</tbody></table></div></div></div>
</body></html>