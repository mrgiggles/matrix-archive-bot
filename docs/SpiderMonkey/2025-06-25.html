<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-06-25</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-06-25<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-06-24" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jun 24 2025 23:29:19 GMT-0700 (Pacific Daylight Time)">06:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@dazabani:igalia.com">delan</span>&gt;</div></td><td class="msg-cell">o/ does anyone know if the <a href="https://firefox-source-docs.mozilla.org/js/Debugger/Debugger-API.html">Debugger api</a> is exposed to C++, or only javascript? if it’s only available to javascript, how do we run a privileged script that can <a href="https://firefox-source-docs.mozilla.org/js/Debugger/Tutorial-Breakpoint.html">import resource://gre/modules/jsdebugger.sys.mjs</a>?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jun 24 2025 23:44:47 GMT-0700 (Pacific Daylight Time)">06:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it's mostly available only to JavaScript.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jun 24 2025 23:45:29 GMT-0700 (Pacific Daylight Time)">06:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">are you having trouble with importing the module? for instance, do you get any error message?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jun 24 2025 23:46:22 GMT-0700 (Pacific Daylight Time)">06:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, what's the context for the question?  is this for Firefox, or other embeddings?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jun 24 2025 23:46:32 GMT-0700 (Pacific Daylight Time)">06:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">delan</span>: ^</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jun 25 2025 01:12:09 GMT-0700 (Pacific Daylight Time)">08:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@dazabani:igalia.com">delan</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: this is for servo, another embedding of spidermonkey. i haven’t really worked with spidermonkey before, so i’m not sure how running a privileged script would need to look compared to running a normal content script</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jun 25 2025 01:47:55 GMT-0700 (Pacific Daylight Time)">08:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't know how servo works, but isn't there any privileged script already running as a part of browser UI ?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jun 25 2025 01:55:03 GMT-0700 (Pacific Daylight Time)">08:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@dazabani:igalia.com">delan</span>&gt;</div></td><td class="msg-cell">i don’t think so, no, our browser ui is written in rust with a native widget toolkit such as egui</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jun 25 2025 01:56:31 GMT-0700 (Pacific Daylight Time)">08:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if there's no privileged global or anything along that line, then it would mean you need to create similar thing from scratch</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jun 25 2025 01:57:13 GMT-0700 (Pacific Daylight Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, for the Debugger API itself, you can call <a href="https://searchfox.org/mozilla-central/rev/ec8a326713f60dec138a3e3383b03ac739870fc7/js/public/Debug.h#30-32">JS_DefineDebuggerObject</a> on the global</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jun 25 2025 01:57:56 GMT-0700 (Pacific Daylight Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">which is done in <a href="https://searchfox.org/mozilla-central/rev/ec8a326713f60dec138a3e3383b03ac739870fc7/devtools/platform/JSDebugger.cpp#43-46">mozilla::jsdebugger::JSDebugger::AddClass</a>, that's the main part of <a href="https://searchfox.org/mozilla-central/rev/ec8a326713f60dec138a3e3383b03ac739870fc7/devtools/platform/jsdebugger.sys.mjs#23-24">jsdebugger.sys.mjs</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jun 25 2025 01:58:41 GMT-0700 (Pacific Daylight Time)">08:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@dazabani:igalia.com">delan</span>&gt;</div></td><td class="msg-cell">what makes a global privileged? sorry for probably a really basic question</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jun 25 2025 01:58:42 GMT-0700 (Pacific Daylight Time)">08:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that way the <code>Debugger</code> property is defined on the global, and you can call Debugger API from JS code</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jun 25 2025 02:00:17 GMT-0700 (Pacific Daylight Time)">09:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">associated principal, passed to <a href="https://searchfox.org/mozilla-central/rev/ec8a326713f60dec138a3e3383b03ac739870fc7/js/public/GlobalObject.h#65-66">JS_NewGlobalObject</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jun 25 2025 02:00:26 GMT-0700 (Pacific Daylight Time)">09:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">but I'm not sure how it's used in servo</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jun 25 2025 02:00:38 GMT-0700 (Pacific Daylight Time)">09:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, I'd suggest looking into existing JSAPI consumers</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jun 25 2025 02:00:53 GMT-0700 (Pacific Daylight Time)">09:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and how principal or anything along that line is implemented there</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jun 25 2025 02:01:47 GMT-0700 (Pacific Daylight Time)">09:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">especially <a href="https://searchfox.org/mozilla-central/rev/ec8a326713f60dec138a3e3383b03ac739870fc7/js/public/Principals.h#55-59">JSPrincipals::isSystemOrAddonPrincipal</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jun 25 2025 02:06:18 GMT-0700 (Pacific Daylight Time)">09:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, to my understanding, "privileged" is mostly what the embeddings define.  the principal provides a way to associate it to globals</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jun 25 2025 02:07:03 GMT-0700 (Pacific Daylight Time)">09:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@dazabani:igalia.com">delan</span>&gt;</div></td><td class="msg-cell">ahh thank you! it looks like <a href="https://github.com/servo/servo/blob/4ee348a2021f80f23b1063841acf7402b020ddcb/components/script_bindings/interface.rs#L155-L161">our counterpart is here</a> → <a href="https://github.com/servo/servo/blob/4ee348a2021f80f23b1063841acf7402b020ddcb/components/script_bindings/principals.rs#L27">here</a> → <a href="https://github.com/servo/servo/blob/4ee348a2021f80f23b1063841acf7402b020ddcb/components/script/dom/bindings/utils.rs#L161">here</a> → <a href="https://github.com/servo/servo/blob/4ee348a2021f80f23b1063841acf7402b020ddcb/components/script/dom/bindings/principals.rs#L77">here</a></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jun 25 2025 02:07:11 GMT-0700 (Pacific Daylight Time)">09:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, if servo-side doesn't use it at all, then either (a) you don't have to worry about it, and just define Debugger API to dedicate global and use it, or (b) define it and use it</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jun 25 2025 02:08:30 GMT-0700 (Pacific Daylight Time)">09:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@dazabani:igalia.com">delan</span>&gt;</div></td><td class="msg-cell">this is very helpful, thanks again! i expect we’ll run into more questions along the way, but this is a great start</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jun 25 2025 09:15:38 GMT-0700 (Pacific Daylight Time)">16:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: hey, I just saw you messages from yesterday about barriers</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jun 25 2025 09:15:52 GMT-0700 (Pacific Daylight Time)">16:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">can you share you patches so I can have a look?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jun 25 2025 09:16:35 GMT-0700 (Pacific Daylight Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">we shouldn't be seeing so much time spent in barriers</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jun 25 2025 09:17:02 GMT-0700 (Pacific Daylight Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I think the microtask queue should be a root, and therefore should not need most barriers</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jun 25 2025 09:17:49 GMT-0700 (Pacific Daylight Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">also the profile looks like you're using a std::deque - I don't know how that's implemented but it may be doing a lot of moving things around internally which could cause a lot of barrier traffic</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jun 25 2025 09:39:58 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span></div></td><td class="msg-cell">nods 

I've got a number of fixes planned for today. If I'm still in the same situation tomorrow I'll share patches with you</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jun 25 2025 09:40:22 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">OK</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jun 25 2025 09:40:48 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Just to say, what you're seeing is not normal behaviour and indicates that there's a problem somewhere</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Jun 25 2025 09:41:36 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Yeah; I know for sure it's partially driven by copy construction happening more than I had expected. <code>std::move</code> turns out can only cover so many sins</td></tr>

</tbody></table></div></div></div>
</body></html>