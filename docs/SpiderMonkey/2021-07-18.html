<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-07-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-07-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-07-16" class="nav-link"><span>prev</span></a>
<a href="2021-07-19" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sat Jul 17 2021 23:41:41 GMT-0700 (Pacific Daylight Time)">06:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>I'm crashing with a</p>
<pre><code>Caused by:
process didn't exit successfully: `C:\Users\[REDACTED]\Software\spiderfire\target\debug\deps\assert-b71590113009ad97.exe` (exit code: 0xc000001d, STATUS_ILLEGAL_INSTRUCTION)
</code></pre>
<p>Stack:</p>
<pre><code>_CxxThrowException 0x00007ff79f1693a0
panic_unwind::real_imp::panic() seh.rs:315
panic_unwind::__rust_start_panic() lib.rs:109
std::panicking::rust_panic() panicking.rs:640
std::panicking::rust_panic_with_hook() panicking.rs:610
std::panicking::begin_panic_handler::{{closure}}() panicking.rs:495
std::sys_common::backtrace::__rust_end_short_backtrace&lt;closure-0,!&gt;() backtrace.rs:141
std::panicking::begin_panic_handler() panicking.rs:493
core::panicking::panic_fmt() panicking.rs:92
core::panicking::panic() panicking.rs:50
modules::assert::assert::assert::native_fn(mozjs_sys::generated::root::JSContext *,ion::functions::arguments::Arguments *) assert.rs:27
modules::assert::assert::assert(mozjs_sys::generated::root::JSContext *,unsigned int,mozjs_sys::generated::root::JS::Value *) macros.rs:22
js::InternalCallOrConstruct(JSContext *,const JS::CallArgs &amp;,MaybeConstruct,CallReason) Interpreter.cpp:520
Interpret(JSContext *,js::RunState &amp;) Interpreter.cpp:3244
js::RunScript(JSContext *,js::RunState &amp;) Interpreter.cpp:405
js::ExecuteKernel(JSContext *,Handle&lt;JSScript *&gt;,Handle&lt;JSObject *&gt;,Handle&lt;JS::Value&gt;,AbstractFramePtr,MutableHandle&lt;JS::Value&gt;) Interpreter.cpp:772
js::Execute(JSContext *,Handle&lt;JSScript *&gt;,Handle&lt;JSObject *&gt;,MutableHandle&lt;JS::Value&gt;) Interpreter.cpp:804
js::ModuleObject::execute(JSContext *,Handle&lt;js::ModuleObject *&gt;,MutableHandle&lt;JS::Value&gt;) ModuleObject.cpp:1164
intrinsic_ExecuteModule(JSContext *,unsigned int,JS::Value *) SelfHosting.cpp:1942
js::InternalCallOrConstruct(JSContext *,const JS::CallArgs &amp;,MaybeConstruct,CallReason) Interpreter.cpp:520
Interpret(JSContext *,js::RunState &amp;) Interpreter.cpp:3244
js::RunScript(JSContext *,js::RunState &amp;) Interpreter.cpp:405
js::InternalCallOrConstruct(JSContext *,const JS::CallArgs &amp;,MaybeConstruct,CallReason) Interpreter.cpp:552
js::Call(JSContext *,Handle&lt;JS::Value&gt;,Handle&lt;JS::Value&gt;,const js::AnyInvokeArgs &amp;,MutableHandle&lt;JS::Value&gt;,CallReason) Interpreter.cpp:597
js::CallSelfHostedFunction(JSContext *,Handle&lt;js::PropertyName *&gt;,Handle&lt;JS::Value&gt;,const js::AnyInvokeArgs &amp;,MutableHandle&lt;JS::Value&gt;) SelfHosting.cpp:1642
js::ModuleObject::Evaluate(JSContext *,Handle&lt;js::ModuleObject *&gt;,MutableHandle&lt;JS::Value&gt;) ModuleObject.cpp:1220
runtime::modules::compile_module(mozjs_sys::generated::root::JSContext *,str,Option&lt;std::path::Path*&gt;,str) modules.rs:79
assert::eval_module(std::path::Path *) assert.rs:61
assert::assert() assert.rs:30
assert::assert::{{closure}}(closure-0 *) assert.rs:26
core::ops::function::FnOnce::call_once&lt;closure-0,tuple&lt;&gt;&gt;(closure-0) function.rs:227
test::__rust_begin_short_backtrace&lt;fn()&gt;() lib.rs:577
test::run_test::run_test_inner::{{closure}}() lib.rs:492
std::sys_common::backtrace::__rust_begin_short_backtrace&lt;closure-1,tuple&lt;&gt;&gt;() backtrace.rs:125
core::ops::function::FnOnce::call_once&lt;closure-0,tuple&lt;&gt;&gt;() function.rs:227
std::sys::windows::thread::{{impl}}::new::thread_start() thread.rs:56
BaseThreadInitThunk 0x00007ffb804e7c24
RtlUserThreadStart 0x00007ffb8096d721
</code></pre>
<p>Specific instruction I crash on:</p>
<pre><code class="language-as">	jmpq   *0x10640a(%rip)            ; mozilla::unused_t const mozilla::Unused + 709392
</code></pre>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sat Jul 17 2021 23:51:16 GMT-0700 (Pacific Daylight Time)">06:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">The weird part is that this crash only happens in tests, regular builds work fine</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sun Jul 18 2021 00:07:58 GMT-0700 (Pacific Daylight Time)">07:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">which frame is it in the stack?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sun Jul 18 2021 00:08:09 GMT-0700 (Pacific Daylight Time)">07:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it looks like the innermost frame is inside assertion failure</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sun Jul 18 2021 00:08:43 GMT-0700 (Pacific Daylight Time)">07:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's <code>Interpreter.cpp</code> line 520 for you?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sun Jul 18 2021 00:08:58 GMT-0700 (Pacific Daylight Time)">07:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that's frame 13 (or 12 if it's 0-origin)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sun Jul 18 2021 00:09:37 GMT-0700 (Pacific Daylight Time)">07:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the next frame is assertion handling, that sounds like, the assertion at line 520 fails</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sun Jul 18 2021 00:10:11 GMT-0700 (Pacific Daylight Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">technically the assertion is my own? <code>assert!(b, "Assertion Failed"); //<a href="http://assert.rs:27">assert.rs:27</a></code></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sun Jul 18 2021 00:10:58 GMT-0700 (Pacific Daylight Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, so you have assertion function implemented as JS native?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sun Jul 18 2021 00:11:12 GMT-0700 (Pacific Daylight Time)">07:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">basically, yep</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sun Jul 18 2021 00:12:34 GMT-0700 (Pacific Daylight Time)">07:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and <code>jmpq   *0x10640a(%rip)</code> instruction is around <code><a href="http://assert.rs:27">assert.rs:27</a></code> ?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sun Jul 18 2021 00:12:39 GMT-0700 (Pacific Daylight Time)">07:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">or somewhere else?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sun Jul 18 2021 00:12:57 GMT-0700 (Pacific Daylight Time)">07:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I'm not sure about that one</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sun Jul 18 2021 00:13:06 GMT-0700 (Pacific Daylight Time)">07:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">how do you get the instruction?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sun Jul 18 2021 00:13:30 GMT-0700 (Pacific Daylight Time)">07:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">CLion's Debugger just showed it to me when the crash occured</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sun Jul 18 2021 00:13:44 GMT-0700 (Pacific Daylight Time)">07:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and it shows stack trace as well?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sun Jul 18 2021 00:13:53 GMT-0700 (Pacific Daylight Time)">07:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">yep</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sun Jul 18 2021 00:13:56 GMT-0700 (Pacific Daylight Time)">07:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if so, which stack does it point when it shows the instruction?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sun Jul 18 2021 00:14:42 GMT-0700 (Pacific Daylight Time)">07:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">or, does it show the function name and/or offset or something for the instruction?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Sun Jul 18 2021 00:15:03 GMT-0700 (Pacific Daylight Time)">07:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Isn't the stack the thing I sent earlier?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Sun Jul 18 2021 00:15:49 GMT-0700 (Pacific Daylight Time)">07:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, I suppose it's the instruction in some function inside the stack trace</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Sun Jul 18 2021 00:16:19 GMT-0700 (Pacific Daylight Time)">07:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and I suppose debugger shows which function it is</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Sun Jul 18 2021 00:17:03 GMT-0700 (Pacific Daylight Time)">07:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I have access to the LLDB console if that'll help</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Sun Jul 18 2021 00:17:43 GMT-0700 (Pacific Daylight Time)">07:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is the lldb already attached to the paused process ?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Sun Jul 18 2021 00:18:20 GMT-0700 (Pacific Daylight Time)">07:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if so, try running <code>bt</code> = (backtrace) to see if the stack trace is same there.  and <code>up</code> and <code>down</code> to move between frames, that will also show either the current code (C++, rust, etc) or disassembly</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Sun Jul 18 2021 00:21:35 GMT-0700 (Pacific Daylight Time)">07:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the above jmpq is for the innermost frame, going up/down frames will tell us how the execution goes there</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Sun Jul 18 2021 00:39:15 GMT-0700 (Pacific Daylight Time)">07:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, what happens if you call the function in regular build?  how is the <code>assert!</code> at <code><a href="http://assert.rs:27">assert.rs:27</a></code> supposed to work?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Sun Jul 18 2021 00:42:43 GMT-0700 (Pacific Daylight Time)">07:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">regular build just panics as expected, doesn't panic while panicking<br><code>assert!</code> checks if the first param is true, if it isn't, it panics with the second param as the message</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Sun Jul 18 2021 00:51:04 GMT-0700 (Pacific Daylight Time)">07:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><pre><code class="language-as">_CxxThrowException:
	jmpq   *0x29a61a(%rip)            ; mozilla::unused_t const mozilla::Unused + 2089995
	int3
	int3
	int3
	int3
	int3
	int3
	int3
	int3
	int3
	int3
; ...
</code></pre>
<p>Called by:</p>
<pre><code class="language-rs">    _CxxThrowException(throw_ptr, &amp;mut THROW_INFO as *mut _ as *mut _); //seh.rs:315
</code></pre>
</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Sun Jul 18 2021 01:06:02 GMT-0700 (Pacific Daylight Time)">08:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I wonder if there's some inconsistency around build configuration for C++ exception handling</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Sun Jul 18 2021 01:07:01 GMT-0700 (Pacific Daylight Time)">08:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">given the jump target pointer value is bogus, it would mean that it's already in unexpected state</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Sun Jul 18 2021 01:09:50 GMT-0700 (Pacific Daylight Time)">08:09</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@arai:mozilla.org">arai</span></div></td><td class="msg-cell">looks into <a href="https://github.com/rust-lang/rust/blob/master/library/panic_unwind/src/seh.rs">https://github.com/rust-lang/rust/blob/master/library/panic_unwind/src/seh.rs</a></td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Sun Jul 18 2021 01:11:56 GMT-0700 (Pacific Daylight Time)">08:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you try putting assertion failure in other place to see how it behaves?  for example, at the beginning of the program</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Sun Jul 18 2021 01:52:26 GMT-0700 (Pacific Daylight Time)">08:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I think you can't do <code>assert!</code> in <code>extern "C"</code> functions, which would explain the issue</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Sun Jul 18 2021 02:06:52 GMT-0700 (Pacific Daylight Time)">09:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">oh.. panicking across FFI is undefined behaviour</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Sun Jul 18 2021 02:10:47 GMT-0700 (Pacific Daylight Time)">09:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh <a href="https://doc.rust-lang.org/nomicon/ffi.html#ffi-and-panics">https://doc.rust-lang.org/nomicon/ffi.html#ffi-and-panics</a></td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Sun Jul 18 2021 07:30:45 GMT-0700 (Pacific Daylight Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><p>hey everyone!<br>trying to build the SM 91.0b3 from sources but can't get past <code>mach bootstrap</code> step:</p>
<pre><code>Could not identify the root directory of your checkout! Are you running `mach bootstrap` in an hg or git clone?
</code></pre>
</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Sun Jul 18 2021 07:31:14 GMT-0700 (Pacific Daylight Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">Is it not possible to build SM without downloading it via source control anymore?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Sun Jul 18 2021 07:40:55 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">looks like mach bootstrap requires local checkout, instead of source code snapshot (bug 1662893)</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Sun Jul 18 2021 07:40:57 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1662893">https://bugzil.la/1662893</a> — RESOLVED (rstewart) — Refactor bootstrap to reflect that the state_dir and topsrcdir are both mandatory</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Sun Jul 18 2021 07:42:07 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, you'll need local checkout of mozilla-central or mozilla-unified, run mach bootstrap there, and then build your spidermonkey source (that can be in different directory)</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Sun Jul 18 2021 07:44:12 GMT-0700 (Pacific Daylight Time)">14:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">ugh, sounds like a PITA (last time I've tried it took like half a day to download the whole tree via git)</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Sun Jul 18 2021 07:44:33 GMT-0700 (Pacific Daylight Time)">14:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, wait</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Sun Jul 18 2021 07:44:57 GMT-0700 (Pacific Daylight Time)">14:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in that case, you can run <a href="http://bootstrap.py">bootstrap.py</a> script alone, that should download necessary files</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Sun Jul 18 2021 07:45:15 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">that's exactly the script that fails =)</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Sun Jul 18 2021 07:45:33 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">eh</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Sun Jul 18 2021 07:45:46 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">running <a href="http://bootstrap.py">bootstrap.py</a> alone should work</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Sun Jul 18 2021 07:45:48 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://firefox-source-docs.mozilla.org/setup/linux_build.html#building-firefox-on-linux">https://firefox-source-docs.mozilla.org/setup/linux_build.html#building-firefox-on-linux</a></td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Sun Jul 18 2021 07:45:52 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><p><a href="http://bootsrtap.py">bootsrtap.py</a>:</p>
<pre><code>        # We need to enable the loading of hgrc in case extensions are
        # required to open the repo.
        (checkout_type, checkout_root) = current_firefox_checkout(
            env=self.instance._hg_cleanenv(load_hgrc=True), hg=which("hg")
        )
</code></pre>
</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Sun Jul 18 2021 07:45:56 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://firefox-source-docs.mozilla.org/setup/linux_build.html#bootstrap-a-copy-of-the-firefox-source-code">https://firefox-source-docs.mozilla.org/setup/linux_build.html#bootstrap-a-copy-of-the-firefox-source-code</a></td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Sun Jul 18 2021 07:46:23 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">maybe the situation changes...?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Sun Jul 18 2021 07:46:38 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">hm... maybe there is a different <a href="http://bootstrap.py">bootstrap.py</a>? let me check</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Sun Jul 18 2021 07:46:46 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, there are 2 <a href="http://bootstrap.py">bootstrap.py</a></td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Sun Jul 18 2021 07:47:30 GMT-0700 (Pacific Daylight Time)">14:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">but that will run the same thing.  one downloaded above is a script that downloads necessary files (scripts, including another <a href="http://bootstrap.py">bootstrap.py</a>)</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Sun Jul 18 2021 07:48:19 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hmm, if it doesn't work without local checkout, it doesn't work as bootstrap script...</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Sun Jul 18 2021 07:49:05 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, bug 1647792</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Sun Jul 18 2021 07:49:06 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1647792">https://bugzil.la/1647792</a> — RESOLVED (rstewart) — Rewrite standalone <a href="http://bootstrap.py">bootstrap.py</a> script to clone before calling into `mach bootstrap`</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Sun Jul 18 2021 07:49:22 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, the standalone <a href="http://bootstrap.py">bootstrap.py</a> now requires cloning...</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Sun Jul 18 2021 07:49:29 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">bin/bootstrap clones the whole tree anyway</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Sun Jul 18 2021 07:49:50 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that was optional step when I worked on bootstrap scripts</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Sun Jul 18 2021 07:50:43 GMT-0700 (Pacific Daylight Time)">14:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">I've managed to hack around by commenting out all the lines that reference source control and it seems to work, but that <em>is</em> a dirty dirty hack</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Sun Jul 18 2021 07:51:21 GMT-0700 (Pacific Daylight Time)">14:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">IMO, current bootstrap method doesnt mesh well with source snapshots (e.g. esr tarballs)</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Sun Jul 18 2021 07:52:04 GMT-0700 (Pacific Daylight Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, that's problematic</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Sun Jul 18 2021 08:03:13 GMT-0700 (Pacific Daylight Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">@arai, btw do you know if it's possible to build only js project with mach? (in 91b3)</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Sun Jul 18 2021 08:04:14 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">previously it could've been achieved by using configure in js/src directly, but it was removed at some point</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Sun Jul 18 2021 08:04:40 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, you can specify js shell as target application</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Sun Jul 18 2021 08:05:06 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://firefox-source-docs.mozilla.org/js/build.html">https://firefox-source-docs.mozilla.org/js/build.html</a></td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Sun Jul 18 2021 08:05:25 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">will that work even if I use <code>--disable-js-shell</code> (since I need only the SM library)?</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Sun Jul 18 2021 08:05:48 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">not sure</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Sun Jul 18 2021 08:06:35 GMT-0700 (Pacific Daylight Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">oh well, guess I'll have to experiment with it =)</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Sun Jul 18 2021 08:08:33 GMT-0700 (Pacific Daylight Time)">15:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, configure+make would still work</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Sun Jul 18 2021 08:09:12 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there's <a href="http://configure.in">configure.in</a> I guess</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Sun Jul 18 2021 08:09:20 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">there's no configure file in js/src anymore though?</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Sun Jul 18 2021 08:09:38 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">copying it to configure should work</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Sun Jul 18 2021 08:10:14 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">or, directly run <a href="http://configure.in">configure.in</a></td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Sun Jul 18 2021 08:11:06 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">I'll try the mach first, since I'd rather minimize the number of hacks I have to use to build SM :D
</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Sun Jul 18 2021 08:52:13 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: another small question, if you dont mind: do you know where I can find correct rust toolchain settings (i.e. <code>--host/--target</code>) for Windows builds by any chance?</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Sun Jul 18 2021 08:52:57 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm afraid I don't know</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Sun Jul 18 2021 08:53:31 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">oh well, thanks anyway =)</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Sun Jul 18 2021 08:53:49 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">guess I'll have to brute-force it, like I did with esr68</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Sun Jul 18 2021 09:50:52 GMT-0700 (Pacific Daylight Time)">16:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">welp, regretfully, it doesn't work: a lot of errors like <code>undefined symbol: _encoding_mem_convert_latin1_to_utf8_partial</code>, which look like symbols from rust bindings</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Sun Jul 18 2021 11:03:19 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">bit the bullet and went <code>whole tree via source control</code> way</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Sun Jul 18 2021 11:03:25 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">still doesn't build on Windows</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Sun Jul 18 2021 11:04:10 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">are there any special settings for rust or mozconfig required to make it work?</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Sun Jul 18 2021 11:04:54 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><p>my MOZCONFIG:</p>
<pre><code>ac_add_options --enable-application=js
ac_add_options --enable-debug
ac_add_options --enable-nspr-build
ac_add_options --disable-jemalloc
ac_add_options --disable-js-shell
ac_add_options --disable-tests

mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/obj-debug-@CONFIG_GUESS@
</code></pre>
</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Sun Jul 18 2021 11:39:31 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">the problems seems to be with <code>--disable-js-shell</code>, which probably causes some deps required for mozjs not to be included or smth</td></tr>

</tbody></table></div></div></div>
</body></html>