<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-04-28</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-04-28<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-04-27" class="nav-link"><span>prev</span></a>
<a href="2020-04-29" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Apr 28 2020 00:21:49 GMT-0700 (Pacific Daylight Time)">07:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: RegExpShared is a GC thing, so please don't use a UniquePtr for it</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Apr 28 2020 00:21:56 GMT-0700 (Pacific Daylight Time)">07:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><em>wonders what happens if you try to delete a GC thing</em></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Apr 28 2020 00:31:44 GMT-0700 (Pacific Daylight Time)">07:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">assertion failures, looks like</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Apr 28 2020 02:07:16 GMT-0700 (Pacific Daylight Time)">09:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I think he was adding a UniquePtr field to RegExpShared</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Apr 28 2020 03:36:31 GMT-0700 (Pacific Daylight Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: oh that makes more sense</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Apr 28 2020 03:37:32 GMT-0700 (Pacific Daylight Time)">10:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">well, it's destructor won't get called (because we don't for GC things) so it might also be problematic</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Apr 28 2020 06:16:53 GMT-0700 (Pacific Daylight Time)">13:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: Yeah, it was going to be a field, and yeah, even the field was a bad idea</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Apr 28 2020 06:17:22 GMT-0700 (Pacific Daylight Time)">13:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Using a raw pointer now and everything is much nicer</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Apr 28 2020 06:18:04 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: great</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Apr 28 2020 08:26:56 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: ping</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Apr 28 2020 08:27:32 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/TokenStream.h#51">https://searchfox.org/mozilla-central/source/js/src/frontend/TokenStream.h#51</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Apr 28 2020 08:28:01 GMT-0700 (Pacific Daylight Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">^-- exactly how "wasteful" is this, and is the waste being talked about strictly in terms of code-size and compiled-code duplication?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Apr 28 2020 08:28:48 GMT-0700 (Pacific Daylight Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">Because I think I need to unify these two different "tails" of the inheritance hierarchy to implement my parser atoms stuff</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Apr 28 2020 08:30:43 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">Basically: make TokenStreamCharsShared inherit from TokenStreamAnyChars, instead of having no base classes.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Apr 28 2020 08:32:00 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">AFAICT, this shouldn't cause problems, because TokenStreamCharsShared is not insantiated directly.  There are classes way down the inheritance chain that are instantiated.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Apr 28 2020 08:32:50 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">And those classes implicitly inherit from TokenStreamAnyChars via multiple-inheritance anyway, so the storage for the fields in TokenStreamAnyChars ends up getting used anyway in those places.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Apr 28 2020 08:36:34 GMT-0700 (Pacific Daylight Time)">15:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: alternatively, I can make changes to this assumption: <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/TokenStream.h#65">https://searchfox.org/mozilla-central/source/js/src/frontend/TokenStream.h#65</a></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Apr 28 2020 08:37:24 GMT-0700 (Pacific Daylight Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">I.e. unify TokenStreamCharsShared with TokenStreamAnyChars.  I think maybe that's actually the same idea as I proposed above.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Apr 28 2020 08:39:21 GMT-0700 (Pacific Daylight Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">The rub I'm trying to deal with is this: both of these conjoined inheritance hierarchies deal with atoms, their creation, and their contents.  Moving to a parser-internal, indexed atom model requires that they both need access to the atoms table.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Apr 28 2020 08:39:47 GMT-0700 (Pacific Daylight Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">The TokenStreamAnyChars branch needs access to the atoms table because it inspects atom internals in various places.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Apr 28 2020 08:40:06 GMT-0700 (Pacific Daylight Time)">15:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">The TokenStreamCharsShared branch needs access to the atoms table because it creates them.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Apr 28 2020 08:42:24 GMT-0700 (Pacific Daylight Time)">15:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">Alternatively, I can <em>maybe</em> avoid the whole issue by yet again rewriting my approach to the parser atoms - and instead of going with an indexed scheme, go with a heap-allocated parser-atom object-for-each-atom model, which would allow me to use actual pointers instead of indexed things.  Then, I could keep the current inheritance hierarchy as-is, because the TokenStreamAnyChars branch could inspect ParserAtom*s directly (instead of needing the table to get at the contents).. and the table itself could be kept on the TokenStreamCharsShared branch.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Apr 28 2020 08:57:17 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: I'd like to schedule a meeting to discuss the options here.  In the meantime, I'm probably going to look at fixing up the parser atoms representation as that requires the least change to existing Tokenizer machinery.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Apr 28 2020 09:34:26 GMT-0700 (Pacific Daylight Time)">16:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: thanks for doing another review. Do you agree with my comment about Maybe&lt;AutoRealm&gt; or am I missing someting?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Apr 28 2020 09:38:43 GMT-0700 (Pacific Daylight Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">can someone please help me grok why we're throwing this error in a specific situation: <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/Promise.cpp#1528">https://searchfox.org/mozilla-central/source/js/src/builtin/Promise.cpp#1528</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Apr 28 2020 09:39:00 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">if i'm in chrome JS, and have a promise P from content JS, chaining it with <code>P.then(v =&gt; ...)</code> seems fine, but if i return a <code>Promise.reject(X)</code> from that, and then chain from there, i get the linked error</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Apr 28 2020 09:39:58 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">and comments in that method seem confusing, since all my uses after that are in chrome JS, able to read both the original promise P (from content), and any later resolution/rejection values</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Apr 28 2020 09:51:15 GMT-0700 (Pacific Daylight Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: oh right, yes that does make sense now you explain it</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Apr 28 2020 09:51:40 GMT-0700 (Pacific Daylight Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I get worried about the order of destruction when I see Maybe&lt;&gt; around RAII classes...</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Apr 28 2020 09:54:41 GMT-0700 (Pacific Daylight Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">djvj</span>: Reading scrollback now, for some reason phone wasn't showing it when I checked earlier.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Apr 28 2020 09:58:58 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> ^-- exactly how "wasteful" is this, and is the waste being talked about strictly in terms of code-size and compiled-code duplication?</blockquote></mx-reply>TSAC itself is pretty small, so it's not too much duplication -- of code size/compiled-code duplication, with resulting size and icache effects.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Apr 28 2020 09:59:49 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Basically: make TokenStreamCharsShared inherit from TokenStreamAnyChars, instead of having no base classes.</blockquote></mx-reply>The inheritance hierarchy is very just-so.  The <em>comments</em> may attempt to rationalize the current setup, but they're at least as explanatory, add guideposts, as rationalizing.  If it needs to change, it should change, pretty much.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Apr 28 2020 10:04:12 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: Ok, I'll change the hierarchy and see how it goes.  Rewriting the parser atoms internals again was not something I was looking forward to.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Apr 28 2020 10:04:37 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">To summarize hazily, while listening to something else: everything is very bespoke, if it needs to bespeak in different fashion it should.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Apr 28 2020 10:10:13 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">I like this answer.  It's a lot better than the "everything needs to be carefully arranged this way for &lt;strange requirement&gt;", which I feared.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Apr 28 2020 10:10:16 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">And I suppose particularly, if you're changing the representation of atoms in tokenizing/parsing so that it's something like pointer/hash/length into the original source units, that necessarily means encoding-awareness to understand what that pointer's contents are, which means it needs to move into something <code>&lt;Unit&gt;</code>-parametrized.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Apr 28 2020 10:10:27 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">🙂</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Apr 28 2020 10:11:06 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I mean, really: did you <em>actually</em> think all those comments indicated an artfully aesthetically pleasing crafting of the setup?  😂</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Apr 28 2020 10:11:36 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">"no comments" =&gt; code is terrible; "some comments" =&gt; code is probably decent; "way too many comments" =&gt; you need to go home and rethink your life</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Apr 28 2020 10:11:38 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">No, the parser atoms representation is multiplexed within the parser atom itself.  It doesn't (can't) carry out into outer types.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Apr 28 2020 10:12:14 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">The parser internal representation variations are simply analogues of the whole JSAtom Lastin1 vs. TwoByte dichotomies</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Apr 28 2020 10:13:57 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: BaselineJIT was like 30% comments and it was one of the cleanest designs I have had the pleasure of contributing to.  ASCII art diagrams and everything.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Apr 28 2020 10:14:19 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">But I suppose when the comments are explaining/justifying C++ multiple inheritance hierarchies, it's a different matter</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Apr 28 2020 10:14:46 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">djvj</span>: I wouldn't say 30% is obviously not "some comments".  I think I had a roughly similar percentage in httpd.js, last time I checked.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Apr 28 2020 10:15:48 GMT-0700 (Pacific Daylight Time)">17:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Big huge long block comments are where you need to be leery.  Admittedly this one was an overview comment -- standards are different there -- but yeah, one to describe a big ol' inheritance graph is skeezy.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Apr 28 2020 10:16:41 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I remember first realizing this when I saw something like a forty-line comment in <code>DefineFunctions</code>, as used to implement some sort of JSAPI function, and it was basically all to deal with one small weirdness in the interface of the JSAPI thing.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Apr 28 2020 10:17:56 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">Yeah I love the "here's why this innocuous looking code is in fact really scary, but don't worry I'm going to take a few paragraphs to once again reassure you that the really scary thing is not going to hurt you" comments</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Apr 28 2020 10:18:21 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">right above a single line of <em>very</em> innocent looking code</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Apr 28 2020 11:50:43 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I find doing computations with NaNs (in my case, a finite number multiplied by a NaN) slows down JS a <em>lot</em>, is that correct ?</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Apr 28 2020 11:51:38 GMT-0700 (Pacific Daylight Time)">18:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">a workload that is well under the real-time budget in an audioworklet without NaN overshoots it by 50% or 100% when NaNs are introduced</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Apr 28 2020 11:52:28 GMT-0700 (Pacific Daylight Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I think CPUs are actually slower at doing computations involving NaNs</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Apr 28 2020 11:52:46 GMT-0700 (Pacific Daylight Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">yeah that's another problem</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Apr 28 2020 11:53:01 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">unless you are falling of the int32 path into double territory. that's of course bad too</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Apr 28 2020 11:53:22 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I'm getting numbers for the nominal case where the bug is fixed and there is no NaN</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Apr 28 2020 11:53:53 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">In JS at least, NaNs in normal values are going to often require extra work to canonicalize their bit patterns.  Plus they'll mean computations <em>have</em> to be floating-point, when integer math might have otherwise been possible.  Inside CPUs, I am not <em>aware</em> that NaNs slow stuff down (denormals are the thing that really slows stuff, usually), but I may just not know enough.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Apr 28 2020 11:53:54 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">denormals we deal with in audio using FTZ/DAZ flags, but js is js, we can't do this</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Apr 28 2020 11:54:17 GMT-0700 (Pacific Daylight Time)">18:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Web Assembly may reduce or eliminate some of that NaN slowdown for canonicalizing...or it may not and I'm just wrong about that.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Apr 28 2020 11:57:30 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: I assume you have some experience with leaks in the browser?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Apr 28 2020 11:57:37 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">this is float32 audio computations, everything is in [-1, 1], so I expect js doesn't do any integer trickery</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Apr 28 2020 11:57:40 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">Man.  So GeneralParser embeds a TokenStream, but also inherits from ParserBase, which embeds a TokenStreamAnyChars</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Apr 28 2020 11:57:44 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">it's a 35x slowdown, give or take</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Apr 28 2020 11:57:44 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">browser/components/contextualidentity/test/browser/browser_serviceworkers.js sadly seems to reproducible leak 6 windows now</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Apr 28 2020 11:57:58 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">I can't even..</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Apr 28 2020 11:58:42 GMT-0700 (Pacific Daylight Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">This is fine.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Apr 28 2020 12:00:33 GMT-0700 (Pacific Daylight Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: We have some code in Ion that is float32 specific, but I don't know off the top of my head if it is only for wasm</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Apr 28 2020 12:01:10 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I suspect it probably is</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Apr 28 2020 12:01:33 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">35x slowdown sounds like you are falling off a JIT happy path</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Apr 28 2020 12:03:43 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Apr 28 2020 12:04:17 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">if that's sensible to you, it's fine (this is a bug, code without the bug is of course fine and the jit makes it very fast)</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Apr 28 2020 12:05:00 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">it turns out that feeding a stream of NaN into an OS audio stack produces lots of interesting things</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Apr 28 2020 12:06:41 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I'm vaguely curious about where you're falling off the happy path</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Apr 28 2020 12:06:45 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">(we're now flushing them to zero in software, but I still had glitches, but it turned out that the js code was 35 times slower, and that was over the real-time budget)</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Apr 28 2020 12:07:01 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">it's a small file and a one line diff if you want</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Apr 28 2020 12:07:19 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Point me at it and I will take a quick look</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Apr 28 2020 12:07:21 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: ok, I understand why I can't have TokenStreamCharsShared inherit from TokenStreamCharsBase now</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Apr 28 2020 12:08:01 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: the regular parser infrastructure actually splits those two inheritance lineages up, and uses AnyCharsAccess (template parameter) to provide access to the correct AnyChars</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Apr 28 2020 12:08:27 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">I meant to say "why I can't have TokenStreamCharsShared inherit from TokenStreamAnyShars"</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Apr 28 2020 12:09:00 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">It is absolutely a bit byzantine.  I don't remember the exact details of the setup, but I could page it in if I had to at any point.</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Apr 28 2020 12:09:19 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: <a href="https://paste.mozilla.org/RaFh4FVB#L22,23">https://paste.mozilla.org/RaFh4FVB#L22,23</a></td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Apr 28 2020 12:09:46 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: Numbers in the [-1, 1] range overlap the denormals a fair bit, I would expect regrettably.</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Apr 28 2020 12:09:47 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: I highlighted the two lines that need to change to fix the bug. <code>gain</code> is otherwise a <code>Float32Array</code> of 128 elements</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Apr 28 2020 12:09:58 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Maybe it's unavoidable, tho.</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Tue Apr 28 2020 12:10:30 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: it's fine.. I'm starting to get it.  The logic and state for TokenStream is <em>actually</em> split into two pieces.  ParserBase embeds one part (the TokenStreamAnyChars), which tracks some state, but not the actual charstream itself</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Tue Apr 28 2020 12:11:13 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: And GeneralParser embeds the TokenStreamChars lineage, which is the other half of the state, which contains the actual charstream</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Tue Apr 28 2020 12:11:48 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">djvj</span>: Back when I was looking at all this, I wanted to/thought we could basically inline the token stream bits into the separate parser classes and kill a bunch of complexity.  But someone, can't remember who, was adamant that being able to use just token streams on their own was useful, so that inlining ought not be done.</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Tue Apr 28 2020 12:12:23 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">We need to find that someone</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Tue Apr 28 2020 12:12:33 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">And in any event that inlining was totally afield of what I was <em>actually</em> trying to do, so I wasn't touching it at that point.</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Tue Apr 28 2020 12:12:34 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">but honestly even if we wanted to do that I don't know if it can be in-scope for the parser-atoms work</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Tue Apr 28 2020 12:12:37 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: it's a very big problem in audio, and for audio in js. wait until I tell you that audio is based on lots of reccursive filter in the form of <code>y[i] = y[i-1] * coeff + x[i] - x[i-1]</code></td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Tue Apr 28 2020 12:12:41 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">with coeff &lt; 1.0</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Tue Apr 28 2020 12:13:21 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">that converges to 0 when input is zero, which means that whenever you have silence in your processing, things slow down to a stop</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Tue Apr 28 2020 12:13:56 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: I'm surprised you can't upscale the math to the integral range of IEEE-754.  But I guess if you do that you also want to make sure to truncate fractional parts at the same time, and there may not be IEEE-754 ops (or microarchitectural ops) for that.</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Tue Apr 28 2020 12:14:31 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">we can but don't want to, because we like to still be able to compute way out of the [-1.0, 1.0] range to avoid clipping</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Tue Apr 28 2020 12:14:43 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">djvj</span>: Yeah, it's certainly not a pressing thing -- tho simplifying these hierarchies is arguably a debt well worth paying down sooner and not later.</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Tue Apr 28 2020 12:15:01 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">djvj</span>: Tho maybe the new frontend means it's moot, if we wait.</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Tue Apr 28 2020 12:15:11 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">what is important is that <em>at the end</em> you give the soundcard something in [-1.0, 1.0], so that the output doesn't distort</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Tue Apr 28 2020 12:15:55 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: I have no real objection to that - more that I don't know if it works with timeline scoping for ParserAtoms work (as in: it almost certainly doesn't).  We have given ourselves about 2 months to wrap up that <em>and</em> the stencil finalization work.</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Tue Apr 28 2020 12:17:19 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">I hope the new frontend makes this moot.  This is all eminently mootworthy.</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Tue Apr 28 2020 12:18:30 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">Ok, I think I'm heading back to "parser atoms ids should be pointers to heap-allocated parser-atom-thingies"</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Tue Apr 28 2020 14:20:27 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">What's the best way to dump the scopes for a piece of code? </td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Tue Apr 28 2020 14:27:37 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">"scopes"?</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Tue Apr 28 2020 14:28:14 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><code>dumpScopeChain</code> does exist even today, but I have zero idea if that's the meaning of scope you wanted to invoke or the context you wanted to invoke within.</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Tue Apr 28 2020 14:30:47 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><p>whoops. Closed riot window by accident :)</p>
<p><code>dumpScopeChain</code> looks pretty good</p>
</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Tue Apr 28 2020 14:30:53 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Thanks for the pointer!</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Tue Apr 28 2020 15:03:04 GMT-0700 (Pacific Daylight Time)">22:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">caroline</span>+++! The last of the BCE script flags are gone! Lazy BaseScripts now have the same flags as non-lazy ones</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Tue Apr 28 2020 15:06:05 GMT-0700 (Pacific Daylight Time)">22:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@caroline:mozilla.org">caroline</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>:  woop woooooop! 🥳</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Tue Apr 28 2020 15:10:15 GMT-0700 (Pacific Daylight Time)">22:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Spent the day reading André's already in-progress stack for implementing private fields. (@anba++) Tomorrow will probably continue down that road, and re-teach myself all sorts of things about how this engine works that I've forgotten or need to learn. </td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Tue Apr 28 2020 15:10:17 GMT-0700 (Pacific Daylight Time)">22:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>

</tbody></table></div></div></div>
</body></html>