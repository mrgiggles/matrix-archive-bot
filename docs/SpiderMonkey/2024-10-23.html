<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-10-23</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-10-23<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-10-22" class="nav-link"><span>prev</span></a>
<a href="2024-10-24" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Oct 23 2024 01:49:39 GMT-0700 (Pacific Daylight Time)">08:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@julienw:mozilla.org">julienw</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I would like to have a range constructor in JS. I have an array of marker start times in the profiler, and I'm computing the deltas between them: <code>[...Array(53).keys()].map(i =&gt; ts[i+1] - ts[i]).map(n =&gt; n.toFixed(1))</code></blockquote></mx-reply>Array.from({length: 53)}</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Oct 23 2024 01:50:27 GMT-0700 (Pacific Daylight Time)">08:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">That makes them all <code>undefined</code>, not <code>0, 1, 2, ..</code></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Oct 23 2024 01:50:57 GMT-0700 (Pacific Daylight Time)">08:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@julienw:mozilla.org">julienw</span>&gt;</div></td><td class="msg-cell">that's ok, because you can do <code>.map((_, i) =&gt; ...</code> :-)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Oct 23 2024 01:51:31 GMT-0700 (Pacific Daylight Time)">08:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@julienw:mozilla.org">julienw</span>&gt;</div></td><td class="msg-cell">otherwise this works too: Array.from({length: 53}, (_, i) =&gt; i)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Oct 23 2024 01:51:41 GMT-0700 (Pacific Daylight Time)">08:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@julienw:mozilla.org">julienw</span>&gt;</div></td><td class="msg-cell">but yeah, not so much better than the other one</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Oct 23 2024 01:52:22 GMT-0700 (Pacific Daylight Time)">08:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Performance wise much better though haha</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Oct 23 2024 01:52:58 GMT-0700 (Pacific Daylight Time)">08:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@julienw:mozilla.org">julienw</span>&gt;</div></td><td class="msg-cell">performance wise, a for loop would be better :D</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Oct 23 2024 01:52:58 GMT-0700 (Pacific Daylight Time)">08:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><p>There is a proposal in TC39 that would help, but it's not been very active lately: <a href="https://github.com/tc39/proposal-iterator.range">https://github.com/tc39/proposal-iterator.range</a></p>
<p>You'd do <code>Iterator.range(0, 53).toArray()</code></p>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Oct 23 2024 06:03:11 GMT-0700 (Pacific Daylight Time)">13:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">jon4t4n</span>: hi, I replied a bugzilla comment to you yesterday, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1858078#c5">https://bugzilla.mozilla.org/show_bug.cgi?id=1858078#c5</a> , in case you didn't see that (you were already ni?)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Oct 23 2024 07:32:23 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>There is a proposal in TC39 that would help, but it's not been very active lately: <a href="https://github.com/tc39/proposal-iterator.range">https://github.com/tc39/proposal-iterator.range</a></p>
<p>You'd do <code>Iterator.range(0, 53).toArray()</code></p>
</blockquote></mx-reply>We're planning to have an Outreachy intern look at this proposal starting in December.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Oct 23 2024 09:02:53 GMT-0700 (Pacific Daylight Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@jon4t4n:mozilla.org">jon4t4n</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-5">jon4t4n</span>: hi, I replied a bugzilla comment to you yesterday, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1858078#c5">https://bugzilla.mozilla.org/show_bug.cgi?id=1858078#c5</a> , in case you didn't see that (you were already ni?)</blockquote></mx-reply>Thanks! I'll take a look :)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Oct 23 2024 12:36:13 GMT-0700 (Pacific Daylight Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: remind me, are functions allocated from nursery, and will a minor GC collect them even if they were temporarily assigned to a JS::Heap?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Oct 23 2024 12:41:44 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">The underlying type is nursery-allocatable, but I'm trying to track down whether it is explicitly allocated in the tenured heap.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Oct 23 2024 12:42:58 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I just ran a test in the shell, and yes, they can be allocated in the nursery</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Oct 23 2024 12:43:27 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">a minor GC will definitely move them, if that's what you need</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Oct 23 2024 12:46:31 GMT-0700 (Pacific Daylight Time)">19:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">if one were in a JS::Heap and then overwritten, I don't think the pre-write barrier would change whether it's reachable. Which direction are you concerned with? It getting collected when you don't want it to, or not getting collected because of barriers or whatever?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Oct 23 2024 12:48:42 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I was thinking whether minor GC will collect it</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Oct 23 2024 12:49:15 GMT-0700 (Pacific Daylight Time)">19:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">If the JS::Heap was (temporarily) the only thing keeping it alive</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Oct 23 2024 12:51:29 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">this JS::Heap is not traced?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Oct 23 2024 12:52:03 GMT-0700 (Pacific Daylight Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">It is, but when minor GC runs, JS::Heap would have null value</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Oct 23 2024 12:52:41 GMT-0700 (Pacific Daylight Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">then I don't think it will keep it alive. Minor GC reachability depends on roots and the store buffer. Barriers won't keep them alive.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Oct 23 2024 12:52:52 GMT-0700 (Pacific Daylight Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">ok, good, thanks</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Oct 23 2024 12:53:45 GMT-0700 (Pacific Daylight Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Just thinking basically the case when one adds and then almost immediately removes an event listener</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Oct 23 2024 12:54:52 GMT-0700 (Pacific Daylight Time)">19:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">for major GC, I think that would matter. Specifically, if there's an ongoing incremental GC and you do that, then the event listener would not get collected.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Oct 23 2024 12:55:09 GMT-0700 (Pacific Daylight Time)">19:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">sure, that is fine</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Oct 23 2024 12:58:45 GMT-0700 (Pacific Daylight Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I don't know if there's any weirdness involved with JS reflectors or the holder map that could cause the event listener to be retained. <span class="nick-15">tcampbell</span> might know.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Oct 23 2024 13:06:09 GMT-0700 (Pacific Daylight Time)">20:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The weird reflectors are DOM objects that are both nsWrapperCache and also call <code>HoldJSObjects</code>, but I don't think that applies in this case for the <code>EventListenerHolder</code></td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Oct 23 2024 13:09:19 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Hmm, what is weird with those? All the wrapper caches need to call holdJSObject when there are expandos</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Oct 23 2024 13:10:03 GMT-0700 (Pacific Daylight Time)">20:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">but yes, CallbackObjects are simpler</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Oct 23 2024 13:12:38 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">wrapper caches calls holdjsobject only if expando added, while if objects with edges to gc directly call holdjsobject in constructor (and then again if expando added). Probably doesn't have much impact on when cleanup happens, since the JSHolderMap::Iter should remove entries the next time the holder is scanned</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Oct 23 2024 13:13:21 GMT-0700 (Pacific Daylight Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">oh, you mean extra edges to gc</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Oct 23 2024 13:13:34 GMT-0700 (Pacific Daylight Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">yeah, often holdjsobjects is called in the ctor</td></tr>

</tbody></table></div></div></div>
</body></html>