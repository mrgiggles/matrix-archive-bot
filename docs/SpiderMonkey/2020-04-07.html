<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-04-07</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-04-07<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-04-06" class="nav-link"><span>prev</span></a>
<a href="2020-04-08" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Apr 06 2020 17:44:58 GMT-0700 (Pacific Daylight Time)">00:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I think if C++11 had had template aliases and template variables, they never would have added the non-<code>_t</code>/<code>_v</code> varieties.  But C++11 only enabled the more-verbose phrasing, so the most compatible way is the fugliest/most error-prone way.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Apr 06 2020 17:45:35 GMT-0700 (Pacific Daylight Time)">00:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">And of course type traits techniques arose totally organically and were not designed into the language, hence to some degree why template aliases and variables came late.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Apr 06 2020 20:27:10 GMT-0700 (Pacific Daylight Time)">03:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I assume there is some evident reason why all these classes can't inherit from a class that you can statically cast through to get to a <code>uintptr_t header_</code>, right?  It seems extremely silly to demand standard-layout, to reinterpret addresses, when this is something that really ought be readily doable with a simple base class.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Apr 07 2020 01:53:03 GMT-0700 (Pacific Daylight Time)">08:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@bnjbvr:mozilla.org">Benjamin Bouvier</span>&gt;</div></td><td class="msg-cell">wow, ACM digital library is freely accessible for some time <a href="https://dl.acm.org/">https://dl.acm.org/</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Apr 07 2020 02:14:18 GMT-0700 (Pacific Daylight Time)">09:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is it really necessary for us to use <code>JS_FASTCALL</code> any more?  It's barely used, and it isn't immediately obvious to me that the places that use it are exactly the places that might demand some hypothetically "faster" custom ABI.</blockquote></mx-reply><span class="nick-15">Waldo</span>: +1 for removing it. It's only defined on 32-bit x86 anyway</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Apr 07 2020 02:38:57 GMT-0700 (Pacific Daylight Time)">09:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: I did it that way at first but it was thought to be more confusing for GC things to have one of their data members stored in the base class and accessed only via special accessors vs defining all data members in one place</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Apr 07 2020 02:46:09 GMT-0700 (Pacific Daylight Time)">09:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: "was thought" by whom?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Apr 07 2020 02:46:14 GMT-0700 (Pacific Daylight Time)">09:46</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span></div></td><td class="msg-cell">eyes <span class="nick-4">jonco</span> beadily</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Apr 07 2020 02:46:27 GMT-0700 (Pacific Daylight Time)">09:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">(shut up <span class="nick-12">Ms2ger [~half-time dedication]</span> ðŸ™‚)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Apr 07 2020 02:46:47 GMT-0700 (Pacific Daylight Time)">09:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Inheritance to access/encapsulate stuff is really perfectly normal...</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Apr 07 2020 02:51:18 GMT-0700 (Pacific Daylight Time)">09:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: by the people I asked for feedback on the patches, tcampbell and sfink.  It was discussed in a GC meeting but there are some comments from: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1625212#c5">https://bugzilla.mozilla.org/show_bug.cgi?id=1625212#c5</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Apr 07 2020 02:57:10 GMT-0700 (Pacific Daylight Time)">09:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Hmm.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Apr 07 2020 02:58:37 GMT-0700 (Pacific Daylight Time)">09:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Last I checked, we weren't doing this just yet, but ultimately we need to get to a place where <code>T* Allocate(JSContext* cx)</code> or some other function can placement-<code>new</code> its <code>T</code> into place.  That may end up working better with a base-class approach, that can be plugged into the constructor fairly normally...</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Apr 07 2020 03:00:49 GMT-0700 (Pacific Daylight Time)">10:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">BTW, <span class="nick-4">jonco</span>, spurred on by a long-ignored needinfo on bug 949220, I have started working on trying to disentangle singleton status from <code>NewObjectKind</code> somehow.  Mostly right now I'm just trying to encode <code>newObjectKind</code> into the function signature at each caller's allocation site, for now, to at least minimize the number of places that ever have to list a particular <code>NewObjectKind</code>, whether a constant or a computed variable.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Apr 07 2020 03:00:51 GMT-0700 (Pacific Daylight Time)">10:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/949220">https://bugzil.la/949220</a> â€” REOPENED (Waldo) â€” Object creation should be an atomic operation, such that if it succeeds, and reserved slots are immediately written to, finalizers can depend upon those writes having happened</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Apr 07 2020 03:03:45 GMT-0700 (Pacific Daylight Time)">10:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: agreed, ideally Allocate would take constructor arguments to pass on to placement new</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Apr 07 2020 03:05:46 GMT-0700 (Pacific Daylight Time)">10:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: 3AM, huh</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Apr 07 2020 03:10:15 GMT-0700 (Pacific Daylight Time)">10:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Yeah.  Late day yesterday, I'll make it up with a shorter day today.  :-)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Apr 07 2020 07:55:22 GMT-0700 (Pacific Daylight Time)">14:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Do we throw away Ion code on any (non-nursery) GC, or only on compacting GCs?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Apr 07 2020 07:56:20 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">definitely not on every GC, there are some heuristics. Compacting GCs will cancel in-progress compilations</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Apr 07 2020 07:56:56 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Oh, this is the part I was missing: <a href="https://searchfox.org/mozilla-central/source/js/src/gc/Zone.cpp#391-393">https://searchfox.org/mozilla-central/source/js/src/gc/Zone.cpp#391-393</a></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Apr 07 2020 08:01:34 GMT-0700 (Pacific Daylight Time)">15:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I might be missing something similar, but it looks like we cancel off-thread compilations even for non-compacting GC? <code>beginMarkPhase</code> calls <code>discardJITCodeForGC</code> unconditionally, which calls <code>CancelOffThreadIonCompile</code> unconditionally</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Apr 07 2020 08:06:54 GMT-0700 (Pacific Daylight Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: true.. it might be worth changing that. Maybe after warp we can be a bit more confident</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Apr 07 2020 08:13:55 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: does that mean the tracing code in WarpSnapshot is unreachable?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Apr 07 2020 08:14:02 GMT-0700 (Pacific Daylight Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(currently)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Apr 07 2020 08:15:49 GMT-0700 (Pacific Daylight Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: if there's an incremental gc, there can be compilations starting between gc slices. These will be marked as part of root marking (by each slice)</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Apr 07 2020 08:16:26 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Ah! Okay, good to know</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Apr 07 2020 08:16:33 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">That makes sense in retrospect</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Apr 07 2020 08:18:09 GMT-0700 (Pacific Daylight Time)">15:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: I wonder if we could do better there by marking the whole snapshot as marked/traced, so we don't have to go through the whole (immutable) snapshot on every slice. I can file a follow-up bug to investigate that</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Apr 07 2020 08:23:59 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">oh nursery GCs also trace the helper thread state afaict. Another follow-up</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Apr 07 2020 09:20:56 GMT-0700 (Pacific Daylight Time)">16:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: it is rare, but a nursery GC can also call discardJitCode() for a zone that is switching to pretenuring strings or bigints.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Apr 07 2020 11:56:51 GMT-0700 (Pacific Daylight Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@aholm:matrix.org">aholm</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">Benjamin Bouvier</span>: any suggestions for books to take a look at while the ACM digital library is freely accessible? I have access to the ACM digital library through work, but we don't have access to books in our subscription.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Apr 07 2020 14:20:02 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">confession: Remove <code>BytecodeEmitter::lazyScript</code> field to reduce BCE accesses to VM. (Bug 1627371)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Apr 07 2020 14:20:04 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Apr 07 2020 14:20:06 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1627371">https://bugzil.la/1627371</a> â€” NEW (tcampbell) â€” Eliminate BytecodeEmitter::lazyScript field</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Apr 07 2020 16:43:14 GMT-0700 (Pacific Daylight Time)">23:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: Do you have any thoughts on <a href="https://phabricator.services.mozilla.com/D68503">https://phabricator.services.mozilla.com/D68503</a>? Is there anyone else you think would be better to give feedback?</td></tr>

</tbody></table></div></div></div>
</body></html>