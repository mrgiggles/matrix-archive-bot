<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-11-30</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-11-30<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-11-29" class="nav-link"><span>prev</span></a>
<a href="2022-12-01" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Nov 29 2022 17:17:43 GMT-0800 (Pacific Standard Time)">01:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><p>huh.. TIL that you can define out-of-line inner classes in C++. I guess it isn't surprising, but I never realized it actually was allowed.</p>
<pre><code class="language-cpp">class A {
  class B;
};
class A::B {
  void mtd();
};
</code></pre>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Nov 30 2022 01:39:07 GMT-0800 (Pacific Standard Time)">09:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: review ping for bug 1797736</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Nov 30 2022 01:39:09 GMT-0800 (Pacific Standard Time)">09:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1797736">https://bugzil.la/1797736</a> — ASSIGNED (arai) — eager evaluation fails when inner function uses variable from outside its scope</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Nov 30 2022 08:27:06 GMT-0800 (Pacific Standard Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">How is PersistentRooted garbage collected? What happens if a PersistentRooted variable falls out of scope?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Nov 30 2022 08:27:31 GMT-0800 (Pacific Standard Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Even if it falls out of scope it stays in GC until process exits I assume?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Nov 30 2022 08:29:20 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">a PersistentRooted registers itself with the GC to be traced during the GC, which is what keeps whatever it is holding alive. When it goes out of scope, it unregisters itself. So no, if it goes out of scope, then whatever it was holding will no longer be kept alive (by that PersistentRooted; something else might keep it alive).</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Nov 30 2022 08:34:15 GMT-0800 (Pacific Standard Time)">16:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Thank you sfink</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Nov 30 2022 08:34:52 GMT-0800 (Pacific Standard Time)">16:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Reading that, it sounds like PersistentRooted works very similarly to Rooted which I find confusing</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Nov 30 2022 08:35:54 GMT-0800 (Pacific Standard Time)">16:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">we could call <code>Rooted</code> something like <code>TemporaryOnStackRooted</code>, but it's used a lot more. ;-)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Nov 30 2022 08:36:39 GMT-0800 (Pacific Standard Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>But note that JS::PersistentRooted in a struct or class is a rather dangerous thing to use — it will keep a GC thing alive, and most GC things end up keeping their global alive, so if your class/struct is reachable in any way from that global, then nothing will ever be cleaned up by the GC.</p>
</blockquote>
<p>Is this meant for binded classes/structs? Or just general encapsulation of PersistentRooted variables in classes/structs?</p>
</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Nov 30 2022 08:37:46 GMT-0800 (Pacific Standard Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><code>PersistentRooted</code> pretty much <em>is</em> the same as <code>Rooted</code>, but yes, it can be used in structs, on the heap, and doesn't need to be destructed in LIFO order.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Nov 30 2022 08:40:53 GMT-0800 (Pacific Standard Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it's good for things like the global root of a whole object graph, and makes a more convenient alternative to registering a callback for tracing the initial entry points into an embedding's graph.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Nov 30 2022 08:46:46 GMT-0800 (Pacific Standard Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: piing</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Nov 30 2022 12:11:59 GMT-0800 (Pacific Standard Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@laurencerowe:mozilla.org">laurencerowe</span>&gt;</div></td><td class="msg-cell">Hi, I'm seeing <code>InternalError: too much recursion</code> when running my script with the spidermonkey js.wasm (mozilla-release branch) under either wasmtime or through the SpiderMonkey WASI demo site. The script works fine when using native spidermonkey js cli (installed through Mac homebrew.) Is there a way to increase the recursion limit for the wasi version of spidermonkey?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Nov 30 2022 12:17:21 GMT-0800 (Pacific Standard Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">laurencerowe</span>: <a href="https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#1039">https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#1039</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Nov 30 2022 12:17:59 GMT-0800 (Pacific Standard Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">for the WASI stuff, it counts frames rather than bytes (since WASM call stack is virtual and directly accessible from code)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Nov 30 2022 12:21:59 GMT-0800 (Pacific Standard Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@laurencerowe:mozilla.org">laurencerowe</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> for the WASI stuff, it counts frames rather than bytes (since WASM call stack is virtual and directly accessible from code)</blockquote></mx-reply>100 is rather low (Python's default stack depth is 1000). Is it worth filing a bug? My script is calling React to server render some html.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Nov 30 2022 12:22:38 GMT-0800 (Pacific Standard Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">filing a bug and giving this sort of context is useful</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Nov 30 2022 12:51:55 GMT-0800 (Pacific Standard Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@laurencerowe:mozilla.org">laurencerowe</span>&gt;</div></td><td class="msg-cell">Created <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1803438">https://bugzilla.mozilla.org/show_bug.cgi?id=1803438</a></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Nov 30 2022 13:49:24 GMT-0800 (Pacific Standard Time)">21:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@laurencerowe:mozilla.org">laurencerowe</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Created <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1803438">https://bugzilla.mozilla.org/show_bug.cgi?id=1803438</a></blockquote></mx-reply>Given <code>wasiRecursionDepthLimit</code> is a constant used in only one place I was able to find it in the WAT and change it. My script required it be at least 221. Details added to bug report.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Nov 30 2022 14:30:23 GMT-0800 (Pacific Standard Time)">22:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">thanks for testing that</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Nov 30 2022 14:31:21 GMT-0800 (Pacific Standard Time)">22:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@laurencerowe:mozilla.org">laurencerowe</span>&gt;</div></td><td class="msg-cell">thanks for pointing me to the relevant code!</td></tr>

</tbody></table></div></div></div>
</body></html>