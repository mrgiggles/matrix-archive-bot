<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-10-04</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-10-04<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-10-01" class="nav-link"><span>prev</span></a>
<a href="2021-10-05" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Oct 04 2021 01:56:18 GMT-0700 (Pacific Daylight Time)">08:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">ANdi</span>: still investigating, it may take a little time</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Oct 04 2021 01:57:33 GMT-0700 (Pacific Daylight Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@andi:mozilla.org">ANdi</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">ANdi</span>: still investigating, it may take a little time</blockquote></mx-reply>I did the proposed fix and it kinda didn't fix the issue</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Oct 04 2021 01:57:47 GMT-0700 (Pacific Daylight Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell">yeah, i think it is an issue but it's not the issue we're looking for</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Oct 04 2021 08:03:32 GMT-0700 (Pacific Daylight Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">ANdi</span>: Disassembly points to this being a Clang/TSAN bug, I've ni?'d you</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Oct 04 2021 10:41:45 GMT-0700 (Pacific Daylight Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">Hey, folks! I'm getting ready to plan out a JSAPI project for a developer who is new to embedding.  I'm not new to JSAPI, but out of date (I know JS 1.8.5 very well).  We're going to try and run spidermonkey from inside of Python, sharing immutable memory between select JS and Python data types  (falling back to ctypes if that fails).   Any words of wisdom for us?

My big question is -- have any super major under the hood changes to basic data structures happened since jsapi moved to fatvals?  I Know we have a moving GC now, and interop with the GC will be very important for the project. I'm assuming that there is a way of declaring a "don't move my data" JS root, and the basic GC callback API probably still exists...  Are strings still basically uint16[] ?  Are jsvals still NAN-tagged float 64s?

I'll also need a basic network stack so that I can implement XHR if anybody happens to know of something...otherwise we can cobble together a basic reactor around select() or something.

(Does jorendorff still hack on spidermonkey?)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Oct 04 2021 10:46:41 GMT-0700 (Pacific Daylight Time)">17:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">wes</span>: values are still NaN-boxed doubles. Strings are arrays of either char or char16_t, depending on whether they contain any non-latin1 characters</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Oct 04 2021 10:47:01 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Hey Wes! It's been a while. jorendorff is gone, semi-recently (in the time scale of your involvement, pretty recently!)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Oct 04 2021 10:47:47 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">for the GC, if your data is in malloc memory held by the GC cell, then you're fine</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Oct 04 2021 10:48:03 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it gets more complicated if you want to store the data directly in the GC thing</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Oct 04 2021 10:49:16 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ctypes has sort of been on life support for a while -- Gecko has very few remaining uses and they're slowly being removed, and it's likely that we'll drop it from spidermonkey once that's gone</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Oct 04 2021 10:50:18 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the GC rooting APIs still exist, fewer of them than in 1.8.5, but there are easier ways now (eg <code>PersistentRooted</code>). See <a href="https://spidermonkey.dev/">https://spidermonkey.dev/</a> for examples.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Oct 04 2021 10:50:58 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: Cool - was wondering when an 8-bit backing store for characters was coming. :)   That's a good choice, giving how latin1 maps onto both utf16 and unicode.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Oct 04 2021 10:51:29 GMT-0700 (Pacific Daylight Time)">17:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">we'd kind of like it to be wtf-8, I think, but for now it's just latin1 or 16bit chunks</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Oct 04 2021 10:55:14 GMT-0700 (Pacific Daylight Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Out of curiosity, I checked, and the latin1 optimization landed <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=998392">seven years ago</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Oct 04 2021 10:58:55 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-12">sfink</span>: Bummer to hear about Jason, but I bet he's doing amazing things. I remember his early days here, hacking on tamarin, he was very kind and gracious and taught me many things.</p>
<p>Sorry to hear that ctypes is on life support...........OTOH I implemented a complete ffi for JS 1.8.5, and if things are kind of still the same I can reimplement something very similar to js-ctypes if I absolutely have to and hopefully wire it up to python C types  (I don't actually know anything about python...time to learn, I guess)</p>
<p>re strings -- v8 either does or did have a utf8 backing store (have not RTFSd in a long while), I can certainly see the value, especially when remote data is from a utf8 source. wtf-8 is a new one on me, thanks for the reference.......I initially thought it was going to be something like the old spidermonkey wctombs code (I think I actually wrote some patches on that back in the day) ...... but I see now that wtf-8 is what I thought utf-8 allowed AND it explains a bug I had in NodeJS a couple of years ago.  I was banging float64s, bitwise raw, into Strings and expecting them to make it across the network; but somewhere along the line my unpaired surrogates were getting rewritten as invalid code points.  This was in a distributed computing astrophysics application and it only harmed my mantissa, most of the time.  BOY was that fun to figure out.</p>
</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Oct 04 2021 10:59:56 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: ToT  Seven years!!!  I hate that I'm not as involved @moz as I'd like to be.   I landed the JS 1.8.5 release more than ten years ago  (face book told me earlier this year) and that was the last major work I did. :( :( :(</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Oct 04 2021 11:00:36 GMT-0700 (Pacific Daylight Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it must have been a good release, given how long people continued to use it... ;-)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Oct 04 2021 11:03:14 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Huh, V8 having a utf8 backing store is news to me. One of the obstacles to wtf8 is that the regexp engine wants to be able to index into strings (for eg Boyer-Moore search), which requires fixed-length characters, and we use the same regexp code as V8</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Oct 04 2021 11:05:36 GMT-0700 (Pacific Daylight Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-12">sfink</span>: That was no accident. Folks were using 1.7.0 at the time and some distros were shipping even earlier.  The distros wanted moz to adopt semver-style versioning for jsapi, at a time where jsapi wasn't even ABI compatible between -DDEBUG and -UDEBUG  (sizeof JSClass changed!!)....and they were trying to move to fatvals, improve tracemonkey, etc..... it took a fair bit of politicking behind the scenes with the distros to convince them to let mozjs185 in the ecosystem.  Now that release-train is on board and the path has been blazed, releases are (should be??) easier, but getting embedders to keep up with the major version changes (which become package changes) is still a challenge, I imagine.</p>
<p>I tried to address the API/ABI cross-release stuff with GPSEE, but ran out of capability.  Something in the future like N-API, though, would be cool.  (I actually think it should be possible to write a N-API layer for spidermonkey quite easily if it hasn't been done. Too bad it didn't exist during the spidernode push)</p>
</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Oct 04 2021 11:06:03 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: They definitely had one ten years ago.  But that is an eternity in JS engine time.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Oct 04 2021 11:06:26 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">(or maybe my brain is muddy - not impossible)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Oct 04 2021 11:06:38 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">Interesting problem with the regex, is the backing engine still a pcre fork?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Oct 04 2021 11:07:46 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Looks to me like they convert utf8 strings to latin1 or utf16 on <a href="https://source.chromium.org/chromium/chromium/src/+/main:v8/src/heap/factory.cc;l=735-764;drc=ed29b11535052162b60b14c1eaf88553f42b8d5b;bpv=0;bpt=1">construction</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Oct 04 2021 11:07:48 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>at a time where jsapi wasn't even ABI compatible between -DDEBUG and -UDEBUG</p>
</blockquote>
<p>this is still true, FWIW 😄</p>
</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Oct 04 2021 11:08:39 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">No, V8 wrote <a href="https://blog.chromium.org/2009/02/irregexp-google-chromes-new-regexp.html">irregexp</a>, and we stole it twice</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Oct 04 2021 11:08:49 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-4">wes</span>: most of the JSAPI C++-ified since.</p>
<p>For embedding, one of the trick which can be done is what is done in mozjs rust library, which is to have a vector of rooted elements.<br>However interaction between Python and SpiderMonkey memory collection is going to be some kind of a challenge (I would expect)</p>
</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Oct 04 2021 11:09:26 GMT-0700 (Pacific Daylight Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I wrote a blog post about the second import of irregexp <a href="https://hacks.mozilla.org/2020/06/a-new-regexp-engine-in-spidermonkey/">here</a></td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Oct 04 2021 11:12:16 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">wes</span>: I would recommend looking at Gecko cycle-collector interaction with the GC, but I am not even sure python offers APIs to tweak its memory management system.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Oct 04 2021 11:18:19 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">iain: Stole it twice. NICE! :)   &lt;reads blog&gt;

nbp: Thanks for mentioning the mozjs rust lib. This hadn't crossed my mind, I will certainly give that a read.   Re Gecko cycle-collector, I was thinking the same thing!  I actually mentioned this the other day as illustrative example of how two GCs can cooperate if done right.   Getting both GCs to interoperate will certainly be a challenge, I hope we can pull it off.  I guess we will be learning lots about the Python guts soon.  I am sick of our scientific computing stack being slow and bloated.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Oct 04 2021 11:27:00 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@ewlsh:gnome.org">ewlsh</span>&gt;</div></td><td class="msg-cell">You could take a look at GJS for interfacing with a reference counting system</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Oct 04 2021 11:28:02 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@ewlsh:gnome.org">ewlsh</span>&gt;</div></td><td class="msg-cell">GJS would've been only a few years old when you landed 1.8.5 <span class="nick-4">wes</span> ☺️

It's come a ways since then and distro packaging generally follows our release cycle now.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Oct 04 2021 11:38:11 GMT-0700 (Pacific Daylight Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> You could take a look at GJS for interfacing with a reference counting system</blockquote></mx-reply>ewish - nice! Glad to see that's still around. I do remember this project, it was in its infancy but very interesting to me.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Oct 04 2021 11:39:38 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@ewlsh:gnome.org">ewlsh</span>&gt;</div></td><td class="msg-cell">It now runs the entire GNOME desktop environment and we track the ESR builds 🎉</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Oct 04 2021 11:40:08 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">The cycle collector used to theoretically support interoperating with multiple languages, including Python, but I don't think it was ever actually used.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Oct 04 2021 11:40:46 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@ewlsh:gnome.org">ewlsh</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/</a>

<span class="nick-6">ptomato @ptomato:gnome.org</span> started this work and it's become quite wonderful</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Oct 04 2021 12:12:51 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">iain - great blog post, really helped pull some cobwebs out of my brain, too.  (BTW - I see you're in Canada - I'm in Kingston ON - if you're anywhere near Ottawa/Montreal/Toronto, I'd love to buy you lunch someday)

I also took a walk through memory lane and checked out v8's string implementation from 2009  (which is about the last time I read it).   They have two-byte and ascii backing store, but as you said, the utf8 is taken apart at constructor time, and either jammed into the ascii or the uint16 strings, depending on content.  They also have (had?) "sliced strings" which I'm guessing are some kind of rope.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Oct 04 2021 12:13:37 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Alas, I was in Toronto until a year or so ago, but now we're in Abbotsford</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Oct 04 2021 12:16:48 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">IIRC, V8's sliced strings are equivalent to our <a href="https://searchfox.org/mozilla-central/source/js/src/vm/StringType.h#93">dependent strings</a>, which are a cheap way to make substrings of an existing string</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Oct 04 2021 12:17:27 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Looks like ropes in V8 are called ConsStrings</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Oct 04 2021 12:18:55 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Basically, there's a bunch of different string representations listed in <a href="https://searchfox.org/mozilla-central/source/js/src/vm/StringType.h#81">this SMDOC</a>, and last time I checked there was pretty much a one-to-one mapping between the string types in SM and V8</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Oct 04 2021 12:37:29 GMT-0700 (Pacific Daylight Time)">19:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">oh it's already a new cycle</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Oct 04 2021 13:39:16 GMT-0700 (Pacific Daylight Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">Iain - Abbotsford!  Nice place.  I visited on my way to visit the left coast a couple of years back.  My buddy has a Volkswagen Westfalia (ontario plate VAN GOUGH) parked in Abby that I borrowed for the duration.  

Thanks for the SMDOC pointer. That's all new. I will be reading lots.  This is great, way better than bugging brendan, shaver, jorendorff and waldo when I don't grok the source. :) :) </td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Oct 04 2021 13:55:20 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">There are [SMDOC] comments scattered <a href="https://searchfox.org/mozilla-central/search?path=&amp;q=%5Bsmdoc%5D">throughout the code</a>, which is basically an indication that at some point somebody thought it was an important concept and put an above-average amount of effort into documenting it</td></tr>

</tbody></table></div></div></div>
</body></html>