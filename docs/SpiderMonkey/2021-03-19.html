<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-03-19</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-03-19<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-03-18" class="nav-link"><span>prev</span></a>
<a href="2021-03-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Mar 18 2021 18:50:33 GMT-0700 (Pacific Daylight Time)">01:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">Hey, does it means MPhiIterator will used to iterate all phi in a block?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Mar 18 2021 19:43:45 GMT-0700 (Pacific Daylight Time)">02:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">18f</span>: Yes, that will iterate over all of the phis in the block</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Mar 18 2021 19:45:02 GMT-0700 (Pacific Daylight Time)">02:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-4">18f</span>: Yes, that will iterate over all of the phis in the block</blockquote></mx-reply>Interesting, I mean, could it be empty?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Mar 18 2021 19:45:51 GMT-0700 (Pacific Daylight Time)">02:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">If it have one element. Then "it == end' will always  be true, so nothing happend?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Mar 18 2021 19:52:29 GMT-0700 (Pacific Daylight Time)">02:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">18f</span>: InlineList uses a sentinel node as the end of the list, so a list with one element would visit that element, and then visit the sentinel node. <code>it == end</code> would be false when visiting the element.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Mar 18 2021 19:52:46 GMT-0700 (Pacific Daylight Time)">02:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The implementation is in this file: <a href="https://searchfox.org/mozilla-central/source/js/src/jit/InlineList.h">https://searchfox.org/mozilla-central/source/js/src/jit/InlineList.h</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Mar 18 2021 19:53:22 GMT-0700 (Pacific Daylight Time)">02:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">cool, I fully understand it. </td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Mar 18 2021 19:53:28 GMT-0700 (Pacific Daylight Time)">02:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">thank u!</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Mar 18 2021 20:27:11 GMT-0700 (Pacific Daylight Time)">03:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/mozilla/gecko-dev/blob/cfffcfb4c03737d963945c2025bbbe75beef45c6/js/src/jit/IonAnalysis.cpp#L41">https://github.com/mozilla/gecko-dev/blob/cfffcfb4c03737d963945c2025bbbe75beef45c6/js/src/jit/IonAnalysis.cpp#L41</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Mar 18 2021 20:27:18 GMT-0700 (Pacific Daylight Time)">03:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">hey, I read this code</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Mar 18 2021 20:28:31 GMT-0700 (Pacific Daylight Time)">03:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">understand DFS on tree is easy. But if there are loop backage, it's not simple. is there any slide or blog about this? </td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Mar 18 2021 20:29:02 GMT-0700 (Pacific Daylight Time)">03:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <code>ReversePostOrder</code> goes forward in the CFG, so when marking predecessors before successors. In this case this is used to compute the cost of blocks and flag them as bailing, and thus successors as unreachable.<br><code>PostOrder</code> goes backward in the CFG, so visiting successors before predecessors. In this case this used to matter when the removal was part of the loop, as we want to mark predecessors before removing the back-edges. This then got split in 2 loops for sanity.</blockquote></mx-reply>like this part...</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Mar 18 2021 21:05:24 GMT-0700 (Pacific Daylight Time)">04:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">18f</span>: I don't know of any good blog posts. This wikipedia section might be useful: <a href="https://en.wikipedia.org/wiki/Depth-first_search#Vertex_orderings">https://en.wikipedia.org/wiki/Depth-first_search#Vertex_orderings</a></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Mar 18 2021 21:16:18 GMT-0700 (Pacific Daylight Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But it's actually pretty simple. When we generate blocks in WarpBuilder, we add each block to the CFG before we add its successors (except for backedges). Because of this, if you walk through the list of blocks backwards, you visit the successors of each block before you visit the block itself (ignoring backedges), which is postorder.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Mar 18 2021 21:16:42 GMT-0700 (Pacific Daylight Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which means that walking through the list of blocks forward is reverse postorder.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Mar 18 2021 21:17:16 GMT-0700 (Pacific Daylight Time)">04:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">When we add or remove blocks, we always preserve this property</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Mar 18 2021 21:18:27 GMT-0700 (Pacific Daylight Time)">04:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">In debug builds, we verify it after each pass here: <a href="https://searchfox.org/mozilla-central/source/js/src/jit/IonAnalysis.cpp#2837-2857">https://searchfox.org/mozilla-central/source/js/src/jit/IonAnalysis.cpp#2837-2857</a></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Mar 18 2021 21:41:07 GMT-0700 (Pacific Daylight Time)">04:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">ok, I will think about this.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Mar 18 2021 21:41:14 GMT-0700 (Pacific Daylight Time)">04:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@18f:mozilla.org">18f</span>&gt;</div></td><td class="msg-cell">üòêÔ∏è</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Mar 19 2021 00:10:02 GMT-0700 (Pacific Daylight Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Re: Native Modules
Are there any plans to support non-scripted modules or do I have to try a different approach? </td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Mar 19 2021 04:01:18 GMT-0700 (Pacific Daylight Time)">11:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">is there a way to define something in a module locally from the JSAPI?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Mar 19 2021 04:02:16 GMT-0700 (Pacific Daylight Time)">11:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">like, define a local variable as a given <code>Value</code> inside a module</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Mar 19 2021 04:13:33 GMT-0700 (Pacific Daylight Time)">11:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: is it after compiling the module script?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Mar 19 2021 04:14:10 GMT-0700 (Pacific Daylight Time)">11:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">before or after, both can work</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Mar 19 2021 04:14:22 GMT-0700 (Pacific Daylight Time)">11:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if "after", adding extra binding won't work in term of ES spec (&lt;- nvm, I was thinking wrong thing)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Mar 19 2021 04:15:27 GMT-0700 (Pacific Daylight Time)">11:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if "before", the easiest way would be to modify the module script source itself to contain the declaration</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Mar 19 2021 04:17:16 GMT-0700 (Pacific Daylight Time)">11:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I was trying to get it to hold the native JS Object</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Mar 19 2021 04:17:57 GMT-0700 (Pacific Daylight Time)">11:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>I think people have tried hacks by having a wrapper .mjs file that has the export list and in the body calls some helper method that populates those bindings. I don't recall if that plan worked though..</p>
</blockquote>
<p>I'm basically trying this right now, but the only way I've gotten it to work so far pollutes the global scope</p>
</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Mar 19 2021 04:18:22 GMT-0700 (Pacific Daylight Time)">11:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><pre><code class="language-rs">                rooted!(in(cx) let fs_module = JS_NewPlainObject(cx));
		rooted!(in(cx) let undefined = UndefinedValue());
		rooted!(in(cx) let rglobal = global);
		if JS_DefineFunctionsWithHelp(cx, fs_module.handle().into(), METHODS.as_ptr()) {
			rooted!(in(cx) let fs_module_obj = ObjectValue(fs_module.get()));
			if JS_DefineProperty(cx, rglobal.handle().into(), "fsInternal\0".as_ptr() as *const i8, fs_module_obj.handle().into(), 0) {
				return register_module(cx, &amp;String::from("fs"), compile_module(cx, &amp;String::from("fs"), &amp;String::from(FS_SOURCE)));
					// &amp;&amp; JS_SetProperty(cx, rglobal.handle().into(), "fsInternal\0".as_ptr() as *const i8, undefined.handle().into());
			}
		}
		false
</code></pre>
</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Mar 19 2021 04:22:40 GMT-0700 (Pacific Daylight Time)">11:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">maybe I misunderstood the question</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Mar 19 2021 04:26:21 GMT-0700 (Pacific Daylight Time)">11:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what does "locally" mean?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Mar 19 2021 04:26:39 GMT-0700 (Pacific Daylight Time)">11:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">local as in only accessible from the helper module</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Mar 19 2021 04:27:03 GMT-0700 (Pacific Daylight Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">like how if you have a <code>let x = thing</code> in a module, you can't access <code>x</code> from other scripts/modules</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Mar 19 2021 04:34:10 GMT-0700 (Pacific Daylight Time)">11:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">let me check how module environment works</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Mar 19 2021 04:38:37 GMT-0700 (Pacific Daylight Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, it cannot be global object, right?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Mar 19 2021 04:41:57 GMT-0700 (Pacific Daylight Time)">11:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">it cannot be on the global object, yes</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Mar 19 2021 04:58:16 GMT-0700 (Pacific Daylight Time)">11:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I cannot find any way so far</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Mar 19 2021 06:25:29 GMT-0700 (Pacific Daylight Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">18f</span>: This is how DFS is made possible on a graph, by rejecting loops: <a href="https://github.com/mozilla/gecko-dev/blob/cfffcfb4c03737d963945c2025bbbe75beef45c6/js/src/jit/IonAnalysis.cpp#L106-L110">https://github.com/mozilla/gecko-dev/blob/cfffcfb4c03737d963945c2025bbbe75beef45c6/js/src/jit/IonAnalysis.cpp#L106-L110</a> Thus a directed graph without loops is a DAG, on which you can use DFS safely.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Mar 19 2021 06:47:47 GMT-0700 (Pacific Daylight Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span> thanks for the review. I am going to merge after the soft freeze</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Mar 19 2021 06:54:47 GMT-0700 (Pacific Daylight Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">confession: Try to locate the best file to add a global variable ‚Ä¶ js/xpconnect it sounds like it would be, as being the closest thing to JS while being able to rely on IPC features ‚Ä¶</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Mar 19 2021 06:54:48 GMT-0700 (Pacific Daylight Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Mar 19 2021 14:45:26 GMT-0700 (Pacific Daylight Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Rapidly approaching the point where I can put Jason's private methods patch stack out for review. Still a little bit of work left to do, but not enough energy to do it. Debug.frame.eval needs new bytecode to work properly though, so I'm going to punt there for now.</td></tr>

</tbody></table></div></div></div>
</body></html>