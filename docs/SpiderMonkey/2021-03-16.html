<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-03-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-03-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-03-15" class="nav-link"><span>prev</span></a>
<a href="2021-03-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Mar 15 2021 17:57:50 GMT-0700 (Pacific Daylight Time)">00:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">in the object returned by js::gc::NewMemoryInfoObject (<a href="https://searchfox.org/mozilla-central/source/js/public/GCAPI.h#1184">https://searchfox.org/mozilla-central/source/js/public/GCAPI.h#1184</a>) (let's call it <code>info</code>), what is the difference between <code>info.gcBytes</code>/<code>info.mallocBytes</code> on the one hand, and <code><a href="http://info.zone">info.zone</a>.gcBytes</code>/<code><a href="http://info.zone">info.zone</a>.mallocBytes</code> on the other?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Mar 15 2021 18:00:03 GMT-0700 (Pacific Daylight Time)">01:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">and is there another way to get this info, using the embedder API, without allocating a JSObject?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Mar 15 2021 19:13:15 GMT-0700 (Pacific Daylight Time)">02:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: info.gcBytes should give the sum over all zones</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Mar 15 2021 19:13:33 GMT-0700 (Pacific Daylight Time)">02:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">info.mallocBytes is the same, except I think there can also be malloc memory not associated with any ZOne</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Mar 15 2021 19:15:13 GMT-0700 (Pacific Daylight Time)">02:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><code>gc::NewMemoryInfoObject</code> does allocate an object, but all of its fields are getters that access runtime-wide state. So you only need one.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Mar 15 2021 19:15:25 GMT-0700 (Pacific Daylight Time)">02:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I don't think the things it accesses are exposed through the embedding API</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Mar 15 2021 19:16:02 GMT-0700 (Pacific Daylight Time)">02:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">internally, it calls eg <code>cx-&gt;runtime()-&gt;gc.heapSize.bytes()</code> which looks very much non-exposed</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Mar 15 2021 19:17:06 GMT-0700 (Pacific Daylight Time)">02:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">bleh. Actually, I see from the implementation of mallocBytes that it purely sums over all Zones. We now do have accounting that could be exposed that would better match what I said first.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Mar 15 2021 19:40:33 GMT-0700 (Pacific Daylight Time)">02:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Mar 15 2021 19:41:44 GMT-0700 (Pacific Daylight Time)">02:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">as an embedder, if I'm looking for meaningful statistics about how much memory my embedded code (say, GNOME Shell for example) is using, is one of these more meaningful than the other?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Mar 15 2021 19:42:52 GMT-0700 (Pacific Daylight Time)">02:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">I only have one JSContext, so I believe that means only one zone? so <code><a href="http://info.zone">info.zone</a>.gcBytes</code> would indicate more accurately what my JS code is taking up? whereas <code>info.gcBytes</code> includes other JS engine overhead?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Mar 15 2021 19:42:56 GMT-0700 (Pacific Daylight Time)">02:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">is that accurate?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Mar 15 2021 19:48:13 GMT-0700 (Pacific Daylight Time)">02:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">JSContext is (now) per-runtime, so it's not at all surprising that you'd only have one. (You would need another process or at least thread to have another one.)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Mar 15 2021 19:48:29 GMT-0700 (Pacific Daylight Time)">02:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but how many Zones you have is somewhat separate</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Mar 15 2021 19:48:53 GMT-0700 (Pacific Daylight Time)">02:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">unless you're explicitly creating multiple zones, you'd normally just have one of those too</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Mar 15 2021 19:49:44 GMT-0700 (Pacific Daylight Time)">02:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">so the numbers may be the same. Though in your version, there's a self-hosting zone that sort of gets shared -- I guess in light of that, you're right, <code><a href="http://info.zone">info.zone</a>.gcBytes</code> would be a better estimate for your JS code</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Mar 15 2021 19:50:19 GMT-0700 (Pacific Daylight Time)">02:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but note that if you <em>do</em> create multiple Zones, the zone it's reporting on is the zone that the memory object is in, which is a little weird.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Mar 15 2021 19:51:04 GMT-0700 (Pacific Daylight Time)">02:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">hm, in the shell the zone and total numbers are rather different</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Mar 15 2021 19:51:33 GMT-0700 (Pacific Daylight Time)">02:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">so maybe it is better to just use the zone-specific one, to ignore whatever else that is</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Mar 15 2021 19:52:33 GMT-0700 (Pacific Daylight Time)">02:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">note that these leak a fair amount of internal state, so it might be better not to have them available to your equivalent of user code</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Mar 15 2021 20:07:16 GMT-0700 (Pacific Daylight Time)">03:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">indeed, I'm piping them to sysprof (<a href="https://wiki.gnome.org/Apps/Sysprof">https://wiki.gnome.org/Apps/Sysprof</a>)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Mar 15 2021 20:09:22 GMT-0700 (Pacific Daylight Time)">03:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">in a small test program I've been seeing numbers like: <code>{ gcBytes: 1077248, mallocBytes: 217866, zone: { gcBytes: 577536, mallocBytes: 80590 } }</code></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Mar 15 2021 20:11:26 GMT-0700 (Pacific Daylight Time)">03:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">I've also been wondering if the numbers that you get from <code>JS::CollectRuntimeStats</code> are these same ones but expressed differently?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Mar 15 2021 20:11:59 GMT-0700 (Pacific Daylight Time)">03:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell"><code>JS::RuntimeStats::realmTotals</code> and <code>JS::RuntimeStats::zTotals</code> are quite different from each other</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Mar 15 2021 20:14:57 GMT-0700 (Pacific Daylight Time)">03:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Hm. One difference is that the memory object is used by pretty much nobody, and is really giving a direct read on internal data structures. RuntimeStats is actually used, often, for <code>about:memory</code> and so probably sees a lot more testing. Not to mention that it's <a href="https://searchfox.org/mozilla-central/rev/a848cde8a73065fcc41902ac58c65821eb9a44ca/js/public/MemoryMetrics.h#807-828">somewhat documented</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Mar 15 2021 20:15:57 GMT-0700 (Pacific Daylight Time)">03:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it looks like RuntimeStats is probably a bit slower (it iterates over more stuff; the memory object iterates over zones but I think that's it)</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Mar 15 2021 20:16:26 GMT-0700 (Pacific Daylight Time)">03:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">oh, interesting</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Mar 15 2021 20:16:33 GMT-0700 (Pacific Daylight Time)">03:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">until recently, the malloc stats from the memory object were useless, since we only tracked allocations and not deallocations. But it should be better now.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Mar 15 2021 20:17:17 GMT-0700 (Pacific Daylight Time)">03:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">do you recall a bug number from that? I'm curious if it's been fixed in esr78</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Mar 15 2021 20:17:28 GMT-0700 (Pacific Daylight Time)">03:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">there was something that seemed to only go up and not down, but I'm not sure if it was that</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Mar 15 2021 20:18:19 GMT-0700 (Pacific Daylight Time)">03:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">in that doc snippet, what's the difference between decommitted and unused bytes?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Mar 15 2021 20:18:56 GMT-0700 (Pacific Daylight Time)">03:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">bug 1395509, it looks like. That was 55.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Mar 15 2021 20:18:57 GMT-0700 (Pacific Daylight Time)">03:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1395509">https://bugzil.la/1395509</a> — RESOLVED (jonco) — Track the amount of malloc memory precisely</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Mar 15 2021 20:19:37 GMT-0700 (Pacific Daylight Time)">03:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">decommitted is where we told the OS that we wouldn't use the memory and it could kick it out of the page file or whatever. (The exact semantics differ slightly between OSes.)</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Mar 15 2021 20:20:37 GMT-0700 (Pacific Daylight Time)">03:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">VirtualFree(MEM_DECOMMIT) on WIndows, madvise(MADV_DONTNEED) on linux, madvise(MADV_FREE_REUSABLE) on osx</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Mar 15 2021 20:20:53 GMT-0700 (Pacific Daylight Time)">03:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">got it</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Mar 15 2021 20:21:30 GMT-0700 (Pacific Daylight Time)">03:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">so the virtual memory addresses are still allocated, but no physical memory backing them</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Mar 15 2021 20:30:20 GMT-0700 (Pacific Daylight Time)">03:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">what's the difference between <code>realmTotals</code> and <code>zTotals</code> in RuntimeStats?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Mar 15 2021 20:31:07 GMT-0700 (Pacific Daylight Time)">03:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">especially if I collect them into TabSizes</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Mar 15 2021 20:31:30 GMT-0700 (Pacific Daylight Time)">03:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">I get 0 strings in the realmTotals, and 0 objects and 0 private in the zTotals</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Mar 15 2021 20:31:46 GMT-0700 (Pacific Daylight Time)">03:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">not quite sure what the difference is between "private" and "other" in TabSizes</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Mar 15 2021 20:59:04 GMT-0700 (Pacific Daylight Time)">03:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm not sure. realmTotals are for realms, zTotals are for zones, given what you said I'm guessing that it's because strings are zone-wide and all objects are in realms already so they are accounted there instead of in the realm.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Mar 15 2021 20:59:09 GMT-0700 (Pacific Daylight Time)">03:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I have to run now, sorry</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Mar 15 2021 20:59:32 GMT-0700 (Pacific Daylight Time)">03:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">thanks for all the answers though! I really appreciate it</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Mar 16 2021 02:00:57 GMT-0700 (Pacific Daylight Time)">09:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-8">Redfire</span>: I am not look into this. I don't know much about moz-js. Maybe open an issue and ask them directly?</blockquote></mx-reply><a href="https://github.com/servo/rust-mozjs/issues/538">https://github.com/servo/rust-mozjs/issues/538</a><br>Just made one, let's see if they have any idea what's happening.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Mar 16 2021 02:41:04 GMT-0700 (Pacific Daylight Time)">09:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">completely unrelated<br>let's say I wanted to make all the methods on <code>console</code> getters so they could not be modified by the user at runtime, how would I go about such a thing?<br><a href="https://doc.servo.org/mozjs/jsapi/type.JSGetterOp.html">https://doc.servo.org/mozjs/jsapi/type.JSGetterOp.html</a> this looks like it could be useful, but I'm not sure how I could use it</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Mar 16 2021 02:45:33 GMT-0700 (Pacific Daylight Time)">09:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">can't you just define them as non-configurable/non-writable? <code>JSPROP_READONLY | JSPROP_PERMANENT</code> attributes</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Mar 16 2021 02:46:14 GMT-0700 (Pacific Daylight Time)">09:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">JSGetterOps are a bit weird, it's best not to use them if you can</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Mar 16 2021 02:48:11 GMT-0700 (Pacific Daylight Time)">09:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/526a5089c61db85d4d43eb0e46edaf1f632e853a/js/src/shell/js.cpp#10513-10522">this</a> is an example of a getter property, but note that getters can still be redefined with defineProperty if they're configurable</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Mar 16 2021 02:50:09 GMT-0700 (Pacific Daylight Time)">09:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">currently, i'm defining the methods with <code>JS_DefineFunctionsWithHelp</code>, I assume I'd have to switch to <code>JS_DefinePropertyById</code> to use the attributes?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Mar 16 2021 02:53:09 GMT-0700 (Pacific Daylight Time)">09:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: I think you can use the readonly/permanent attributes I mentioned above as <code>flags</code> <a href="https://searchfox.org/mozilla-central/rev/526a5089c61db85d4d43eb0e46edaf1f632e853a/js/src/jsfriendapi.h#183-194">here</a></td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Mar 16 2021 02:56:51 GMT-0700 (Pacific Daylight Time)">09:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">can you only use 1 flag then?</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Mar 16 2021 03:02:35 GMT-0700 (Pacific Daylight Time)">10:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it's a bit mask, so you can use multiple flags like this: <code>JSPROP_READONLY | JSPROP_PERMANENT</code></td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Mar 16 2021 03:03:00 GMT-0700 (Pacific Daylight Time)">10:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">oh, the flags are set up such that the bits never overlap</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Mar 16 2021 03:03:41 GMT-0700 (Pacific Daylight Time)">10:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">so i'd want ENUMERATE, READONLY and PERMANENT?</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Mar 16 2021 03:37:41 GMT-0700 (Pacific Daylight Time)">10:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">rips, updating mozjs broke building <a href="https://gist.github.com/Redfire75369/6e801b7bbd3f477122438cbe28b00550">https://gist.github.com/Redfire75369/6e801b7bbd3f477122438cbe28b00550</a></td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Mar 16 2021 06:02:19 GMT-0700 (Pacific Daylight Time)">13:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span> <span class="nick-15">lth</span>: I wonder if for jit-related prefs we should generally push them to only apply on restarts, and maybe work with Fx UI folks to add a "restart required" hint to about:config?</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Mar 16 2021 06:03:01 GMT-0700 (Pacific Daylight Time)">13:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I presume the main problem is remembering to restart rather than the restart?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Mar 16 2021 06:04:13 GMT-0700 (Pacific Daylight Time)">13:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">+1, for the (non-Wasm) JIT prefs we've already been moving to process-wide and restart-required</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Mar 16 2021 06:04:25 GMT-0700 (Pacific Daylight Time)">13:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">One thing I'm not sure how to handle is all the JitOptions that were never exposed as prefs. We probably don't want them as enumerable prefs, and probably don't want them un-enumerable for the browser case?</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Mar 16 2021 06:04:53 GMT-0700 (Pacific Daylight Time)">13:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">lol.. maybe we need to add ENUMERABLE / CONFIGURABLE / RESTART bits to the yaml ;)</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Mar 16 2021 06:05:05 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><code>about:config</code> is the UI for advanced users and the gfx prefs for example also require a restart, so I'm not too worried about changing behavior there</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Mar 16 2021 06:05:43 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, would be nice to have an icon or a message at the top saying "restart required" if you toggle one of them</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Mar 16 2021 06:06:48 GMT-0700 (Pacific Daylight Time)">13:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(I think new content processes get the new pref value without <code>mirror: once</code>?)</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Mar 16 2021 06:09:36 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: for JitOptions we never exposed as prefs, maybe we should just keep these in JitOptions for now,? I'm not sure about 'polluting' StaticPrefList.yaml with internal knobs</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Mar 16 2021 06:11:19 GMT-0700 (Pacific Daylight Time)">13:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Maybe we want our own yaml for them?</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Mar 16 2021 06:11:43 GMT-0700 (Pacific Daylight Time)">13:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Even if internal knobs, we expose a bunch to the shell, and we realy don't want to have worker/non-worker surprises</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Mar 16 2021 06:11:45 GMT-0700 (Pacific Daylight Time)">13:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I think that would be ideal, maybe could be combined with how we handle shell flags</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Mar 16 2021 06:12:42 GMT-0700 (Pacific Daylight Time)">13:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">they are already process-wide though</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Mar 16 2021 06:12:49 GMT-0700 (Pacific Daylight Time)">13:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">true</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Mar 16 2021 06:13:12 GMT-0700 (Pacific Daylight Time)">13:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I guess I want to generalize JitOptions to not be limited to jit</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Mar 16 2021 06:13:24 GMT-0700 (Pacific Daylight Time)">13:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">contextoptions seems to basically be never what we want</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Mar 16 2021 06:15:30 GMT-0700 (Pacific Daylight Time)">13:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">realm options could probably be migrated too, we sometimes use these for new features but it has the same potential for footguns</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Mar 16 2021 06:18:18 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: so we'd have InternalPrefList.yaml with exactly the same format? then exposing a pref to the browser is a matter of moving it to StaticPrefList.yaml, that sounds nice</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Mar 16 2021 06:25:30 GMT-0700 (Pacific Daylight Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, that would be the thought</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Mar 16 2021 06:57:46 GMT-0700 (Pacific Daylight Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: i think that would be fine.  in the past we (wasm) have erred on the side of flexibility but the result is frequently messy and brittle</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Mar 16 2021 07:45:31 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: did you ever consider generating the C++ interpreter from the baseline interpreter codegen?  i.e. writing out C++ to a file or something.  i guess that sounds silly</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Mar 16 2021 07:47:23 GMT-0700 (Pacific Daylight Time)">14:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">i guess that's what jsc does with the llint cloop target, though they have that external ruby compiler</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Mar 16 2021 07:48:08 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">maybe it buys nothing for a low-overhead part</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Mar 16 2021 07:48:21 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">we've considered generating trampolines + blinterp code at build time and then baking it into the binary, but it's quite a lot of work</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Mar 16 2021 07:48:26 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-10" title="@jandem:mozilla.org">jandem</span></div></td><td class="msg-cell">back in an hour or so</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Mar 16 2021 07:49:11 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-9" title="@awingo:igalia.com">wingo</span></div></td><td class="msg-cell">nod</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Tue Mar 16 2021 08:29:13 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">oh we got our first question discourse <a href="https://discourse.mozilla.org/t/js-wasm-vs-js-native-function-call-overhead/77120">https://discourse.mozilla.org/t/js-wasm-vs-js-native-function-call-overhead/77120</a></td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Tue Mar 16 2021 13:38:21 GMT-0700 (Pacific Daylight Time)">20:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Thoughts on removing internal-to-engine uses of <code>JSID_IS_ATOM</code> and <code>JSID_TO_ATOM</code>, replacing them with the <code>PropertyKey</code> methods, leaving those macro-like functions to embeddings? (Would a great fountain of good-first-bugs for outreachy, and remove a peculiar API-- also simpler code after)</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Tue Mar 16 2021 13:41:33 GMT-0700 (Pacific Daylight Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: the plan is definitely to remove all <code>JSID_</code> APIs. It's just a lot of work</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Tue Mar 16 2021 13:42:03 GMT-0700 (Pacific Daylight Time)">20:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">A lot of work that's mechanical is -exactly- what we would like right now :) </td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Tue Mar 16 2021 13:43:07 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Good</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Tue Mar 16 2021 13:44:42 GMT-0700 (Pacific Daylight Time)">20:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I'll plan to open a meta bug + write a template for generating these bugs + a few examples tomorrow, unless there are objections :) </td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Tue Mar 16 2021 15:51:07 GMT-0700 (Pacific Daylight Time)">22:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">sounds good to me. I also defer to evilpie's judgment on this question anyways.</td></tr>

</tbody></table></div></div></div>
</body></html>