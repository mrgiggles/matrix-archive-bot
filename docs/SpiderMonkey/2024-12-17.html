<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-12-17</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-12-17<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-12-13" class="nav-link"><span>prev</span></a>
<a href="2024-12-18" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Dec 17 2024 09:54:05 GMT-0800 (Pacific Standard Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">Is there some documentation about <code>WasmBuiltinModule.yaml</code> I am not sure to fully understand the <code>type: Args_Int32_GeneralInt32Float32Float32....</code> part. I thought it was just the same signature than the underlying C++ function but it seems to have nuances</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Dec 17 2024 09:55:24 GMT-0800 (Pacific Standard Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is there some documentation about <code>WasmBuiltinModule.yaml</code> I am not sure to fully understand the <code>type: Args_Int32_GeneralInt32Float32Float32....</code> part. I thought it was just the same signature than the underlying C++ function but it seems to have nuances</blockquote></mx-reply>No, unfortunately there's not. It's sort of an internal detail. The type should be the signature, what nuances are you seeing?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Dec 17 2024 09:55:31 GMT-0800 (Pacific Standard Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">Also can someone confirm that all signatures are i32 or f32, even if it's going to hold other int and float types</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Dec 17 2024 09:55:58 GMT-0800 (Pacific Standard Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/jit/ABIFunctionType.h#18-30">https://searchfox.org/mozilla-central/source/js/src/jit/ABIFunctionType.h#18-30</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Dec 17 2024 09:59:26 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">thx</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Dec 17 2024 10:00:49 GMT-0800 (Pacific Standard Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p>can you confirm the pattern is :</p>
<pre><code>  type: Args_&lt;output type&gt;_General&lt;input types&gt;General
</code></pre>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Dec 17 2024 10:03:05 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">Yes, the first 'General' refers to the implicit wasm::Instance* pointer we pass to the builtin function. the last 'General' refers the the implicit uint8_t* Heap pointer we pass to the builtin function</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Dec 17 2024 10:03:13 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/wasm/WasmInstance.cpp#661">https://searchfox.org/mozilla-central/source/js/src/wasm/WasmInstance.cpp#661</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Dec 17 2024 10:03:39 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">^ this is a memcopy builtin we have, showing the implicit extra params we pass</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Dec 17 2024 10:05:44 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">thx</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Dec 17 2024 10:14:32 GMT-0800 (Pacific Standard Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p>I am trying to add a new option to the built in declaration, and I get :</p>
<pre><code>WasmBuiltins.cpp:1686:7: error: use of undeclared identifier 'Args_Int32_GeneralInt32Float32Int32Int32Int32Int32Int32General'
</code></pre>
<p>the fonction is defined with :</p>
<pre><code>- op: I8Multiply
  symbolic_address:
    name: IntrI8Multiply
    type: Args_Int32_GeneralInt32Float32Int32Int32Int32Int32Int32General
  entry: intgemm::IntrI8Multiply
  export: int8_multiply
  params:
    - 'i32'
    - 'f32'
    - 'i32'
    - 'i32'
    - 'i32'
    - 'i32'
    - 'i32'
    - 'i32'  &lt;-- is this the output ?
  fail_mode: FailOnNegI32
  uses_memory: true
</code></pre>
</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Dec 17 2024 10:15:51 GMT-0800 (Pacific Standard Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p>with the function being:</p>
<pre><code>int32_t IntrI8Multiply(wasm::Instance* instance, uint32_t inputMatrixA,
                       float zeroPointA, uint32_t inputMatrixB, uint32_t zeroPointB,
                       uint32_t rowsA,  // M
                       uint32_t width,  // N
                       uint32_t colsB,  // K
                       uint32_t output, uint8_t* memBase);
</code></pre>
</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Dec 17 2024 10:16:09 GMT-0800 (Pacific Standard Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I am adding <code>zeroPointB</code></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Dec 17 2024 10:19:10 GMT-0800 (Pacific Standard Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Awesome profile of Mayank here: <a href="https://blog.mozilla.org/community/2024/12/16/contributor-spotlight-mayank-bansal/">https://blog.mozilla.org/community/2024/12/16/contributor-spotlight-mayank-bansal/</a> </td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Dec 17 2024 10:29:55 GMT-0800 (Pacific Standard Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">or maybe I need to kill the generated ABI header file in obj?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Dec 17 2024 10:30:55 GMT-0800 (Pacific Standard Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I know nothing about the specifics of the wasm builtins, but,if you haven't tried a clobber build definitely start there. I wouldn't super trust we've nailed all the dependencies on generated files perfectly</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Dec 17 2024 10:32:17 GMT-0800 (Pacific Standard Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(And if you're able to start with a shell build, I'd do that, then iterate out to a browser) </td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Dec 17 2024 10:37:43 GMT-0800 (Pacific Standard Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: bbiab, but check out ABIFunctionType.yaml</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Dec 17 2024 10:46:54 GMT-0800 (Pacific Standard Time)">18:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">amazing. What feels like a totally innocuous split of a public header file (that should be a no-op change for any consumers) has somehow breaks our media code IPC building for reasons that are thus far -totally- beyond me </td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Dec 17 2024 10:47:34 GMT-0800 (Pacific Standard Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">it seems to have broken a friend class resolution but I cannot fathom why</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Dec 17 2024 10:58:25 GMT-0800 (Pacific Standard Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Do you have a link to a patch for the change?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Dec 17 2024 11:19:26 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: (back now) did that help? You should be able to add an entry there and ./mach build will generate all the stuff needed for it</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Dec 17 2024 11:19:31 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/jit/ABIFunctionType.yaml">https://searchfox.org/mozilla-central/source/js/src/jit/ABIFunctionType.yaml</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Dec 17 2024 11:20:38 GMT-0800 (Pacific Standard Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">it did I edited it and it fixed it thanks</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Dec 17 2024 11:21:00 GMT-0800 (Pacific Standard Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I think I was just lucky before because my function signature was already covered in its old version</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Dec 17 2024 11:25:53 GMT-0800 (Pacific Standard Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">yeah, the ABIFunctionType system is a little annoying. It used to be worse, to add a new signature type you used to need to update like 5 different files. but it'd be even nicer if we could get rid of the yaml somehow</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Dec 17 2024 11:34:58 GMT-0800 (Pacific Standard Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">one thing I notice is that when I have a buggy header to expose the API in the caller, I can tab crash. But for some reason even with a debug build, I was not able to get a traceback or anything. even with <code>javascript.options.wasm_verbose</code> -- is there another flag that can help for this?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Dec 17 2024 11:41:32 GMT-0800 (Pacific Standard Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-16">Ryan Hunt</span>: another weird thing I don't understand. in Bergamot, they expose the API in the client with</p>
<pre><code>    __attribute__((import_module("wasm_gemm"), import_name("int8_multiply")))
</code></pre>
<p>for example, but the types of the input can be greatly different from the built in one (like using int8 and pointers etc)/<br>is there a rule here or we just make the assumption the WASM ABI layer just pass it through</p>
</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Dec 17 2024 11:42:01 GMT-0800 (Pacific Standard Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">example: <a href="https://github.com/browsermt/marian-dev/blob/master/src/tensors/cpu/wasm_intgemm_interface.h#L230">https://github.com/browsermt/marian-dev/blob/master/src/tensors/cpu/wasm_intgemm_interface.h#L230</a></td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Dec 17 2024 11:43:56 GMT-0800 (Pacific Standard Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">our definition: <a href="https://searchfox.org/mozilla-central/source/js/src/wasm/WasmBuiltinModule.yaml#173-193">https://searchfox.org/mozilla-central/source/js/src/wasm/WasmBuiltinModule.yaml#173-193</a></td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Dec 17 2024 11:44:42 GMT-0800 (Pacific Standard Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">and then the definition <a href="https://searchfox.org/mozilla-central/source/js/src/intgemm/IntegerGemmIntrinsic.h#307-315">https://searchfox.org/mozilla-central/source/js/src/intgemm/IntegerGemmIntrinsic.h#307-315</a></td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Dec 17 2024 11:52:08 GMT-0800 (Pacific Standard Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell">Yeah, types shall match in sense of size and kind. Pointer in wasm32 memory is uint32_t offset. Rest of them shall be less magical e.g. wasm f32 is float,  wasm i32  is int32_t</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Dec 17 2024 11:52:25 GMT-0800 (Pacific Standard Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> one thing I notice is that when I have a buggy header to expose the API in the caller, I can tab crash. But for some reason even with a debug build, I was not able to get a traceback or anything. even with <code>javascript.options.wasm_verbose</code> -- is there another flag that can help for this?</blockquote></mx-reply><span class="nick-13">Tarek</span>: a buggy header for compiling the wasm side? That's really odd. Best idea I have would be to try to attach GDB to the process before the crash and catch it that way</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Dec 17 2024 11:53:16 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Yeah, types shall match in sense of size and kind. Pointer in wasm32 memory is uint32_t offset. Rest of them shall be less magical e.g. wasm f32 is float,  wasm i32  is int32_t</blockquote></mx-reply>Yeah, was just going to say that a pointer on the wasm side, is really just an offset into the sandboxed memory. So to wasm code it looks like <code>uint8_t*</code> but to the VM it's really just a uint32_t</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Dec 17 2024 11:53:29 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">and that uint32_t needs to get added to <code>memBase</code> to get the real pointer</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Dec 17 2024 11:54:18 GMT-0800 (Pacific Standard Time)">19:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">So the good practice is to keep uint32_t and float in <a href="https://searchfox.org/mozilla-central/source/js/src/intgemm/IntegerGemmIntrinsic.h">https://searchfox.org/mozilla-central/source/js/src/intgemm/IntegerGemmIntrinsic.h</a> and cast etc</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Dec 17 2024 11:55:04 GMT-0800 (Pacific Standard Time)">19:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>and that uint32_t needs to get added to memBase to get the real pointer</p>
</blockquote>
<p>is this something to do through code or is this automatic?</p>
</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Dec 17 2024 11:55:08 GMT-0800 (Pacific Standard Time)">19:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell">For C++ pointer in wasm code (and we don't want cast any other types like float)</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Dec 17 2024 11:58:42 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: <a href="https://searchfox.org/mozilla-central/source/js/src/intgemm/IntegerGemmIntrinsic.cpp#205">https://searchfox.org/mozilla-central/source/js/src/intgemm/IntegerGemmIntrinsic.cpp#205</a></td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Dec 17 2024 11:59:56 GMT-0800 (Pacific Standard Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">oh yeah I do this for my pointers. I was just wondering if somethign extra was needed so that data was part of membase</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Dec 17 2024 11:59:57 GMT-0800 (Pacific Standard Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">so for that parameter, on the wasm code side it's some sort of pointer, on the wasm VM side, it's a uint32_t that is in offset into memBase. You can see when that function needs to access the contents of the wasm code's pointer it reads from memBase</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Dec 17 2024 12:00:07 GMT-0800 (Pacific Standard Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">okay</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Dec 17 2024 12:03:30 GMT-0800 (Pacific Standard Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">yury</span>: I have implemented a naive MatMul that works, and Serge has made a neon flavor of it and we're adding this into the patch alongside gemmology (he used some API there). We could not really use the existing high level Shift::Multiply because the way it transposes the matrices is not onnx friendly. Now the remaining part is me gluing evertything together. I had it working earlier today and now it crashes because I probably did some crap. But hopefully we'll have a v1 of the POC this week along with a benchmark</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Dec 17 2024 12:16:27 GMT-0800 (Pacific Standard Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-16">Ryan Hunt</span>: I have this code that fails when calling my API, saying that my matrix goes <em>over</em> the wasm buffer limit:</p>
<pre><code>size_t GetWasmRawBufferLength(const uint8_t* memBase) {
  const js::WasmSharedArrayRawBuffer* rawBuf =
      js::WasmSharedArrayRawBuffer::fromDataPtr(memBase);
  return rawBuf-&gt;volatileByteLength();
}
</code></pre>
<p>quick question, is this supposed to be the same size than the one we set when creating the WebAssembly.Memory?</p>
</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Dec 17 2024 12:22:37 GMT-0800 (Pacific Standard Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">Yes, the length you get there should be basically the same as the length you use when constructing the wasm memory</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Dec 17 2024 12:22:56 GMT-0800 (Pacific Standard Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">Only reason itâ€™d be different is if you grew the memory, I think</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Dec 17 2024 12:23:08 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> amazing. What feels like a totally innocuous split of a public header file (that should be a no-op change for any consumers) has somehow breaks our media code IPC building for reasons that are thus far -totally- beyond me </blockquote></mx-reply>Woof. People were getting mozilla/Variant.h types accidentally by including js/Stack.h</td></tr>

</tbody></table></div></div></div>
</body></html>