<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-07-26</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-07-26<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-07-25" class="nav-link"><span>prev</span></a>
<a href="2023-07-27" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Jul 26 2023 06:39:29 GMT-0700 (Pacific Daylight Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">How do you feel about removing the <code>JSLocaleCallbacks</code>? We don't use in the browser anymore and I doubt any embedding uses it.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Jul 26 2023 06:40:00 GMT-0700 (Pacific Daylight Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">(I am looking into making some more localization stuff per-realm, similar to what I did for Timezones)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Jul 26 2023 06:43:47 GMT-0700 (Pacific Daylight Time)">13:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@pchimento:igalia.com">ptomato (at GUADEC, limited availability)</span>&gt;</div></td><td class="msg-cell">GJS has not used them since we started requiring a build of SpiderMonkey <code>--with-intl-api</code> (because they are never called if Intl API is present)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Jul 26 2023 06:45:45 GMT-0700 (Pacific Daylight Time)">13:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> GJS has not used them since we started requiring a build of SpiderMonkey <code>--with-intl-api</code> (because they are never called if Intl API is present)</blockquote></mx-reply>Thanks for confirming that. The situation in Firefox is the same, we just use ICU.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Jul 26 2023 07:24:46 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><p>Hi team,<br>I have a question here. If I don't use internal queue initialized by "UseInternalJobQueues()", but use boost::asio::io_context instead for asynchronized operations</p>
<ol>
<li>can mozjs work well?</li>
<li>need I abandon in-build components(eg. JS::NewPromiseObject()), and encapsulate my own?</li>
<li>Does js::RunJobs() still work</li>
<li>Which components are affected by js::RunJobs(), if I abandon internal job queue, should I encapsulate them all?</li>
</ol>
<p>Thx</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jul 26 2023 07:48:28 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: probably fine. Maybe also time to consider removing <code>--without-intl-api</code>...</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jul 26 2023 08:05:34 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">kevin_wang_22</span>: job queue is simply a queue of a JSFunction which executes a reaction to each promise resolution, and the embedding is supposed to call those functions at certain point, such as after executing a top-level script.  in order to use job queue with <code>RunJobs</code>, you need to either call <code>UseInternalJobQueues</code>, or call <code>JS::SetJobQueue</code> with your own job queue implementation.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jul 26 2023 08:07:21 GMT-0700 (Pacific Daylight Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">are you trying to implement your own job queue as a subclass of <a href="https://searchfox.org/mozilla-central/rev/b6b8ff043e944a5e32ea63208d3ba7cb6b16191d/js/public/Promise.h#34">JS::JobQueue</a> using <code>io_context</code> ?  or trying to do it without <code>JS::JobQueue</code> ?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jul 26 2023 08:09:23 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you don't use <code>JS::JobQueue</code>, then <code>Promise</code> and any other promise-based things (async function, etc) don't work</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jul 26 2023 08:14:31 GMT-0700 (Pacific Daylight Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if you don't use <code>JS::JobQueue</code>, then <code>Promise</code> and any other promise-based things (async function, etc) don't work</blockquote></mx-reply>I just want to use without JS::JobQueue, because there are 2 queues running in a single thread if I add io_context , not easy to handle events. But as you say Promise will not work, are there other components will be affected?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jul 26 2023 08:19:21 GMT-0700 (Pacific Daylight Time)">15:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>Promise</code>, async function, async generator, module's top-level await, and dynamic import</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jul 26 2023 08:19:59 GMT-0700 (Pacific Daylight Time)">15:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and <code>Array.fromAsync</code></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jul 26 2023 08:20:42 GMT-0700 (Pacific Daylight Time)">15:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to be clear, "doesn't work" here means, if it's used inside the script, it crashes with nullptr dereference</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jul 26 2023 08:21:18 GMT-0700 (Pacific Daylight Time)">15:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <code>Promise</code>, async function, async generator, module's top-level await, and dynamic import</blockquote></mx-reply>Is there method to post a callback into a job queue, just like boost::asio::io_context::post()</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jul 26 2023 08:25:54 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">when you implement your own job queue based on <code>JS::JobQueue</code>, you can do anything you want there.  <code>JS::JobQueue</code> doesn't force what kind of storage or algorithm it uses</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jul 26 2023 08:26:43 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, for example, if you want to handle the promise reaction job and other job created by your embedding in the same way, your job queue needs to have a job class that holds either promise reaction job or your custom job</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jul 26 2023 08:26:54 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and execute them when <code>runJobs</code> is called</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jul 26 2023 08:27:22 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><a href="https://searchfox.org/mozilla-central/rev/b6b8ff043e944a5e32ea63208d3ba7cb6b16191d/js/public/Promise.h#34,56-59,76">https://searchfox.org/mozilla-central/rev/b6b8ff043e944a5e32ea63208d3ba7cb6b16191d/js/public/Promise.h#34,56-59,76</a></p>
<pre><code class="language-cpp">class JS_PUBLIC_API JobQueue {
...
  virtual bool enqueuePromiseJob(JSContext* cx, JS::HandleObject promise,
                                 JS::HandleObject job,
                                 JS::HandleObject allocationSite,
                                 JS::HandleObject incumbentGlobal) = 0;
...
  virtual void runJobs(JSContext* cx) = 0;
</code></pre>
</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jul 26 2023 08:28:10 GMT-0700 (Pacific Daylight Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so, for example, if you want to handle the promise reaction job and other job created by your embedding in the same way, your job queue needs to have a job class that holds either promise reaction job or your custom job</blockquote></mx-reply>Thx, let me do some investigation</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jul 26 2023 08:38:31 GMT-0700 (Pacific Daylight Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/b6b8ff043e944a5e32ea63208d3ba7cb6b16191d/xpcom/base/CycleCollectedJSContext.h#134">mozilla::CycleCollectedJSContext</a> is an example of <code>JS::JobQueue</code> subclass, which is used inside Firefox.  (it implements many other things tho...)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jul 26 2023 08:38:49 GMT-0700 (Pacific Daylight Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <a href="https://searchfox.org/mozilla-central/rev/b6b8ff043e944a5e32ea63208d3ba7cb6b16191d/xpcom/base/CycleCollectedJSContext.h#134">mozilla::CycleCollectedJSContext</a> is an example of <code>JS::JobQueue</code> subclass, which is used inside Firefox.  (it implements many other things tho...)</blockquote></mx-reply>Thx</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jul 26 2023 09:10:36 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">Is there an idiomatic way to ensure a JS function gets compiled with Ion for a jit-test? I was able to do it by calling it in a loop that runs a million times, but I think that's overkill</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jul 26 2023 09:14:29 GMT-0700 (Pacific Daylight Time)">16:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: If you add <code>// |jit-test| --fast-warmup; --ion-offthread-compile=off</code> as the first line, then we decrease the warmup thresholds so that Ion compilation happens on iteration 30 (see <a href="https://searchfox.org/mozilla-central/source/js/src/jit/JitOptions.cpp#407">here</a>), and avoid the need to race the compilation with the main thread.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jul 26 2023 09:15:12 GMT-0700 (Pacific Daylight Time)">16:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">There's also an <code>inIon()</code> testing function that returns true iff the code calling it is running in Ion</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jul 26 2023 09:19:31 GMT-0700 (Pacific Daylight Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: perfect, that will work nicely</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jul 26 2023 09:23:18 GMT-0700 (Pacific Daylight Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">I also see <code>--ion-eager</code> is available, which seems even better than <code>--fast-warmup</code></td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jul 26 2023 09:24:42 GMT-0700 (Pacific Daylight Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><code>--ion-eager</code> will set the threshold to 0, but you'll usually bail out immediately because if we never run in baseline, we don't have any CacheIR to transpile, so a bunch of code looks unreachable. It will eventually stabilize, but <code>--fast-warmup</code> gets there more smoothly</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jul 26 2023 10:29:23 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so, for example, if you want to handle the promise reaction job and other job created by your embedding in the same way, your job queue needs to have a job class that holds either promise reaction job or your custom job</blockquote></mx-reply><p>I browse the source code of <code>InternalJobQueue</code>, so does it mean when calling <code>Promise, async function, async generator, module's top-level await, dynamic import, Array.fromAsync</code> will automatically invoke <code>JS::JobQueue::enqueuePromiseJob()</code>?</p>
<p>If so, I think I can implement a customized queue with boost::asio::io_context like this:</p>
<pre><code>class MyJobQueue : public JS::JobQueue{
public: 
      bool enqueuePromiseJob(JSContext* cx, JS::HandleObject promise,
                         JS::HandleObject job, JS::HandleObject allocationSite,
                         JS::HandleObject incumbentGlobal) override    {
              ioContext.post([cx, promise, job, allocationSite, incumbentGlobal](){
                        // execute the job
              });
              return;
      }  

      void runJobs(JSContext * cx) override{
             ioContext.run();
      }
private:
     boost::asio::io_context ioContext;
};
</code></pre>
<p>is that right?</p>
</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jul 26 2023 10:31:41 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">calling Promise itself doesn't enqueue job, but when a Promise is resolved, a job for reaction is enqueued (like, when you've called <code>promise.then(fun)</code>, a reaction job that calls <code>fun</code> will be enqueued).  but yeah, <code>enqueuePromiseJob</code> is called by JS engine automatically whenever a job is created</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jul 26 2023 10:33:40 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> calling Promise itself doesn't enqueue job, but when a Promise is resolved, a job for reaction is enqueued (like, when you've called <code>promise.then(fun)</code>, a reaction job that calls <code>fun</code> will be enqueued).  but yeah, <code>enqueuePromiseJob</code> is called by JS engine automatically whenever a job is created</blockquote></mx-reply>Thx</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Jul 26 2023 10:33:44 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and yes, if the <code>ioContext</code>'s job is called at appropriate timing, it will work</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Jul 26 2023 10:34:10 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, what you need to make sure is to root the <code>job</code> object until you call it</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Jul 26 2023 10:34:40 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">otherwise the <code>job</code> object will be GC-ed</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Jul 26 2023 10:34:53 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> then, what you need to make sure is to root the <code>job</code> object until you call it</blockquote></mx-reply>Can I just follow InternalJobQueue to execute the job?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Jul 26 2023 10:36:00 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Jul 26 2023 10:36:50 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the ioContext is on heap, you can use <a href="https://searchfox.org/mozilla-central/rev/b6b8ff043e944a5e32ea63208d3ba7cb6b16191d/js/public/RootingAPI.h#1401">JS::PersistentRooted</a></td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Jul 26 2023 13:57:58 GMT-0700 (Pacific Daylight Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">I'm importing the test262 decorators tests, using a feature check. I have two that fail because I don't yet support private decorators, how can I skip just these tests? The README says to update jstests.list to skip the tests, but the top of that file says it's automatically generated and not to edit it. It's not super important in that I'm the only one working on decorators, but it would be nice to keep things clean.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Jul 26 2023 13:59:22 GMT-0700 (Pacific Daylight Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">I'm trying to understand how the <code>!<a href="http://xulRuntime.shell">xulRuntime.shell</a></code> condition in <a href="https://searchfox.org/mozilla-central/source/js/src/tests/non262/Array/from_async.js#1">this test</a> gets evaluated, but I haven't had any luck tracking it down. The test is executed by <code>./mach jstests</code> and is not skipped when I run it locally. Is there another test harness that runs it where <code>!<a href="http://xulRuntime.shell">xulRuntime.shell</a></code> would cause it to be skipped?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Jul 26 2023 14:19:07 GMT-0700 (Pacific Daylight Time)">21:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm trying to understand how the <code>!<a href="http://xulRuntime.shell">xulRuntime.shell</a></code> condition in <a href="https://searchfox.org/mozilla-central/source/js/src/tests/non262/Array/from_async.js#1">this test</a> gets evaluated, but I haven't had any luck tracking it down. The test is executed by <code>./mach jstests</code> and is not skipped when I run it locally. Is there another test harness that runs it where <code>!<a href="http://xulRuntime.shell">xulRuntime.shell</a></code> would cause it to be skipped?</blockquote></mx-reply>This skips the tests when run in the browser via <code>./mach jstestbrowser</code></td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Jul 26 2023 14:19:25 GMT-0700 (Pacific Daylight Time)">21:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm importing the test262 decorators tests, using a feature check. I have two that fail because I don't yet support private decorators, how can I skip just these tests? The README says to update jstests.list to skip the tests, but the top of that file says it's automatically generated and not to edit it. It's not super important in that I'm the only one working on decorators, but it would be nice to keep things clean.</blockquote></mx-reply>Use <a href="https://searchfox.org/mozilla-central/source/js/src/tests/jstests.list">https://searchfox.org/mozilla-central/source/js/src/tests/jstests.list</a></td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Jul 26 2023 14:20:17 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(there are two files with identical names which causes no end of confusion) </td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Jul 26 2023 14:49:50 GMT-0700 (Pacific Daylight Time)">21:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> This skips the tests when run in the browser via <code>./mach jstestbrowser</code></blockquote></mx-reply><p>Thanks!<br>I think I'm still missing something, though. When I try to run <code>./mach jstestbrowser</code>, I get the following error:</p>
<pre><code> 0:00.48 W Clobber not needed.
  Parallelism determined by memory: using 63 jobs for 64 cores based on 62.6 GiB RAM and estimated job size of 1.0 GiB
 0:00.48 /usr/bin/gmake -j63 -s stage-jstests
 0:00.49 gmake: *** No rule to make target 'stage-jstests'.  Stop.
 0:00.49 W 6 compiler warnings present.
Hey! Builds initiated with `mach build $A_SPECIFIC_TARGET` may not always work, even if the code being built is correct. Consider doing a bare `mach build` instead.
REFTEST WARNING | runreftest.py | Failed to copy /home/bryan/src/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/plugins to profile
REFTEST WARNING | runreftest.py | Failed to copy /home/bryan/src/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/test-stage/jsreftest/tests/js/src/tests/user.js to profile
REFTEST INFO | Running with e10s: True
REFTEST INFO | Running with fission: True
REFTEST INFO | Application command: /home/bryan/src/mozilla-unified/obj-debug-x86_64-pc-linux-gnu/dist/bin/js -marionette -profile /tmp/tmpf40npcf6.mozrunner
Error: Short option followed by junk: -marionette

</code></pre>
<p>Should I be using a browser build instead of a SM build?</p>
</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Jul 26 2023 14:50:49 GMT-0700 (Pacific Daylight Time)">21:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, it's for browser build</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Jul 26 2023 14:52:41 GMT-0700 (Pacific Daylight Time)">21:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, if you want to run specific test, you'll need to run something like <code>./mach jstestbrowser --filter=non262/Array/from_async.js</code> .   directly passing the test's path as TEST_PATH parameter doesn't work as expected (bug 1844656)</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Jul 26 2023 14:52:42 GMT-0700 (Pacific Daylight Time)">21:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1844656">https://bugzil.la/1844656</a> — NEW (nobody) — ./mach jstestbrowser's TEST_PATH parameter help message doesn't match the behavior</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Jul 26 2023 14:53:49 GMT-0700 (Pacific Daylight Time)">21:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it uses reftest's framework to run jstests in browser environment</td></tr>

</tbody></table></div></div></div>
</body></html>