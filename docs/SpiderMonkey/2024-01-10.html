<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-01-10</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-01-10<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-01-08" class="nav-link"><span>prev</span></a>
<a href="2024-01-11" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jan 09 2024 23:26:24 GMT-0800 (Pacific Standard Time)">07:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">What's the reason for TC39 specs not having a WebIDL-like abstraction for describing the built-ins and instead having step-by-step rules for crossing from the calling script into the built-in code? My guess is that the number of built-ins in the core spec is so small and so special-casey that an IDL didn't make sense and then <code>Intl</code> continued in the same way despite having different nature, and then Temporal also just continuing in the same way. Is my guess correct, or is there more to it?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jan 09 2024 23:32:14 GMT-0800 (Pacific Standard Time)">07:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">Has there been an analysis of whether the boundary crossing rules in <code>Intl</code> are regular enough that there could be an abstraction instead of case-by-case rules at the boundary?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jan 09 2024 23:49:37 GMT-0800 (Pacific Standard Time)">07:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there seem to be some attempt for IDL in ECMAScript: <a href="https://github.com/w3ctag/jsidl">https://github.com/w3ctag/jsidl</a> and <a href="https://github.com/tc39/proposal-idl">https://github.com/tc39/proposal-idl</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jan 09 2024 23:55:23 GMT-0800 (Pacific Standard Time)">07:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">Thanks. 11 years ago and 6 years ago, it seems.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Jan 10 2024 05:30:12 GMT-0800 (Pacific Standard Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">AFAICT, <code>js::ClassSpec</code> makes the mapping of method name to C++ function data-driven, but the C++ function itself is always responsible for manually marshaling the arguments and the return value. Is there a reason other than inlining for execution speed why there isn't a data-driven spec for argument and return value marshaling?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jan 10 2024 05:36:00 GMT-0800 (Pacific Standard Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@ms2ger:igalia.com">Ms2ger (back in 2024 W2)</span>&gt;</div></td><td class="msg-cell">As far as I'm aware, historical reasons and it being quite hard to mapt</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jan 10 2024 05:36:12 GMT-0800 (Pacific Standard Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@ms2ger:igalia.com">Ms2ger (back in 2024 W2)</span>&gt;</div></td><td class="msg-cell"> *the spec requirements into that model</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jan 10 2024 05:49:34 GMT-0800 (Pacific Standard Time)">13:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">for SpiderMonkey internal, I'm planning to introduce IDL, generated from the spec, and auto-generate binding code. the current prototype uses "any" for all types, and each native remains same, but maybe we could extend it to use other types and generate more binding code</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jan 10 2024 05:51:43 GMT-0800 (Pacific Standard Time)">13:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">Is there a work-in-progress patch or a design doc that I can read?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jan 10 2024 05:55:09 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the patch stack is in <a href="https://treeherder.mozilla.org/jobs?repo=try&amp;group_state=expanded&amp;revision=4ab9eb90818a09ffad2b79fbba921d98a837a79c">this try run</a> .  the IDL look like <a href="https://hg.mozilla.org/try/file/4ab9eb90818a09ffad2b79fbba921d98a837a79c/js/src/webidl/Spec.webidl">this</a>, and bindgen is in <a href="https://hg.mozilla.org/try/file/4ab9eb90818a09ffad2b79fbba921d98a837a79c/js/src/bindings/">this directory</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jan 10 2024 05:55:19 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">I'm trying to understand how big a deal would it be to declare e.g. an array of argument conversion function pointers so that the engine would loop over such an array of argument marshaling function and arguments, put the unmarshaled arguments (integer, native-typed object pointers, or string pointer) into the right places according to the C calling convention and then call a C-linkage function that expects integers, native-typed object pointers or string pointers accordingly.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jan 10 2024 05:55:44 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">That is, surely there has to be a way that results in smaller code size than e.g. <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/temporal/PlainDateTime.cpp#1215-1279">https://searchfox.org/mozilla-central/source/js/src/builtin/temporal/PlainDateTime.cpp#1215-1279</a></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jan 10 2024 05:55:58 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> the patch stack is in <a href="https://treeherder.mozilla.org/jobs?repo=try&amp;group_state=expanded&amp;revision=4ab9eb90818a09ffad2b79fbba921d98a837a79c">this try run</a> .  the IDL look like <a href="https://hg.mozilla.org/try/file/4ab9eb90818a09ffad2b79fbba921d98a837a79c/js/src/webidl/Spec.webidl">this</a>, and bindgen is in <a href="https://hg.mozilla.org/try/file/4ab9eb90818a09ffad2b79fbba921d98a837a79c/js/src/bindings/">this directory</a></blockquote></mx-reply>Thanks.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jan 10 2024 06:08:17 GMT-0800 (Pacific Standard Time)">14:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is "code size" about the binary size, or simplicity of the source code?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jan 10 2024 06:11:30 GMT-0800 (Pacific Standard Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">for simple case, where arguments are handled before any other code, in the same order as arguments, with mono-morphic type, introducing the mapping would be easy</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jan 10 2024 06:12:41 GMT-0800 (Pacific Standard Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">but I think there are several cases where arguments are handled after other code, in different order than the arguments, and also being <code>undefined</code> is used as condition.  I'm not sure how they fit the scheme</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jan 10 2024 06:14:17 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">but we could incrementally introducing types into the bindgen above and evaluate the feasibility, I guess?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jan 10 2024 06:15:31 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@ms2ger:igalia.com">Ms2ger (back in 2024 W2)</span>&gt;</div></td><td class="msg-cell">Yeah, once the idl is in place, it should be pretty easy to incrementally extend it</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jan 10 2024 06:16:40 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@ms2ger:igalia.com">Ms2ger (back in 2024 W2)</span>&gt;</div></td><td class="msg-cell">Curious what your motivation is to build this</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jan 10 2024 06:19:09 GMT-0800 (Pacific Standard Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it's for replacing <a href="https://searchfox.org/mozilla-central/rev/52f45d12530f9f8da61c6c7237003b5d1499b6d1/js/src/vm/CommonPropertyNames.h">CommonPropertyNames.h</a> with better data source. Generating binding is for verifying the consistency between the generated IDL and the implementation.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jan 10 2024 06:31:56 GMT-0800 (Pacific Standard Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hm, maybe we could use the native function with native-types in JIT, with adding the corresponding type-check into JIT compiler?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jan 10 2024 08:11:42 GMT-0800 (Pacific Standard Time)">16:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">To follow up on the zero-length arrays question, C++ disallows zero-length arrays: <a href="https://eel.is/c++draft/dcl.array#1">https://eel.is/c++draft/dcl.array#1</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jan 10 2024 08:11:58 GMT-0800 (Pacific Standard Time)">16:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">thanks to <span class="nick-15">tcampbell</span> for the answer</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jan 10 2024 08:58:47 GMT-0800 (Pacific Standard Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: if nursery heap contains only stuff which can be finalized in a background thread, how much of the minorGC needs to happen still on the main thread?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jan 10 2024 09:18:44 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: In general the nursery contains stuff which does not have finalizers, with some exceptions for things we really want to run in the nursery. These things get finalized on the main thread.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jan 10 2024 09:19:38 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Moving GC things to the tenured heap (the bulk of collection) also needs to happen while the mutator is paused otherwise it could observe stale pointers</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jan 10 2024 09:33:36 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>, <span class="nick-12">sfink</span> : meeting?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jan 10 2024 10:01:32 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> is "code size" about the binary size, or simplicity of the source code?</blockquote></mx-reply>I meant binary size</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jan 10 2024 10:29:41 GMT-0800 (Pacific Standard Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, the conversion is dynamically dispatched for each argument, based on some data structure, instead of generating a sequence of conversion as native code?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jan 10 2024 12:51:25 GMT-0800 (Pacific Standard Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell">Yeah. Superficially at least that would seem to result in smaller binary size. Unclear how important that <em>really</em> is, though.</td></tr>

</tbody></table></div></div></div>
</body></html>