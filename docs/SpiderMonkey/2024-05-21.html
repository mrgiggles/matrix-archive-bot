<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-05-21</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-05-21<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-05-20" class="nav-link"><span>prev</span></a>
<a href="2024-05-22" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon May 20 2024 21:15:22 GMT-0700 (Pacific Daylight Time)">04:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">as far as I can see, the script is not loaded twice, and also it happens also with inline script.  there seems to be something different happening</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon May 20 2024 21:18:39 GMT-0700 (Pacific Daylight Time)">04:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and the number of duplicate breakpoint inceases if I increase the nest of functions.  it looks like the traversal overlaps between inner vs inner-inner functions</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon May 20 2024 21:53:15 GMT-0700 (Pacific Daylight Time)">04:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't see duplication in the <code>findScript</code> response in the affected case.  but I see that <a href="https://searchfox.org/mozilla-central/rev/00b18126ec6a14a710086eb24e6a281460a678d5/devtools/server/actors/source.js#332-337">the current <code>delete</code> logic</a> doesn't work well given it immediately deletes the child script from the set, which was supposed to be handled in the upcoming iteration, which results in only half of scripts are handled deleted</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon May 20 2024 21:55:39 GMT-0700 (Pacific Daylight Time)">04:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so I assume the extra traversal happens after <code>findScripts</code>, in devtools' side, and that finds the inner function multiple times because the <code>delete</code> logic doesn't delete all inner functions</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon May 20 2024 22:03:32 GMT-0700 (Pacific Daylight Time)">05:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, maybe I'm misunderstanding the initial question</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon May 20 2024 22:10:58 GMT-0700 (Pacific Daylight Time)">05:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so the question is not about the duplication in the bug itself</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon May 20 2024 22:28:06 GMT-0700 (Pacific Daylight Time)">05:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>here's my understanding:</p>
<ul>
<li>Top-level script can be GCed anytime after evaluating it (because it's no longer necessary), even without duplicate load</li>
<li>When the top-level script is GCed, what DevTools need is the outer-most not-GCed functions, to traverse child scripts and make breakpoint available.  Thus, <code>!isFunction</code> doesn't work well</li>
<li><code>findScripts</code> with <code>line</code> parameter doesn't check whether the script has bytecode for the line, but just checks if the script spans across the line.  So, all enclosing functions also match, which results in returning multiple scripts even if <code>line</code> parameter is passed</li>
<li>iiuc, "same script loaded twice" case isn't related here, but if a same script is loaded twice, and if it's not filtered by <code>source</code> parameter, <code>findScripts</code> can return duplicate scripts, but they're for different instances, and not actually duplicate</li>
</ul>
</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon May 20 2024 22:29:43 GMT-0700 (Pacific Daylight Time)">05:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, adding <code>findScripts</code> parameter to exclude functions with live enclosing script would make sense.  it can avoid traversing lazy functions (which is done by <a href="https://searchfox.org/mozilla-central/rev/00b18126ec6a14a710086eb24e6a281460a678d5/js/src/gc/PublicIterators.cpp#93">TraverseInnerLazyScriptsForLazyScript</a>)</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon May 20 2024 23:02:36 GMT-0700 (Pacific Daylight Time)">06:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(but if DevTools code wants the top-level script only to list up the child scripts, then it can just use the <code>findScripts</code> result as is)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue May 21 2024 05:11:46 GMT-0700 (Pacific Daylight Time)">12:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell"><p>Sounds along the lines of what I suggested in <a href="https://phabricator.services.mozilla.com/D209513#7214132">https://phabricator.services.mozilla.com/D209513#7214132</a><br>Right?<br>Except that instead of filtering out child scripts, we would avoid iterating over child scripts?</p>
<p>If I follow you right, it would mean passing a boolean down to this code branch:<br><a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/js/src/gc/PublicIterators.cpp#159">https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/js/src/gc/PublicIterators.cpp#159</a><br>to avoid calling <code>TraverseInnerLazyScriptsForLazyScript</code>?</p>
</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue May 21 2024 05:16:57 GMT-0700 (Pacific Daylight Time)">12:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">About the <code>!isFunction</code> check and how to know if the GC freed any Script that are relevant to DevTools.<br>Shouldn't we have an explicit check, may be before calling <code>findScripts</code>?<br>Or may be <code>findScripts</code> should throw if the things got GCed?<br>We are also using the <code>!isFunction</code> check <a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/source.js#357-372">over there</a>,<br>just after having called <code>findScripts</code>.<br>Isn't it brittle to do this known-to-be-brittle check again over there?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue May 21 2024 05:19:47 GMT-0700 (Pacific Daylight Time)">12:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Are we really generating as many trampoline as <code>JSScript</code> in <a href="https://searchfox.org/mozilla-central/source/js/src/jit/InterpreterEntryTrampoline.cpp#233">generateEntryTrampolineForScript</a>? The generated code does not seems to depend on the <code>JSScript</code>, except for recording the various code offsets for perf recordings?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue May 21 2024 05:22:04 GMT-0700 (Pacific Daylight Time)">12:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Wouldn't it make sense to share the trampoline to improve execution speed (more cache sharing), and reduce memory (less allocations)?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue May 21 2024 05:33:34 GMT-0700 (Pacific Daylight Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what do you mean by "script relevant to DevTools" ?  if it's a script that's still possibly executed in future, it shouldn't be GCed</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue May 21 2024 05:35:00 GMT-0700 (Pacific Daylight Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">scripts can be GCed when there's no any remaining references to them, which means, after the top-level script is evaluated, or a function has no reference.  in any case, those scripts won't be executed after that point</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue May 21 2024 05:36:46 GMT-0700 (Pacific Daylight Time)">12:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">of course this is specific to the current pageload.  if DevTools want to handle the script for subsequent pageload, such as, "set breakpoint, reload the page, and expect the breakpoint to hit", then it will need to reparse the script</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue May 21 2024 05:40:33 GMT-0700 (Pacific Daylight Time)">12:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, if we're going to implement it inside debugger API, it's better just not iterate over things that's definitely going to be filtered out in the later step</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue May 21 2024 05:41:11 GMT-0700 (Pacific Daylight Time)">12:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, I think I misunderstood the DevTools' expectation</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue May 21 2024 05:41:52 GMT-0700 (Pacific Daylight Time)">12:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, it really wants the top-level script, not a set of scripts that's going to be executed in the current pageload?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue May 21 2024 05:47:19 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in that case, indeed, looking for <code>!isFunction</code> after filtering all child scripts out is redundant.  it just need to look for non-function script as a first step, inside Debugger API</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue May 21 2024 05:53:15 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@mstange:mozilla.org">mstange</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: The string passed to recordOffset is different for each script</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue May 21 2024 05:53:52 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@mstange:mozilla.org">mstange</span>&gt;</div></td><td class="msg-cell">We want distinct symbol names in the profiler for each function</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue May 21 2024 05:54:15 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">at this point, <a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/source.js#319">SourceActor._getTopLevelDebuggeeScripts</a> returns (or, should return) all outer-most not-GCed scripts and functions.  <a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/source.js#352">SourceActor._getTopLevelBreakpointPositionScripts</a> seems to want actual top-level script (thus it reparses if there isn't).  <a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/source.js#392">SourceActor._findDebuggeeScripts</a> just uses what <code>_getTopLevelDebuggeeScripts</code> returns</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue May 21 2024 05:54:46 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">this mode also isn't enabled by default anywhere. It can be used with profilers such as <code>perf</code></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue May 21 2024 05:57:51 GMT-0700 (Pacific Daylight Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is there difference for the expectation between them?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue May 21 2024 05:59:08 GMT-0700 (Pacific Daylight Time)">12:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, just realized the sole consumer of <code>_getTopLevelBreakpointPositionScripts</code> is also <code>_findDebuggeeScripts</code></td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue May 21 2024 06:02:19 GMT-0700 (Pacific Daylight Time)">13:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">This is something I had completely omitted when thinking about JIT Spraying mitigations, and profiling. I guess we would not be able to have both at the same time, or not a precise profiling :/</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue May 21 2024 06:05:38 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, for <code>findScripts</code> calls in <code>_findDebuggeeScripts</code> , the expectation is either:  (a) all outermost non-GCed scripts/functions, where traversing all child scripts will list up all scripts that can be executed in the current pageload,  (b) the top-level script, where traversing all child scripts will list up all scripts in the source, right?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue May 21 2024 06:09:48 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, looking into the remaining part of <code>_findDebuggeeScripts</code>, it iterates over all child scripts and apply filter based on line/column, that sounds like what <code>findScripts</code> actually should provide, by adding <code>column</code> parameter to the query (it already has <code>line</code>, but not <code>column</code>)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue May 21 2024 06:13:20 GMT-0700 (Pacific Daylight Time)">13:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that should solve (a) case, with single function call, replacing <code>_findDebuggeeScripts</code> logic</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue May 21 2024 06:18:27 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(b) case indeed needs some kind of check.  simple one would be a query parameter <code>isFunction: false</code> or something, and reparse if the result is empty</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue May 21 2024 06:23:12 GMT-0700 (Pacific Daylight Time)">13:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell"><p>TBH, people that knew this codebase are not longer in the team. I don't have full knowledge on that particular part of the DevTools codebase.</p>
<p>I'm still unclear about what top level and child scripts really are.</p>
<p>Having said that, I think that we have two distinct usecases:</p>
<ol>
<li>Displaying any source that executed on the page and be able to define breakpoints on them.</li>
</ol>
<p>This includes any GC-ed source. I /think/ it is only about top level scripts.<br>For me a top level scripts represent the whole file or evaled string? Is that really the case?</p>
<p>This allows to show any source that ran on the page currently debugged.<br>Retrieve the breakable positions, set breakpoint and have the breakpoints be later "applied" by usecase (2).</p>
<p>This is using <code>_findDebuggeeScripts</code> <a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/source.js#456-459">over there</a>.<br>This is the only once callsite using forBreakpointPositions=true<br>and <a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/source.js#352">_getTopLevelBreakpointPositionScripts</a><br>and so, the only one to force reparsing the GCed sources</p>
<ol start="2">
<li>"Applying" the breakpoints.</li>
</ol>
<p>This is only against active JS, i.e. non-GC-ed. It may have to work against top and child scripts,<br>that, I don't really know.</p>
<p>The goal is to apply all breakpoint positions communicated by DevTools frontend.<br>More concretely, this is about calling Spidermonkey's Debugger API's Script.setBreakpoint method<br><a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/breakpoint.js#102">over here</a></p>
<p>This is the other usages of <code>_findDebuggeeScripts</code>, which do not force to reparse gc-ed scripts. I don't know if that's important to have only top level or also child scripts.</p>
</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue May 21 2024 06:26:40 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">about "top level vs child".  in SpiderMonkey, Script (JSScript, Debugger.Script) corresponds to statements and declarations, excluding things inside inner functions.  So, top-level script only represents things that's outside of any functions</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue May 21 2024 06:29:00 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, breakpoint for a statement inside a function cannot be set by the top-level script itself, but you need to get the function's script (by <code>findScripts</code> result, or traversing from outer script) and then set breakpoint to it</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue May 21 2024 06:29:06 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">so, if we were only processing top level script, we wouldn't get breakable position within function, (for example)?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue May 21 2024 06:29:31 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">correct</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue May 21 2024 06:30:05 GMT-0700 (Pacific Daylight Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">and do we have to ignore some of the child scripts in that process (of retrieving breakable positions) ?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue May 21 2024 06:30:45 GMT-0700 (Pacific Daylight Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">(assuming, we ignore the complex scenario where something get GCed)</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue May 21 2024 06:31:50 GMT-0700 (Pacific Daylight Time)">13:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there's no need to ignore child scripts</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue May 21 2024 06:32:16 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">ok thanks, that clarifies things!</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue May 21 2024 06:32:29 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">just to make sure, this is a scenario where "set breakpoint to specific line and column" ?</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue May 21 2024 06:32:38 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue May 21 2024 06:33:21 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, passing <code>line</code> to <code>findScripts</code> will return all scripts that spans across that line. and setting breakpoint within the returned scripts should work</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue May 21 2024 06:34:03 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">we could move the column handling into <code>findScripts</code> logic if that helps</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue May 21 2024 06:34:31 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">you mean this one? <a href="https://searchfox.org/mozilla-central/source/devtools/server/actors/source.js#399,419-429">https://searchfox.org/mozilla-central/source/devtools/server/actors/source.js#399,419-429</a></td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue May 21 2024 06:34:54 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue May 21 2024 06:36:03 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">Yes I imagine things would be clearer and may be faster...</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue May 21 2024 06:38:53 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">Then we have that <a href="https://searchfox.org/mozilla-central/rev/c84d3db8d7d6503b1208a0378db640095e106355/devtools/server/actors/source.js#324-339">buggy code</a> bomsy is fixing in JS. Could that also somehow be folded into <code>findScripts</code>?  Is that fixable with your suggestion of not calling <code>TraverseInnerLazyScriptsForLazyScript</code>?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue May 21 2024 06:43:58 GMT-0700 (Pacific Daylight Time)">13:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, and we don't have to touch the traversal itself</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue May 21 2024 06:44:03 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">filed bug 1897964</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue May 21 2024 06:44:04 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1897964">https://bugzil.la/1897964</a> — NEW (nobody) — Support startLine, startColumn, endLine, and endColumn query parameters in `Debugger.findScripts`</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue May 21 2024 06:52:19 GMT-0700 (Pacific Daylight Time)">13:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and bug 1897966 for "reparse" case</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue May 21 2024 06:52:21 GMT-0700 (Pacific Daylight Time)">13:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1897966">https://bugzil.la/1897966</a> — NEW (nobody) — Provide a Debugger API that allows "reparse the source if top-level script is already GCed"</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue May 21 2024 06:55:22 GMT-0700 (Pacific Daylight Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">Thanks a lot. This clarifies a lot and there two bugs were what I was looking for! A better cooperation between JS/DevTools and C++/Spidermonkey codebases!</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue May 21 2024 07:25:24 GMT-0700 (Pacific Daylight Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">Thanks, arai!</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue May 21 2024 08:01:57 GMT-0700 (Pacific Daylight Time)">15:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: In the future it would be nice if we refactored the breakpoint-position logic to work directly on ImmutableScriptData so that we have a pathway to querying breakpoints on Stencils directly. In that scenario, if we needed to reparse we would only need to generate a stencil instead of JSScript. The current devtools code would need some refactoring, so I'm not sure it is worth doing today, but my hope was that we'd eventually resolve this reparse-gc'd-script issue by using Stencil directly.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue May 21 2024 08:14:51 GMT-0700 (Pacific Daylight Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(I think your current plan in those two bugs makes sense for today)</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue May 21 2024 08:15:49 GMT-0700 (Pacific Daylight Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that sounds interesting</td></tr>

</tbody></table></div></div></div>
</body></html>