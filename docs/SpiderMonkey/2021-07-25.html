<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-07-25</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-07-25<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-07-23" class="nav-link"><span>prev</span></a>
<a href="2021-07-26" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Jul 25 2021 06:46:12 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@standard8:mozilla.org">Standard8</span>&gt;</div></td><td class="msg-cell">If we removed the Components.classes, Components.utils, Components.interfaces, Components.results interfaces, and just kept the Cc, Cu, Ci and Cr ones, would that save on any overhead?

We've largely removed uses of the long form from most of mozilla-central now, apart from tests.

With ESLint, it shouldn't be too hard to finish off, and hence I'm wondering if we removing the long form would save us anything in particular.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Jul 25 2021 07:23:39 GMT-0700 (Pacific Daylight Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>not something specific to Components.* tho:</p>
<ul>
<li>small memory win for not having extra global property "Components", and its object representation</li>
<li>small memory win for not having those property names in runtime atom table</li>
<li>if there were still some use of long-form in chrome-priv code:
<ul>
<li>small perf win in parser for shorter text</li>
<li>small win for disk usage for not storing long form names in XDR cache</li>
</ul>
</li>
</ul>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sun Jul 25 2021 07:48:47 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">Hey,<br>is there a single piece of code in spidermonkey that all access to native code has to go through?<br>I'm currently writing my bachelor's thesis on observing WebAPI usage from a WebExtension and started prototyping by instrumenting individual callsites (<a href="https://phabricator.services.mozilla.com/D110681">see this very WIP patch</a> or <a href="https://zabka.it/bachelor/01-introduction/#implementation">this blog post</a>  for additional context).<br>Is there a more generalized approach possible in the engine?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sun Jul 25 2021 07:58:30 GMT-0700 (Pacific Daylight Time)">14:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">vringar</span>: in interpreter execution, all native function call will go through here  <a href="https://searchfox.org/mozilla-central/rev/fffc51a40a341eefced15420d12e15419122b63a/js/src/vm/Interpreter.cpp#379-408">https://searchfox.org/mozilla-central/rev/fffc51a40a341eefced15420d12e15419122b63a/js/src/vm/Interpreter.cpp#379-408</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sun Jul 25 2021 07:59:39 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">And once it's been JIT-ed it wouldn't?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sun Jul 25 2021 08:00:04 GMT-0700 (Pacific Daylight Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it depends on the native function</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sun Jul 25 2021 08:02:23 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">for experimental purpose, one option is to disable all JITs, so that that kind of instrumentation can be simpler (but of course it will be slow)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sun Jul 25 2021 08:03:13 GMT-0700 (Pacific Daylight Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">you can disable them by setting preferences  <a href="https://searchfox.org/mozilla-central/rev/fffc51a40a341eefced15420d12e15419122b63a/modules/libpref/init/StaticPrefList.yaml#5722-5738">https://searchfox.org/mozilla-central/rev/fffc51a40a341eefced15420d12e15419122b63a/modules/libpref/init/StaticPrefList.yaml#5722-5738</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sun Jul 25 2021 08:03:23 GMT-0700 (Pacific Daylight Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">those 3 preferences correspond to each JIT layer</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sun Jul 25 2021 08:07:09 GMT-0700 (Pacific Daylight Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, there seems to be debugger API to listen to native function call  <a href="https://searchfox.org/mozilla-central/rev/fffc51a40a341eefced15420d12e15419122b63a/js/src/doc/Debugger/Debugger.md#153-174">https://searchfox.org/mozilla-central/rev/fffc51a40a341eefced15420d12e15419122b63a/js/src/doc/Debugger/Debugger.md#153-174</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sun Jul 25 2021 08:07:32 GMT-0700 (Pacific Daylight Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that might be simpler</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sun Jul 25 2021 08:10:47 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">ðŸ‘€ that API seems exactly like the kind of thing I need to scale this instrumentation. Thank you!</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sun Jul 25 2021 08:11:27 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">(I don't know what half the words in the documentation you linked mean, but I'm assuming I can read up on that in the doc folder.)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sun Jul 25 2021 08:11:35 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">Thank you so much!</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sun Jul 25 2021 08:12:15 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you have questions, feel free to ask here :)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sun Jul 25 2021 08:30:26 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">What would be the best way to create a debugger in every single window (Including iframes)?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sun Jul 25 2021 08:41:07 GMT-0700 (Pacific Daylight Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">instead of specific page/frame?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sun Jul 25 2021 08:47:23 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">Whatever is easier. I wanted to be more precise than "into everything", sorry. I only care about content, so I don't want to accidentally capture calls in the chrome code or on privileged sites.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sun Jul 25 2021 08:51:05 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the question is, does the consumer of the new API listen to all calls across all tabs, instead of listening to calls in specific page(s)?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Sun Jul 25 2021 08:51:55 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">Yes, that's the plan. (That's also how the thing that I'm trying to replace works, and I don't aim to be better than it)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Sun Jul 25 2021 08:55:19 GMT-0700 (Pacific Daylight Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">not sure the "best way" tho, you'd want to hook into somewhere in the initialization of the JS global, or somewhere WebExtension's content script hooks into</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Sun Jul 25 2021 08:58:19 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">Thank you! I'm going to write this down and try to experiment with it later in the week. I'll come back here when I make progress or have more questions.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Sun Jul 25 2021 09:06:16 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">one more solution than debugger API.  if it's only about web API, you could modify the bindgen (binding generator) to add hook there.  bindgen generates c++ code from webidl</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Sun Jul 25 2021 09:09:37 GMT-0700 (Pacific Daylight Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">generator is <a href="https://searchfox.org/mozilla-central/source/dom/bindings/Codegen.py">https://searchfox.org/mozilla-central/source/dom/bindings/Codegen.py</a>  , and example binding <code><a href="https://searchfox.org/mozilla-central/source/__GENERATED__/dom/bindings/HTMLScriptElementBinding.cpp">https://searchfox.org/mozilla-central/source/__GENERATED__/dom/bindings/HTMLScriptElementBinding.cpp</a></code></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Sun Jul 25 2021 09:13:53 GMT-0700 (Pacific Daylight Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@vringar:mozilla.org">vringar</span>&gt;</div></td><td class="msg-cell">Yeah, that was my initial idea, but 23k LoC of parser generator code was too intimidating for me ðŸ˜…</td></tr>

</tbody></table></div></div></div>
</body></html>