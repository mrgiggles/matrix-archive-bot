<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-12-11</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-12-11<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-12-09" class="nav-link"><span>prev</span></a>
<a href="2023-12-12" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Dec 11 2023 04:59:46 GMT-0800 (Pacific Standard Time)">12:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: btw, that compartment gc/cc thing, I wonder if the sandbox wasn't collected soon enough because it has its own zone. If we do only zone GCs for web page's zone and probably the normal system zone, sandbox might stay alive, because it is part of C++&lt;-&gt;JS cycle. Or something like that.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Dec 11 2023 05:01:58 GMT-0800 (Pacific Standard Time)">13:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yes, that's possible if it's a small zone and there isn't much allocation happening there</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Dec 11 2023 05:02:43 GMT-0800 (Pacific Standard Time)">13:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">As far as I see, there is very little happening there during sp3.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Dec 11 2023 05:04:27 GMT-0800 (Pacific Standard Time)">13:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I don't think it's that important to collect that zone - the GC only thought so because it couldn't see any roots in it </td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Dec 11 2023 09:33:21 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Does anybody knows where is <code>portable-baseline-interp</code> defined, in order to reproduce it locally?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Dec 11 2023 09:39:26 GMT-0800 (Pacific Standard Time)">17:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">I think you can enable it by adding <code>--enable-portable-baseline-interp</code> to your <code>mozconfig</code>.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Dec 11 2023 09:39:29 GMT-0800 (Pacific Standard Time)">17:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1859010">https://bugzilla.mozilla.org/show_bug.cgi?id=1859010</a> should have whatever it is</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Dec 11 2023 09:41:04 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">dminor</span>: I tried and it reports that it is unknown, and grep does not find it either :/</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Dec 11 2023 09:41:05 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">for a closer reproduction, I think you can do <code>js/src/devtools/automation/<a href="http://autospider.py">autospider.py</a> pbl</code> (and <code>wasi-pbl</code>). Or add <code>--build</code> to avoid having it run all the tests.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Dec 11 2023 09:41:29 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I don't see any special packages being added for it.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Dec 11 2023 09:41:36 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">though I'm not sure how the sysroots work.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Dec 11 2023 09:42:06 GMT-0800 (Pacific Standard Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">was I working on a 2 month old version of central?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Dec 11 2023 09:42:14 GMT-0800 (Pacific Standard Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Dec 11 2023 09:42:22 GMT-0800 (Pacific Standard Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(the answer to questions like that is always "yes")</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Dec 11 2023 09:43:44 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">If so I got extremely lucky that the patch landed successfully in the first place :)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Dec 11 2023 10:47:01 GMT-0800 (Pacific Standard Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">jandem: thanks for pointing out the <a href="https://phabricator.services.mozilla.com/D194003#6500849">missing piece</a> of the inline string changes. A question: looking at the <a href="https://docs.google.com/spreadsheets/d/1r4t6lfqLpk8dpTul_vEfMSOAEl5Zg1rFe0AMywUPu4s/edit#gid=1269367432">table of sizes</a>, I noticed that this keeps a 40-byte atom on 32-bit, when the max atom size on 64-bit is now only 32 bytes. I was thinking I should probably shrink the 32-bit max size to match. What do you think?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Dec 11 2023 11:22:48 GMT-0800 (Pacific Standard Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@vladyslavy:mozilla.org">vladyslavy</span>&gt;</div></td><td class="msg-cell"><p>Hi all! I am a user of Spidermonkey 102.12.0.<br>I see that Spidermonkey does some of its work in the background threads. And I want to take control of it. I see that there is a <code>JS::SetHelperThreadTaskCallback</code>, which I assume is used to set a callback that will be responsible for running background tasks.<br>I don't see much documentation on it, so could you help me figure out what the pitfalls might be when using it.<br>Should I just call <code>JS::RunHelperThreadTask</code> in the background thread?<br>Do I need to provide additional synchronization?<br>Is it safe to join a thread that runs background task?</p>
<p>Thank you in advance!</p>
</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Dec 11 2023 11:33:51 GMT-0800 (Pacific Standard Time)">19:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: how does that affect the number of bytes for inline chars on 32-bit? how does this compare to 64-bit?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Dec 11 2023 11:43:12 GMT-0800 (Pacific Standard Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">64-bit now has a max bytes of 20, but 32-bit still has a max bytes of 28. This would make both of them have a max bytes of 20.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Dec 11 2023 11:44:20 GMT-0800 (Pacific Standard Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(before any of these patches, both had max-bytes of 24)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Dec 11 2023 11:47:56 GMT-0800 (Pacific Standard Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I think that's a good idea</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Dec 11 2023 11:49:51 GMT-0800 (Pacific Standard Time)">19:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I guess the alternative would be to make both of them be 28. I don't have a great way of estimating the costs and benefits for various sizes. I can histogram how many of each size is used, but it's not really clear what's better and worse, especially since some of it is based on the allocation &amp; free pressure, which sometimes matters and sometimes doesn't.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Dec 11 2023 11:50:11 GMT-0800 (Pacific Standard Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'll do 20 for now, and maybe do some sp3 try pushes with 20 and 28.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Dec 11 2023 11:56:36 GMT-0800 (Pacific Standard Time)">19:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">works for me. Calculating the total size of all atoms combined and comparing that might be interesting</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Dec 11 2023 12:53:51 GMT-0800 (Pacific Standard Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Hi all! I am a user of Spidermonkey 102.12.0.<br>I see that Spidermonkey does some of its work in the background threads. And I want to take control of it. I see that there is a <code>JS::SetHelperThreadTaskCallback</code>, which I assume is used to set a callback that will be responsible for running background tasks.<br>I don't see much documentation on it, so could you help me figure out what the pitfalls might be when using it.<br>Should I just call <code>JS::RunHelperThreadTask</code> in the background thread?<br>Do I need to provide additional synchronization?<br>Is it safe to join a thread that runs background task?</p>
<p>Thank you in advance!</p>
</blockquote></mx-reply>Safety... can't speak to, but it seems like the API is relatively transparent about what it's suggesting. <a href="https://searchfox.org/mozilla-central/rev/c003be8b9727672e7d30972983b375f4c200233f/js/xpconnect/src/XPCJSContext.cpp#1175-1184">Here's the in-tree gecko background task running code</a>, which is pretty straightforward</td></tr>

</tbody></table></div></div></div>
</body></html>