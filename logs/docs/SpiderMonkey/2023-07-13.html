<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-07-13</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-07-13<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-07-12" class="nav-link"><span>prev</span></a>
<a href="2023-07-14" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Jul 12 2023 23:58:04 GMT-0700 (Pacific Daylight Time)">06:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> âœ‹ high-five to Iain for <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1829411#c19">https://bugzilla.mozilla.org/show_bug.cgi?id=1829411#c19</a> </blockquote></mx-reply>quite an impact on DevTools debugger pretty print and sourcemap: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1829411#c23">https://bugzilla.mozilla.org/show_bug.cgi?id=1829411#c23</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Jul 13 2023 04:11:57 GMT-0700 (Pacific Daylight Time)">11:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I have a problem with my custom implementation of <code>BaseProxyHandler</code> which I'm not able to figure out. My class <code>CellProxyHandler</code> derives from <code>BaseProxyHandler</code>, and it is supposed to behave similarly to <code>js::Wrapper</code>, i.e. it is supposed to wrap an object stored in a reserved slot. I am compiling Javascript code to this object, by setting it to the scope chain and then running <code>JS_Evaluate</code>. This means that when I compile the code <code>var x = 10; this.y = 11</code>to the proxy object, I would expect to see properties x = 10 and y = 11 in the wrapped object. With<code>js::Wrapper</code>, this is exactly what I get. But when I run my own <code>CellProxyHandler</code>class, I get properties x = undefined and y = 11. So the<code>js::Wrapper</code>class accepts the<code>var x = 10</code>syntax, but my own<code>CellProxyHandler</code> class does not. Can anything see why this might be?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Jul 13 2023 04:14:10 GMT-0700 (Pacific Daylight Time)">11:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">When I peak inside my <code>defineProperty()</code> method, the <code>js::PropertyDescriptor</code> for x is undefined. So the problem must be something that occurs before that method is called.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Jul 13 2023 04:38:27 GMT-0700 (Pacific Daylight Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: maybe try inheriting from <code>ForwardingProxyHandler</code> instead of <code>BaseProxyHandler</code> to see if that changes anything</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Jul 13 2023 04:40:04 GMT-0700 (Pacific Daylight Time)">11:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I'm trying that right now. Feels weird though because I can't think what the difference could be.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Jul 13 2023 04:50:35 GMT-0700 (Pacific Daylight Time)">11:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Yup, inheriting from <code>js::Wrapper</code> seems to work. I'm frustrated that I couldn't work it out myself, but I suppose that using <code>js::Wrapper</code> is a good thing, since there's a bit less boilerplate code.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Jul 13 2023 04:51:28 GMT-0700 (Pacific Daylight Time)">11:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I have one remaining doubt about <code>js::Wrapper</code> though. I need an extra reserve slot object (besides the one that holds the wrapped object).</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Jul 13 2023 04:52:01 GMT-0700 (Pacific Daylight Time)">11:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Is it safe just to pass this option in through the js::Wrapper constructor?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Jul 13 2023 04:52:08 GMT-0700 (Pacific Daylight Time)">11:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell"><code>constexpr CellProxyHandler::CellProxyHandler() : js::Wrapper(JSCLASS_HAS_RESERVED_SLOTS(1), true, false) {}</code></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Jul 13 2023 04:53:03 GMT-0700 (Pacific Daylight Time)">11:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I suspect you weren't overriding some proxy trap that affects behavior here</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Jul 13 2023 04:54:24 GMT-0700 (Pacific Daylight Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is it safe just to pass this option in through the js::Wrapper constructor?</blockquote></mx-reply>no, that won't work because proxy handler flags are unrelated to JSClass flags. I think you can still use your own JSClass with reserved slots?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Jul 13 2023 04:54:49 GMT-0700 (Pacific Daylight Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">But how do I specify my own class?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Jul 13 2023 04:55:47 GMT-0700 (Pacific Daylight Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">with the <code>ProxyOptions</code> you pass to <code>NewProxyObject</code></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Jul 13 2023 04:57:23 GMT-0700 (Pacific Daylight Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I'm using <code>js::Wrapper::New</code>, not <code>js::NewProxyObject</code>.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Jul 13 2023 04:57:54 GMT-0700 (Pacific Daylight Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Perhaps if I dig into <code>js::Wrapper::New</code>, I'll find that I can bypass this function and supply my own class.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Jul 13 2023 04:58:03 GMT-0700 (Pacific Daylight Time)">11:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">you can use the <code>WrapperOptions</code> then, it inherits from <code>ProxyOptions</code> so also lets you set the class</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Jul 13 2023 04:58:34 GMT-0700 (Pacific Daylight Time)">11:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Oh right, it inherits. That will work.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Jul 13 2023 04:59:55 GMT-0700 (Pacific Daylight Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Thanks <span class="nick-10">jandem</span> , this sounds like the right way forward for me. Using <code>js::Wrapper</code> will probably make for cleaner code than what I've been using anyway.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Jul 13 2023 05:01:56 GMT-0700 (Pacific Daylight Time)">12:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: great. Proxy handlers can be hard to reason about unfortunately because of the default trap implementations from <code>BaseProxyHandler</code> if you don't override them</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Jul 13 2023 05:12:27 GMT-0700 (Pacific Daylight Time)">12:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">@allstarschh</span>: <span class="nick-4">jonco</span> I'm still trying to understand that modulepreload regression. Loading a module triggers disallowimportmap. Want to remind me why? What is the reason for that limitation (I know it is in the spec too)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Jul 13 2023 05:14:12 GMT-0700 (Pacific Daylight Time)">12:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: <a href="https://html.spec.whatwg.org/#fetch-a-modulepreload-module-script-graph">https://html.spec.whatwg.org/#fetch-a-modulepreload-module-script-graph</a> step 1</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Jul 13 2023 05:14:41 GMT-0700 (Pacific Daylight Time)">12:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">@allstarschh</span>: sure, but why?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Jul 13 2023 05:15:30 GMT-0700 (Pacific Daylight Time)">12:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Import maps need to be loaded first otherwise may not be able to resolve module imports, or will resolve them differently</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Jul 13 2023 05:15:41 GMT-0700 (Pacific Daylight Time)">12:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">It is the speculative load of modulepreload which triggers the regression, but I can't understand why we wouldn't have the same issue with speculative load of &lt;script type=module src="..."&gt;. But perhaps I'm missing something</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Jul 13 2023 05:19:26 GMT-0700 (Pacific Daylight Time)">12:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">We don't use speculatively loaded modules if an import map is present: <a href="https://hg.mozilla.org/mozilla-central/rev/24f62f68f45a332fe856c9da02467ca6f95e38cd">https://hg.mozilla.org/mozilla-central/rev/24f62f68f45a332fe856c9da02467ca6f95e38cd</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Jul 13 2023 05:19:29 GMT-0700 (Pacific Daylight Time)">12:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Perhaps we need to disable speculative module loads if we see a importmap while parsing. So only loads before that would work</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Jul 13 2023 05:20:41 GMT-0700 (Pacific Daylight Time)">12:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: oh. Hmm, does that somehow not apply to modulepreload</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Jul 13 2023 05:20:51 GMT-0700 (Pacific Daylight Time)">12:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">That is a very recent change</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Jul 13 2023 05:20:57 GMT-0700 (Pacific Daylight Time)">12:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I don't know how modulepreload works</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Jul 13 2023 05:20:59 GMT-0700 (Pacific Daylight Time)">12:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Yes</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Jul 13 2023 05:23:27 GMT-0700 (Pacific Daylight Time)">12:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">This is interesting.  And it is the same bug basically, as <span class="nick-13">@allstarschh</span> said in the other bug.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Jul 13 2023 05:23:43 GMT-0700 (Pacific Daylight Time)">12:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Just that we need similar fix for modulepreload</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Jul 13 2023 05:23:57 GMT-0700 (Pacific Daylight Time)">12:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">on release</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Jul 13 2023 05:24:58 GMT-0700 (Pacific Daylight Time)">12:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">We could also just not do speculative loading if we see importmap during parsing, right?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Jul 13 2023 05:30:56 GMT-0700 (Pacific Daylight Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> We could also just not do speculative loading if we see importmap during parsing, right?</blockquote></mx-reply>we could, but for &lt;modulepreload&gt; it would be a little bit weird, as it prevents the preloading of modules</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Jul 13 2023 05:31:33 GMT-0700 (Pacific Daylight Time)">12:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">how is that weird? This is only about speculative loads</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Jul 13 2023 05:31:46 GMT-0700 (Pacific Daylight Time)">12:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">not about loads done when &lt;link modulepreload&gt; is added to DOM</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Jul 13 2023 05:32:55 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">other option is to fix module resolving somehow</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Jul 13 2023 05:32:56 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell">oh, okay, I see</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Jul 13 2023 07:36:04 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">@allstarschh</span>: <span class="nick-4">jonco</span>: want to take a look at <a href="https://phabricator.services.mozilla.com/D183421">https://phabricator.services.mozilla.com/D183421</a>? It was already reviewed from DOM point of view, but since you're more familiar with importmap, might be good if you check that I'm not missing anything obvious. The patch is trying to be the minimal possible for the current release</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Jul 13 2023 07:38:40 GMT-0700 (Pacific Daylight Time)">14:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell">Will do that soon, I am picking up kids now</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Jul 13 2023 08:00:52 GMT-0700 (Pacific Daylight Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell">There is <code>SamplerThread</code> that is run in ff during profiling. I do not see the obvious way to start it for testing. (There is <code>enableSingleStepProfiling</code> but it is supported only for ARM simulator) Am I missing some pref/build/env flag to start it?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Jul 13 2023 08:04:22 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">yury</span>: Looks like the root init call is this: <a href="https://searchfox.org/mozilla-central/search?q=symbol:_ZN7mozilla12baseprofiler13profiler_initEPv&amp;redirect=false">https://searchfox.org/mozilla-central/search?q=symbol:_ZN7mozilla12baseprofiler13profiler_initEPv&amp;redirect=false</a> which we never call in shell -- in principle, we might be able to, but in the short term you -may- be able to succeed with xpcshell?</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Jul 13 2023 08:05:33 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-14" title="@yury:mozilla.org">yury</span></div></td><td class="msg-cell">trying xpcshell</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Jul 13 2023 08:06:30 GMT-0700 (Pacific Daylight Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah the JS shell does not have a sampler thread, but you can use <code>readGeckoProfilingStack()</code>or <code>enableSingleStepProfiling()</code> (with the ARM simulator) to test our profiler integration code in many cases</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Jul 13 2023 08:10:19 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for Wasm we mostly rely on <code>enableSingleStepProfiling</code> I think. It's nice that it can get a stack trace at every instruction we execute so it's very deterministic and complete. Unfortunately not available for every platform</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Jul 13 2023 08:11:44 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>Unfortunately not available for every platform</p>
</blockquote>
<p>Yep, it is available only for one platform that is used by developers</p>
</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Jul 13 2023 10:20:44 GMT-0700 (Pacific Daylight Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: my new proxy implementation using <code>Wrapper</code> is working well--definitely cleaner code than before. There's just one thing that's bugging me, which is <code>let</code> and <code>const</code>values. In my old implementation of<code>BaseProxyHandler</code>, any values declared using <code>let</code>or<code>const</code> would only be accessible from within the scope of that object, whereas<code>var</code>and<code>this.</code>would be accessible from anywhere. This was surprising behavior, but it was also very useful, because it meant I could implement public and private values. Do you have any idea why this would have happened, and how I could get it back with my implementation of<code>Wrapper</code>?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Jul 13 2023 11:58:33 GMT-0700 (Pacific Daylight Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell"><p>heh, now looking for xpcshell experts... so test suppose to crash-crash, but I see:</p>
<pre><code> 0:00.60 TEST_END: Test FAIL. Subtests passed 1/1. Unexpected 0
 0:00.60 INFO js/xpconnect/tests/unit/test_wasm_tailcalls_profiler.js failed or timed out, will retry.
...
xpcshell
~~~~~~~~
Ran 2 checks (1 subtests, 1 tests)
Expected results: 2
Unexpected results: 0
OK

</code></pre>
<p>Is it really OK?</p>
</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Jul 13 2023 12:02:52 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">TreviÃ±o</span>&gt;</div></td><td class="msg-cell">hey, if I've to wrap a C++ struct inside a js::value, but also providing a destroy function, is there any shortcut class for that? Or should I go through JSClassOps? As I'd ideally just need to set a reserved slot, but there's not a way to trigger a callback when the owner value of it gets destroyed, right?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Jul 13 2023 12:11:31 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">yury</span>: That looks like a failure of some sort for sure -- it's been a while since I've written an xpcshell-test; iirc they are grumpy if you don't ever do any Asserting</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Jul 13 2023 12:13:45 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell">aight, will poke it more. I was seeing CRASH before I recompile or change something, but now it is mute and not showing anything</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Jul 13 2023 12:13:59 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">TreviÃ±o</span>: Can you get by with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry"><code>FinalizationRegistry</code></a>?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu Jul 13 2023 12:21:07 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">TreviÃ±o</span>&gt;</div></td><td class="msg-cell">mgaudet: you mean by SetHostCleanupFinalizationRegistryCallback ? It's the only public API I see, but it doesn't seem to be tied to any value</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu Jul 13 2023 12:22:02 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">TreviÃ±o</span>: More like wrapping your creation of these objects in JS that registers them in a finalization registry and does cleanup JS side</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu Jul 13 2023 12:22:21 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">otherwise, a finalize class op is definitely the more traditional way</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu Jul 13 2023 12:22:35 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">TreviÃ±o</span>&gt;</div></td><td class="msg-cell">yeah, that seems clearer</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu Jul 13 2023 12:23:24 GMT-0700 (Pacific Daylight Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">TreviÃ±o</span>&gt;</div></td><td class="msg-cell">was wondering if there was some thing to avoid rewriting the some stuff many times, allowing allocating data of a type, cgenerate a JSObject of it, and define the proper destructor in one step</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu Jul 13 2023 12:29:43 GMT-0700 (Pacific Daylight Time)">19:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Usually the C++ answer there is templates, macros, or other code-generation tooling. I don't think there's a generic solution here that's going to clean up everything</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu Jul 13 2023 14:17:00 GMT-0700 (Pacific Daylight Time)">21:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>: Is there a metabug for followup work on the FrontendContext related error handling stuff?</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu Jul 13 2023 14:17:15 GMT-0700 (Pacific Daylight Time)">21:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Ran into an awkward thing which maybe already has a bug open and otherwise I'd like to open one) </td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu Jul 13 2023 14:20:45 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">bug 1759123 I think</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu Jul 13 2023 14:20:46 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1759123">https://bugzil.la/1759123</a> â€” NEW (nobody) â€” Remove helper thread JSContexts</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu Jul 13 2023 14:25:20 GMT-0700 (Pacific Daylight Time)">21:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Thank you!</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu Jul 13 2023 14:57:57 GMT-0700 (Pacific Daylight Time)">21:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">TreviÃ±o</span>&gt;</div></td><td class="msg-cell">mgaudet: I ended up sketching this <a href="https://www.pastery.net/avhrgd/">https://www.pastery.net/avhrgd/</a> (cpp <a href="https://www.pastery.net/hhqtmq/">https://www.pastery.net/hhqtmq/</a>) which allows to handle this in matter of seconds :)</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu Jul 13 2023 14:59:31 GMT-0700 (Pacific Daylight Time)">21:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Scans sensibly! Glad you figured something out.</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu Jul 13 2023 15:05:12 GMT-0700 (Pacific Daylight Time)">22:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, that seems like the right way to go about it. We ought to have something like that in the examples repo. </td></tr>

</tbody></table></div></div></div>
</body></html>