<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-01-08</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-01-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-01-07" class="nav-link"><span>prev</span></a>
<a href="2021-01-11" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Jan 08 2021 01:28:27 GMT-0800 (Pacific Standard Time)">09:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">nice, shell tests are noticeably faster now with the self-hosted-code caching</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Jan 08 2021 02:26:25 GMT-0800 (Pacific Standard Time)">10:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I should probably suggest that to <span class="nick-8">decoder</span>, as a way to test case reducing.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Jan 08 2021 02:27:06 GMT-0800 (Pacific Standard Time)">10:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">what? free stuff?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Jan 08 2021 02:27:08 GMT-0800 (Pacific Standard Time)">10:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">^.^</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Jan 08 2021 02:28:04 GMT-0800 (Pacific Standard Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: I recently added <code>--selfhosted-xdr-mode {encode|decode|off}</code> and <code>--selfhosted-xdr-path /tmp/selfhosted.xdr</code> options.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Jan 08 2021 02:28:53 GMT-0800 (Pacific Standard Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: If you are in a case where you spawn many JS shell, I would mostly think of test case reduction for example.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Jan 08 2021 02:29:50 GMT-0800 (Pacific Standard Time)">10:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">ah, so that caches stuff while the machine exists so I have to do the parsing only once for self hosted code?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Jan 08 2021 02:29:58 GMT-0800 (Pacific Standard Time)">10:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">sounds interesting both for reducing and fuzzing</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Jan 08 2021 02:30:05 GMT-0800 (Pacific Standard Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Then you can spawn a JS shell with <code>--selfhosted-xdr-mode encode --selfhosted-xdr-path /tmp/selfhosted.xdr</code>, and later spawn the other JS shells with <code>--selfhosted-xdr-mode decode --selfhosted-xdr-path /tmp/selfhosted.xdr</code></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Jan 08 2021 02:30:35 GMT-0800 (Pacific Standard Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">couldnt we even make it the default to auto-create a cached xdr somewhere and use it automatically if present?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Jan 08 2021 02:30:50 GMT-0800 (Pacific Standard Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Exactly, it caches the selfhosted parsed content on disk and reload it when asked to <code>decode</code>.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Jan 08 2021 02:30:55 GMT-0800 (Pacific Standard Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">(we can add an option to disable it)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Jan 08 2021 02:31:09 GMT-0800 (Pacific Standard Time)">10:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">if this is really providing that much of a speed up, we should aim at making it the default for the shell too</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Jan 08 2021 02:31:22 GMT-0800 (Pacific Standard Time)">10:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: This would be racy and this is highly dependent on the JS shell version.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Jan 08 2021 02:31:45 GMT-0800 (Pacific Standard Time)">10:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">racy if multiple shells start at once you mean?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Jan 08 2021 02:31:52 GMT-0800 (Pacific Standard Time)">10:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">You could no longer run 2 JS test suite concurrently.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Jan 08 2021 02:32:00 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">I think you could</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Jan 08 2021 02:32:06 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">if one start decoding while one is encoding.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Jan 08 2021 02:32:08 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">the first just locks the cache dir</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Jan 08 2021 02:32:17 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">if the second doesnt get the lock, it uses the in memory default</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Jan 08 2021 02:32:26 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">and that should be a rare case</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Jan 08 2021 02:32:37 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">and yea, it would have to be versioned </td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Jan 08 2021 02:33:38 GMT-0800 (Pacific Standard Time)">10:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I prefer the explicit command line, such that we have control over what is happening.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Jan 08 2021 02:34:18 GMT-0800 (Pacific Standard Time)">10:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">but I think we could add another mode which does what you expect.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Jan 08 2021 02:34:19 GMT-0800 (Pacific Standard Time)">10:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">imho, we should always try to make things as easy and automatic as possible. that doesnt mean that we cant have a command line option to disable that automatic behavior</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Jan 08 2021 02:34:40 GMT-0800 (Pacific Standard Time)">10:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">with automatic behavior, everyone benefits immediately</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Jan 08 2021 02:34:47 GMT-0800 (Pacific Standard Time)">10:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">no matter if they know about this or not</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Jan 08 2021 02:35:29 GMT-0800 (Pacific Standard Time)">10:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">This might be a source of differential behavior for fuzzing, as the memory would not be allocated the same way when we parse/encode/decode.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Jan 08 2021 02:35:50 GMT-0800 (Pacific Standard Time)">10:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">yea, for something like differential fuzzing we should disable this</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Jan 08 2021 02:35:58 GMT-0800 (Pacific Standard Time)">10:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">but we already have a runtime flag for that anyway</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Jan 08 2021 02:36:10 GMT-0800 (Pacific Standard Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">so we can easily disable it</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Jan 08 2021 02:36:38 GMT-0800 (Pacific Standard Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">hm.. thinking about this, I am not sure if that is actually true: this should not cause differential behavior</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Jan 08 2021 02:36:43 GMT-0800 (Pacific Standard Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">at least not observable one</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Jan 08 2021 02:36:49 GMT-0800 (Pacific Standard Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">(other than oom, which is already filtered)</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Jan 08 2021 02:37:00 GMT-0800 (Pacific Standard Time)">10:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">if it does, that might actually be a bug</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Jan 08 2021 02:37:06 GMT-0800 (Pacific Standard Time)">10:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">or allocation alignments … but these are rare.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Jan 08 2021 02:37:30 GMT-0800 (Pacific Standard Time)">10:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">anyway, if it became a problem in that mode, there is --differential-testing by now </td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Jan 08 2021 02:37:34 GMT-0800 (Pacific Standard Time)">10:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">so we can disable it for that use case easily</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Jan 08 2021 02:41:05 GMT-0800 (Pacific Standard Time)">10:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">how much code does the fuzzer load for its harness? eventually it would be nice if we could XDR-encode that too</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Jan 08 2021 02:42:01 GMT-0800 (Pacific Standard Time)">10:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">a bit like python's .pyc files, .jsc :p</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Jan 08 2021 02:42:12 GMT-0800 (Pacific Standard Time)">10:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: ^</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Jan 08 2021 02:43:58 GMT-0800 (Pacific Standard Time)">10:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: yea, it would make sense for the toplevel shell</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Jan 08 2021 02:44:05 GMT-0800 (Pacific Standard Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">thats a concat of js/src/tests/shell.js and some others</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Jan 08 2021 02:44:19 GMT-0800 (Pacific Standard Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">it takes up quite some time to load</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Jan 08 2021 02:45:01 GMT-0800 (Pacific Standard Time)">10:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">we only have a limited amount of restarts, but I have numbers and it would allow us to calculate the time save to determine if it is worth it</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri Jan 08 2021 02:45:57 GMT-0800 (Pacific Standard Time)">10:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah it would allow doing more restarts and make reduction easier?</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri Jan 08 2021 02:48:58 GMT-0800 (Pacific Standard Time)">10:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> a bit like python's .pyc files, .jsc :p</blockquote></mx-reply>That's a good idea, we could do that for loaded files as well.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri Jan 08 2021 02:54:32 GMT-0800 (Pacific Standard Time)">10:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I wonder how much it would speed up jstests, most test files are small but jstests load some shell.js files for every test</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Jan 08 2021 02:55:10 GMT-0800 (Pacific Standard Time)">10:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">but it uses lazy parsing unlike self-hosted</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Jan 08 2021 03:57:06 GMT-0800 (Pacific Standard Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell">Hey, I've just compiled the js shell v84 and it looks like <code>dis</code> has been removed / replaced. What are the alternatives? <code>disnative</code> doesn't seem to work in the same way as it doesn't show any bytecode.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Jan 08 2021 03:59:07 GMT-0800 (Pacific Standard Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">flx1101</span>: it was not removed</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Jan 08 2021 03:59:25 GMT-0800 (Pacific Standard Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell">Did I mess up compilation? :D</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Jan 08 2021 04:00:29 GMT-0800 (Pacific Standard Time)">12:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">flx1101</span>: you either need a debug build or --enable-jitspew</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Jan 08 2021 04:02:21 GMT-0800 (Pacific Standard Time)">12:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell"><code>--enable-debug</code> somehow removed itself from the configure options 😃 thank you!</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Jan 08 2021 04:10:53 GMT-0800 (Pacific Standard Time)">12:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell"><p>Before I waste hours of debugging and digging through code, maybe someone here can help me?</p>
<p>What I'm trying to find out (also with the help of <code>dis</code>, hence my previous question) is how calls with ignored return values are optimized, i.e., called with opcode <code>CallIgnoresRv</code>. Are they eliminated at some optimization stage (I think <code>Math</code> functions can be)? And where can I find this in the code base?</p>
</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Jan 08 2021 04:28:41 GMT-0800 (Pacific Standard Time)">12:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">flx1101</span>: native functions can have a JSJitInfo attached. This makes it possible to optimize some natives for when they're called and the return value isn't used, for example here for array splice: <a href="https://searchfox.org/mozilla-central/rev/519f913527b0d9d5097d290d5731cff6b2991fe0/js/src/builtin/Array.cpp#3648">https://searchfox.org/mozilla-central/rev/519f913527b0d9d5097d290d5731cff6b2991fe0/js/src/builtin/Array.cpp#3648</a></td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Jan 08 2021 04:30:34 GMT-0800 (Pacific Standard Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">this isn't used for Math functions, those are optimized by the JIT and the JIT knows it can eliminate those operations if they're not used</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Jan 08 2021 04:32:28 GMT-0800 (Pacific Standard Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> this isn't used for Math functions, those are optimized by the JIT and the JIT knows it can eliminate those operations if they're not used</blockquote></mx-reply>How does the JIT know it can eliminate those?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Jan 08 2021 04:33:20 GMT-0800 (Pacific Standard Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-5">flx1101</span>: native functions can have a JSJitInfo attached. This makes it possible to optimize some natives for when they're called and the return value isn't used, for example here for array splice: <a href="https://searchfox.org/mozilla-central/rev/519f913527b0d9d5097d290d5731cff6b2991fe0/js/src/builtin/Array.cpp#3648">https://searchfox.org/mozilla-central/rev/519f913527b0d9d5097d290d5731cff6b2991fe0/js/src/builtin/Array.cpp#3648</a></blockquote></mx-reply>If I understand this correctly they are different functions in the JIT? So there's a <code>array_splice</code> and a <code>array_splice_noRetVal</code>?</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Jan 08 2021 04:33:47 GMT-0800 (Pacific Standard Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for example for <code>Math.abs</code> the optimizing JIT will use the <code>MAbs</code> instruction, and that has a <a href="https://searchfox.org/mozilla-central/rev/519f913527b0d9d5097d290d5731cff6b2991fe0/js/src/jit/MIR.h#4903">getAliasSet</a> that tells the optimizer there are no side-effects</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Jan 08 2021 04:34:17 GMT-0800 (Pacific Standard Time)">12:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">also note that the <code>MAbs</code> constructor calls <code>setMovable()</code>, this makes it possible to hoist it before loops</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Jan 08 2021 04:35:16 GMT-0800 (Pacific Standard Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah the JIT will call <code>array_splice_noRetVal</code> if it's a <code>CallIgnoresRv</code> op</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Jan 08 2021 04:39:33 GMT-0800 (Pacific Standard Time)">12:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> for example for <code>Math.abs</code> the optimizing JIT will use the <code>MAbs</code> instruction, and that has a <a href="https://searchfox.org/mozilla-central/rev/519f913527b0d9d5097d290d5731cff6b2991fe0/js/src/jit/MIR.h#4903">getAliasSet</a> that tells the optimizer there are no side-effects</blockquote></mx-reply>Does this mean every function that has <code>AliasSet::None()</code> and therefore no side effects gets eliminated when it's a <code>CallIgnoresRv</code>?</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Jan 08 2021 04:40:41 GMT-0800 (Pacific Standard Time)">12:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">not just when it's a <code>CallIgnoresRv</code>, it doesn't matter what call opcode the <code>MAbs</code> was added for</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Jan 08 2021 04:41:05 GMT-0800 (Pacific Standard Time)">12:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">instructions can also call <code>setGuard()</code>, that means "don't eliminate this even if it has no side-effects"</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri Jan 08 2021 04:42:51 GMT-0800 (Pacific Standard Time)">12:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">this is because the JIT does its own tracking of which values are used where (it uses SSA and tracks where each definition is used)</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri Jan 08 2021 04:44:49 GMT-0800 (Pacific Standard Time)">12:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell">So if I wanted to compile a list of instructions that can't be eliminated I could search for <code>setGuard()</code> and remove all that have <code>AliasSet::None()</code>?</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri Jan 08 2021 04:46:50 GMT-0800 (Pacific Standard Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">everything with <code>setGuard()</code> definitely can't be eliminated. Then, instructions that have a <code>getAliasSet</code> that's a store (not <code>None</code> and not loads) also can't be eliminated (see <code>isEffectful</code> <a href="https://searchfox.org/mozilla-central/rev/519f913527b0d9d5097d290d5731cff6b2991fe0/js/src/jit/MIR.h#921">here</a>)</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Fri Jan 08 2021 04:48:04 GMT-0800 (Pacific Standard Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for example the instruction for loading a value from a typed array has an alias set that's not <code>None</code>, but it can still be eliminated because it's not observable</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Fri Jan 08 2021 04:49:26 GMT-0800 (Pacific Standard Time)">12:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell">Aah, yes, that makes sense</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Fri Jan 08 2021 04:51:22 GMT-0800 (Pacific Standard Time)">12:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@flx1101:matrix.org">flx1101</span>&gt;</div></td><td class="msg-cell">Okay, I'll try and go ahead with my list, thank you for your help <span class="nick-10">jandem</span> ! 🙂</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Fri Jan 08 2021 04:53:02 GMT-0800 (Pacific Standard Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">no problem 🙂</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Fri Jan 08 2021 07:27:07 GMT-0800 (Pacific Standard Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: I think of the long options as just initial steps until we are more comfortable with it being robust and not surprising. Eg automatic decision to encode/decode makes test failures harder to reproduce. The next steps are to get a similar system in browser + android builds and then we'll continue iterating.</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Fri Jan 08 2021 07:28:04 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">sgtm, but we can still add the auto-mode as opt in using a single flag.</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Fri Jan 08 2021 07:28:18 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">(or opt-out and add that to tests if it is causing problems)</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Fri Jan 08 2021 07:28:43 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">this can also be used to determine pain points as we are progressing</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Fri Jan 08 2021 07:29:11 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">mostly I want to avoid surprises where <code>./mach run foo.js</code> has different gc behaviour depending on when you run it</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Fri Jan 08 2021 07:29:28 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">you already have that by now because of the memory load of the machine</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Fri Jan 08 2021 07:29:37 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">we are long past the point of deterministic GC ;)</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Fri Jan 08 2021 07:29:41 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">but I see what you mean</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Fri Jan 08 2021 07:29:51 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">in fuzzing we have quite a few GC asserts that never reproduce</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Fri Jan 08 2021 07:29:56 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">longer term, we'll probably make this data part of the build itself</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Fri Jan 08 2021 07:30:19 GMT-0800 (Pacific Standard Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">eg. a build step will parse selfhosted.js into this stencil-xdr form</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Fri Jan 08 2021 09:47:55 GMT-0800 (Pacific Standard Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">yea, that sounds like a great idea :)</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Fri Jan 08 2021 09:52:26 GMT-0800 (Pacific Standard Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">^ when we would have a solution for cross-compiling stencil.</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Fri Jan 08 2021 10:12:56 GMT-0800 (Pacific Standard Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">To support <a href="https://github.com/annevk/orb">ORB</a> we might want to have lightweight standalone parsing (without any GC). To do that, it might be helpful to have parse-to-stencil compile with from minimal spidermonkey sources. If we did that, it could be a basis for cross-compiling stencil.</td></tr>

</tbody></table></div></div></div>
</body></html>