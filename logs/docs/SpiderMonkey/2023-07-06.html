<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-07-06</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-07-06<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-07-05" class="nav-link"><span>prev</span></a>
<a href="2023-07-07" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Jul 06 2023 08:10:29 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">What's the difference between RegExpRealm and RegExpStatics - aren't these basically the same thing (per realm/global reg exp data)?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Jul 06 2023 08:25:40 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: <code>RegExpStatics</code> is used for the legacy static properties on <code>RegExp</code> like <code>/abc/g.exec("abcdef"); assertEq(RegExp.input, "abcdef");</code></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Jul 06 2023 08:26:13 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the lifetime is similar to <code>RegExpRealm</code> I think? maybe it could live there</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Jul 06 2023 08:26:28 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">ah I see</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Jul 06 2023 08:27:14 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yeah I think they could both be part of GlobalObjectData</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Jul 06 2023 08:27:40 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">makes sense</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Jul 06 2023 11:14:30 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Question: Opening a <em>blank</em> html file in Firefox results in ~1200 calls to either JSScript::fromStencil() or BaseScript::CreateRawLazy(). Is this expected? (To be clear, these are just the script objects that are created when I load this local html file and is after the wave of script objects that are created just upon Firefox start-up.)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Jul 06 2023 11:18:20 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">opening a file can create a new content process and that can run many scripts during its startup I think?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Jul 06 2023 11:20:25 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and even a blank html can have JavaScript global and it contains built-ins, where some of them are implemented with self-hosted JavaScript, and that can also go through that path</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Jul 06 2023 11:21:19 GMT-0700 (Pacific Daylight Time)">18:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in which process and in which call stack do you observe them called?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Jul 06 2023 11:22:19 GMT-0700 (Pacific Daylight Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Examples of the 'filenames' are:
resource:///modules/BrowserSearchTelemetry.sys.mjs
resource:///modules/URILoadingHelper.sys.mjs
self-hosted:#:#
resource://gre/modules/TelemetryControllerContent.sys.mjs
resource://gre/modules/AppConstants.sys.mjs
resource://gre/modules/Log.sys.mjs
resource://gre/modules/XPCOMUtils.sys.mjs
resource://gre/modules/extensionProcessScriptLoader.js
resource://gre/modules/ExtensionUtils.sys.mjs
resource://devtools/client/jsonview/Sniffer.sys.mjs
resource:///actors/InteractionsChild.sys.mjs
resource://gre/modules/PrivateBrowsingUtils.sys.mjs
resource://gre/actors/TranslationsChild.sys.mjs
resource:///actors/LinkHandlerChild.sys.mjs
resource:///actors/AboutReaderChild.sys.mjs
resource://gre/modules/Readerable.sys.mjs
resource://gre/actors/ContentMetaChild.sys.mjs
resource://gre/modules/BrowserTelemetryUtils.sys.mjs
chrome://global/content/translations/language-id-engine-worker.js
chrome://global/content/translations/fasttext.js
chrome://global/content/translations/fasttext_wasm.js (whole bunch of this one)
resource://gre/actors/FindBarChild.sys.mjs</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Jul 06 2023 11:23:48 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Do those seem like the content process scripts that you mentioned? Or do any of those seem out of place?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Jul 06 2023 11:24:10 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Or do any of those seem out of place?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Jul 06 2023 11:24:22 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">mostly looks reasonable.  I don't know the exact set of files that runs during process startup tho</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Jul 06 2023 11:24:47 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and yeah, having "Child" sounds like it's for content process</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Jul 06 2023 11:26:17 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">some of them are fundamental modules (AppConstants, Log, XPCOMUtils, etc),  some of them are for extensions-related, and some of them are UI-related (Translation, Readerable, FindBar)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Jul 06 2023 11:26:32 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">We do track the set of scripts that get loaded at process startup. <a href="https://searchfox.org/mozilla-central/source/browser/base/content/test/performance/browser_startup_content.js#21">https://searchfox.org/mozilla-central/source/browser/base/content/test/performance/browser_startup_content.js#21</a></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Jul 06 2023 11:26:45 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Also, taking a look at the list more closely, the three "global/content/translations/..." ones actually account for around 800 of the 1200.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Jul 06 2023 11:27:24 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Also, taking a look at the list more closely, the three "global/content/translations/..." ones actually account for around 800 of the 1200.</blockquote></mx-reply>When is your tree from? Translations is a very new feature and there's ongoing optimization work for it.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Jul 06 2023 11:27:50 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Let me check, it's at least several weeks old at this point.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Jul 06 2023 11:27:50 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Specifically a number of fixes have landed recently that reduce how much the content scripts for it are doing.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Jul 06 2023 11:28:13 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Roughly three weeks old.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Jul 06 2023 11:28:26 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Ah yeah you probably don't have the most recent fixes. There's the bugs blocking this one and some other ones: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1840698">https://bugzilla.mozilla.org/show_bug.cgi?id=1840698</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Jul 06 2023 11:28:42 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">They did notice some perf issues because of the massive amounts of scripts getting loaded, which I guess is what you are seeing.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Jul 06 2023 11:29:20 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">Cool! It's not causing any real problem for me but I just wanted to find out if that was expected to others because ... it wasn't expected to me. :)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Jul 06 2023 11:29:48 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">(I didn't want to walk right by a problem on my way to what I'm intending to look at.)</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Jul 06 2023 11:30:43 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">We load a lot less content scripts than we used to. 😄</td></tr>

</tbody></table></div></div></div>
</body></html>