<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-05-17</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-05-17<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-05-16" class="nav-link"><span>prev</span></a>
<a href="2024-05-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu May 16 2024 21:54:34 GMT-0700 (Pacific Daylight Time)">04:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">Can someone look how bad bug 1897204 is for actual use in the wild? It only happens on arm64 mac shippable builds, not opt or debug, so it's likely LTO or PGO-driven, and could just as well be miscompilation or UB being exploited. If someone could tell me what is busted and how, that would be useful. On my end, I'm bisecting what LLVM change triggered it.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu May 16 2024 21:54:36 GMT-0700 (Pacific Daylight Time)">04:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1897204">https://bugzil.la/1897204</a> — NEW (nobody) — Perma tests/jit-test/jit-test/tests/wasm/const.js | /opt/worker/tasks/task_171586490191684/build/tests/jit-test/jit-test/lib/wasm.js:238:13 Error: Assertion failed: got 0, expected 1 (code 3, args "") [0.0 s]</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu May 16 2024 21:58:53 GMT-0700 (Pacific Daylight Time)">04:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">oh, this also affects android arm64 shippable builds</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu May 16 2024 23:52:31 GMT-0700 (Pacific Daylight Time)">06:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">we're failing this assertion: <a href="https://searchfox.org/mozilla-central/rev/a18a7c526cf3c531f2fc24db4f0dffbc16290a7e/js/src/jit-test/lib/wasm.js#238">https://searchfox.org/mozilla-central/rev/a18a7c526cf3c531f2fc24db4f0dffbc16290a7e/js/src/jit-test/lib/wasm.js#238</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu May 16 2024 23:53:33 GMT-0700 (Pacific Daylight Time)">06:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for this case: <a href="https://searchfox.org/mozilla-central/rev/a18a7c526cf3c531f2fc24db4f0dffbc16290a7e/js/src/jit-test/tests/wasm/const.js#50">https://searchfox.org/mozilla-central/rev/a18a7c526cf3c531f2fc24db4f0dffbc16290a7e/js/src/jit-test/tests/wasm/const.js#50</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu May 16 2024 23:58:27 GMT-0700 (Pacific Daylight Time)">06:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">we generate a small wasm module that has this big constant as <code>i64.const</code> instruction</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri May 17 2024 00:00:36 GMT-0700 (Pacific Daylight Time)">07:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">and another module that calls this and checks the i64 return value matches what we expect</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri May 17 2024 00:03:43 GMT-0700 (Pacific Daylight Time)">07:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">maybe something to do with large i64 constants? There are a few other jit-test failures, let me see if they're similar</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri May 17 2024 00:10:18 GMT-0700 (Pacific Daylight Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">other failures also involve large constants <a href="https://searchfox.org/mozilla-central/rev/1f46481d6c16f27c989e72b898fd1fddce9f445f/js/src/jit-test/tests/wasm/conversion.js#170">here</a> and <a href="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/wasm/errors.js#89">here</a> and <a href="https://searchfox.org/mozilla-central/rev/1f46481d6c16f27c989e72b898fd1fddce9f445f/js/src/jit-test/tests/wasm/integer.js#222">here</a> and <a href="https://searchfox.org/mozilla-central/rev/1f46481d6c16f27c989e72b898fd1fddce9f445f/js/src/jit-test/tests/wasm/spec/spec/i64.wast.js#160">here</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri May 17 2024 00:12:01 GMT-0700 (Pacific Daylight Time)">07:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">glandium</span>: ^</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri May 17 2024 00:17:16 GMT-0700 (Pacific Daylight Time)">07:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: do you know what specific step is doing something wrong? is it the wasm module generation, or its execution, or extracting the result?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri May 17 2024 00:23:59 GMT-0700 (Pacific Daylight Time)">07:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">seems to affect both wasm compilers and also no-js-jit modes</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri May 17 2024 00:24:35 GMT-0700 (Pacific Daylight Time)">07:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">some of these just generate a wasm function that takes two i64 arguments and does a division</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri May 17 2024 00:26:47 GMT-0700 (Pacific Daylight Time)">07:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">I'm looking for a concrete piece of code where things go awry</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri May 17 2024 00:28:45 GMT-0700 (Pacific Daylight Time)">07:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah I'm looking at that now</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri May 17 2024 00:29:22 GMT-0700 (Pacific Daylight Time)">07:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">thanks</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri May 17 2024 00:34:11 GMT-0700 (Pacific Daylight Time)">07:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">glandium</span>: do your changes affect llvm for both rust and c++ code?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri May 17 2024 00:39:52 GMT-0700 (Pacific Daylight Time)">07:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: "my changes" is an upgrade of both clang and rustc</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri May 17 2024 00:43:30 GMT-0700 (Pacific Daylight Time)">07:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">oh no</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri May 17 2024 00:49:30 GMT-0700 (Pacific Daylight Time)">07:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">bisecting llvm is going to take forever... need full PGO+LTO to reproduce :(</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri May 17 2024 00:50:04 GMT-0700 (Pacific Daylight Time)">07:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I can reproduce locally with a macos shell build from the autoland push. Working on a reduced js test case</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri May 17 2024 01:02:06 GMT-0700 (Pacific Daylight Time)">08:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><a href="https://paste.mozilla.org/jVJgT40x">https://paste.mozilla.org/jVJgT40x</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri May 17 2024 01:07:53 GMT-0700 (Pacific Daylight Time)">08:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">at least it's not in the text parser. I'll step through the rest</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri May 17 2024 01:23:34 GMT-0700 (Pacific Daylight Time)">08:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">wait a second, what is 0x8000000000000000 supposed to be as a i64?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri May 17 2024 01:23:58 GMT-0700 (Pacific Daylight Time)">08:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">the largest i64 is 0x7fffffffffffffff</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri May 17 2024 01:25:03 GMT-0700 (Pacific Daylight Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">could there be some UB related to expectations of wrapping?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri May 17 2024 01:28:37 GMT-0700 (Pacific Daylight Time)">08:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I think it's interpreted as INT64_MIN</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri May 17 2024 01:28:42 GMT-0700 (Pacific Daylight Time)">08:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">stepping through it, the function returns that value</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri May 17 2024 01:29:08 GMT-0700 (Pacific Daylight Time)">08:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">but the caller has invalid code for the comparison, it's comparing it to 0 or something</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri May 17 2024 01:34:19 GMT-0700 (Pacific Daylight Time)">08:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">the caller being?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri May 17 2024 01:38:31 GMT-0700 (Pacific Daylight Time)">08:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the <code>assert_0</code> wasm function. We miscompile the eq instruction: <a href="https://paste.mozilla.org/UZerF8Xo">https://paste.mozilla.org/UZerF8Xo</a></td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri May 17 2024 01:39:23 GMT-0700 (Pacific Daylight Time)">08:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">oh wow, so it's the jit that's broken?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri May 17 2024 01:40:36 GMT-0700 (Pacific Daylight Time)">08:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I think LLVM is miscompiling something in the JIT backend, that then results in miscompiled Wasm code</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri May 17 2024 01:40:41 GMT-0700 (Pacific Daylight Time)">08:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I'll try to track that down</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri May 17 2024 02:24:03 GMT-0700 (Pacific Daylight Time)">09:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: I don't see where in the jit code such a cmn could be generated</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri May 17 2024 02:25:26 GMT-0700 (Pacific Daylight Time)">09:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it goes off the rails in the macro assembler backend, we call into that with the constant still being what we expect</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri May 17 2024 02:27:19 GMT-0700 (Pacific Daylight Time)">09:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">glandium</span>: this - operator on the int64_t immediate looks suspicious? <a href="https://searchfox.org/mozilla-central/rev/1f46481d6c16f27c989e72b898fd1fddce9f445f/js/src/jit/arm64/vixl/MacroAssembler-vixl.cpp#842-843">https://searchfox.org/mozilla-central/rev/1f46481d6c16f27c989e72b898fd1fddce9f445f/js/src/jit/arm64/vixl/MacroAssembler-vixl.cpp#842-843</a></td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri May 17 2024 02:28:37 GMT-0700 (Pacific Daylight Time)">09:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">because that's INT64_MIN in this case</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri May 17 2024 02:28:56 GMT-0700 (Pacific Daylight Time)">09:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">searchfox doesn't have type stuff in this file :(</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri May 17 2024 02:29:27 GMT-0700 (Pacific Daylight Time)">09:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah :/ it's a pain</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri May 17 2024 02:30:13 GMT-0700 (Pacific Daylight Time)">09:30</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-10" title="@jandem:mozilla.org">jandem</span></div></td><td class="msg-cell">continues here in the debugger</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri May 17 2024 02:31:10 GMT-0700 (Pacific Daylight Time)">09:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the Operand type is <a href="https://searchfox.org/mozilla-central/source/js/src/jit/arm64/vixl/Assembler-vixl.h#704">https://searchfox.org/mozilla-central/source/js/src/jit/arm64/vixl/Assembler-vixl.h#704</a></td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri May 17 2024 02:32:08 GMT-0700 (Pacific Daylight Time)">09:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">yeah, minus of a int64_t doesn't smell good</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri May 17 2024 02:34:19 GMT-0700 (Pacific Daylight Time)">09:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, searchfox uses macOS x64 only.  should we add aarch64 indexing?  there's bug 1795177 for it</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri May 17 2024 02:34:21 GMT-0700 (Pacific Daylight Time)">09:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1795177">https://bugzil.la/1795177</a> — NEW (nobody) — OSX AArch64 code not getting indexed</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri May 17 2024 02:35:38 GMT-0700 (Pacific Daylight Time)">09:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it also has arm32 but not arm64.. would be great to add it. The Vixl code often has multiple layers of calls</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri May 17 2024 02:36:16 GMT-0700 (Pacific Daylight Time)">09:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I can take a look this weekend</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri May 17 2024 02:38:09 GMT-0700 (Pacific Daylight Time)">09:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">great, thanks!</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri May 17 2024 02:54:04 GMT-0700 (Pacific Daylight Time)">09:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@anba:mozilla.org">anba</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: We probably need to backport <a href="https://github.com/Linaro/vixl/commit/b8da04db2b3c59c595bc1efd0540c3d1c595f4cc">https://github.com/Linaro/vixl/commit/b8da04db2b3c59c595bc1efd0540c3d1c595f4cc</a></td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri May 17 2024 03:10:46 GMT-0700 (Pacific Daylight Time)">10:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">anba</span>: testing that on try</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri May 17 2024 03:14:04 GMT-0700 (Pacific Daylight Time)">10:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">I won't be around in the probably 3 hours it'll take to have a result, but you can follow along: <a href="https://treeherder.mozilla.org/jobs?repo=try&amp;revision=19b0e7c31fe5d6a360a8c7bead33b93e9a14e86b">https://treeherder.mozilla.org/jobs?repo=try&amp;revision=19b0e7c31fe5d6a360a8c7bead33b93e9a14e86b</a></td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri May 17 2024 03:46:01 GMT-0700 (Pacific Daylight Time)">10:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">thanks <span class="nick-12">anba</span></td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri May 17 2024 03:48:04 GMT-0700 (Pacific Daylight Time)">10:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">looking at the generated code more, for the <code>IsImmAddSub(-operand.immediate())</code> call, LLVM emits a <code>neg</code> instruction and then masks the high bit off (<code>and x16, x20, #0x7fffffffffffffff</code>)</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri May 17 2024 03:49:18 GMT-0700 (Pacific Daylight Time)">10:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the (inlined) code in <code>IsImmAddSub</code> then incorrectly thinks this is in the immediate range</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri May 17 2024 03:54:46 GMT-0700 (Pacific Daylight Time)">10:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">it's a little worrying that it was fixed 4 years ago upstream... how many other bugs are lurking?</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri May 17 2024 04:35:59 GMT-0700 (Pacific Daylight Time)">11:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the same pattern also shows up in Ccmp/Ccmn/Neg and might affect <a href="https://searchfox.org/mozilla-central/rev/1f46481d6c16f27c989e72b898fd1fddce9f445f/js/src/jit/arm64/MacroAssembler-arm64.cpp#1910">this code</a></td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri May 17 2024 04:36:47 GMT-0700 (Pacific Daylight Time)">11:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">this isn't fixed <a href="https://github.com/Linaro/vixl/blob/main/src/aarch64/macro-assembler-aarch64.cc#L1152-L1153">upstream</a> either</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri May 17 2024 04:37:55 GMT-0700 (Pacific Daylight Time)">11:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">these may not be a problem (yet) but I'll write a patch</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri May 17 2024 04:46:00 GMT-0700 (Pacific Daylight Time)">11:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: there's one in MacroAssembler::Ccmn too</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri May 17 2024 04:47:54 GMT-0700 (Pacific Daylight Time)">11:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">the one in MacroAssembler::Neg is interesting too</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri May 17 2024 05:23:48 GMT-0700 (Pacific Daylight Time)">12:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">posted a patch in bug 1897204</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri May 17 2024 05:23:50 GMT-0700 (Pacific Daylight Time)">12:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1897204">https://bugzil.la/1897204</a> — ASSIGNED (jandem) — Perma tests/jit-test/jit-test/tests/wasm/const.js | /opt/worker/tasks/task_171586490191684/build/tests/jit-test/jit-test/lib/wasm.js:238:13 Error: Assertion failed: got 0, expected 1 (code 3, args "") [0.0 s]</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri May 17 2024 05:52:11 GMT-0700 (Pacific Daylight Time)">12:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: Patching Add and Sub was enough to fix the failure</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri May 17 2024 05:52:25 GMT-0700 (Pacific Daylight Time)">12:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">(FWIW)</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri May 17 2024 05:52:41 GMT-0700 (Pacific Daylight Time)">12:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">nice. I'll land the patch now</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri May 17 2024 05:54:24 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell">I wonder if we have enough arm64 macs to add ubsan tests</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri May 17 2024 10:23:07 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">rr record --chaos-mode in a loop would be a worthwhile attempt still. </td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri May 17 2024 12:12:16 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">thanks for the tip</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Fri May 17 2024 12:48:49 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@glandium:mozilla.org">glandium</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: you should probably upstream the extra fixes.</td></tr>

</tbody></table></div></div></div>
</body></html>