<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-01-10</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-01-10<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-01-09" class="nav-link"><span>prev</span></a>
<a href="2025-01-11" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Jan 10 2025 04:57:46 GMT-0800 (Pacific Standard Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">I was testing a game based on godot engine. I have enabled tiering on my machine. For fun, i tested with tiering disabled. It is brutal: <a href="https://share.firefox.dev/3PzqOWU">https://share.firefox.dev/3PzqOWU</a> (partial)</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Jan 10 2025 05:20:33 GMT-0800 (Pacific Standard Time)">13:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the tiering-enabled profile is a lot better? excellent :)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Jan 10 2025 05:24:05 GMT-0800 (Pacific Standard Time)">13:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">that said, so much time under <code>minimalBundle</code> on especially thread #6 is pretty bad. I think we can make that a lot faster with some small changes. I'll look into it</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Jan 10 2025 05:40:16 GMT-0800 (Pacific Standard Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">it is. It takes about 4 seconds only. For reference: bug 1939938</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Jan 10 2025 05:40:18 GMT-0800 (Pacific Standard Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1939938">https://bugzil.la/1939938</a> — NEW (nobody) — [WASM] Godot engine based <a href="https://emiwa.itch.io/home">https://emiwa.itch.io/home</a> spends ~4seconds on multiple background threads, and 800ms doing malloc-y stuff on 6 DOMWorkers each</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Jan 10 2025 05:43:44 GMT-0800 (Pacific Standard Time)">13:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">you may need to disable enhanced tracking protection (the shield icon in addressbar) to make the game run.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Jan 10 2025 05:44:37 GMT-0800 (Pacific Standard Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">TaskController #2 also looks similarish to my naive eyes.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Jan 10 2025 05:46:05 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yes that one is very similar</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Jan 10 2025 06:09:58 GMT-0800 (Pacific Standard Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">jesup</span>: are you still working on bug 1811927 ?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Jan 10 2025 06:10:00 GMT-0800 (Pacific Standard Time)">14:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1811927">https://bugzil.la/1811927</a> — ASSIGNED (jesup) — Report non-malloc memory managed by SpiderMonkey to the profiler, e.g. wasm memory</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Jan 10 2025 07:45:42 GMT-0800 (Pacific Standard Time)">15:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: it had totally fallen off my radar</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Jan 10 2025 07:48:12 GMT-0800 (Pacific Standard Time)">15:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">jesup</span>: Is there anything blocking this? Currently we don't report any GC memory to the profiler and it would be good to get that fixed. I had assumed this had landed as I saw it being discussed a while ago.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Jan 10 2025 07:49:54 GMT-0800 (Pacific Standard Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'm happy to help out (or even take over if needs be)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Jan 10 2025 08:09:24 GMT-0800 (Pacific Standard Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">If you'd like to take it over, that'd be great - I don't think there's a lot more to do</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Jan 10 2025 08:10:14 GMT-0800 (Pacific Standard Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">I'm deep in testing multithreading the network cache, to see if it actually helps performance given how fast SSDs are</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Jan 10 2025 08:10:51 GMT-0800 (Pacific Standard Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">(by bet currently is 'not much'; turning off racecachewithnetwork, at least on SSDs, seems to be a big win though)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Jan 10 2025 08:10:59 GMT-0800 (Pacific Standard Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">Thanks!</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Jan 10 2025 08:55:56 GMT-0800 (Pacific Standard Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">What's my best bet for benchmarking? i.e. execution time, memory usage, cpu usage, for an embedded application?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Jan 10 2025 08:58:33 GMT-0800 (Pacific Standard Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Like what kind of harness? Or specific workloads? </td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Jan 10 2025 09:06:24 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">I want to compare the application's memory, and CPU usage at specific points like for each global compartment introduced</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Jan 10 2025 09:48:45 GMT-0800 (Pacific Standard Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">jesup</span>: OK sure. I'll ping you if I have any questions.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Jan 10 2025 12:50:58 GMT-0800 (Pacific Standard Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: I got pretty much everything working except <a href="https://searchfox.org/mozilla-central/source/testing/web-platform/tests/scheduler/tentative/yield/yield-priority-timers.any.js">one test</a> :) Can I get some opinions about it from you? This one doesn't rely on the <code>scheduling state</code> thing, so it should be easy, however I am not sure if I can make it pass without changing how we run setTimeout handlers.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Jan 10 2025 12:57:23 GMT-0800 (Pacific Standard Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">this test expects that <code>for loop</code> to finish before the setTimeout handlers for <code>t2</code> and <code>t3</code>. But we currently <a href="https://searchfox.org/mozilla-central/rev/29e186485fe1b835f05bde01f650e371545de98e/dom/base/TimeoutManager.cpp#814-815,940">run setTimeout handlers in a sequence</a>, and <a href="https://wicg.github.io/scheduling-apis/#schedule-a-yield-continuation">scheduler.yield</a>'s promise won't resolve until the scheduled task to finish, so AFAICT there's no way for this <code>for loop</code> to finish because no matter how high the priority I give to this task, the setTimeout handlers for <code>t2</code> and <code>t3</code> will be finished first.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Jan 10 2025 12:57:51 GMT-0800 (Pacific Standard Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">(sorry this feels like a DOM question, but I still want to ask you first :) )</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Jan 10 2025 13:37:11 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@leftmostcat:matrix.org">leftmostcat (UTC-8)</span>&gt;</div></td><td class="msg-cell">I took a peek at <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1919856">https://bugzilla.mozilla.org/show_bug.cgi?id=1919856</a>; am I correct in thinking putting <code>endOffset_; usesEnvironmentChain_; flags_; hasPurgedStubs_</code> after <code>templateEnv_</code> would cut it down to a single 4-byte hole, or am I missing something? (I'm a little bit confused by what I'm seeing on that layout.)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Jan 10 2025 13:45:12 GMT-0800 (Pacific Standard Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Seems quite possible! I'm bad at packing in my head; one thing I've done to experiment here is add <code>static_assert(sizeof(JitScript), ...)</code>; once you get the size right, then edit the order and recompile and see if the assert fails because sizeof shrunk</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Jan 10 2025 13:45:37 GMT-0800 (Pacific Standard Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Sorry I didn't reply here; we don't really have much in the way of introspection system akin to this. </td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Jan 10 2025 13:46:13 GMT-0800 (Pacific Standard Time)">21:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">In Firefox we have the gecko profiler which can do a lot of this, but I don't think it works for arbitrary embeddings</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Jan 10 2025 13:48:39 GMT-0800 (Pacific Standard Time)">21:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@leftmostcat:matrix.org">leftmostcat (UTC-8)</span>&gt;</div></td><td class="msg-cell">Thanks for the idea. I'll give that a shot.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Jan 10 2025 14:55:50 GMT-0800 (Pacific Standard Time)">22:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@leftmostcat:matrix.org">leftmostcat (UTC-8)</span>&gt;</div></td><td class="msg-cell">Yep, that drops it from 304 bytes to 296 bytes on my machine. I can put up a patch.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Jan 10 2025 14:56:47 GMT-0800 (Pacific Standard Time)">22:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">also, you can always do <code>static int foo[-sizeof(JitScript)];</code> to get a compile-time error with the (negative of the) size in it. ;-)</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Jan 10 2025 14:57:15 GMT-0800 (Pacific Standard Time)">22:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@leftmostcat:matrix.org">leftmostcat (UTC-8)</span>&gt;</div></td><td class="msg-cell">Moving <code>hasPurgedStubs_</code> doesn't actually make a difference since it gets aligned with the other hole anyhow.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Jan 10 2025 15:09:33 GMT-0800 (Pacific Standard Time)">23:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@leftmostcat:matrix.org">leftmostcat (UTC-8)</span>&gt;</div></td><td class="msg-cell"><code>clangd</code> very kindly lets me know the full expression of a <code>static_assert</code> with <code>==</code> in it. :)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Jan 10 2025 15:13:22 GMT-0800 (Pacific Standard Time)">23:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Hey, that's much better! Oddly, my clang does not (clang, not clangd), but gcc does.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Jan 10 2025 15:13:29 GMT-0800 (Pacific Standard Time)">23:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh, wait, a newer clang version does.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Jan 10 2025 15:15:39 GMT-0800 (Pacific Standard Time)">23:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@leftmostcat:matrix.org">leftmostcat (UTC-8)</span>&gt;</div></td><td class="msg-cell">I never actually got around to seeing what <code>clang</code> itself does, 'cause I typed it out in my IDE and it immediately told me it was wrong. 😆</td></tr>

</tbody></table></div></div></div>
</body></html>