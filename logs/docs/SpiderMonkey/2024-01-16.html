<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-01-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-01-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-01-15" class="nav-link"><span>prev</span></a>
<a href="2024-01-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jan 16 2024 02:58:18 GMT-0800 (Pacific Standard Time)">10:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Hello! I am currently working on an in-house game engine which embeds SpiderMonkey. I am attempting an upgrade from SM 38 to SM 91. Is this the right place to ask about issues I'm facing?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jan 16 2024 03:08:40 GMT-0800 (Pacific Standard Time)">11:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, feel free to ask questions</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jan 16 2024 03:53:31 GMT-0800 (Pacific Standard Time)">11:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Alright, thanks! So, the current problem we're facing is weird to say the least.

We already have some of the bindings working, namely those that don't use inheritance of any kind. Our inheritance was essentially done with a couple of templated classes which served to invoke methods on our target object. The parent object's method data was injected using an std::vector&lt;JSFunctionSpec&gt; stored within the parent which served to invoke those parent methods using. Part of the weirdness comes from the fact that we can access the properties of the derived class that are injected using a similar vector of JSPropertySpec's, but none of the methods that are defined by the class, only its upper most parent (for example, in our case we have Entity -&gt; Container, in this case all of the properties from Entity are accessible in a Container, but only the methods defined in Entity are accessible in a Container).

I have more info, but this feels like it's the most relevant to share. During the initial update process I used a lot of snippets from the cookbook, as well as followed a post in 0ad's forums someone made when upgrading their version from 30 or so to 64 I believe. Some of the older context options were no longer available as well so I removed them. This might be irrelevant but might as well share too.

If you could help me figure this out I'd be wholly appreciated.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jan 16 2024 04:08:09 GMT-0800 (Pacific Standard Time)">12:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-7">sonarshroom</span>: I have some questions, in order to understand the situation better:</p>
<ul>
<li>(a) is "inheritance" about C++ side, or JS side?</li>
<li>(b) How do you use <code>std::vector&lt;JSFunctionSpec&gt;</code> ?</li>
<li>(c) what exactly do you mean by "we can access the properties" ?  what operation? C++ side or JS side? what's the target?</li>
<li>(d) what is "class" here?  <code>JSClass</code> ?  <code>class</code> syntax in JS code? or something else?</li>
</ul>
</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jan 16 2024 04:16:30 GMT-0800 (Pacific Standard Time)">12:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p><span class="nick-7">sonarshroom</span>: I have some questions, in order to understand the situation better:</p>
<ul>
<li>(a) is "inheritance" about C++ side, or JS side?</li>
<li>(b) How do you use <code>std::vector&lt;JSFunctionSpec&gt;</code> ?</li>
<li>(c) what exactly do you mean by "we can access the properties" ?  what operation? C++ side or JS side? what's the target?</li>
<li>(d) what is "class" here?  <code>JSClass</code> ?  <code>class</code> syntax in JS code? or something else?</li>
</ul>
</blockquote></mx-reply>(a) if I understand the question correctly, this is about the bindings created within C++ to access from JS. We have a few macros to declare the bindings for JS:<br>DEF_BIND(Container)<br>DEF_PARENT(Entity)<br>In this case Container and Entity are classes that serve as the bridge between JS and C++, written in the C++ side.<br>(b) The std::vector&lt;JSFunctionSpec&gt; contains the results of the macros JS_FN using the methods names. In the case of our bindings we have, in the same block something along these lines<br>DEF_METHOD(clone)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jan 16 2024 04:16:57 GMT-0800 (Pacific Standard Time)">12:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">This clone is a method in the same Container class.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jan 16 2024 04:20:14 GMT-0800 (Pacific Standard Time)">12:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">(c) I have a script that adds behavior to a class. If in that script I try to call "container.clone" for example which is a method defined in the same Container glue class, it won't get called, even though it's inside the std::vector&lt;JSFunctionSpec&gt;. If I use any method from the Entity parent class however in my JS scripts, it works as normal.
(d) I'm referring to the class as our glue classes in C++.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jan 16 2024 04:20:38 GMT-0800 (Pacific Standard Time)">12:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Sorry for being so vague, I'm essentially talking to my lead if I have permission to share some stuff in here.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jan 16 2024 04:23:02 GMT-0800 (Pacific Standard Time)">12:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, about (a), when you say "don't use inheritance", it means C++ classes <code>Container</code> and <code>Entity</code> has no relation in term of C++ class?  or does it mean that JS classes corresponds to <code>Entity</code> and <code>Container</code> has no relation in term of JS prototype chain ?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jan 16 2024 04:26:04 GMT-0800 (Pacific Standard Time)">12:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I believe the latter applies, since, in our case, when we do DEF_PARENT(Entity) we get it's std::vector&lt;JSFunctionSpec&gt; remove it's last element (the JS_FN_END) and use those same objects.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jan 16 2024 04:27:42 GMT-0800 (Pacific Standard Time)">12:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, then about (b). now I see how you create the <code>std::vector&lt;JSFunctionSpec&gt;</code> data.  can you tell me how you use the data?  which JSAPI do you pass the data to?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jan 16 2024 04:35:50 GMT-0800 (Pacific Standard Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Of course. The structure is a bit complex, so I'll try to simplify. The Container class in the previous example refers to a glue class in our code. This also creates a "Binding" object templated on this glue code class. When the macro DEF_METHOD is invoked on any bind, it creates a templated object which invokes the target method in the glue code class. In essence, we get this pushed onto our JSFunctionSpec vector:
(JS_FN(strdup(name.c_str()), wrapper::JSNativeFunction, wrapper::ArgsCount, 0)
In which wrapper is said class that invokes the method using template black magic (we unwrap the definition of the method in the template and call it with the correct object).</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jan 16 2024 04:45:16 GMT-0800 (Pacific Standard Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hm, maybe my question wasn't clear.  what JSAPI function do you call with the data represented by the vector?  is it <code>JS_InitClass</code>, <code>JS::NewFunctionFromSpec</code>, <code>JS_DefineFunctions</code>, or something else?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jan 16 2024 04:46:06 GMT-0800 (Pacific Standard Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Oh my bad. JS_InitClass is called with the pointers to said vectors</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jan 16 2024 04:46:43 GMT-0800 (Pacific Standard Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I was wondering what you meant by JSAPI, only now I recalled that it's used pretty much all over the docs haha</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jan 16 2024 04:47:53 GMT-0800 (Pacific Standard Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay. then, it sounds like the vector is dynamically modified.  when does it happen?  before calling <code>JS_InitClass</code> ?  or you keep the vector after calling <code>JS_InitClass</code> and modify it?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jan 16 2024 05:02:12 GMT-0800 (Pacific Standard Time)">13:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, about (c), is the "script" a JS script?  what is <code>container</code> there? an instance of <code>Container</code> JS class?  what do you mean by "won't get called"?  what exactly do you observe instead?  do you get error?  or it silently fails, or it crashes the process?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jan 16 2024 05:20:22 GMT-0800 (Pacific Standard Time)">13:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> okay. then, it sounds like the vector is dynamically modified.  when does it happen?  before calling <code>JS_InitClass</code> ?  or you keep the vector after calling <code>JS_InitClass</code> and modify it?</blockquote></mx-reply>We keep the vector initially, and "truncate" the binding with it's parent information before calling JS_InitClass. Afaik, it's never modified after the fact.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jan 16 2024 05:26:10 GMT-0800 (Pacific Standard Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> then, about (c), is the "script" a JS script?  what is <code>container</code> there? an instance of <code>Container</code> JS class?  what do you mean by "won't get called"?  what exactly do you observe instead?  do you get error?  or it silently fails, or it crashes the process?</blockquote></mx-reply>The script is a JS script yes. Container refers to an entity type in our game scene, more specifically, in this example, it refers to the class in C++ which acts as the glue code between the actual entity in C++ land, and the JS code in the scripts. Regarding the won't get called, I forgot to mention that it fails with the following error:<br>Error: TypeError: this.root.getEntity is not a function<br>In this case, this.root refers to an entity in the tree which our behavior is attached to, of type Container. The getEntity is a function defined in the Container class, but it always throws this error. If I instead had called a function that's defined in the Entity class which Container derives from, it works.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jan 16 2024 05:28:42 GMT-0800 (Pacific Standard Time)">13:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">where does <code>this.root.getEntity</code> expression come from?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jan 16 2024 05:34:40 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>and what's the relation between the following?</p>
<ul>
<li><code>container.clone</code> expression</li>
<li><code>this.root.getEntity</code> expression</li>
<li><code>JSFunctionSpec</code> vector</li>
</ul>
</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jan 16 2024 05:44:54 GMT-0800 (Pacific Standard Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> where does <code>this.root.getEntity</code> expression come from?</blockquote></mx-reply>This is a line from the script I'm loading in the game</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jan 16 2024 05:46:45 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, there are 2 scripts related to this issue? one with <code>container.clone</code> expression in it, and one with <code>this.root.getEntity</code> in it?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jan 16 2024 05:48:10 GMT-0800 (Pacific Standard Time)">13:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>and what's the relation between the following?</p>
<ul>
<li><code>container.clone</code> expression</li>
<li><code>this.root.getEntity</code> expression</li>
<li><code>JSFunctionSpec</code> vector</li>
</ul>
</blockquote></mx-reply><code>container.clone</code> is an example line i used where I'm calling the clone function on a container;<br><code>this.root.getEntity</code> is the actual line in one of our projects in which the function <code>getEntity</code> is called. <code>getEntity</code> is itself a function defined in <code>Container</code> which derives from <code>Entity</code>;<br><code>JSFunctionSpec</code> vector is the vector we use in our C++ class that keeps track of said JSFunctionSpec's for the glue classes in our engine.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jan 16 2024 05:48:43 GMT-0800 (Pacific Standard Time)">13:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so, there are 2 scripts related to this issue? one with <code>container.clone</code> expression in it, and one with <code>this.root.getEntity</code> in it?</blockquote></mx-reply>The <code>container.clone</code> part is just an example. Currently the live example I'm working with is that <code>getEntity</code> call.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jan 16 2024 05:53:15 GMT-0800 (Pacific Standard Time)">13:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">sorry, can you explain the issue from the beginning, without using example or dummy code?  I'm lost what's important info and what's unrelated info</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Jan 16 2024 05:55:11 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(or maybe we'd better waiting for the approval for sharing code...)</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Jan 16 2024 05:56:34 GMT-0800 (Pacific Standard Time)">13:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">or, if you cannot provide the actual code, the other option is to create a minimal testcase that demonstrates the issue</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Jan 16 2024 05:57:04 GMT-0800 (Pacific Standard Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">currently there are so many thing happening, and most of them are actually unrelated to SpiderMonkey itself. and hard to follow without looking the code</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Jan 16 2024 05:57:44 GMT-0800 (Pacific Standard Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> sorry, can you explain the issue from the beginning, without using example or dummy code?  I'm lost what's important info and what's unrelated info</blockquote></mx-reply>Ofc, so essentially we have a game engine, which exports types from C++ to JS. Those types follow C++'s inheritance hierarchy but, due to us having used an older version of SpiderMonkey until now (version 38), we'd essentially create various classes using JS_InitClass, and inject into them the information from their parents (meaning that they don't share prototypes I believe). The issue we're having right now is that for some reason we can only call methods from the top most parent of the classes, not from the actual classes themselves.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Jan 16 2024 05:58:49 GMT-0800 (Pacific Standard Time)">13:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> or, if you cannot provide the actual code, the other option is to create a minimal testcase that demonstrates the issue</blockquote></mx-reply>The code is quite complex on our side, leaving me without understanding if this is an issue with the glue code itself, or something else. Too much templates does bad to the brain I'm afraid haha</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Jan 16 2024 05:59:35 GMT-0800 (Pacific Standard Time)">13:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> (or maybe we'd better waiting for the approval for sharing code...)</blockquote></mx-reply>I'm gonna try to get it in the meanwhile, sorry about it :(</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Jan 16 2024 06:08:16 GMT-0800 (Pacific Standard Time)">14:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>okay, now the questions are:</p>
<ul>
<li>(e) what is the exact operation for "inject into them the information from their parents" ?</li>
<li>(f) what is the exact operation for "call methods from the top most parent of the classes" ?</li>
<li>(g) what is the exact operation for "call methods from the actual classes themselves" ?</li>
</ul>
</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Jan 16 2024 06:34:08 GMT-0800 (Pacific Standard Time)">14:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><p>I've gotten permission to share a bit more so here goes: in our code we have the following</p>
<pre><code class="language-cpp">DEF_BIND(Container)
DEF_PARENT(Entity)
DEF_METHOD(getEntity)
// plus a bunch more DEF_METHOD calls here
DEF_METHOD_IMMUTABLE_PROPERTY(children, GetChildren)
// plus a bunch more DEF_METHOD_PROPERTY calls here
DEF_METHOD_PROPERTY(acceptsMouse, acceptsMouseInput, setAcceptsMouseInput);
</code></pre>
<p>This defines a static Binding object, templated on the Container class (the DEF_BIND call). This Binding object contains most importantly the following:</p>
<pre><code class="language-cpp">class BindingBase {
	public:
		struct CallbackDef {
			std::string name;
			std::string substructure;
		};

		struct CustomMethodDef {
			JSNativeFunction func;
			uint16 argc;
		};

		std::vector&lt;JSPropertySpec&gt; 						propertyspec;
		std::vector&lt;JSPropertySpec&gt; 						staticpropertyspec;
		std::vector&lt;JSFunctionSpec&gt; 						functionspec;
		std::vector&lt;JSFunctionSpec&gt; 						staticfunctionspec;
		std::vector&lt;CallbackDef&gt;							callbacks; // in this case both this and the next are not needed to understand the problem.
		std::unordered_map&lt;std::string, CustomMethodDef&gt;	triggers;
	};
</code></pre>
<p>These are initially full of only the results of the calls to JS_PS and JS_FS where it's required, through the DEF_METHOD (for methods this essentially adds a JS_FN) and DEF_METHOD_(IMMUTABLE_)PROPERTY (for properties this adds a JS_PSGS or JS_PSG in the case of immutable properties). Then, in the Init method for the Binding class itself, which derives from this BindingBase we have the following:</p>
<pre><code class="language-cpp">void Init(JSContext* cx, JS::RootedObject* globalObject) {
			Init ({cx, globalObject});
		}

		void Init(const InitData &amp;data) {

			InjectParentInfo();
			TruncateBinding();

			JS::RootedObject _prototype(data.context,
										parentPrototypeBuilder ? parentPrototypeBuilder(data.context) : nullptr);

			using ConstructorProvider_t = CHIM::JSUtils::ConstructorProvider&lt;Class_t, CHIM::JSUtils::has_make&lt;Class_t, JS::CallArgs &amp;&gt;::value&gt;;

			auto _constructor = static_cast&lt;JSNative&gt;(ConstructorProvider_t::JSConstructor);

			_jsClass.oOps = &amp;objectOps;
			prototype = JS_InitClass(data.context,
									   *data.globalObject,
										_prototype,
										&amp;_jsClass,
									    _constructor,
										0,
									    propertyspec.data(),
										functionspec.data(),
									    staticpropertyspec.data(),
										staticfunctionspec.data()
			);
			JS::RootedObject _protoObj(data.context, prototype);
		}
</code></pre>
</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Jan 16 2024 06:40:38 GMT-0800 (Pacific Standard Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>okay, now the questions are:</p>
<ul>
<li>(e) what is the exact operation for "inject into them the information from their parents" ?</li>
<li>(f) what is the exact operation for "call methods from the top most parent of the classes" ?</li>
<li>(g) what is the exact operation for "call methods from the actual classes themselves" ?</li>
</ul>
</blockquote></mx-reply><p>So, with this context, to answer your questions:<br>(e) our call in this Init method calls InjectParentInfo():</p>
<pre><code class="language-cpp">		void InjectInto(BindingBase &amp;binding) {

			std::size_t _currFunctionSpec = 0;
			for (auto &amp;_fs : functionspec) {
				if (_currFunctionSpec &gt;= functionspec.size() - 1) {
					break;
				}
				binding.functionspec.insert(binding.functionspec.begin(), _fs);
				_currFunctionSpec++;
			}

			std::size_t _currPropertySpec = 0;
			for (auto &amp;p : propertyspec) {
				if (_currPropertySpec &gt;= propertyspec.size() - 1) {
					break;
				}
				binding.propertyspec.insert(binding.propertyspec.begin(), p);
				_currPropertySpec++;
			}

			std::size_t _currStaticPropertySpec = 0;
			for (auto &amp;p : staticpropertyspec) {
				if (_currStaticPropertySpec &gt;= staticpropertyspec.size() - 1) {
					break;
				}
				binding.staticpropertyspec.insert(binding.staticpropertyspec.begin(), p);
				_currStaticPropertySpec++;
			}
		}
</code></pre>
<p>Those breaks are there to not inject the JS_PS_END and JS_FN_END in the middle.<br>(f) Imagine we have a Container object and I decide to call from JS the getEntity function which I defined in that example: it won't be called with that TypeError I wrote about earlier, even though it's present in it's functionspec vector. If I call any of it's parent class' methods (in this case Entity is it's parent class) they can be called.<br>(g) I think I answered this in (f).</p>
<p>Hope this helps a bit more :D</p>
</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Jan 16 2024 06:45:30 GMT-0800 (Pacific Standard Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so <code>DEF_METHOD(getEntity)</code> puts an item for <code>getEntity</code> into <code>BindingBase::functionspec</code> vector, and the spec is supposed to be passed to <code>JS_InitClass</code> call for the <code>Container</code>, right?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Jan 16 2024 06:46:21 GMT-0800 (Pacific Standard Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">have you verified that <code>getEntity</code> is part of the <code><a href="http://functionspec.data">functionspec.data</a>()</code> for each <code>JS_InitClass</code> call which expects <code>getEntity</code> in it?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Jan 16 2024 06:46:53 GMT-0800 (Pacific Standard Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">once you verified that part, the code before <code>JS_InitClass</code> becomes unrelated</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Jan 16 2024 06:51:21 GMT-0800 (Pacific Standard Time)">14:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so <code>DEF_METHOD(getEntity)</code> puts an item for <code>getEntity</code> into <code>BindingBase::functionspec</code> vector, and the spec is supposed to be passed to <code>JS_InitClass</code> call for the <code>Container</code>, right?</blockquote></mx-reply>Essentially yes</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Jan 16 2024 06:51:54 GMT-0800 (Pacific Standard Time)">14:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> once you verified that part, the code before <code>JS_InitClass</code> becomes unrelated</blockquote></mx-reply>Yes it is inside. I don't know if can send pictures of the debugger but it's there</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Jan 16 2024 07:04:14 GMT-0800 (Pacific Standard Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, then the next thing is to verify that the prototype object created by JS_InitClass has the property.  and then the next thing is to verify the prototype of the object you want to call getEntity is the same prototype object</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Jan 16 2024 07:05:10 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I'd imagine it would be easier to check that in JS correct?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Jan 16 2024 07:05:19 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Jan 16 2024 07:05:31 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><p>Ok</p>
<pre><code class="language-js">for (let prop of Container.__prototype__)
{
console.log(prop)
}
</code></pre>
</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Jan 16 2024 07:05:58 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if your global has <code>console.log</code> or equivalent, it should be easy</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Jan 16 2024 07:06:16 GMT-0800 (Pacific Standard Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">something along those lines right?</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Jan 16 2024 07:06:51 GMT-0800 (Pacific Standard Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">for-of won't work</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Jan 16 2024 07:07:22 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">hmm even if the properties are JS_ENUMERABLE?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Jan 16 2024 07:07:41 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">you want for-in</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Jan 16 2024 07:07:48 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Ah I see</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Jan 16 2024 07:07:54 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">thanks, I'll get back to you</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Jan 16 2024 07:26:51 GMT-0800 (Pacific Standard Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> okay, then the next thing is to verify that the prototype object created by JS_InitClass has the property.  and then the next thing is to verify the prototype of the object you want to call getEntity is the same prototype object</blockquote></mx-reply>Running that code yields no properties at all</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Jan 16 2024 07:27:51 GMT-0800 (Pacific Standard Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I've also made sure to make all properties enumerable explicitely</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Jan 16 2024 07:28:20 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what happens if you do property access directly?</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Jan 16 2024 07:29:32 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">like <code>typeof Container.prototype.getEntity</code></td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Jan 16 2024 07:30:12 GMT-0800 (Pacific Standard Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><p>Wait, another person that's helping me debug said that instancing a Container and iterating the same way yields the properties, but I'm unsure if that's the same. I.e.:</p>
<pre><code class="language-js">var c = new Container
for (let prop in c.__prototype__) {
    console.log(prop);
}
</code></pre>
</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Jan 16 2024 07:30:20 GMT-0800 (Pacific Standard Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> like <code>typeof Container.prototype.getEntity</code></blockquote></mx-reply>lemme check</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Jan 16 2024 07:30:46 GMT-0800 (Pacific Standard Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is that the exact code?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Jan 16 2024 07:32:08 GMT-0800 (Pacific Standard Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>Container.__prototype__</code> is not what you want (unless you define something special).  you want <code>Container.prototype</code></td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Jan 16 2024 07:32:13 GMT-0800 (Pacific Standard Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">The one he tested yes. This one yields the correct properties. If I try <code>Container.__prototype__</code> instead, none are outputted</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Jan 16 2024 07:32:44 GMT-0800 (Pacific Standard Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't know where the property with double underscores comes from</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Jan 16 2024 07:32:47 GMT-0800 (Pacific Standard Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <code>Container.__prototype__</code> is not what you want (unless you define something special).  you want <code>Container.prototype</code></blockquote></mx-reply>Oh lemme check that as well</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Jan 16 2024 07:36:06 GMT-0800 (Pacific Standard Time)">15:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I don't know where the property with double underscores comes from</blockquote></mx-reply>It was my mistake. Container.prototype does yield the correct properties.</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Jan 16 2024 07:36:42 GMT-0800 (Pacific Standard Time)">15:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> like <code>typeof Container.prototype.getEntity</code></blockquote></mx-reply>This one yields the correct result as well, "function" in this case.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Jan 16 2024 07:37:32 GMT-0800 (Pacific Standard Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to be clear, there's <code>__proto__</code> property, but it's different thing.  <code>obj.__proto__</code> is the equivalent of <code>Object.getPrototypeOf(obj)</code></td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Jan 16 2024 07:37:41 GMT-0800 (Pacific Standard Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(but still not <code>__prototype__</code>)</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Jan 16 2024 07:37:48 GMT-0800 (Pacific Standard Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Got it</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Jan 16 2024 07:38:06 GMT-0800 (Pacific Standard Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, <code>c.__proto__</code> would be the same thing as <code>Container.prototype</code></td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Jan 16 2024 07:39:17 GMT-0800 (Pacific Standard Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then the next thing is to verify that the object has expected prototype when you observe the issue</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Jan 16 2024 07:40:51 GMT-0800 (Pacific Standard Time)">15:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><p>Something along the lines of</p>
<pre><code class="language-js">Container.prototype.isPrototypeOf(this.root)
</code></pre>
<p>correct?</p>
</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Jan 16 2024 07:42:46 GMT-0800 (Pacific Standard Time)">15:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I guess so</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Jan 16 2024 07:57:42 GMT-0800 (Pacific Standard Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">So I just had another potentially related problem. In trying to find a script in which <code>this.root</code> is <em>exactly</em> a Container, I found out that running this isPrototypeOf call in the first script that's loaded works, while in the next ones it fails with this error:<br>Error: TypeError: Container.prototype.isPrototypeOf is not a function</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Jan 16 2024 08:03:09 GMT-0800 (Pacific Standard Time)">16:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what is <code>Container.prototype</code> then?</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Jan 16 2024 08:08:41 GMT-0800 (Pacific Standard Time)">16:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell"><p>Hi,</p>
<p>Are there options to make mozjs efficient when building mozjs-102? I am now using the following build options:</p>
<pre><code>JIT ?= ""
JIT:mipsarch = "--enable-jit"

do_configure() {
    cd ${B}
    python3 ${S}/configure.py \
        --enable-project=js \
        --with-intl-api \
        --target=${TARGET_SYS} \
        --host=${BUILD_SYS} \
        --prefix=${prefix} \
        --libdir=${libdir} \
        --disable-jemalloc \
        --disable-strip \
        --disable-debug \
        ${JIT}
}

</code></pre>
<p>Thanks</p>
</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Jan 16 2024 08:09:21 GMT-0800 (Pacific Standard Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>I'm confused as to why this doesn't print <code>[object FakeBlob]</code>. Is there something I'm missing with how it works?</p>
<pre><code class="language-js">&gt; Object.prototype.toString(Object.create(null, { [Symbol.toStringTag]: { get() { return "FakeBlob" }, enumerable: true } }))
"[object Object]"
</code></pre>
</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Jan 16 2024 08:11:53 GMT-0800 (Pacific Standard Time)">16:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">In my case it prints object as well.</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Jan 16 2024 08:12:17 GMT-0800 (Pacific Standard Time)">16:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: you need <code><a href="http://Object.prototype.toString.call">Object.prototype.toString.call</a></code></td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Jan 16 2024 08:13:11 GMT-0800 (Pacific Standard Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">sonarshroom</span>: what's the detail of the object?</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Jan 16 2024 08:13:46 GMT-0800 (Pacific Standard Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">It prints the same properties as before (the expected ones).</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Jan 16 2024 08:16:23 GMT-0800 (Pacific Standard Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, it has the same set of own properties, while <code>isPrototypeOf</code> is not a function?</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Jan 16 2024 08:16:25 GMT-0800 (Pacific Standard Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's the value?</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Jan 16 2024 08:16:38 GMT-0800 (Pacific Standard Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so, it has the same set of own properties, while <code>isPrototypeOf</code> is not a function?</blockquote></mx-reply>Supposedly yeah</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Tue Jan 16 2024 08:17:32 GMT-0800 (Pacific Standard Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><p>Sorry, this one I don't know how to answer, my test code until now is:</p>
<pre><code class="language-js">console.log("INIT:")
	console.log(typeof Container.prototype.getEntity);
	console.log("CONTAINER PROTO BEGIN:")
	for (let prop in Container.prototype) {
		console.log(prop);
	}
console.log("CONTAINER PROTO END.")
console.log(typeof Container.prototype);
console.log(Container.prototype.isPrototypeOf(this.root));
console.log("ID:" + this.root.id);
</code></pre>
</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Tue Jan 16 2024 08:18:10 GMT-0800 (Pacific Standard Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>console.log(typeof Container.prototype.isPrototypeOf)</code>?</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Tue Jan 16 2024 08:18:43 GMT-0800 (Pacific Standard Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and also <code>console.log(Object.getPrototypeOf(Container.prototype))</code> to make sure if it has prototype</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Tue Jan 16 2024 08:19:04 GMT-0800 (Pacific Standard Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and then <code>console.log(Object.getPrototypeOf(Container.prototype) == Object.prototype)</code>, maybe?</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Tue Jan 16 2024 08:23:28 GMT-0800 (Pacific Standard Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <code>console.log(typeof Container.prototype.isPrototypeOf)</code>?</blockquote></mx-reply>This one works, it's object.</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Tue Jan 16 2024 08:23:42 GMT-0800 (Pacific Standard Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> and also <code>console.log(Object.getPrototypeOf(Container.prototype))</code> to make sure if it has prototype</blockquote></mx-reply>This one hits an assert inside SpiderMonkey</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Tue Jan 16 2024 08:23:55 GMT-0800 (Pacific Standard Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">js/src/vm/ObjectOperations-inl.h:266</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Tue Jan 16 2024 08:24:44 GMT-0800 (Pacific Standard Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it shouldn't be an object. it should be a function</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Tue Jan 16 2024 08:25:15 GMT-0800 (Pacific Standard Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I wonder if you're using multiple globals, while reusing the same <code>Container</code> object across them</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Tue Jan 16 2024 08:25:54 GMT-0800 (Pacific Standard Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you provide the details of the "in the next ones" ? </td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Tue Jan 16 2024 08:27:29 GMT-0800 (Pacific Standard Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> can you provide the details of the "in the next ones" ? </blockquote></mx-reply>For each game entity I have behaviors in, I load them in - by the next ones I mean the behavior scripts that are loaded after the first in this case.</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Tue Jan 16 2024 08:27:40 GMT-0800 (Pacific Standard Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I wonder if you're using multiple globals, while reusing the same <code>Container</code> object across them</blockquote></mx-reply>I'll send here my initialization code in a sec</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Tue Jan 16 2024 08:28:58 GMT-0800 (Pacific Standard Time)">16:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">when posting long code, please use <a href="https://paste.mozilla.org/">https://paste.mozilla.org/</a> (possibly with long timeout).  please make sure the paste becomes public and anyone can see it</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Tue Jan 16 2024 08:29:31 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Will do</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Tue Jan 16 2024 08:33:05 GMT-0800 (Pacific Standard Time)">16:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><a href="https://paste.mozilla.org/32S3Y9f3">https://paste.mozilla.org/32S3Y9f3</a></td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Tue Jan 16 2024 08:33:55 GMT-0800 (Pacific Standard Time)">16:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">All code commented in that snippet is old code from when we had SM36</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Tue Jan 16 2024 08:36:25 GMT-0800 (Pacific Standard Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I wonder if you're using multiple globals, while reusing the same <code>Container</code> object across them</blockquote></mx-reply>Do we need to explicitely destroy the global object before calling JS_ShutDown?</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Tue Jan 16 2024 08:38:01 GMT-0800 (Pacific Standard Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Do we need to explicitely destroy the global object before calling JS_ShutDown?</blockquote></mx-reply>generally, yes. <a href="https://searchfox.org/mozilla-central/source/js/src/vm/Initialization.cpp#258-266">https://searchfox.org/mozilla-central/source/js/src/vm/Initialization.cpp#258-266</a></td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Tue Jan 16 2024 08:39:47 GMT-0800 (Pacific Standard Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I don't hit that print when calling it</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Tue Jan 16 2024 08:39:55 GMT-0800 (Pacific Standard Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">So I don't think that's happening</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Tue Jan 16 2024 08:40:34 GMT-0800 (Pacific Standard Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's the relation between the initialization code, the Container class , and first script and the next script?</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Tue Jan 16 2024 08:41:18 GMT-0800 (Pacific Standard Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I wonder if you're using multiple globals, while reusing the same <code>Container</code> object across them</blockquote></mx-reply>Since you had that hunch it might've been related I figured I'd share the init code.</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Tue Jan 16 2024 08:42:17 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">sorry, I don't mean it's unrelated.   my question is that how they interact</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Tue Jan 16 2024 08:42:28 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Oh</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Tue Jan 16 2024 08:42:54 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">when what's done, in which order, etc</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Tue Jan 16 2024 08:44:31 GMT-0800 (Pacific Standard Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Init is done first, which then creates the bindings for each objects (Entity, Container, etc), then the scene is loaded, in which behavior scripts are loaded (JS scripts go here)</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Tue Jan 16 2024 08:46:32 GMT-0800 (Pacific Standard Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, both "first" and "next" scripts are loaded in the same way, into the same global?</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Tue Jan 16 2024 08:46:43 GMT-0800 (Pacific Standard Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Yes</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Tue Jan 16 2024 08:48:26 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you make the content of the first and next scripts to only <code>console.log(typeof Container.prototype.isPrototypeOf)</code>, and run them to see what's printed?</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Tue Jan 16 2024 08:49:44 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">There are a lot of scripts but I'll do it for the first couple of em :D</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Tue Jan 16 2024 08:49:52 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I'll get back to you in a sec</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Tue Jan 16 2024 08:57:37 GMT-0800 (Pacific Standard Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> can you make the content of the first and next scripts to only <code>console.log(typeof Container.prototype.isPrototypeOf)</code>, and run them to see what's printed?</blockquote></mx-reply>on all of the ones I tested, object is the type</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Tue Jan 16 2024 08:58:50 GMT-0800 (Pacific Standard Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I expected it to print "function".  what's the output for <code>console.log(typeof function(){});</code> ?</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Tue Jan 16 2024 09:00:07 GMT-0800 (Pacific Standard Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, what's the output for <code>console.log(typeof Array.prototype.isPrototypeOf)</code> ?</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Tue Jan 16 2024 09:01:04 GMT-0800 (Pacific Standard Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I expected it to print "function".  what's the output for <code>console.log(typeof function(){});</code> ?</blockquote></mx-reply>all of them print function</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Tue Jan 16 2024 09:02:14 GMT-0800 (Pacific Standard Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">same here</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Tue Jan 16 2024 09:02:23 GMT-0800 (Pacific Standard Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> also, what's the output for <code>console.log(typeof Array.prototype.isPrototypeOf)</code> ?</blockquote></mx-reply>here I mean</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Tue Jan 16 2024 09:03:26 GMT-0800 (Pacific Standard Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you check this?  <code>console.log(Object.getPrototypeOf(Container) == Function.prototype)</code></td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Tue Jan 16 2024 09:04:56 GMT-0800 (Pacific Standard Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">true is the result</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Tue Jan 16 2024 09:06:08 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's the value of <code>Container.prototype.isPrototypeOf.toString()</code> ?</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Tue Jan 16 2024 09:08:13 GMT-0800 (Pacific Standard Time)">17:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">This error pops up: Error: TypeError: Container.prototype.isPrototypeOf is null</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Tue Jan 16 2024 09:08:36 GMT-0800 (Pacific Standard Time)">17:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, that's the reason why typeof says object...</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Tue Jan 16 2024 09:11:46 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and it's strange. if the property doesn't exist (for example when it doesn't have <code>Object.prototype</code> in prototype chain), the typeof should've say <code>undefined</code></td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Tue Jan 16 2024 09:11:55 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">do you define <code>isPrototypeOf</code> ?</td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Tue Jan 16 2024 09:12:32 GMT-0800 (Pacific Standard Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">No</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Tue Jan 16 2024 09:13:24 GMT-0800 (Pacific Standard Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is this true?  <code>Object.getPrototypeOf(Container.prototype) == Object.prototype</code></td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Tue Jan 16 2024 09:14:41 GMT-0800 (Pacific Standard Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">No, it's false</td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Tue Jan 16 2024 09:17:55 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, then your prototype doesn't have Object.prototype as its <code>[[Prototype]]</code>.</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Tue Jan 16 2024 09:18:35 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">anyway, I think this is unrelated to the main issue. you just need to avoid using <code>isPrototypeOf</code></td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Tue Jan 16 2024 09:19:18 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I see</td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Tue Jan 16 2024 09:19:23 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">just use <code>Object.getPrototypeOf(this.root) == Container.prototype</code> instead</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Tue Jan 16 2024 09:23:08 GMT-0800 (Pacific Standard Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">False as well</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Tue Jan 16 2024 09:24:11 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what is the expected value of <code>this.root</code> there?</td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Tue Jan 16 2024 09:25:33 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">The object that represents the container in the scene</td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Tue Jan 16 2024 09:25:56 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">where is it created and where is it assigned to <code>root</code> ?</td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Tue Jan 16 2024 09:28:11 GMT-0800 (Pacific Standard Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">so in this case it's created in C++ <a href="https://paste.mozilla.org/LO8SyzmW">https://paste.mozilla.org/LO8SyzmW</a></td></tr>
  <tr class="msg" id="L138"><td class="ts-cell"><a class="ts" href="#L138" alt="Tue Jan 16 2024 09:29:29 GMT-0800 (Pacific Standard Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that code defines the property, but it retrieves the actual value from <code>owner-&gt;scene-&gt;GetScriptingSystem().GetBindable(root)-&gt;GetJSObject(owningcontext)</code></td></tr>
  <tr class="msg" id="L139"><td class="ts-cell"><a class="ts" href="#L139" alt="Tue Jan 16 2024 09:31:03 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">ahh I see</td></tr>
  <tr class="msg" id="L140"><td class="ts-cell"><a class="ts" href="#L140" alt="Tue Jan 16 2024 09:31:32 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">you want the GetJSObject function I think</td></tr>
  <tr class="msg" id="L141"><td class="ts-cell"><a class="ts" href="#L141" alt="Tue Jan 16 2024 09:32:13 GMT-0800 (Pacific Standard Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">or somewhere that actually creates the object</td></tr>
  <tr class="msg" id="L142"><td class="ts-cell"><a class="ts" href="#L142" alt="Tue Jan 16 2024 09:33:15 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><a href="https://paste.mozilla.org/Ypuqe2Wu">https://paste.mozilla.org/Ypuqe2Wu</a></td></tr>
  <tr class="msg" id="L143"><td class="ts-cell"><a class="ts" href="#L143" alt="Tue Jan 16 2024 09:42:10 GMT-0800 (Pacific Standard Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I think you need to use <a href="https://searchfox.org/mozilla-esr91/rev/f3f439e007bdd4b5b1c2ba05ca706b68563413b2/js/src/jsapi.h#562-563">JS_NewObjectWithGivenProto</a>, passing the <code>Container.prototype</code> object</td></tr>
  <tr class="msg" id="L144"><td class="ts-cell"><a class="ts" href="#L144" alt="Tue Jan 16 2024 09:43:00 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>JS_NewObject</code> uses <code>Object.prototype</code> for classes which isn't built-ins</td></tr>
  <tr class="msg" id="L145"><td class="ts-cell"><a class="ts" href="#L145" alt="Tue Jan 16 2024 09:43:01 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I'll check it out</td></tr>
  <tr class="msg" id="L146"><td class="ts-cell"><a class="ts" href="#L146" alt="Tue Jan 16 2024 10:24:05 GMT-0800 (Pacific Standard Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">is there a hidden bug for an assertion failing at <code>jit/VMFunctions.cpp:2979</code>?</td></tr>
  <tr class="msg" id="L147"><td class="ts-cell"><a class="ts" href="#L147" alt="Tue Jan 16 2024 10:31:00 GMT-0800 (Pacific Standard Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: <a href="https://searchfox.org/mozilla-central/source/js/src/jit/VMFunctions.cpp#2978-2980">This helper</a>? That's just the C++ code that gets called when an assertion we generate in JIT code fails. I'm not aware of any outstanding bugs of that kind, so if you've found something, please go ahead and file it</td></tr>
  <tr class="msg" id="L148"><td class="ts-cell"><a class="ts" href="#L148" alt="Tue Jan 16 2024 10:48:44 GMT-0800 (Pacific Standard Time)">18:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think you need to use <a href="https://searchfox.org/mozilla-esr91/rev/f3f439e007bdd4b5b1c2ba05ca706b68563413b2/js/src/jsapi.h#562-563">JS_NewObjectWithGivenProto</a>, passing the <code>Container.prototype</code> object</blockquote></mx-reply>Unfortunately even with that call it does not solve my problem, though after having a hunch I decided to check something related to the js::ObjectOps class we are using and wanted to confirm the following: are methods considered properties to be passed to the getProperty function this object receives a pointer of?</td></tr>
  <tr class="msg" id="L149"><td class="ts-cell"><a class="ts" href="#L149" alt="Tue Jan 16 2024 10:50:39 GMT-0800 (Pacific Standard Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Because, more specifically in my case, I get the "getEntity" method name passed into that function.</td></tr>
  <tr class="msg" id="L150"><td class="ts-cell"><a class="ts" href="#L150" alt="Tue Jan 16 2024 10:54:04 GMT-0800 (Pacific Standard Time)">18:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if your class has <code>GetPropertyOp</code>, then all property access will be caught by it</td></tr>
  <tr class="msg" id="L151"><td class="ts-cell"><a class="ts" href="#L151" alt="Tue Jan 16 2024 10:54:22 GMT-0800 (Pacific Standard Time)">18:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and yes, method is property</td></tr>
  <tr class="msg" id="L152"><td class="ts-cell"><a class="ts" href="#L152" alt="Tue Jan 16 2024 10:58:49 GMT-0800 (Pacific Standard Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">Ok it is partially explained then</td></tr>
  <tr class="msg" id="L153"><td class="ts-cell"><a class="ts" href="#L153" alt="Tue Jan 16 2024 10:59:05 GMT-0800 (Pacific Standard Time)">18:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">if not all explained :D</td></tr>
  <tr class="msg" id="L154"><td class="ts-cell"><a class="ts" href="#L154" alt="Tue Jan 16 2024 10:59:32 GMT-0800 (Pacific Standard Time)">18:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">I'll get back to you soon, probably tomorrow but that was awesome help :D</td></tr>
  <tr class="msg" id="L155"><td class="ts-cell"><a class="ts" href="#L155" alt="Tue Jan 16 2024 10:59:37 GMT-0800 (Pacific Standard Time)">18:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sonarshroom:mozilla.org">sonarshroom</span>&gt;</div></td><td class="msg-cell">thanks a lot!</td></tr>
  <tr class="msg" id="L156"><td class="ts-cell"><a class="ts" href="#L156" alt="Tue Jan 16 2024 11:18:52 GMT-0800 (Pacific Standard Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gkw:mozilla.org">gkw</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: happy new year! Bug 1873328 and bug 1874785 for you, though probably not s-s :)</td></tr>
  <tr class="msg" id="L157"><td class="ts-cell"><a class="ts" href="#L157" alt="Tue Jan 16 2024 11:18:53 GMT-0800 (Pacific Standard Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1873328">https://bugzil.la/1873328</a>  NEW (nobody)  AddressSanitizer: stack-overflow on address 0x7ffe5ed61d08 with ubi node takeCensus</td></tr>
  <tr class="msg" id="L158"><td class="ts-cell"><a class="ts" href="#L158" alt="Tue Jan 16 2024 11:18:53 GMT-0800 (Pacific Standard Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1874785">https://bugzil.la/1874785</a>  NEW (nobody)  LeakSanitizer: detected memory leaks [@ CustomSerializableObject::ActivityLog]</td></tr>
  <tr class="msg" id="L159"><td class="ts-cell"><a class="ts" href="#L159" alt="Tue Jan 16 2024 11:19:04 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gkw:mozilla.org">gkw</span>&gt;</div></td><td class="msg-cell">oh nice, botzilla</td></tr>
  <tr class="msg" id="L160"><td class="ts-cell"><a class="ts" href="#L160" alt="Tue Jan 16 2024 11:22:27 GMT-0800 (Pacific Standard Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">if you're going to give me something fuzzy, I'd prefer socks</td></tr>
  <tr class="msg" id="L161"><td class="ts-cell"><a class="ts" href="#L161" alt="Tue Jan 16 2024 11:22:30 GMT-0800 (Pacific Standard Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">:-)</td></tr>

</tbody></table></div></div></div>
</body></html>