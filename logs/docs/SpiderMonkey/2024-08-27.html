<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-08-27</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-08-27<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-08-26" class="nav-link"><span>prev</span></a>
<a href="2024-08-28" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Aug 27 2024 01:33:19 GMT-0700 (Pacific Daylight Time)">08:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I was thinking maybe I should extend GCOptions to have a "FastStart" bit, which would yield immediately after preparing the GC. Then I could use existing APIs to kick the GC off, and then set a budget for the first slice using the other existing APIs.</blockquote></mx-reply>If you're kicking the GC off yourself then can't you pass a budget in? If the engine starts the GC then there does need to be a mechanism to set this - a callback seems fine for this though.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Aug 27 2024 01:36:35 GMT-0700 (Pacific Daylight Time)">08:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Most of the time the initial slice will be very short in an incremental GC because we start clearing the mark bits on a background thread and then yield to the mutator, unless that completes instantaneously from the POV of the main thread.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Aug 27 2024 07:42:33 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I was looking at this for the eager <code>JS_MaybeGC</code> -&gt; <code>GCRuntime::maybeGC</code> -&gt; <code>gcIfRequestedImpl</code> path. It's currently using the callback mechanism. Though as you point out, there are still internal GCs, some of which go through the interrupt. Hm... so it sounds like the callback is necessary, and passing in either a FastStart option or a budget would still only get some of the GCs, so why bother.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Aug 27 2024 07:42:34 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ok, thanks</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Aug 27 2024 08:09:20 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Since Bug 1904429 landed builds with JS_JIT_SPEW enabled should have access to MOZ_LOG now. What this means is that you can dynamically turn on logging in the browser via <code>about:logging</code>, logging to file or to profiler.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Aug 27 2024 08:10:33 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Now, it appears Nightly builds -don't- have JS_JIT_SPEW enabled; but I'm planning on decoupling the logging from JS_JIT_SPEW. There's a different macro, JS_LOG, that can be used directly for this purpose, with the goal of this being enabled all the way to release</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Aug 27 2024 08:11:05 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I'm posting here because I know there's been some curiosity about this happening ( <span class="nick-16">Ryan Hunt</span> specifically was curious about this in Dublin)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Aug 27 2024 08:11:51 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Here's an example profile with BaselineBailouts:5 set as the logging in about:logging (done on a local build) </td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Aug 27 2024 08:13:34 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Oh yes, usage note: the JitSpew logging is all done at the  <a href="https://searchfox.org/mozilla-central/source/mozglue/misc/LoggingCore.h#31">debug level</a>, so you have to set the channel level to 4+ )</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Aug 27 2024 08:16:21 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Oh, and we have a simple but functional shell logger enabled too -- making this better is definitely an open project, but <code>MOZ_LOG</code> should be able to enable logging on the shell. We just dump to <a href="https://searchfox.org/mozilla-central/source/js/src/shell/js.cpp#382-388">stderr</a> but probably sufficient in the short term</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Aug 27 2024 08:17:25 GMT-0700 (Pacific Daylight Time)">15:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Here's a simple patch example of how to use JS_LOG: <a href="https://phabricator.services.mozilla.com/D217874">https://phabricator.services.mozilla.com/D217874</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Aug 27 2024 08:18:02 GMT-0700 (Pacific Daylight Time)">15:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Nice! Thank you for this. I've been using the logging for Gecko stuff, and it's been very convenient. I assume these log messages will end up in the profile as well? (Which is noisy, but can be useful.)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Aug 27 2024 08:20:02 GMT-0700 (Pacific Daylight Time)">15:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"> Yep. It's functionally identical to the gecko logging stuff -- all the same upsides,  all the same downsides, with the slight exception that at least for now, the builds where the SM logging stuff is enabled differ from where gecko logging is enabled (Everywhere right now actually) </td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Aug 27 2024 09:41:15 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">perf report comparing forkserver on/off when running a microbenchmark: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1912262">https://bugzilla.mozilla.org/show_bug.cgi?id=1912262</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Aug 27 2024 09:41:35 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">I'm wondering if those JIT-related stacks I see on the right (forkserver on) could mean something?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Aug 27 2024 09:41:44 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">we're tracking weird perf regression</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Aug 27 2024 09:42:03 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">(same build opt on both run, same benchmark, only pref flip)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Aug 27 2024 09:55:26 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell"><code>javascript.options.baselinejit=false</code> does not look to change anything so maybe it's just noise</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Aug 27 2024 10:19:32 GMT-0700 (Pacific Daylight Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">gerard-majax</span>: I don't understand from looking at the bug which JIT-related stacks you're talking about. Which comment should I be looking at?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Aug 27 2024 10:19:55 GMT-0700 (Pacific Daylight Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">it was supposed to be the screenshot ...</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Aug 27 2024 10:20:07 GMT-0700 (Pacific Daylight Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/attachment.cgi?id=9421046">https://bugzilla.mozilla.org/attachment.cgi?id=9421046</a></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Aug 27 2024 10:24:04 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">And what does the second screenshot show?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Aug 27 2024 10:25:29 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">left is non forkserver, right is with forkserver</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Aug 27 2024 10:26:08 GMT-0700 (Pacific Daylight Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">In the " jit Bad (right) vs Good (left)" screenshot?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Aug 27 2024 10:27:17 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">that's the link i re-shared yes</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Aug 27 2024 10:28:54 GMT-0700 (Pacific Daylight Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Oh, sorry, thought you had linked the other screenshot</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Aug 27 2024 10:30:31 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Trying to make sure I'm following: the forkserver is a change to how we start up processes. With the forkserver enabled, we're seeing more cache misses in some DOM code.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Aug 27 2024 10:31:25 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">that's the best we have so far to diagnose the regression yes</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Aug 27 2024 10:31:37 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If you run a benchmark that targets that DOM code and profile cache misses, the version with the fork server enabled sees more cache misses in JIT code than without the fork server</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Aug 27 2024 10:32:20 GMT-0700 (Pacific Daylight Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Is that specifically "cache misses inside dom::BindToTree"?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Aug 27 2024 10:32:30 GMT-0700 (Pacific Daylight Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">As in, is BindToTree calling into the JIT?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Aug 27 2024 10:33:35 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">rather js code from jit calling it</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Aug 27 2024 10:34:06 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">I was looking at the BindToTree to try and get something that may explain and i saw the difference of the stacks, I'm wondering if it's meaningful or just noise</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Aug 27 2024 10:34:08 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Do these profiles have callers at the top, or callees?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Aug 27 2024 10:34:19 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">callees</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Aug 27 2024 10:35:26 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So the difference is that the JIT code calling into BindToTree is having cache misses with the fork server enabled, but not with the fork server disabled?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Aug 27 2024 10:35:49 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">no</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Aug 27 2024 10:35:52 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I assume that you have to call through JS either way</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Aug 27 2024 10:36:18 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">the difference is that i see jit-related stacks when forkserver is enabled and i dont when it's not</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Aug 27 2024 10:38:17 GMT-0700 (Pacific Daylight Time)">17:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">What do you see instead? You presumably still have to run JS, so even if you don't see <code>MaybeEnterJIT</code> you should still see <code>RunScript</code></td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Aug 27 2024 10:39:15 GMT-0700 (Pacific Daylight Time)">17:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: I see what is on the left</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Aug 27 2024 10:39:29 GMT-0700 (Pacific Daylight Time)">17:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">the code that runs is here <a href="https://bugzilla.mozilla.org/attachment.cgi?id=9421049">https://bugzilla.mozilla.org/attachment.cgi?id=9421049</a></td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Aug 27 2024 10:40:05 GMT-0700 (Pacific Daylight Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I'm pretty sure that all the un-symbolicated stack frames there are running jitcode.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Aug 27 2024 10:41:25 GMT-0700 (Pacific Daylight Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If you build with <code>--enable-perf</code> and follow <a href="https://gist.github.com/mstange/a8a0943f16f388e3ddc9e726d68c436a">the instructions here</a>, we will dump out information for <code>perf</code> so that it knows how to profile JIT code, which will give you better information.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Aug 27 2024 10:44:39 GMT-0700 (Pacific Daylight Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: is <code>javascript.options.baselinejit=false</code> enough to verify if it's related to jit?</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Aug 27 2024 10:47:01 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Related to JIT how?</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Aug 27 2024 10:48:08 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">This testcase is running JS code. We have several tiers of execution for running JS (C++ interpreter, baseline interpreter, baseline compiler, Ion compiler). Setting baselinejit to false will disable the baseline compiler and the Ion compiler.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Aug 27 2024 10:48:28 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which means that the code has to run in the C++ <del>compiler</del> interpreter and/or the baseline interpreter.</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Aug 27 2024 10:48:43 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The baseline interpreter is JIT code in the sense that we generate it at runtime</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Aug 27 2024 10:49:31 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">You can disable it with <code>javascript.options.baselineInterpreter=false</code> if you think that's somehow relevant</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Aug 27 2024 10:50:20 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The more tiers you disable, the slower the code will run</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Aug 27 2024 10:53:24 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">In the profile on the left, can you expand the stacks with unsymbolicated <code>0x1178b37ed27d</code> any further? I expect that those are JIT frames corresponding to recursive calls to <code>create_tree</code> in your benchmark.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Aug 27 2024 10:59:40 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">no they were not expandable</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Aug 27 2024 11:06:36 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay. So it looks to me like the main difference here is just that the profiler is successfully unwinding through the JIT frames in the profile on the right, but is getting stuck / giving up in the profile on the left. In all the places where you see stacks of <code>0x1178b37ed27d</code> in the profile on the left, you can assume that the caller of that stack looks a lot like the equivalent stack on the right: a call to MaybeEnterJIT with roughly the same callers.</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Aug 27 2024 11:08:13 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I don't know why the profiler does a better job with the forkserver enabled.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Aug 27 2024 11:08:39 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But I don't see any evidence here that JS is meaningfully involved in your performance problem.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Aug 27 2024 12:44:10 GMT-0700 (Pacific Daylight Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">regarding the comment <a href="https://searchfox.org/mozilla-central/source/js/src/jit/MIROps.yaml#130">here</a> call what? VM call?</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Aug 27 2024 13:15:16 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Calls into C++, roughly. The consumer is <a href="https://searchfox.org/mozilla-central/source/js/src/jit/LICM.cpp#261-265">this code</a> in the register allocator. We want to know if it's worth trying to hoist floating point constants out of the loop, or whether they are going to be spilled/filled at the call anyway.</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Aug 27 2024 13:16:14 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Broadly speaking, if you think that your op is going to do a call more often than not, then you should set the flag.</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Aug 27 2024 13:33:27 GMT-0700 (Pacific Daylight Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">oh i see! got it! thank you!</td></tr>

</tbody></table></div></div></div>
</body></html>