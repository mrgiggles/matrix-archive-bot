<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-02-24</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-02-24<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-02-23" class="nav-link"><span>prev</span></a>
<a href="2020-02-25" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Feb 24 2020 00:56:40 GMT-0800 (Pacific Standard Time)">08:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: thanks for your comment in the bug, I'll have a look. Also I wanted to say that your instructions the other day resulted in the same reports locally as I got on try, so it definitely worked</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Feb 24 2020 03:12:12 GMT-0800 (Pacific Standard Time)">11:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Is there anything MSVC-specific with regard to the layout of classes with bases that don't have any virtual methods nor fields?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Feb 24 2020 03:13:11 GMT-0800 (Pacific Standard Time)">11:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">More specifically, is there any way MutableHandleIdVector could be more than just a pointer on x86_64-pc-windows-msvc?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Feb 24 2020 03:14:02 GMT-0800 (Pacific Standard Time)">11:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: I can repro the gjs crashes with relative frequency... May be worth trying to catch them in rr?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Feb 24 2020 03:16:19 GMT-0800 (Pacific Standard Time)">11:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">nox</span>: I don't think so off hand, but MSVC ABI is weird... throw an <code>static_assert(sizeof(&lt;thing&gt;) == 8)</code> in there and see if it fires?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Feb 24 2020 03:16:46 GMT-0800 (Pacific Standard Time)">11:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">emilio</span>: <a href="https://devblogs.microsoft.com/cppblog/optimizing-the-layout-of-empty-base-classes-in-vs2015-update-2-3/">https://devblogs.microsoft.com/cppblog/optimizing-the-layout-of-empty-base-classes-in-vs2015-update-2-3/</a> This seems extremely relevant.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Feb 24 2020 03:18:23 GMT-0800 (Pacific Standard Time)">11:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">nox</span>: clang and gcc also do that IIRC, so I'd hope not so much?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Feb 24 2020 03:19:07 GMT-0800 (Pacific Standard Time)">11:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell">Empty base-class optimizations are sorta well known</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Feb 24 2020 03:21:30 GMT-0800 (Pacific Standard Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Oh right.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Feb 24 2020 04:33:36 GMT-0800 (Pacific Standard Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#666">https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#666</a> I'm suspecting this is making the class non-trivially-copyable on MSVC for some reason (lol that it is line 666).</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Feb 24 2020 05:17:29 GMT-0800 (Pacific Standard Time)">13:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">It wasn't this deletion, but I'm correct that my issue come from the fact that MutableHandle&lt;T&gt; isn't trivially copyable on msvc builds.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Feb 24 2020 05:17:45 GMT-0800 (Pacific Standard Time)">13:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><code>class MutableHandle { MutableHandle&amp; operator=(const MutableHandle&amp;) = delete; };</code> This is trivially copyable in clang but not msvc.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Feb 24 2020 05:40:36 GMT-0800 (Pacific Standard Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">nox</span>: did you work out why not?  I think this should be trivially copyable if possible</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Feb 24 2020 05:42:44 GMT-0800 (Pacific Standard Time)">13:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@bnjbvr:mozilla.org">Benjamin Bouvier</span>&gt;</div></td><td class="msg-cell">is anybody still using the StupidAlloactor for testing? otherwise, we should remove it, pretty sure it's untested</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Feb 24 2020 05:45:19 GMT-0800 (Pacific Standard Time)">13:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">Benjamin Bouvier</span>: it's failing a number of jit-tests fwiw. Let's remove it, we can resurrect it if we ever need something like it</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Feb 24 2020 05:46:09 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@bnjbvr:mozilla.org">Benjamin Bouvier</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: üëçÔ∏è</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Feb 24 2020 06:11:11 GMT-0800 (Pacific Standard Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: Pretty sure it's a MSVC bug.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Feb 24 2020 06:11:42 GMT-0800 (Pacific Standard Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: <a href="https://developercommunity.visualstudio.com/content/problem/170863/msvc-type-traits-stdis-trivially-copyable-is-bugge.html">https://developercommunity.visualstudio.com/content/problem/170863/msvc-type-traits-stdis-trivially-copyable-is-bugge.html</a> <a href="https://stackoverflow.com/questions/50720054/is-stdis-trivially-copyable-wrong">https://stackoverflow.com/questions/50720054/is-stdis-trivially-copyable-wrong</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Feb 24 2020 06:12:26 GMT-0800 (Pacific Standard Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">nox</span>: just curious, do you also use MSVC to compile spidermonkey itself? things will likely get more difficult in the future since we dropped it for m-c and have no CI coverage</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Feb 24 2020 06:13:55 GMT-0800 (Pacific Standard Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">nox</span>: ok thanks</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Feb 24 2020 06:14:08 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: Yes we use MSVC.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Feb 24 2020 06:14:19 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">And gcc or whatever, we have both in our CI.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Feb 24 2020 06:15:00 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Or I think so? At the very least, not returning a MutableHandleIdVector like in GetMutableHandleIdVector in jsglue.cpp fixed my issues.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Feb 24 2020 06:15:14 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">(And this doesn't fail on any other build than our MSVC target.)</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Feb 24 2020 06:15:35 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">can someone recap what I should know? this room doesn't show any backlog before I joined.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Feb 24 2020 06:15:51 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">jdm</span>: <span class="nick-10">jandem</span> asked "just curious, do you also use MSVC to compile spidermonkey itself? things will likely get more difficult in the future since we dropped it for m-c and have no CI coverage"</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Feb 24 2020 06:16:18 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">as far as I know the answer to that is no</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Feb 24 2020 06:16:22 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">we also moved to clang-cl</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Feb 24 2020 06:16:50 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Could it be that clang-cl suffers from the same trivially-copyable issue?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Feb 24 2020 06:16:56 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">ah nice</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Feb 24 2020 06:20:08 GMT-0800 (Pacific Standard Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Anyway, I'm out for lunch, I don't have a Windows box available right now so if someone could check if <code>class MutableHandle { MutableHandle&amp; operator=(const MutableHandle&amp;) = delete; };</code> is trivially copyable or not through clang-cl, that would be nice.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Feb 24 2020 07:41:10 GMT-0800 (Pacific Standard Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@froydnj:mozilla.org">froydnj</span>&gt;</div></td><td class="msg-cell">we use msvc's std, so if <code>is_trivially_copyable</code> is bugged in msvc's <code>&lt;type_traits&gt;</code>, it's a decent bet that it's bugged in <code>clang-cl</code> too (depends on some details, though)</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Feb 24 2020 07:44:36 GMT-0800 (Pacific Standard Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">how do I turn on LTO for shell builds?  I'm using the configure options --enable-release --enable-lto=cross but I get thousands of 'undefined reference' errors from the linker</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Feb 24 2020 07:47:02 GMT-0800 (Pacific Standard Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@froydnj:mozilla.org">froydnj</span>&gt;</div></td><td class="msg-cell">I don't know that we've ever thought about using LTO for shell builds!</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Feb 24 2020 07:47:07 GMT-0800 (Pacific Standard Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@froydnj:mozilla.org">froydnj</span>&gt;</div></td><td class="msg-cell">what sort of errors do you get?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Feb 24 2020 07:54:27 GMT-0800 (Pacific Standard Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">froydnj</span>: here's a snippet: <a href="https://paste.mozilla.org/qTdnvJ7t">https://paste.mozilla.org/qTdnvJ7t</a></td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Feb 24 2020 07:55:44 GMT-0800 (Pacific Standard Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'm trying to test something without doing a full browser build</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Feb 24 2020 07:57:04 GMT-0800 (Pacific Standard Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@froydnj:mozilla.org">froydnj</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: what's the invocation for that shell link look like?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Feb 24 2020 08:01:05 GMT-0800 (Pacific Standard Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">froydnj</span>: <a href="https://paste.mozilla.org/2ZawzkHf">https://paste.mozilla.org/2ZawzkHf</a></td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Feb 24 2020 08:01:55 GMT-0800 (Pacific Standard Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@froydnj:mozilla.org">froydnj</span>&gt;</div></td><td class="msg-cell">well, cool, we are at least linking with lto</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Feb 24 2020 08:02:47 GMT-0800 (Pacific Standard Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> we use msvc's std, so if <code>is_trivially_copyable</code> is bugged in msvc's <code>&lt;type_traits&gt;</code>, it's a decent bet that it's bugged in <code>clang-cl</code> too (depends on some details, though)</blockquote></mx-reply>Thanks for the answer!</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Feb 24 2020 08:03:12 GMT-0800 (Pacific Standard Time)">16:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: Is <code>aarch64-windows-mingw32</code> also not supported?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Feb 24 2020 08:05:13 GMT-0800 (Pacific Standard Time)">16:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><p>Asking because:</p>
<blockquote>
<p>ERROR: Don't know how to translate aarch64-windows-mingw32 for rustc</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Feb 24 2020 08:17:28 GMT-0800 (Pacific Standard Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Windows shell builds have been giving me target-triple issues for months =. I usually have to manually switch the rust toolchain override to even build 32-bit windows</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Feb 24 2020 08:18:41 GMT-0800 (Pacific Standard Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@froydnj:mozilla.org">froydnj</span>&gt;</div></td><td class="msg-cell">the aarch64 seems like a bug, because that's the exact same triple we use on browser builds</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Feb 24 2020 08:29:25 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Maybe I borked one of my patches,</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon Feb 24 2020 08:29:48 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">I had to remove some bindgen-related stuff already from the build system, because that was failing even though we don't use it through the build system on our side.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon Feb 24 2020 08:33:08 GMT-0800 (Pacific Standard Time)">16:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I found the problem with my Function#caller patch, the realm code is correct</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon Feb 24 2020 08:37:53 GMT-0800 (Pacific Standard Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: hi, I was wondering about restrictions on the first field of a GC thing</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon Feb 24 2020 08:38:29 GMT-0800 (Pacific Standard Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I guess this is undefined behaviour, but can you point me at the exact rule this is breaking?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon Feb 24 2020 08:40:45 GMT-0800 (Pacific Standard Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: it is type-punning when we access the isforwarded bits</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon Feb 24 2020 08:41:17 GMT-0800 (Pacific Standard Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: sure, but we already do this via casting to RelocationOverlay... how is that ok?</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon Feb 24 2020 08:41:39 GMT-0800 (Pacific Standard Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I might have misunderstood something. In ecmascript, if a object which has strings for keys, and Float32Arrays of a certain size for value is frozen, can I detach the Float32Arrays ?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon Feb 24 2020 08:42:14 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">It seems like nothing prevents it in ecma, but it does a DataCloneError in Gecko, so there must be something in postMessage or other thing to detach ArrayBuffer ?</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon Feb 24 2020 08:42:24 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: waldo gave me some hand-wavey answer that we can kind of get away with it if the primitive type of the field we access matches (although we mix pointer and uintptr_t so that is still not quite there)</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon Feb 24 2020 08:43:05 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: In general I find relying on struct layout to be very high risk</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon Feb 24 2020 08:43:14 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">do you know if 'matches' is defined somewhere?</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon Feb 24 2020 08:43:29 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">so at the very least going though a uintptr_t you have clear definitions of low-bits, etc</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon Feb 24 2020 08:44:31 GMT-0800 (Pacific Standard Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">true</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon Feb 24 2020 08:45:02 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">even if you patch works today, it seems likely than not that it will be a sec bug in a year</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon Feb 24 2020 08:45:24 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">ah no forget it I botched my test case</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon Feb 24 2020 08:45:45 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: that seems pretty strong</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon Feb 24 2020 08:45:57 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">it's equally likely the current code could be a sec bug in a year</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon Feb 24 2020 08:45:58 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(ideally the cell type would define the uintptr_t itself)</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon Feb 24 2020 08:46:30 GMT-0800 (Pacific Standard Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Mon Feb 24 2020 08:46:57 GMT-0800 (Pacific Standard Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">bzbarsky</span>: hi, do you know if <a href="https://github.com/WebAudio/web-audio-api/issues/1933#issuecomment-590327155">https://github.com/WebAudio/web-audio-api/issues/1933#issuecomment-590327155</a> would be something that we could use?</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Mon Feb 24 2020 08:47:00 GMT-0800 (Pacific Standard Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: do we need to change all the types with gcptr in first field, or is shape speical?</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Mon Feb 24 2020 08:47:23 GMT-0800 (Pacific Standard Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">karlt</span> found it yesterday, it seems like this is what we need</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Mon Feb 24 2020 08:47:36 GMT-0800 (Pacific Standard Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">we need better abstractions for these fields that are used for storing pointers/flags</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Mon Feb 24 2020 08:48:00 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, we do =\</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Mon Feb 24 2020 08:48:41 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">that's a good question</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Mon Feb 24 2020 08:49:05 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'm surprised this hasn't shown up in TSAN tests already (the code has been stable for a while)</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Mon Feb 24 2020 08:49:50 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I wonder if there is sensitivity to sweep phases</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Mon Feb 24 2020 08:50:06 GMT-0800 (Pacific Standard Time)">16:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">which already scare me a lot as I touch this lazy-script stuff</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Mon Feb 24 2020 08:52:31 GMT-0800 (Pacific Standard Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">it's sensitive to the phases used for updating GC thing pointers in a compacting GC; it can only happen between GC things in the same phase</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Mon Feb 24 2020 08:59:13 GMT-0800 (Pacific Standard Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: potentially (fwiw, I believe it was added for <a href="https://webassembly.github.io/spec/js-api/#memories">https://webassembly.github.io/spec/js-api/#memories</a>)</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Mon Feb 24 2020 09:01:45 GMT-0800 (Pacific Standard Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">Ms2ger [~half-time dedication]</span>: in terms of what it does, it sounds perfect, so I was wondering why it was not mentionned to us before, since we really want things to not be tampered with (be it the Object wrapping those buffers, or the buffers themselves)</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Mon Feb 24 2020 09:02:34 GMT-0800 (Pacific Standard Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">maybe we should have asked more people</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Mon Feb 24 2020 09:02:54 GMT-0800 (Pacific Standard Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">Why is <a href="https://en.cppreference.com/w/cpp/language/value_initialization">value initialization</a> called that?</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Mon Feb 24 2020 09:03:00 GMT-0800 (Pacific Standard Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">seems like weird name</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Mon Feb 24 2020 09:04:24 GMT-0800 (Pacific Standard Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I guess one of the issue is that we would have to bind it in WebIDL, but it doesn't seem like the end of the world</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Mon Feb 24 2020 09:09:32 GMT-0800 (Pacific Standard Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: I wonder about generalizing CellWithLengthAndFlags for this case</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Mon Feb 24 2020 09:09:52 GMT-0800 (Pacific Standard Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">so Shape::immutableFlags would be the length value</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Mon Feb 24 2020 09:10:09 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yeah that's a good idea</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Mon Feb 24 2020 09:10:29 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">emilio</span>: I haven't had a gjs crash myself yet, only reports from other people</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Mon Feb 24 2020 09:14:03 GMT-0800 (Pacific Standard Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: this runs in to the problem of uintptr_t being different sizes on different builds though</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Mon Feb 24 2020 09:14:47 GMT-0800 (Pacific Standard Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">maybe we need an equivalent to CellWithLengthAndFlags which stores a pointer in the flags word</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Mon Feb 24 2020 09:16:49 GMT-0800 (Pacific Standard Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">in your patch you have 64-bits of integer fields, right?</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Mon Feb 24 2020 09:17:12 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">that is what CellWithLengthAndFlags is for. It uses one or two fields depending on platform</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Mon Feb 24 2020 09:18:29 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yes, but AIUI those individual flags fields were split out of a combined field to avoid races</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Mon Feb 24 2020 09:18:46 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">hmm..</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Mon Feb 24 2020 09:19:07 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span></div></td><td class="msg-cell">doesn't actually know how races work for sub-word accesses</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Mon Feb 24 2020 09:19:34 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">the isforwarded check reads a uintptr_t I think</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Mon Feb 24 2020 09:20:01 GMT-0800 (Pacific Standard Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">maybe it's enough that mutableFlags and immutableFlags end up stored in different fields</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Mon Feb 24 2020 09:20:02 GMT-0800 (Pacific Standard Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: Looking</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Mon Feb 24 2020 09:20:47 GMT-0800 (Pacific Standard Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yes, isForwarded reads uintptr_t</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Mon Feb 24 2020 09:21:40 GMT-0800 (Pacific Standard Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: on my laptop I can see it relatively easily, as in a couple times a day (Gnome / Wayland / Fedora)</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Mon Feb 24 2020 09:21:52 GMT-0800 (Pacific Standard Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: are stack traces and such useful?</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Mon Feb 24 2020 09:22:08 GMT-0800 (Pacific Standard Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: First time I see this thing.  But yes, presumably if we are allocating these array buffers we could use this mechanism</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Mon Feb 24 2020 09:22:15 GMT-0800 (Pacific Standard Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">we are</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Mon Feb 24 2020 09:22:18 GMT-0800 (Pacific Standard Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: lemme check something</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Mon Feb 24 2020 09:23:42 GMT-0800 (Pacific Standard Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: We don't implement that thing as written</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Mon Feb 24 2020 09:23:59 GMT-0800 (Pacific Standard Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: We basically have a "is wasm or asm" flag that we check</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Mon Feb 24 2020 09:24:12 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: Maybe we could generalize it a bit, but that work would have to happen</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Mon Feb 24 2020 09:24:42 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell">See <a href="https://searchfox.org/mozilla-central/rev/96f1457323cc598a36f5701f8e67aedaf97acfcf/js/src/vm/ArrayBufferObject.cpp#1619-1623">https://searchfox.org/mozilla-central/rev/96f1457323cc598a36f5701f8e67aedaf97acfcf/js/src/vm/ArrayBufferObject.cpp#1619-1623</a> called from <a href="https://searchfox.org/mozilla-central/rev/96f1457323cc598a36f5701f8e67aedaf97acfcf/js/src/vm/StructuredClone.cpp#1950">https://searchfox.org/mozilla-central/rev/96f1457323cc598a36f5701f8e67aedaf97acfcf/js/src/vm/StructuredClone.cpp#1950</a></td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Mon Feb 24 2020 09:25:53 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span></div></td><td class="msg-cell">not sure how people generally feel about these sorts of APIs, but for this use case guaranteeing people can't detach your buffer might be reasonable...</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Mon Feb 24 2020 09:25:59 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">yeah I've traced some code, the general idea is to make something impossible to detach, presumably the AudioBufferDetachKey is to allow specific APIs to detach it at some point?</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Mon Feb 24 2020 09:26:22 GMT-0800 (Pacific Standard Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">bzbarsky</span>: I'll ask around, because in our particular case, it seems useful</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Mon Feb 24 2020 09:26:24 GMT-0800 (Pacific Standard Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell">Presumably</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Mon Feb 24 2020 09:26:35 GMT-0800 (Pacific Standard Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">emilio</span>: see <a href="https://gitlab.gnome.org/GNOME/gjs/issues/301#note_721935">https://gitlab.gnome.org/GNOME/gjs/issues/301#note_721935</a>, stack trace would be useful if it doesn't match one that's already tracked there. more immediately helpful would be consistent repro instructions</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Mon Feb 24 2020 09:26:37 GMT-0800 (Pacific Standard Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell">There are no non-wasm consumers of this, afaict</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Mon Feb 24 2020 09:30:06 GMT-0800 (Pacific Standard Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I'll propose it to the audio wg, and we'll see, maybe someone in wasm-land has some opinions about this</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Mon Feb 24 2020 09:31:35 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: dealing with gc I suspect there won't be concrete repro steps... will look at my system logs and paste some stacks there later today if they don't match those</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Mon Feb 24 2020 09:31:49 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: Sounds good</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Mon Feb 24 2020 09:32:19 GMT-0800 (Pacific Standard Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">emilio</span>: thanks!</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Mon Feb 24 2020 09:33:20 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">emilio</span>: I've been hoping that there would be a way to consistently crash it by performing some UI action and then manually triggering a GC (Alt+F2, lg, trash button)</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Mon Feb 24 2020 09:41:41 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: I think your patch meant to include changes to JSScript as well?</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Mon Feb 24 2020 10:13:12 GMT-0800 (Pacific Standard Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">mgaudet</span>: I think your patch meant to include changes to JSScript as well?</blockquote></mx-reply>Yeah, it‚Äôs in the patch below (stole it from another stack)</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Mon Feb 24 2020 10:13:55 GMT-0800 (Pacific Standard Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: don't you need GjsMaybeOwned::operator bool() to be <code>explicit</code> too, to avoid it from being used to autoconvert to an int or whatever?</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Mon Feb 24 2020 10:15:43 GMT-0800 (Pacific Standard Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: oh right, sorry</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Mon Feb 24 2020 10:17:34 GMT-0800 (Pacific Standard Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: good question! would that still allow doing <code>if(!myMaybeOwned)</code>? (that was the intention, but not sure we actually do it anywhere)</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Mon Feb 24 2020 10:17:48 GMT-0800 (Pacific Standard Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Mon Feb 24 2020 10:17:53 GMT-0800 (Pacific Standard Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that's considered explicit bool context</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Mon Feb 24 2020 10:18:22 GMT-0800 (Pacific Standard Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">both <code>if(x)</code> and <code>if (!x)</code> should still work</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Mon Feb 24 2020 10:19:42 GMT-0800 (Pacific Standard Time)">18:19</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span></div></td><td class="msg-cell">adds <code>explicit</code> to all <code>operator bool</code> in gjs</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Mon Feb 24 2020 10:20:20 GMT-0800 (Pacific Standard Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">seems unlikely to be related to the crash, though</td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Mon Feb 24 2020 10:20:29 GMT-0800 (Pacific Standard Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I agree</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Mon Feb 24 2020 10:22:05 GMT-0800 (Pacific Standard Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">thanks for taking a look! I really appreciate any help I can get, since I have no idea what convention I might be breaking here</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Mon Feb 24 2020 10:22:16 GMT-0800 (Pacific Standard Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm wondering if you could sprinkle in some IsInsideNursery(static_cast&lt;Cell*&gt;(x)) calls in places like switch_to_rooted and discard_wrapper. Not for the return value, for the MOZ_ASSERT on the ChunkLocation inside of it.</td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Mon Feb 24 2020 10:22:28 GMT-0800 (Pacific Standard Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(or do the assert directly)</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Mon Feb 24 2020 10:23:42 GMT-0800 (Pacific Standard Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">just because it seems like the pointers coming in seem to be totally wrong in some way. Or at least, that's what it sorta appears like, I may be wrong.</td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Mon Feb 24 2020 10:24:24 GMT-0800 (Pacific Standard Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">can you get register values from these crashes? I don't know if they would reveal anything, but it's the next thing I would glance at.</td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Mon Feb 24 2020 10:33:11 GMT-0800 (Pacific Standard Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: if I add the IsInsideNursery calls, at least my test suite doesn't fail the assertion üòù</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Mon Feb 24 2020 10:33:27 GMT-0800 (Pacific Standard Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">good sign!</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Mon Feb 24 2020 10:34:54 GMT-0800 (Pacific Standard Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I haven't had any of these crashes myself yet, but I can ask for register values on that issue and it's likely someone will add them. what should I look for if I get them?</td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Mon Feb 24 2020 10:36:10 GMT-0800 (Pacific Standard Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">If you do any poisoning, then a poisoned pointer pattern would be an obvious sign. But if not, I guess I'd be looking at stack vs heap, and whether the upper or low 3 bits look wrong.</td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Mon Feb 24 2020 11:16:32 GMT-0800 (Pacific Standard Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Why is <a href="https://en.cppreference.com/w/cpp/language/value_initialization">value initialization</a> called that?</blockquote></mx-reply>Seems like it's just a name, to me.  This rose by any other name would still be as abstruse and difficult to fully comprehend.</td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Mon Feb 24 2020 11:53:21 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span></div></td><td class="msg-cell">does not ever expect to have fully internalized and memorized C++'s initialization semantics</td></tr>

</tbody></table></div></div></div>
</body></html>