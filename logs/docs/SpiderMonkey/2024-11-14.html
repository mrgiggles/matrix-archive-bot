<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-11-14</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-11-14<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-11-13" class="nav-link"><span>prev</span></a>
<a href="2024-11-15" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Nov 13 2024 16:51:17 GMT-0800 (Pacific Standard Time)">00:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I think there are Ion things that depend on discard, although I'm struggling to remember any off the top of my head</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Nov 13 2024 16:52:09 GMT-0800 (Pacific Standard Time)">00:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">If it has pointers to GC things that can get moved and the pointers aren't updated that would cause problems. It would only show up after a compacting GC.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Nov 13 2024 17:20:37 GMT-0800 (Pacific Standard Time)">01:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">I'm looking at <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1918065">a memory bug</a> that has fairly high usage under "js-realm" / "classes" / "class(ArrayBuffer)/objects" / "non-heap/elements/wasm":<br>──711.91 MB (92.22%) -- window-objects/top(<a href="http://localhost/">http://localhost/</a>, id=6)<br>│  ├──676.73 MB (87.66%) -- active/window(<a href="http://localhost/">http://localhost/</a>)<br>│  │  ├──676.46 MB (87.63%) -- js-realm(<a href="http://localhost/">http://localhost/</a>)<br>│  │  │  ├──660.76 MB (85.59%) -- classes<br>│  │  │  │  ├──590.25 MB (76.46%) -- class(ArrayBuffer)/objects<br>│  │  │  │  │  ├──458.88 MB (59.44%) ── non-heap/elements/wasm<br>│  │  │  │  │  ├──131.37 MB (17.02%) -- malloc-heap<br>What exactly does that mean? Assuming there's not a leak on the SM side, does that mean that the script is creating a whole bunch of something and then them around? And is it wasm-specific?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Nov 13 2024 20:03:16 GMT-0800 (Pacific Standard Time)">04:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the volume is really low, I agree with landing with more diagnostic asserts.  so I think we first need to check the total crash volume or something for nightly user base</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Nov 13 2024 20:04:16 GMT-0800 (Pacific Standard Time)">04:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the volume is not very low, then we should investigate the issue before re-landing.  maybe we could check the crash reports' comments?  (I don't have access)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Nov 13 2024 20:12:41 GMT-0800 (Pacific Standard Time)">04:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><del>oh, I was wrong about UndefinedValue</del></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Nov 13 2024 20:12:59 GMT-0800 (Pacific Standard Time)">04:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><del>UndefinedValue becomes <code>0x0003800000000000</code></del></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Nov 13 2024 20:13:30 GMT-0800 (Pacific Standard Time)">04:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">err, maybe I'm still missing something</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Nov 13 2024 20:13:49 GMT-0800 (Pacific Standard Time)">04:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>toObjectOrNull</code> on <code>UndefinedValue</code> yields <code>0x0003800000000000</code></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Nov 13 2024 20:14:16 GMT-0800 (Pacific Standard Time)">04:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I should check <code>toObject</code> instead</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Nov 13 2024 20:15:40 GMT-0800 (Pacific Standard Time)">04:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">ah, never mind. <code>toObject</code> on <code>UndefinedValue</code> yields <code>0x0007800000000000</code></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Nov 13 2024 20:16:52 GMT-0800 (Pacific Standard Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so... I just calculated manually.  I guess we should have a tool or table that  shows common cases</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Nov 13 2024 20:17:54 GMT-0800 (Pacific Standard Time)">04:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">sefeng</span>: do you have access to the crash reports' comments?  is there any hint for the reproduction steps?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Nov 13 2024 20:24:42 GMT-0800 (Pacific Standard Time)">04:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gaporf:mozilla.org">gaporf</span>&gt;</div></td><td class="msg-cell"><p>Hi, I'm working on jsapi tests, and I'm wondering if there's a better way to test strings without using <code>JS_NewUCStringCopyZ</code>. Also, I sometimes need to concatenate strings, but the code is quite cumbersome:</p>
<pre><code>JS_ConcatStrings(cx, JS::RootedString(cx, JS_NewUCStringCopyZ(cx, str1)),
                   JS::RootedString(cx, JS_NewUCStringCopyZ(cx, str2)));
</code></pre>
<p>I could use <code>#define</code> to simplify the code in tests, but I might be "reinventing the wheel".</p>
<p>Additionally, how can we verify if a value is <code>NaN</code>? The jsapi-tests README suggests using <code>isNaN</code>, but the compiler doesn’t recognize it. Currently, I'm using <code>std::isnan(a) &amp;&amp; !std::signbit(a</code>) to check for a positive NaN value, but I'm afraid that it's also not a good way.</p>
</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Nov 13 2024 20:37:14 GMT-0800 (Pacific Standard Time)">04:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">gaporf</span>: do you have a WIP patch or something that demonstrates the entire test scenario?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Nov 13 2024 20:59:59 GMT-0800 (Pacific Standard Time)">04:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you want to create JSString or string value, <a href="https://searchfox.org/mozilla-central/rev/c473fbfb32cd42de108f9723aff9bd95f7ec0816/js/public/String.h#66">JS_NewStringCopyZ</a> would be the easiest way for ASCII/Latin1 range, and <a href="https://searchfox.org/mozilla-central/rev/c473fbfb32cd42de108f9723aff9bd95f7ec0816/js/public/String.h#68-69">JS_NewStringCopyUTF8Z</a> for UTF-8</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Nov 13 2024 21:01:26 GMT-0800 (Pacific Standard Time)">05:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, about the concatenation, it would depend on what you're trying to test.  unless you really need to test the details around "concatenated string" representation, I think it's not the best option</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Nov 13 2024 21:03:13 GMT-0800 (Pacific Standard Time)">05:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, <a href="https://searchfox.org/mozilla-central/rev/c473fbfb32cd42de108f9723aff9bd95f7ec0816/js/public/RootingAPI.h#1164">JS::Rooted</a> is supposed to be allocated as local variable (it's RAII class)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Nov 13 2024 21:05:22 GMT-0800 (Pacific Standard Time)">05:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">about isNaN, looks like the README is extremely outdated :P</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Nov 13 2024 21:06:58 GMT-0800 (Pacific Standard Time)">05:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(it's talking about <code>jsval</code> type, which went away 14 years ago...)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Nov 13 2024 21:08:35 GMT-0800 (Pacific Standard Time)">05:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">anyway, yeah, std::isnan should be the correct way</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Nov 13 2024 21:13:17 GMT-0800 (Pacific Standard Time)">05:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gaporf:mozilla.org">gaporf</span>&gt;</div></td><td class="msg-cell"><a href="https://phabricator.services.mozilla.com/D228935">https://phabricator.services.mozilla.com/D228935</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Nov 13 2024 21:14:19 GMT-0800 (Pacific Standard Time)">05:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gaporf:mozilla.org">gaporf</span>&gt;</div></td><td class="msg-cell">Here's a WIP rev, let's discuss in this thread</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Nov 13 2024 21:14:23 GMT-0800 (Pacific Standard Time)">05:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thanks! I'll look into it</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Nov 13 2024 21:40:31 GMT-0800 (Pacific Standard Time)">05:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">gaporf</span>: added comments</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Nov 13 2024 21:40:48 GMT-0800 (Pacific Standard Time)">05:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gaporf:mozilla.org">gaporf</span>&gt;</div></td><td class="msg-cell">Thank you, <span class="nick-15">arai</span>, I'll look at them later</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Nov 13 2024 21:40:50 GMT-0800 (Pacific Standard Time)">05:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(Draft revision doesn't trigger notifications)</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Nov 13 2024 23:19:23 GMT-0800 (Pacific Standard Time)">07:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gaporf:mozilla.org">gaporf</span>&gt;</div></td><td class="msg-cell"><p>Am I right, that we just need to check that the value is not nullptr if we want to be sure that <code>JS_NewStringCopyZ</code> returns a pointer to a valid string?</p>
<pre><code>JSString* inputString = JS_NewUCStringCopyZ(cx, rawInputString);
      CHECK(inputString);
</code></pre>
</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Nov 14 2024 01:10:19 GMT-0800 (Pacific Standard Time)">09:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, it's always better checking the result of allocation</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Nov 14 2024 01:10:47 GMT-0800 (Pacific Standard Time)">09:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and if the allocation fails, it returns nullptr</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Nov 14 2024 01:17:49 GMT-0800 (Pacific Standard Time)">09:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p>Hi all, I am trying to share a WebAssembly.Module through IPC but I am not sure how one gets serialized.<br>Below is the snippet I have, which compiles the module that is collected in Remote Settings. Once compiled I am planning to have it cached into IndexDB and pass it around as an (Shared)ArrayBuffer. But I am missing the Module =&gt; ArrayBuffer step, not sure how to do it</p>
<pre><code>const { buffer } = await client.attachments.download(wasmRecord);
const wasmModule = await WebAssembly.compile(buffer);
</code></pre>
</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Nov 14 2024 01:26:42 GMT-0800 (Pacific Standard Time)">09:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">oh mmm or is the module directly transferrable?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Nov 14 2024 04:54:33 GMT-0800 (Pacific Standard Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">there's some code wraping fd with cdatafinalizer to ensure close is called, is there a way i can get back to the fd itself from the CDataFinalizer?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Nov 14 2024 04:55:00 GMT-0800 (Pacific Standard Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/toolkit/modules/subprocess/subprocess_shared_unix.js#114-116">https://searchfox.org/mozilla-central/source/toolkit/modules/subprocess/subprocess_shared_unix.js#114-116</a></td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Nov 14 2024 04:55:10 GMT-0800 (Pacific Standard Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">what i have is the result of <code>unix.Fd(...)</code></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Nov 14 2024 04:57:33 GMT-0800 (Pacific Standard Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">oh <code>toString()</code> does something?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Nov 14 2024 05:00:05 GMT-0800 (Pacific Standard Time)">13:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">basically, no.  but <code>toSource()</code> may stringify the data <a href="https://searchfox.org/mozilla-central/search?q=symbol:F_%3CT_js%3A%3Actypes%3A%3ACDataFinalizer%3A%3APrivate%3E_code&amp;redirect=false">https://searchfox.org/mozilla-central/search?q=symbol:F_%3CT_js%3A%3Actypes%3A%3ACDataFinalizer%3A%3APrivate%3E_code&amp;redirect=false</a></td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Nov 14 2024 05:22:09 GMT-0800 (Pacific Standard Time)">13:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gerard-majax:mozilla.org">gerard-majax</span>&gt;</div></td><td class="msg-cell">well toString does it for me here</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Nov 14 2024 07:14:01 GMT-0800 (Pacific Standard Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">do you mean protected data? I don't have access to those</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Nov 14 2024 07:38:49 GMT-0800 (Pacific Standard Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Hi all, I am trying to share a WebAssembly.Module through IPC but I am not sure how one gets serialized.<br>Below is the snippet I have, which compiles the module that is collected in Remote Settings. Once compiled I am planning to have it cached into IndexDB and pass it around as an (Shared)ArrayBuffer. But I am missing the Module =&gt; ArrayBuffer step, not sure how to do it</p>
<pre><code>const { buffer } = await client.attachments.download(wasmRecord);
const wasmModule = await WebAssembly.compile(buffer);
</code></pre>
</blockquote></mx-reply>Hmm, I don't believe we support sharing a WebAssembly.Module across an IPC boundary. We only support it in-process across workers using postMessage</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Nov 14 2024 07:39:30 GMT-0800 (Pacific Standard Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">There's no WA.Module =&gt; buffer step. If you need the buffer after compilation you'll need to hold on to it</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Nov 14 2024 07:39:52 GMT-0800 (Pacific Standard Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">interesting. How would I store the result of the compilation in indexdb in that case?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Nov 14 2024 07:39:54 GMT-0800 (Pacific Standard Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">I also don't know if we support storing a WA.Module in IndexedDB directly either. We used to, but that support was removed by a W3C TAG review</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Nov 14 2024 07:40:27 GMT-0800 (Pacific Standard Time)">15:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">in an ideal world I compile it just once and store it, and serve it back.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Nov 14 2024 07:40:34 GMT-0800 (Pacific Standard Time)">15:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">Yeah..</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Nov 14 2024 07:40:43 GMT-0800 (Pacific Standard Time)">15:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I have started a patch </td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Nov 14 2024 07:41:08 GMT-0800 (Pacific Standard Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I guess it's possible if that was removed :) </td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Nov 14 2024 07:41:39 GMT-0800 (Pacific Standard Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">and also if Module can use postMessage, it's serialized somehow</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Nov 14 2024 07:41:44 GMT-0800 (Pacific Standard Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I will investigate :) </td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Nov 14 2024 07:43:17 GMT-0800 (Pacific Standard Time)">15:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">We did have some on-disk wasm cache that used serialization at some point <a href="https://searchfox.org/mozilla-central/rev/30afd6631333bf83d5c62ca48c313d96a21b4bbd/js/src/wasm/WasmJS.h#89-100">https://searchfox.org/mozilla-central/rev/30afd6631333bf83d5c62ca48c313d96a21b4bbd/js/src/wasm/WasmJS.h#89-100</a></td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Nov 14 2024 07:44:17 GMT-0800 (Pacific Standard Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">SpiderMonkey definitely can serialize and cache modules after they're compiled. There's nothing technically impossible with storing it in IndexedDB, but the TAG said from a design perspective caching of user scripts should be automatically handled by the network cache, not manually by users. So we support caching when you pass fetch() to WA.compileStreaming() and store the result in the network cache. That doesn't make sense for your use-case though of chrome/web-extension code</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Nov 14 2024 07:45:29 GMT-0800 (Pacific Standard Time)">15:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">There is a DOM Cache API that could be used for manual caching of WA modules, but I tested it out and it doesn't work yet. I filed a bug for it here: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1927926">https://bugzilla.mozilla.org/show_bug.cgi?id=1927926</a></td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Nov 14 2024 07:45:45 GMT-0800 (Pacific Standard Time)">15:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">The snippet on the bug shows how I was thinking it could work</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu Nov 14 2024 07:46:13 GMT-0800 (Pacific Standard Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">It's possible the best thing for your use-case would be to add a special chrome-only API</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu Nov 14 2024 07:46:43 GMT-0800 (Pacific Standard Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Hi all, I am trying to share a WebAssembly.Module through IPC but I am not sure how one gets serialized.<br>Below is the snippet I have, which compiles the module that is collected in Remote Settings. Once compiled I am planning to have it cached into IndexDB and pass it around as an (Shared)ArrayBuffer. But I am missing the Module =&gt; ArrayBuffer step, not sure how to do it</p>
<pre><code>const { buffer } = await client.attachments.download(wasmRecord);
const wasmModule = await WebAssembly.compile(buffer);
</code></pre>
</blockquote></mx-reply>Please be very careful if you do this. Sharing executable code across processes can potentially be very dangerous.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu Nov 14 2024 07:46:54 GMT-0800 (Pacific Standard Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>user scripts should be automatically handled by the network cache,</p>
</blockquote>
<p>yeah my wasm module comes as an array buffer from Remote settings, not an url</p>
</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu Nov 14 2024 07:47:39 GMT-0800 (Pacific Standard Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Please be very careful if you do this. Sharing executable code across processes can potentially be very dangerous.</blockquote></mx-reply>it's the inference runtime, only happening inside the inference process using the wasm we store in remote settings. this is not an open ended API</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu Nov 14 2024 07:47:45 GMT-0800 (Pacific Standard Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Hi all, I am trying to share a WebAssembly.Module through IPC but I am not sure how one gets serialized.<br>Below is the snippet I have, which compiles the module that is collected in Remote Settings. Once compiled I am planning to have it cached into IndexDB and pass it around as an (Shared)ArrayBuffer. But I am missing the Module =&gt; ArrayBuffer step, not sure how to do it</p>
<pre><code>const { buffer } = await client.attachments.download(wasmRecord);
const wasmModule = await WebAssembly.compile(buffer);
</code></pre>
</blockquote></mx-reply>Yeah, you can't do this - there's no serialization backend for wasm modules in part due to the security concerns <span class="nick-16">mccr8</span> mentioned</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu Nov 14 2024 07:48:24 GMT-0800 (Pacific Standard Time)">15:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">You want to compile the module in the process which will use it</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu Nov 14 2024 07:49:02 GMT-0800 (Pacific Standard Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">yeah that is what I do, and then share it across the workers. but I would liek to do it just once, not everytime the process is started</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu Nov 14 2024 07:49:50 GMT-0800 (Pacific Standard Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">since it's going to be the same operation everytime</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu Nov 14 2024 07:49:58 GMT-0800 (Pacific Standard Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">and is very expensive</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu Nov 14 2024 07:51:31 GMT-0800 (Pacific Standard Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">so I guess postMessage(module) works, and it's just how to avoid calling compile more than once</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu Nov 14 2024 07:51:54 GMT-0800 (Pacific Standard Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Please be very careful if you do this. Sharing executable code across processes can potentially be very dangerous.</blockquote></mx-reply>What are the risks?</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu Nov 14 2024 07:52:50 GMT-0800 (Pacific Standard Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> What are the risks?</blockquote></mx-reply>The danger would be a less privileged process controlling code run in a more privileged process which could lead to sandbox escapes and loss of process isolation.</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu Nov 14 2024 07:54:03 GMT-0800 (Pacific Standard Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The danger would be a less privileged process controlling code run in a more privileged process which could lead to sandbox escapes and loss of process isolation.</blockquote></mx-reply>So, if the security contexts are the same (like using the cache), it is okay?</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu Nov 14 2024 07:54:25 GMT-0800 (Pacific Standard Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I don't know.</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Thu Nov 14 2024 07:57:48 GMT-0800 (Pacific Standard Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">In general receiving built machine code over IPC and then putting it into executable memory is a bit scary. Maybe there is some kind of cache that SpiderMonkey could implement/support on that level, but I don't think we'd want to do it naively (nor am I even sure if that would be possible)</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Thu Nov 14 2024 08:51:09 GMT-0800 (Pacific Standard Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">ok thanks all. I guess for now doing one compilation every time that process is started and sharing it across its workers is already a gain for me. Storing the result in cache even if it's not tied to a url would be nice later. (maybe a hash of the wasm binary?)</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Thu Nov 14 2024 09:31:10 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> ok thanks all. I guess for now doing one compilation every time that process is started and sharing it across its workers is already a gain for me. Storing the result in cache even if it's not tied to a url would be nice later. (maybe a hash of the wasm binary?)</blockquote></mx-reply>Yeah that seems like the easiest thing for right now. Hopefully with lazy tiering that can be good enough for a bit</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Thu Nov 14 2024 09:31:51 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">oh by the way Ryan, is there a way for me to force <code>lazy tiering</code> when I call compile? so not rely on the about :config option</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Thu Nov 14 2024 09:33:14 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">No, not right now. We generally only allow enabling experimental features through the pref system</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Thu Nov 14 2024 09:33:54 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">We could add a way to do it just for chrome code, but I hope that we'll be able to ship lazy tiering quick enough that it's not a big deal to just wait for that</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Thu Nov 14 2024 09:44:21 GMT-0800 (Pacific Standard Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I guess partially I'm trying to figure out if it's possible to fail if we compact without discarding JIT code. (I'm looking into JIT discard heuristics, and want to try and draw the line between "must discard for functional reasons" and "this was a discard heuristic" )</blockquote></mx-reply><span class="nick-4">jonco</span>: I'm still puzzling a bit over this. Because we do have support for tracing pointers in generated code... I'm still not sure if we have to toss jit code</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Thu Nov 14 2024 09:47:34 GMT-0800 (Pacific Standard Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: I don't remember what the final situation was here. Originally discarding JIT code was required because we couldn't update all pointers in JIT code. But that may have been fixed. I seem to remember object element pointers were a problem.</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Thu Nov 14 2024 09:48:07 GMT-0800 (Pacific Standard Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Ok (this may need to wait for Jan to truly nail down). I'll keep on documenting the state of the world :) </td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Thu Nov 14 2024 09:52:16 GMT-0800 (Pacific Standard Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I remembered Alex and I getting in trouble with this, and finally pinned it down. We had to back out a change in <a href="https://phabricator.services.mozilla.com/D164261">this bug</a> because it turns out shapes aren't traced in Ion code.</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Thu Nov 14 2024 09:52:28 GMT-0800 (Pacific Standard Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Original patch <a href="https://phabricator.services.mozilla.com/D161962">here</a></td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Thu Nov 14 2024 09:53:34 GMT-0800 (Pacific Standard Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: Bug 1146867 implies the elements problem was fixed</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Thu Nov 14 2024 09:53:35 GMT-0800 (Pacific Standard Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1146867">https://bugzil.la/1146867</a> — NEW (nobody) — Add a mode to test compacting GC without discarding JIT code</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Thu Nov 14 2024 09:54:58 GMT-0800 (Pacific Standard Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: It would be preferable to trace these if possible... is there a bug for this?</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Thu Nov 14 2024 09:55:12 GMT-0800 (Pacific Standard Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Not to the best of my knowledge</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Thu Nov 14 2024 09:57:01 GMT-0800 (Pacific Standard Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">To fix that would mostly be a case of just changing ImmPtr(shapePtr) to ImGCPtr(shapePtr) rigt? </td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Thu Nov 14 2024 09:58:42 GMT-0800 (Pacific Standard Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The <a href="https://searchfox.org/mozilla-central/source/js/src/jit/CodeGenerator.cpp#4472-4479">codegen for LGuardShape</a> calls <a href="https://searchfox.org/mozilla-central/source/js/src/jit/MacroAssembler-inl.h#714-731">branchTestObjShape</a> which uses ImmGCPtr, so I assume something more than that is necessary</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Thu Nov 14 2024 09:59:09 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I have unfortunately paged out the details here</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Thu Nov 14 2024 10:02:52 GMT-0800 (Pacific Standard Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Alright :) I shall continue on my quest </td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Thu Nov 14 2024 10:05:14 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Filed bug 1931394</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Thu Nov 14 2024 10:05:15 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1931394">https://bugzil.la/1931394</a> — NEW (nobody) — Some shapes in JIT code are not traced</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Thu Nov 14 2024 10:18:15 GMT-0800 (Pacific Standard Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I will say... if I use the same test case from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1804626">https://bugzilla.mozilla.org/show_bug.cgi?id=1804626</a>, and comment out the 'discardJitCode' call inside of prepareForCompactingGC I don't seem to see any failure </td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Thu Nov 14 2024 11:56:49 GMT-0800 (Pacific Standard Time)">19:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Is there any way at all to get a pointer to the InternalJobQueue?

I would really like to create my own job queue but not needlessly copy code.  I know InternalJobQueue is not defined in any public headers, so I can't inherit from it.

The next best thing would be to hold an instance to the original JobQueue and use it as a proxy.</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Thu Nov 14 2024 12:48:12 GMT-0800 (Pacific Standard Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Uh. Currently no. </td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Thu Nov 14 2024 12:48:53 GMT-0800 (Pacific Standard Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I would personally need a bit of convincing to do that for our current version (though we're thinking a bit about queues at the moment architecturally, so maybe a future might be better). What kind of overrides from the internal job queue are you looking for? 

I do worry a bit about letting InternalJobQueue escape</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Thu Nov 14 2024 12:50:19 GMT-0800 (Pacific Standard Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I would personally need a bit of convincing to do that for our current version (though we're thinking a bit about queues at the moment architecturally, so maybe a future might be better). What kind of overrides from the internal job queue are you looking for? <br><br>I do worry a bit about letting InternalJobQueue escape</blockquote></mx-reply>It doesn't really matter.  We're using an older version anyway, so I'll use some kind of work-around.</td></tr>

</tbody></table></div></div></div>
</body></html>