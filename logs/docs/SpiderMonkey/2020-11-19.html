<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-11-19</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-11-19<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-11-18" class="nav-link"><span>prev</span></a>
<a href="2020-11-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Nov 18 2020 17:23:52 GMT-0800 (Pacific Standard Time)">01:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is there any existing tool that can force include-what-you-use with understanding comment after <code>#include</code> line ?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Nov 19 2020 05:17:16 GMT-0800 (Pacific Standard Time)">13:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Do we not support asm.js on Android?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Nov 19 2020 05:22:22 GMT-0800 (Pacific Standard Time)">13:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Do we still support asm.js?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Nov 19 2020 05:24:28 GMT-0800 (Pacific Standard Time)">13:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I would think so, last time I asked there were still more users of asm.js than wasm.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Nov 19 2020 05:24:45 GMT-0800 (Pacific Standard Time)">13:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">but this might have been 1 year ago.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 19 2020 05:25:21 GMT-0800 (Pacific Standard Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">So, end of October? :)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 19 2020 05:46:04 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Is there a way to trigger some kind of object destructor at realm destruction (post GC) or something similar to that?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 19 2020 05:46:25 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I'm using some Proxy objects, and so far i've assumed their handlers needed to outlive the GC because of proxy_finalize... But it's a little annoying</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 19 2020 05:47:40 GMT-0800 (Pacific Standard Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I <em>could</em> just leak proxy handlers and hope it's never a problem, but that seems a little dumb</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 19 2020 05:49:38 GMT-0800 (Pacific Standard Time)">13:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">(my current approach is to just have static handlers, but that means I can't really stop useful data in them, which I'd like to do)</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 19 2020 05:50:46 GMT-0800 (Pacific Standard Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">(I'm carrying out thinking out loud here) Unless the correct approach for this would be to set a prototype and have that prototype hold the data so I keep the "data once per handler, however many proxy objects I want"</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 19 2020 05:53:03 GMT-0800 (Pacific Standard Time)">13:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah that's not really something we support. All our JSClasses and proxy handlers are statically allocated afaik</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 19 2020 05:53:40 GMT-0800 (Pacific Standard Time)">13:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Ok, makes sense</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Nov 19 2020 05:53:49 GMT-0800 (Pacific Standard Time)">13:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">can't you store the data in one of the proxy's slots?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Nov 19 2020 05:54:07 GMT-0800 (Pacific Standard Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I could, the objective was to avoid increasing memory footprint</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Nov 19 2020 05:54:26 GMT-0800 (Pacific Standard Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">since I'm essentially storing like 4 pointers for each "class" of proxy, but I can have hundreds of them</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Nov 19 2020 05:54:30 GMT-0800 (Pacific Standard Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">admittedly not a <em>huge</em> concern</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Nov 19 2020 05:55:52 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">hm right, you'd need one slot to store a pointer to a refcounted thing that stores your 4 pointers or so.. or put it in TLS</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Nov 19 2020 05:55:59 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">That being said, as far as I understand proxies now must have both a private data and a reserved slot ?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Nov 19 2020 05:57:21 GMT-0800 (Pacific Standard Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah I think they need at least 1 reserved slot, but that's left-over from when I changed that from always-2-slots because requiring &gt;= 1 helped people update their code</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Nov 19 2020 05:57:45 GMT-0800 (Pacific Standard Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I should probably remove that static assertion</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Nov 19 2020 05:57:58 GMT-0800 (Pacific Standard Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">right</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Nov 19 2020 05:58:32 GMT-0800 (Pacific Standard Time)">13:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">And they do still have a private data 'slot' too right? (that's what I'm less clear on, since some proxy definitions I've found don't specify JSCLASS_HAS_PRIVATE)</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Nov 19 2020 05:58:44 GMT-0800 (Pacific Standard Time)">13:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">because that would give me my two pointers regardless, which would be good enough I think</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Nov 19 2020 05:59:56 GMT-0800 (Pacific Standard Time)">13:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah there's always a private slot, JSCLASS_HAS_PRIVATE doesn't do anything for proxies</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Nov 19 2020 06:00:15 GMT-0800 (Pacific Standard Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Ok, great. Thanks very much for the info</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Nov 19 2020 06:01:59 GMT-0800 (Pacific Standard Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">confession: Using XDR for the selfhosted code removes 43% of the load time of the JS shell. (Bug 1668361)</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Nov 19 2020 06:02:02 GMT-0800 (Pacific Standard Time)">14:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Nov 19 2020 06:02:03 GMT-0800 (Pacific Standard Time)">14:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1668361">https://bugzil.la/1668361</a> — ASSIGNED (nbp) — Add support for executing JS shell with self-hosted code loaded from stencil XDR</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Nov 19 2020 10:01:09 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I did a dumb and kept a reference to a field of a gc::Cell across a GC. Is there any possibility that hazard analysis could catch this sort of thing?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Nov 19 2020 10:01:41 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">internal pointers are hard</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Nov 19 2020 10:01:53 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">we tried a number of things for JSString data</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Nov 19 2020 10:02:11 GMT-0800 (Pacific Standard Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and we used to have an InternalGCPointer thing of some sort. It didn't really work.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Nov 19 2020 10:03:17 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">SM(cgc) will flush some of these out by moving the data out from under you</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Nov 19 2020 10:03:48 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">that it did eventually</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Nov 19 2020 10:05:19 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I suppose if you don't get another (probably zeal-triggered) GC before you accessed the pointer, we could beef up SM(cgc) a bit by making it toggle everything between two heaps and mprotect the inactive one.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Nov 19 2020 13:25:55 GMT-0800 (Pacific Standard Time)">21:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@zbraniecki:mozilla.org">zbraniecki</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: do you plan to review <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1654116">https://bugzilla.mozilla.org/show_bug.cgi?id=1654116</a> ?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Nov 19 2020 13:27:29 GMT-0800 (Pacific Standard Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">zbraniecki</span>: Yeah, I need to.  Dealing with the tzdata update as we speak, I.DN is next but possibly not in the remainder of the day, and I.S is soon after, I hope.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Nov 19 2020 13:35:28 GMT-0800 (Pacific Standard Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@zbraniecki:mozilla.org">zbraniecki</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: thanks! I just sent you a doc on our plan to find a way to fix the Layout vs SM needs around Segmenter. I'd love your feedback on it!</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Nov 19 2020 13:44:39 GMT-0800 (Pacific Standard Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Seems I have potentially two different GC issues in my warp generators patch stack. :S </td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Nov 19 2020 14:01:57 GMT-0800 (Pacific Standard Time)">22:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">what's the easiest way access a variable from a different compartment? <code>window.opener.object</code> seems to do some wrapping</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Nov 19 2020 14:09:59 GMT-0800 (Pacific Standard Time)">22:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Anyone want to fill me in on what exactly is the purpose of lines like <a href="https://searchfox.org/mozilla-central/rev/1d34bd022de0b55c81d9db6026f69bda1d4a86d2/js/src/builtin/intl/DateTimeFormat.cpp#399">https://searchfox.org/mozilla-central/rev/1d34bd022de0b55c81d9db6026f69bda1d4a86d2/js/src/builtin/intl/DateTimeFormat.cpp#399</a> or why they are needed?  Most places, you get <code>cx-&gt;names().foo</code> and you can shove it into any string or whatever without thinking about it.  What makes cases like this (there are others in the file) different, if anything actually does now?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Nov 19 2020 14:26:37 GMT-0800 (Pacific Standard Time)">22:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: I don't remember the specifics, but I think the idea is that atoms are not stored in compartments any more so there are some weird GC issues that require that you call that.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Nov 19 2020 14:28:42 GMT-0800 (Pacific Standard Time)">22:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Oh, I guess that <em>is</em> getting an atom from a weird out-of-the-way hashmap, so it's not the same as just <code>cx-&gt;names().foo</code>.</td></tr>

</tbody></table></div></div></div>
</body></html>