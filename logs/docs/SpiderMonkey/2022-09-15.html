<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-09-15</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-09-15<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-09-14" class="nav-link"><span>prev</span></a>
<a href="2022-09-16" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Sep 14 2022 17:29:10 GMT-0700 (Pacific Daylight Time)">00:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I wonder where <code>js/examples/jorendb.js</code> should go? Maybe to the <code>js/src/devtools</code> directory</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Sep 14 2022 17:29:32 GMT-0700 (Pacific Daylight Time)">00:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Also wondering if <code>js/src/devtools</code> needs a new name... maybe just <code>js/tools</code></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Sep 14 2022 17:31:10 GMT-0700 (Pacific Daylight Time)">00:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(astute readers may notice I'm trying to stake more direct claim of <code>js/</code> to the spidermonkey team instead of just the module being <code>js/src</code>...)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Sep 14 2022 18:41:47 GMT-0700 (Pacific Daylight Time)">01:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">It seems that after enabling <code>topLevelAwait</code>, <code>ModuleEvaluate</code> doesn't return false for an exception<br>What should I do to get that exception</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Sep 14 2022 21:57:28 GMT-0700 (Pacific Daylight Time)">04:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I <em>think</em> in that case the <code>ModuleEvaluate</code> has a <code>result</code> outparam which is a <code>PromiseObject</code>that you can then catch the async exception from</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Sep 15 2022 00:10:44 GMT-0700 (Pacific Daylight Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Do I just run the event loop as normal, then check the promise state and result?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Sep 15 2022 02:57:01 GMT-0700 (Pacific Daylight Time)">09:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Assuming that is the case, do I run the event loop to completion on every module resolution? That seems a bit wasteful, async-wise.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Sep 15 2022 03:43:44 GMT-0700 (Pacific Daylight Time)">10:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I'm passing a Proxy object into the <code>envChain</code>. The point is to have an implicit "this" capture, so that the user can just write <code>foo()</code> instead of <code><a href="http://this.foo">this.foo</a>()</code> in their code (or <code><a href="http://myObject.foo">myObject.foo</a>()</code>).</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Sep 15 2022 03:51:37 GMT-0700 (Pacific Daylight Time)">10:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I can think of some ways around this problem, but I want to make sure that I understand it properly first. If I want to compile or execute a script which has the <code>import</code> keyword, then my only option is to use <code>JS::CompileModule()</code> and <code>JS::ModuleEvaluate()</code>. Is this right?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Sep 15 2022 07:21:21 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">liam_g, in a module the "this" will be "undefined" at top-level anyways. Typically you'd inject your sort of custom methods on the global object or its' prototype chain,  but there might be some nuance to what you are doing here.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Sep 15 2022 07:24:26 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(this top level environment stuff is <em>hard</em>, we've been going through Firefox recently to remove some very clever approaches in favour of using modules and an appropriate global object. javascript is a weird language and there is a lot of subtly about where global variables get written since <code>foo = 3;</code>, <code>var foo = 3;</code>, <code><a href="http://this.foo">this.foo</a> = 3;</code> all mean different things depending on how precisely the environments are constructed)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Sep 15 2022 08:57:52 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@lgoodacre:matrix.org">liam_g</span>&gt;</div></td><td class="msg-cell">Ok, I'll see if I can inject special user defined functions into the global.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Sep 15 2022 08:58:27 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@lgoodacre:matrix.org">liam_g</span>&gt;</div></td><td class="msg-cell">I'm glad I'm not the only one who finds javascript weird!</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Sep 15 2022 09:08:56 GMT-0700 (Pacific Daylight Time)">16:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Redfire, when you are using <code>ModuleEvaluate</code> with top-level-await, you probably want to model things closer to using dynamic-import on the web. That code may take arbitrary time, so you'd chain the promise with <code>then</code> or <code>catch</code> functions that run when the error is known. Things like syntax errors should still be known when <code>CompileModule</code> happens.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Sep 15 2022 10:05:01 GMT-0700 (Pacific Daylight Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">anyone know of any JavaScript libraries that emulate C++ numerical data types?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Sep 15 2022 10:54:58 GMT-0700 (Pacific Daylight Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">How do you set rooted value to <code>BigInt</code>? <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr68/examples/cookbook.cpp#L85-L94">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr68/examples/cookbook.cpp#L85-L94</a></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Sep 15 2022 11:00:07 GMT-0700 (Pacific Daylight Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">What is the under the hood datatype of <code>BigInt</code> in SpiderMonkey?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Sep 15 2022 11:02:42 GMT-0700 (Pacific Daylight Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">davidj361</span>: <a href="https://searchfox.org/mozilla-central/source/js/public/Value.h#1030">BigIntValue</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Sep 15 2022 11:03:15 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">I saw that, so you basically can't pass some C++ int64 or uint64?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Sep 15 2022 11:03:54 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">davidj361</span>: See here: <a href="https://searchfox.org/mozilla-central/source/js/src/vm/BigIntType.h#114-122">https://searchfox.org/mozilla-central/source/js/src/vm/BigIntType.h#114-122</a></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Sep 15 2022 11:10:35 GMT-0700 (Pacific Daylight Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">so you're supposed to use something like <code>JS::BigIntValue(JS::BigInt::CreateFromDouble(cx, 5))</code>? I'm still confused. There isn't a BigInt example in the cookbook is there?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Sep 15 2022 11:34:43 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@lgoodacre:matrix.org">liam_g</span>&gt;</div></td><td class="msg-cell">In JSFunctionSpec, how much does the "nargs" field matter? Is it ok if the function receives a number of arguments different than the one I specify?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Sep 15 2022 11:47:17 GMT-0700 (Pacific Daylight Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: Functions in JS regularly get too many or too few arguments. Missing arguments are padded out with <code>undefined</code>.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Sep 15 2022 11:48:19 GMT-0700 (Pacific Daylight Time)">18:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">I think <code>nargs</code> is only used to populate the <code>.length</code> property of a function, or no?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Sep 15 2022 11:50:25 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: I think we also use it when calling the function to decide how many extra <code>undefined</code> values to pass, but yeah, more or less</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Sep 15 2022 11:51:29 GMT-0700 (Pacific Daylight Time)">18:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Basically the callee is guaranteed to have at least <code>nargs</code> actual values in the arguments array, but it could have more</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Sep 15 2022 11:53:38 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">davidj361</span>: Yeah, something like that. Depending on the code around it, you probably want to root the result.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Sep 15 2022 11:54:16 GMT-0700 (Pacific Daylight Time)">18:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Basically the callee is guaranteed to have at least <code>nargs</code> actual values in the arguments array, but it could have more</blockquote></mx-reply>this only applies for scripted functions. I think we are talking about native functions here</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Sep 15 2022 11:55:55 GMT-0700 (Pacific Daylight Time)">18:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Oh, you're right. I even went and looked at BaselineCacheIRCompiler, but for some reason I was looking at the scripted case, not the native case.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Sep 15 2022 11:56:53 GMT-0700 (Pacific Daylight Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Given that: yeah, I think ptomato's statement (<code>nargs</code> is only used for populating <code>.length</code>) is accurate for native functions.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Sep 15 2022 12:20:25 GMT-0700 (Pacific Daylight Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Hi.  I have a question about some of the functions defined in jsapi.h.  I notice that many of them return bool to indicate success or failure.

In the case of failure, is it possible to get more detailed information about the nature of those failures?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Sep 15 2022 12:23:35 GMT-0700 (Pacific Daylight Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: yes, in the case of failure there will be an exception pending on the JSContext</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Sep 15 2022 12:24:00 GMT-0700 (Pacific Daylight Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">you can examine it with <code>JS_GetPendingException</code> and similar functions</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Sep 15 2022 12:24:44 GMT-0700 (Pacific Daylight Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> you can examine it with <code>JS_GetPendingException</code> and similar functions</blockquote></mx-reply>I see.  I thought the exceptions were only set in the case of JS code execution errors.  Thanks.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Sep 15 2022 12:29:46 GMT-0700 (Pacific Daylight Time)">19:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">a lot of JS code execution errors originate this way</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Sep 15 2022 12:30:00 GMT-0700 (Pacific Daylight Time)">19:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">in certain cases like out-of-memory where a JS code execution error is not applicable, there will be an "uncatchable" exception set, that cannot be caught by JS code</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Sep 15 2022 13:14:46 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Does anyone know what JSAutoRealm does?  From the code examples, it seems important, but I don't know why.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Sep 15 2022 13:17:52 GMT-0700 (Pacific Daylight Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: It is basically a way to tell the JS engine, "Hey, I'm about to run JS code in this realm!"</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Sep 15 2022 13:18:07 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">oh... what is a "realm" in this context?</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Sep 15 2022 13:18:19 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">it's like an environment with an associated global object</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Sep 15 2022 13:18:32 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">should I keep any reference to it after I create it?</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Sep 15 2022 13:19:15 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">The "realm" terminology originates from specs. Maybe the HTML spec, I'm not sure. <a href="https://html.spec.whatwg.org/multipage/webappapis.html#realms-and-their-counterparts">https://html.spec.whatwg.org/multipage/webappapis.html#realms-and-their-counterparts</a></td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Sep 15 2022 13:19:45 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> should I keep any reference to it after I create it?</blockquote></mx-reply>no, it's a stack-only object I believe, the intention is that it exits the realm when it goes out of scope and is destructed</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Sep 15 2022 13:20:02 GMT-0700 (Pacific Daylight Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Yeah I think you basically create it when you start running code in a certain JS realm, then destroy it when you are done.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Sep 15 2022 13:21:23 GMT-0700 (Pacific Daylight Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">I'm creating a wrapper class around JSContext.  Should the lifetime of the autorealm be the same as the context, or should I only initialize it when I'm ready to execute code?</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Sep 15 2022 13:22:17 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: Well, in Firefox we do the latter. There's basically just one JSContext, but we create and destroy auto realm things all of the time.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Sep 15 2022 13:22:37 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">If your entire program somehow only has one realm ever it probably doesn't matter.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Sep 15 2022 13:23:01 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">What ECMAScript does SM esr68 support?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Sep 15 2022 13:23:22 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: although if you want the lifetime of being in the realm to be longer than one individual scope, I'd use <code>JS::EnterRealm()</code> and <code>JS::LeaveRealm()</code> instead of <code>JSAutoRealm</code></td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Sep 15 2022 13:23:22 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Is it only fully ecmascript 5?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Sep 15 2022 13:24:45 GMT-0700 (Pacific Daylight Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-15">kfjvj</span>: although if you want the lifetime of being in the realm to be longer than one individual scope, I'd use <code>JS::EnterRealm()</code> and <code>JS::LeaveRealm()</code> instead of <code>JSAutoRealm</code></blockquote></mx-reply>So JSAutoRealm is really just an RAII wrapper of EnterRealm and LeaveRealm, is that correct?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Sep 15 2022 13:25:33 GMT-0700 (Pacific Daylight Time)">20:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: looks like it also maintains a stack of realms</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Sep 15 2022 13:25:57 GMT-0700 (Pacific Daylight Time)">20:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">so it saves your old realm, loads the new one, then restores the old one when you exit.</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu Sep 15 2022 13:35:23 GMT-0700 (Pacific Daylight Time)">20:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is it only fully ecmascript 5?</blockquote></mx-reply>esr68 would have had most of EcmaScript 2018 support. (Naming scheme was changed to years at some point <a href="https://en.wikipedia.org/wiki/ECMAScript">https://en.wikipedia.org/wiki/ECMAScript</a> )</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu Sep 15 2022 13:36:52 GMT-0700 (Pacific Daylight Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span> is there a source on esr68 supporting EcmaScript 2018?</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu Sep 15 2022 13:37:53 GMT-0700 (Pacific Daylight Time)">20:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">mostly checking the main features in ES6, 2016, 2017 on MDN and seeing the compatability tables</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu Sep 15 2022 13:38:52 GMT-0700 (Pacific Daylight Time)">20:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">i tried finding compatibility tables like this but didn't see 68 listed and there aren't many ECMAScript editions
<a href="https://kangax.github.io/compat-table/es2016plus/">https://kangax.github.io/compat-table/es2016plus/</a></td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu Sep 15 2022 13:40:38 GMT-0700 (Pacific Daylight Time)">20:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">If you click the little MDN icons on a row, the MDN page usually has the compat data with the version a feature was enabled</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu Sep 15 2022 13:41:33 GMT-0700 (Pacific Daylight Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">That data is in <a href="https://github.com/mdn/browser-compat-data">https://github.com/mdn/browser-compat-data</a></td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu Sep 15 2022 13:43:24 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">This might be an easier form for your questions: <a href="https://caniuse.com/?search=ES6">https://caniuse.com/?search=ES6</a></td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu Sep 15 2022 13:44:29 GMT-0700 (Pacific Daylight Time)">20:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">nothing for es9? <a href="https://caniuse.com/?search=ES9">https://caniuse.com/?search=ES9</a></td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu Sep 15 2022 13:48:01 GMT-0700 (Pacific Daylight Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">if you click the "feature support list" you should see more details</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu Sep 15 2022 13:48:54 GMT-0700 (Pacific Daylight Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The regexp changes of ES9 didn't make the cut for ESR68, but I think most of the other features did</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu Sep 15 2022 15:06:38 GMT-0700 (Pacific Daylight Time)">22:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Redfire, when you are using <code>ModuleEvaluate</code> with top-level-await, you probably want to model things closer to using dynamic-import on the web. That code may take arbitrary time, so you'd chain the promise with <code>then</code> or <code>catch</code> functions that run when the error is known. Things like syntax errors should still be known when <code>CompileModule</code> happens.</blockquote></mx-reply>Can I still use ModuleResolveHook or...?</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu Sep 15 2022 15:07:51 GMT-0700 (Pacific Daylight Time)">22:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I believe the ModuleResolveHook stuff all fires before "evaluation" starts, so yes should be fine.</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu Sep 15 2022 16:07:57 GMT-0700 (Pacific Daylight Time)">23:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>GJS seems to just use AddPromiseReactions (<code>then</code>/<code>catch</code> basically)<br><a href="https://gitlab.gnome.org/GNOME/gjs/-/blob/master/gjs/context.cpp#L1444-L1447">https://gitlab.gnome.org/GNOME/gjs/-/blob/master/gjs/context.cpp#L1444-L1447</a></p>
<p>Is it not possible for me to get the result of the promise after running the event loop through completion though? (using <code>GetPromiseState</code> to check and <code>GetPromiseResult</code> to get the exception/rejection)</p></td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu Sep 15 2022 16:12:12 GMT-0700 (Pacific Daylight Time)">23:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@tcampbell:mozilla.org">tcampbell|ooo-thru-sept-24</span>&gt;</div></td><td class="msg-cell">in your usecase that might be possible. In general, the module could be sleeping on a timeout, network event, etc which would not necesarilly be complete just because event loop is clear</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Thu Sep 15 2022 16:13:10 GMT-0700 (Pacific Daylight Time)">23:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@tcampbell:mozilla.org">tcampbell|ooo-thru-sept-24</span>&gt;</div></td><td class="msg-cell"><code>GetPromiseState</code> might work as you said</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Thu Sep 15 2022 16:15:54 GMT-0700 (Pacific Daylight Time)">23:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>Either way, don't I have to ensure that the promise is run to completion before I exit the runtime and shutdown?</p>
<p>Also, how can it be sleeping if the event loop is clear? By event loop, I mean all the various queues (microtask, macrotask, etc.), including in my case the rust async queue with all my networking and stuffs</p></td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Thu Sep 15 2022 16:37:58 GMT-0700 (Pacific Daylight Time)">23:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@tcampbell:mozilla.org">tcampbell|ooo-thru-sept-24</span>&gt;</div></td><td class="msg-cell"><code>var pp = new Promise((r,j) =&gt; {})</code> makes a promise that stays pending forever as an example</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Thu Sep 15 2022 16:38:44 GMT-0700 (Pacific Daylight Time)">23:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@tcampbell:mozilla.org">tcampbell|ooo-thru-sept-24</span>&gt;</div></td><td class="msg-cell">so if your module awaited it, the module top-level evaluate would never complete, but you could still shutdown process cleanly</td></tr>

</tbody></table></div></div></div>
</body></html>