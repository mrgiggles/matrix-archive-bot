<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-11-13</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-11-13<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-11-12" class="nav-link"><span>prev</span></a>
<a href="2023-11-14" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Nov 13 2023 01:47:10 GMT-0800 (Pacific Standard Time)">09:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">R</span>: 1) how are you compiling spidermonkey? 2) Rust has been a requirement for a while now (for at least 3 years or so). There's not a lot of Rust in SM, but we do depend on it for some string encoding code for example</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Nov 13 2023 01:49:45 GMT-0800 (Pacific Standard Time)">09:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">timvde</span>: yes I skipped the last one, but should probably continue them at some point</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Nov 13 2023 01:54:57 GMT-0800 (Pacific Standard Time)">09:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-6">R</span>: 1) how are you compiling spidermonkey? 2) Rust has been a requirement for a while now (for at least 3 years or so). There's not a lot of Rust in SM, but we do depend on it for some string encoding code for example</blockquote></mx-reply>I've tried both ./mach build with <code>ac_add_options --enable-application=js</code> (following <a href="https://firefox-source-docs.mozilla.org/js/build.html">https://firefox-source-docs.mozilla.org/js/build.html</a> ) and the autoconf2.13 (which I cannot find the link to at the moment).</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Nov 13 2023 01:56:25 GMT-0800 (Pacific Standard Time)">09:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">I'm trying to build it on  Archlinux with rustup nightly (as I found it is required due to the -Z flag)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Nov 13 2023 01:57:04 GMT-0800 (Pacific Standard Time)">09:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">which spidermonkey version? you mean <code>--enable-project=js</code>?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Nov 13 2023 01:58:54 GMT-0800 (Pacific Standard Time)">09:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">I've tried both v115 and v102.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Nov 13 2023 02:01:01 GMT-0800 (Pacific Standard Time)">10:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> which spidermonkey version? you mean <code>--enable-project=js</code>?</blockquote></mx-reply>Oh. I missed that. Interesting. I did base myself for some part on the arch package build. <a href="https://gitlab.archlinux.org/archlinux/packaging/packages/js115/-/blob/main/PKGBUILD?ref_type=heads">https://gitlab.archlinux.org/archlinux/packaging/packages/js115/-/blob/main/PKGBUILD?ref_type=heads</a> Which does seem to write <code>ac_add_options --enable-application=js</code>.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Nov 13 2023 02:02:09 GMT-0800 (Pacific Standard Time)">10:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">R</span>: oh right, my own mozconfigs have <code>--enable-application=js</code> too so that part is fine</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Nov 13 2023 02:02:29 GMT-0800 (Pacific Standard Time)">10:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">you shouldn't need rust nightly, the gecko codebase only uses rust stable at most (there's special circumstances but I doubt you're running into them) </td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Nov 13 2023 02:06:06 GMT-0800 (Pacific Standard Time)">10:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-6">R</span>: oh right, my own mozconfigs have <code>--enable-application=js</code> too so that part is fine</blockquote></mx-reply>I see no change</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Nov 13 2023 02:08:36 GMT-0800 (Pacific Standard Time)">10:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yes I think <code>--enable-project</code> and <code>--enable-application</code> are aliases</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Nov 13 2023 02:12:59 GMT-0800 (Pacific Standard Time)">10:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> you shouldn't need rust nightly, the gecko codebase only uses rust stable at most (there's special circumstances but I doubt you're running into them) </blockquote></mx-reply>0:08.57 error: the <code>-Z</code> flag is only accepted on the nightly channel of Cargo, but this is the <code>stable</code> channel<br>
when using stable rust.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Nov 13 2023 02:43:32 GMT-0800 (Pacific Standard Time)">10:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you post the output of <code>./mach build</code> to <a href="https://paste.mozilla.org/">https://paste.mozilla.org/</a> ?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Nov 13 2023 02:44:36 GMT-0800 (Pacific Standard Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the issue would come from that the build system behave differently for nightly and others.  on nightly, it downloads necessary tools and use them.  on others (like esr, which is what you're using), by default, it uses tools provided by your system. and there might be something going wrong around it</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Nov 13 2023 02:55:41 GMT-0800 (Pacific Standard Time)">10:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't hit the error with rustc stable 1.72.1, on esr115.  the output of the <code>./mach build</code> would contain more info about when and how it hits the error</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Nov 13 2023 03:07:05 GMT-0800 (Pacific Standard Time)">11:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also there will be some more info in <code>obj-*/config.log</code> file, about what exact command and input the build system used</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Nov 13 2023 03:07:28 GMT-0800 (Pacific Standard Time)">11:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">R</span>: ^</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Nov 13 2023 06:35:49 GMT-0800 (Pacific Standard Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I don't hit the error with rustc stable 1.72.1, on esr115.  the output of the <code>./mach build</code> would contain more info about when and how it hits the error</blockquote></mx-reply><a href="https://paste.mozilla.org/0arLp1hN">https://paste.mozilla.org/0arLp1hN</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Nov 13 2023 06:37:28 GMT-0800 (Pacific Standard Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's your mozconfig?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Nov 13 2023 06:37:50 GMT-0800 (Pacific Standard Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the output says you have <code>--enable-thread-sanitizer</code> in it?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Nov 13 2023 06:39:02 GMT-0800 (Pacific Standard Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>if that's the case, then indeed, thread sanitizer uses -Z flag <a href="https://searchfox.org/mozilla-central/rev/fe8b30e982c86d26ccf1f14d825c0de870b91f27/config/makefiles/rust.mk#59-62">https://searchfox.org/mozilla-central/rev/fe8b30e982c86d26ccf1f14d825c0de870b91f27/config/makefiles/rust.mk#59-62</a></p>
<pre><code>ifdef MOZ_TSAN
cargo_build_flags += -Zbuild-std=std,panic_abort
RUSTFLAGS += -Zsanitizer=thread
endif
</code></pre>
</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Nov 13 2023 06:39:19 GMT-0800 (Pacific Standard Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">try building with simpler mozconfig first</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Nov 13 2023 07:27:08 GMT-0800 (Pacific Standard Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> what's your mozconfig?</blockquote></mx-reply>The good news is a simpler config does work. Thanks. How should I get it to work with thread sanitizer?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Nov 13 2023 07:29:52 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">just to be clear, thread sanitizer is a special config for debugging purpose.  do you really want it?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Nov 13 2023 07:31:03 GMT-0800 (Pacific Standard Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">Yeah. I'm working on race detection algorithms. I modify tsan on the compiler end (once I get it to compie normally first)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Nov 13 2023 07:31:54 GMT-0800 (Pacific Standard Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">R</span>: just making sure, you're following <a href="https://firefox-source-docs.mozilla.org/tools/sanitizer/tsan.html">https://firefox-source-docs.mozilla.org/tools/sanitizer/tsan.html</a> ?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Nov 13 2023 07:32:36 GMT-0800 (Pacific Standard Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I haven't seen it linked in this discussion and the rust toolchain override bit is important</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Nov 13 2023 07:33:29 GMT-0800 (Pacific Standard Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">I missed that part! Thanks!</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Nov 13 2023 07:34:28 GMT-0800 (Pacific Standard Time)">15:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I confirm those instructions work, as I've been doing TSAN builds recently, if it still doesn't compile / work after following them please tell us</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Nov 13 2023 07:35:31 GMT-0800 (Pacific Standard Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">Alright. Thank you very much! Can I safely replace ~/.mozbuild with $MOZBUILD_STATE_PATH ?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Nov 13 2023 07:35:49 GMT-0800 (Pacific Standard Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">note: depending on your desktop environment / system (hardware accelerate, software rendering, gnome version, whatever), and if you're attempting to run the browser (something you might not be doing if you're here), there might be more issues</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Nov 13 2023 07:35:58 GMT-0800 (Pacific Standard Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">R</span>: as long as you consistently do it it should work</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Nov 13 2023 07:37:03 GMT-0800 (Pacific Standard Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">Just the js engnine. I'm trying to follow the footsteps of papers that run spidermonkey / v8 on some js benchmarks from 2013. If there's a more up-to-date version that'd be nice.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Nov 13 2023 08:25:52 GMT-0800 (Pacific Standard Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: You've got a trio of patches adding out-of-memory catches inbound from me (to clean up some intermittents from running slow tests); but I honestly would be equally OK if the response was "just delete these tests, they're bad"</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Nov 13 2023 08:41:01 GMT-0800 (Pacific Standard Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: ah all three are pretty similar</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Nov 13 2023 08:41:23 GMT-0800 (Pacific Standard Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Yeah, same root test case, and then variants I imainge</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Nov 13 2023 08:46:17 GMT-0800 (Pacific Standard Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: stamped but I'm also fine with deleting at least 2 of them</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Nov 13 2023 09:24:51 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">Thanks! It compiled.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Nov 13 2023 11:09:30 GMT-0800 (Pacific Standard Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Regarding import module requests, how does mozjs handle relative file paths for imports?</td></tr>

</tbody></table></div></div></div>
</body></html>