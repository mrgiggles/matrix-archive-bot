<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-11-13</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-11-13<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-11-12" class="nav-link"><span>prev</span></a>
<a href="2024-11-14" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Nov 13 2024 06:33:31 GMT-0800 (Pacific Standard Time)">14:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Hi spidermonkey peoples, does phabricator support abandoning a revision in the middle of a stack?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Nov 13 2024 06:35:06 GMT-0800 (Pacific Standard Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Ms2ger</span>: I think I did that a while ago.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Nov 13 2024 06:35:46 GMT-0800 (Pacific Standard Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, you can abandon, but iiuc you need to fix the stack to exclude the revision</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Nov 13 2024 06:37:06 GMT-0800 (Pacific Standard Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I mean, in order to land the stack</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Nov 13 2024 06:37:46 GMT-0800 (Pacific Standard Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">I think it worked ðŸ¤ž</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Nov 13 2024 06:37:48 GMT-0800 (Pacific Standard Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Thanks</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Nov 13 2024 07:00:00 GMT-0800 (Pacific Standard Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: What might be possible for your approach would be to squash DOM changes. Except for few changes which are requiring a direct recomputation/invalidations, changes could be squashed in a "waiting" space to be applied before recomputing the layout. The operations which are requiring the recomputation of are also expensive, and this might be a way to hide the cost ahead of applying the changes. I do not know much about the DOM, and I bet there are more corner cases that I am not aware of, but this could be an interesting direction for trying vmenter/vmexit opcodes.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Nov 13 2024 07:03:12 GMT-0800 (Pacific Standard Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@lbe:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">thanks for this idea, I'll keep that in mind. if the research project actually takes off I'll come back with many more questions and issue</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Nov 13 2024 11:04:37 GMT-0800 (Pacific Standard Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">sfink: there's no reason to hold on to JS::EnableNurseryStrings, JS::EnableNurseryBigInts &amp; disable versions of those right? </td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Nov 13 2024 11:13:25 GMT-0800 (Pacific Standard Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@fkilic:mozilla.org">fkilic</span>&gt;</div></td><td class="msg-cell">It is probably a stupid question, but is there any way of converting JS::Value to bytes/string? (I'm assuming numbers and string would be easy to do, but not sure about objects)</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Nov 13 2024 11:15:45 GMT-0800 (Pacific Standard Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> It is probably a stupid question, but is there any way of converting JS::Value to bytes/string? (I'm assuming numbers and string would be easy to do, but not sure about objects)</blockquote></mx-reply>What do you mean by "bytes/string"?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Nov 13 2024 11:16:02 GMT-0800 (Pacific Standard Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Do you just want to get some vague idea for debugging, or do you want a perfect reversible serialization etc?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Nov 13 2024 11:17:26 GMT-0800 (Pacific Standard Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@fkilic:mozilla.org">fkilic</span>&gt;</div></td><td class="msg-cell">I want to extend AUTO_PROFILER_LABEL_DYNAMIC_FAST for my local build and want to export more stuff into profiler for some testing. I basically want to export all arguments passed into class constructors, methods, setters etc. So just for debugging, no need for perfect reversible serialization</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Nov 13 2024 11:18:55 GMT-0800 (Pacific Standard Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I want to extend AUTO_PROFILER_LABEL_DYNAMIC_FAST for my local build and want to export more stuff into profiler for some testing. I basically want to export all arguments passed into class constructors, methods, setters etc. So just for debugging, no need for perfect reversible serialization</blockquote></mx-reply>There's JS_ValueToSource but it kind of misses like anything from the last decade so it can miss stuff which is annoying.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Nov 13 2024 11:20:04 GMT-0800 (Pacific Standard Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: Hm. The only use I can think of those is for testing. I think it's fine to get rid of them, as long as we can still disable them via prefs.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Nov 13 2024 11:21:02 GMT-0800 (Pacific Standard Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I want to extend AUTO_PROFILER_LABEL_DYNAMIC_FAST for my local build and want to export more stuff into profiler for some testing. I basically want to export all arguments passed into class constructors, methods, setters etc. So just for debugging, no need for perfect reversible serialization</blockquote></mx-reply>Nothing is going to provide perfect fidelity, but I guess you could use JSON. It might dump more than you want, though.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Nov 13 2024 11:22:45 GMT-0800 (Pacific Standard Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, <a href="https://searchfox.org/mozilla-central/rev/55837bbe3e47f9b4fa91ef83a44b53823626f01d/js/src/jsapi.h#123">JS_ValueToSource</a> or <a href="https://searchfox.org/mozilla-central/rev/55837bbe3e47f9b4fa91ef83a44b53823626f01d/js/public/Conversions.h#256">JS::ToString</a> for converting random value to some printable string with JSString type, and then <a href="https://searchfox.org/mozilla-central/rev/55837bbe3e47f9b4fa91ef83a44b53823626f01d/js/public/CharacterEncoding.h#426">JS_EncodeStringToUTF8</a> to convert JSString type to char array</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Nov 13 2024 11:23:57 GMT-0800 (Pacific Standard Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">nsContentUtils::StringifyJSON() can produce something at least somewhat usable. Sometimes.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Nov 13 2024 11:25:10 GMT-0800 (Pacific Standard Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">note that the conversion can execute JS if the value has getter or toString method</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Nov 13 2024 11:25:52 GMT-0800 (Pacific Standard Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@fkilic:mozilla.org">fkilic</span>&gt;</div></td><td class="msg-cell">Hmm I see. Alright, thanks everyone!</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Nov 13 2024 12:09:33 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@julienw:mozilla.org">julienw</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">@fkilic:mozilla.org</span>: depending where you're trying to do, maybe the devtools jstracer functionality might be useful to you. You can enable it in the profiler in about:profiling. A little bit experimental still </td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Nov 13 2024 12:12:21 GMT-0800 (Pacific Standard Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@fkilic:mozilla.org">fkilic</span>&gt;</div></td><td class="msg-cell">yep that's exactly what I'm trying to extend. I want to get what values are set to and method arguments etc. So I'm trying to modify <code>dom/bindings/<a href="http://Codegen.py">Codegen.py</a></code> to print out arguments and stuff, then I'll try to plumb it to TraceLabel or some other function. Just trying to extend it for some testing</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Nov 13 2024 12:45:15 GMT-0800 (Pacific Standard Time)">20:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">mgaudet</span>: Hm. The only use I can think of those is for testing. I think it's fine to get rid of them, as long as we can still disable them via prefs.</blockquote></mx-reply>So currently we can only set this via the shell options. Removing these API functions wouldn't be a regression at least</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Nov 13 2024 12:53:49 GMT-0800 (Pacific Standard Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ok, well it looks like we can use at least startup prefs without exposing public functions, so I'm still good with removing them.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Nov 13 2024 12:57:14 GMT-0800 (Pacific Standard Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">KK. Will write PR eventually :) </td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Nov 13 2024 13:44:14 GMT-0800 (Pacific Standard Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: thanks! element didn't notify your messages... I checked the code, incumbent global should be non-null when host defined object exists</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Nov 13 2024 13:48:24 GMT-0800 (Pacific Standard Time)">21:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">I think I could add a null check to avoid the crash or I could add some diagnostic assertions to try to locate where it becomes null, what do you think?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Nov 13 2024 13:49:13 GMT-0800 (Pacific Standard Time)">21:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: Is the reasoning behind discardingJitCode on discard written down somewhere?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Nov 13 2024 13:50:29 GMT-0800 (Pacific Standard Time)">21:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">"on discard"? On GC? On compaction?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Nov 13 2024 13:50:59 GMT-0800 (Pacific Standard Time)">21:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">erm on compaction</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Nov 13 2024 13:51:21 GMT-0800 (Pacific Standard Time)">21:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">sorry -- something bingled as I was typing and clearly I tossed my thought through a grinder</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Nov 13 2024 13:53:21 GMT-0800 (Pacific Standard Time)">21:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I don't think it's written down anywhere. I could write it down in dis card, but then you wouldn't be able to read it because it's here and you're not. I mean, I think the idea is that when compacting we're trying to minimize memory use (even if the actually used stuff is going to be regenerated). But it's also a trigger for a non-minor moving GC, and I don't know if jitcode can update itself for that?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Nov 13 2024 13:53:29 GMT-0800 (Pacific Standard Time)">21:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">in short, you're right that it should be written down</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Nov 13 2024 13:53:33 GMT-0800 (Pacific Standard Time)">21:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">afaik, it is not</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Nov 13 2024 13:54:34 GMT-0800 (Pacific Standard Time)">21:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">and how did you tell that address came from interpreting UndefinedValue as ObjectValue? </td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Nov 13 2024 13:54:46 GMT-0800 (Pacific Standard Time)">21:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I guess partially I'm trying to figure out if it's possible to fail if we compact without discarding JIT code. (I'm looking into JIT discard heuristics, and want to try and draw the line between "must discard for functional reasons" and "this was a discard heuristic" )</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Nov 13 2024 13:56:13 GMT-0800 (Pacific Standard Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm not sure. jit people, do you know? ( <span class="nick-4">iain</span> <span class="nick-10">jandem</span> ). jonco would know.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Nov 13 2024 13:56:51 GMT-0800 (Pacific Standard Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(The functional evidence I have at the moment is that I commented out the discard and have been running jit-tests, and thus-far haven't actually found a crash, but it could just be that the jit-flags I'm using won't generally do it) </td></tr>

</tbody></table></div></div></div>
</body></html>