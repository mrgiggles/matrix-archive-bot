<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-05-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-05-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-05-15" class="nav-link"><span>prev</span></a>
<a href="2025-05-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri May 16 2025 05:10:45 GMT-0700 (Pacific Daylight Time)">12:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bas:mozilla.org">Bas</span>&gt;</div></td><td class="msg-cell">Hi, I was looking at <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1963578">https://bugzilla.mozilla.org/show_bug.cgi?id=1963578</a>. That profile definitely shows something bad, because of buffer size constraints we only get the last bits, but there's almost exclusively JS running, and it shows some reeeaaally deep recursive stacks in a single function.. Anyone know if that could somehow be a Firefox or site bug? It seems odd that Chrome would be orders of magnitude faster.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri May 16 2025 05:17:06 GMT-0700 (Pacific Daylight Time)">12:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bas:mozilla.org">Bas</span>&gt;</div></td><td class="msg-cell">Trying to reproduce this, it says this shouldn't happen :P</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri May 16 2025 05:26:50 GMT-0700 (Pacific Daylight Time)">12:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">code is <code>function Rv(e,t,n=!1){const r=e.getNodeByIdOrMessageId(t),o=r.id!==e.rootId?Rv(e,r.parentId,n):YM,s=r.message,i=jh.get(o,s);if(i)return i;const a=ZM(o,s,n);return jh.set(o,s,a),a}</code> there's clearly a recursion</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri May 16 2025 05:30:19 GMT-0700 (Pacific Daylight Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bas:mozilla.org">Bas</span>&gt;</div></td><td class="msg-cell">Right, I guess a better formulated question is whether there's any reason for this recursion to run deeper, or be more expensive in Firefox vs Chrome.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri May 16 2025 05:30:47 GMT-0700 (Pacific Daylight Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bas:mozilla.org">Bas</span>&gt;</div></td><td class="msg-cell">This seems like just some framework DOM nonsense to me, but I could be wrong.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri May 16 2025 05:40:46 GMT-0700 (Pacific Daylight Time)">12:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I can repro, you just need a long conversation</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri May 16 2025 05:41:26 GMT-0700 (Pacific Daylight Time)">12:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">It could be that Chrome blows through the stack very quickly and so it doesn't get bogged down in this call. We had a similar kind of issue with a regular expression before, where Chrome just had tighter limits so it gave up before it spent much time.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri May 16 2025 05:42:19 GMT-0700 (Pacific Daylight Time)">12:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">from the look of it, it makes one recursive call per message of the conversation until it reaches the beginning, at least the order of magnitude looks right in my case</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri May 16 2025 06:33:39 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>: what's the expected behavior of <code>topLevel</code> option in <a href="https://phabricator.services.mozilla.com/D249679">https://phabricator.services.mozilla.com/D249679</a> ?  can you add a document?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri May 16 2025 07:30:04 GMT-0700 (Pacific Daylight Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">Will do!</td></tr>

</tbody></table></div></div></div>
</body></html>