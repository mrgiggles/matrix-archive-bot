<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-11-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-11-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-11-15" class="nav-link"><span>prev</span></a>
<a href="2023-11-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Nov 15 2023 16:32:05 GMT-0800 (Pacific Standard Time)">00:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: for <code>SetNonexistentProperty()</code> time under <code>completeWork()</code> we wanted to know if it's setting a property for the first time or not. Do you have any suggestions for how to check this?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Nov 16 2023 07:54:52 GMT-0800 (Pacific Standard Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">Is there a test suite that I can use to execute thread sanitizer with? Turns out the benhcmarks I planned to execute are not multi-threaded in any way.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Nov 16 2023 08:04:44 GMT-0800 (Pacific Standard Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what type of multi-thread situation are you looking into?  JS shell itself uses multi-thread for GC and compilation</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Nov 16 2023 08:07:56 GMT-0800 (Pacific Standard Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if it's about the situation where JS code executes in multiple threads (like Web Workers), then I'm not aware of thread-heavy suite for JS shell.  but some of existing jstests and jit-test testcases uses worker thread</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Nov 16 2023 08:13:32 GMT-0800 (Pacific Standard Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">I think what I need is something that would stress the multi-threaded code of the js shell itself.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 16 2023 08:17:39 GMT-0800 (Pacific Standard Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">running the entire jstests and jit-tests with all option variants would sufficiently cover the multi-threaded code (except for things that interacts with gecko).  it doesn't specifically focus on the multi-threaded part tho</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 16 2023 08:19:54 GMT-0800 (Pacific Standard Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that's what done by the tsan job in automation e.g. <a href="https://treeherder.mozilla.org/jobs?repo=mozilla-central&amp;tier=1%2C2%2C3&amp;searchStr=spider%2Ctsan&amp;revision=30972f1e5f790da2db4cf542e49e522275787122&amp;selectedTaskRun=Qr9gY8h8R-GVSBaGA7LvrQ.0">https://treeherder.mozilla.org/jobs?repo=mozilla-central&amp;tier=1%2C2%2C3&amp;searchStr=spider%2Ctsan&amp;revision=30972f1e5f790da2db4cf542e49e522275787122&amp;selectedTaskRun=Qr9gY8h8R-GVSBaGA7LvrQ.0</a></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 16 2023 08:35:23 GMT-0800 (Pacific Standard Time)">16:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">I'll try that! Thanks.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 16 2023 08:40:32 GMT-0800 (Pacific Standard Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">If I want to run them directly without mach, simply point the js exec at any .js file in the tests / jit-tests folder. Right?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 16 2023 08:42:25 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">jit-test can be run by running <code>js/src/jit-test/jit_test.py JS_SHELL_PATH TESTS</code></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 16 2023 08:42:46 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you omit TESTS, then all tests are executed,  if you pass, it's substring match against the test path</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 16 2023 08:43:19 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">jstests may require <code>mach</code></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 16 2023 08:43:45 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">either <code>./mach jstests ...</code> or <code>cd js/src/tests; ../../../mach python <a href="http://jstests.py">jstests.py</a> ...</code></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Nov 16 2023 08:44:49 GMT-0800 (Pacific Standard Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">If I compiled with the script at <a href="https://firefox-source-docs.mozilla.org/tools/sanitizer/tsan.html">https://firefox-source-docs.mozilla.org/tools/sanitizer/tsan.html</a> (which uses a custom folder), how do I point mach at the binary?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Nov 16 2023 08:47:05 GMT-0800 (Pacific Standard Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>../../../mach python <a href="http://jstests.py">jstests.py</a> JS_SHELL_PATH</code>, according to <a href="https://searchfox.org/mozilla-central/rev/f78093864e287014db7ac9383bb76c45edbf8559/js/src/tests/jstests.py#400">jstests.py</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Nov 16 2023 08:47:37 GMT-0800 (Pacific Standard Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, the above jit_test command was wrong</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Nov 16 2023 08:48:48 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">fixed</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Nov 16 2023 08:49:23 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@r:m.wfr.moe">R</span>&gt;</div></td><td class="msg-cell">Thank you very much!</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Nov 16 2023 08:52:49 GMT-0800 (Pacific Standard Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">you can also use the <code>-s</code> flag to make it display the command lines for running the JS shell directly. It's not always as simple as running a single .js file; sometimes it needs to load in other stuff, and some thing are set up with immediate scripts on the command line.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Nov 16 2023 09:38:33 GMT-0800 (Pacific Standard Time)">17:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-4">iain</span>: for <code>SetNonexistentProperty()</code> time under <code>completeWork()</code> we wanted to know if it's setting a property for the first time or not. Do you have any suggestions for how to check this?</blockquote></mx-reply>That is a very good question. There are a few ways to check if an object has a property yet or not. Making it easy to tell for that particular callsite is a little harder, but maybe we can split SetNonexistentProperty into two versions depending on whether it's the first property or not. Let me try writing up a quick and dirty patch.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Nov 16 2023 09:46:33 GMT-0800 (Pacific Standard Time)">17:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">jrmuizel</span>: <a href="https://prod.pastebin.prod.webservices.mozgcp.net/qCUakOGy">This patch</a> adds SetNonexistentFirstProperty and SetNonexistentNextProperty, and calls the appropriate one from SetNonexistentProperty. I think that should let us tell what's going on at your call site by looking at the profile.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Nov 16 2023 10:18:11 GMT-0800 (Pacific Standard Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: perfect. Thanks</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Nov 16 2023 10:47:00 GMT-0800 (Pacific Standard Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: Would you be able to stamp <a href="https://github.com/mozilla-spidermonkey/spidermonkey.dev/pull/149">https://github.com/mozilla-spidermonkey/spidermonkey.dev/pull/149</a> -- I didn't land one of dan's posts for a month, and it would be good to have a publication date that's not a month in the past</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Nov 16 2023 10:47:40 GMT-0800 (Pacific Standard Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Oh hold on -- I goofed with my gitting</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Nov 16 2023 10:48:43 GMT-0800 (Pacific Standard Time)">18:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">There. </td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Nov 16 2023 10:56:54 GMT-0800 (Pacific Standard Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(Sorry, had to navigate the authentication jungle.)</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Nov 16 2023 11:00:37 GMT-0800 (Pacific Standard Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Awesome. Much appreciated.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Nov 16 2023 11:00:54 GMT-0800 (Pacific Standard Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><a href="https://spidermonkey.dev/blog/2023/11/16/spidermonkey-byte-sized-architectures.html">https://spidermonkey.dev/blog/2023/11/16/spidermonkey-byte-sized-architectures.html</a> for you <span class="nick-9">dminor</span></td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Nov 16 2023 11:00:59 GMT-0800 (Pacific Standard Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">apologies again for the delay :) </td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Nov 16 2023 11:01:08 GMT-0800 (Pacific Standard Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">Thanks :)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Nov 16 2023 13:19:06 GMT-0800 (Pacific Standard Time)">21:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Outside of testing code, <a href="https://searchfox.org/mozilla-central/source/__GENERATED__/dom/bindings/HTMLAllCollectionBinding.cpp#1208-1219">this</a> is the only class that uses JSCLASS_EMULATES_UNDEFINED, and the only use of that class is in a call to CreateProxyObject <a href="https://searchfox.org/mozilla-central/source/__GENERATED__/dom/bindings/HTMLAllCollectionBinding.cpp#1285">here</a>. Does that mean that <a href="https://searchfox.org/mozilla-central/source/js/src/jit/MacroAssembler-inl.h#561-563">this code</a> (checking whether a non-proxy object emulates undefined) is dead code in production?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Nov 16 2023 14:13:09 GMT-0800 (Pacific Standard Time)">22:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I think so :) So that's something.</td></tr>

</tbody></table></div></div></div>
</body></html>