<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-06-20</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-06-20<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-06-19" class="nav-link"><span>prev</span></a>
<a href="2022-06-21" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Jun 19 2022 22:02:46 GMT-0700 (Pacific Daylight Time)">05:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell">Does anyone know if in Firefox we create any "mirrored" memory mappings for any reason?  Different virtual addresses mapped to the same physical address?  Eg would we map the same phsycal memory as r+x in one place and r+w in another? (that's probably confuse the seperate I &amp; D caches)</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jun 20 2022 02:02:00 GMT-0700 (Pacific Daylight Time)">09:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">pbone</span>: while I don't known about the usage of synonymous memory mappings in firefox/spidermonkey I've been using them in the past for implementing pointer tagging. are there any tickets on file describing what you intend to implement?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jun 20 2022 04:33:52 GMT-0700 (Pacific Daylight Time)">11:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell">Oh, that's not my goal.  I'm trying to properly calculate our resident unique memory usage from MacOS's APIs and don't want to count aliased memory twice.  But if we don't currently do anything like that then I don't have to worry about that edge-case.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jun 20 2022 04:35:58 GMT-0700 (Pacific Daylight Time)">11:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell">The problem is that in MacOS if you have a mapping for 3 pages, and you <code>mprotect()</code> the middle page (eg to create a guard page) then the mappings on either side get changed from private mappings to aliased mappings.  They map different pages but they came from the same original mapping, they should be counted in resident-unique.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jun 20 2022 08:21:08 GMT-0700 (Pacific Daylight Time)">15:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">Does Spidermonkey have a JIT optionality?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jun 20 2022 08:28:43 GMT-0700 (Pacific Daylight Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">pbone</span>: I am not aware of us using that. I know this has been used in the past by some moving garbage collector, to move object while making a fault on write for attempts to write on moved objects, to get the relocation address.<br>I also tried in the past (12y ago?), using this technique to reduce the overhead induced by memory consistency model of CPU, which did not play nicely with the prefecthing capabilities of modern CPUs.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jun 20 2022 08:29:22 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">pastah</span>: SpiderMOnkey JIT can be disabled, through the API when embedded, through the command line when using the shell, or with about:config in Firefox.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jun 20 2022 08:30:46 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">What is the API function for enabling/disabling JIT?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jun 20 2022 08:31:09 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">pastah</span>: We also have a configure toggle to disable the JIT, useful for architecture which do not yet have a JIT backend.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jun 20 2022 08:31:38 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-14">pastah</span>: We also have a configure toggle to disable the JIT, useful for architecture which do not yet have a JIT backend.</blockquote></mx-reply>configure toggle as in a compilation configure option?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jun 20 2022 08:33:05 GMT-0700 (Pacific Daylight Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/cc98a15c7327d742d283cddddde712a8a3165006/js/src/vm/Initialization.cpp#341">JS::DisableJitBackend</a>, and <a href="https://searchfox.org/mozilla-central/source/js/moz.configure#172">--disable-jit</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jun 20 2022 09:55:41 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">Does Spidermonkey have different execution modes like Global and Modules?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jun 20 2022 09:56:36 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">yes, we have different compile function in our API.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jun 20 2022 09:58:52 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">does that affect whether you can use <code>import {sleep} from 'os';</code>? I notice <code>import</code> breaks</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jun 20 2022 10:01:38 GMT-0700 (Pacific Daylight Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>import</code> syntax is valid only in module</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jun 20 2022 10:05:19 GMT-0700 (Pacific Daylight Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can anyone give me write access to <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples</a> ?  or can anyone land my PRs that got r+?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jun 20 2022 11:23:03 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: I have the permission bit to land them, so I can do it if you want. I left them unmerged because I wasn't sure whether I count as enough of a reviewer ðŸ˜„</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jun 20 2022 11:25:20 GMT-0700 (Pacific Daylight Time)">18:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I think the configure PR is ready, and it's better merge soon, given it blocks newcomer</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jun 20 2022 14:22:09 GMT-0700 (Pacific Daylight Time)">21:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@nick0ve:mozilla.org">nick0ve</span>&gt;</div></td><td class="msg-cell">Hi, can anybody point me any resources about js::Nursery? Like an highlevel overview of what it is supposed to achieve / where it is used</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jun 20 2022 14:23:11 GMT-0700 (Pacific Daylight Time)">21:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@nick0ve:mozilla.org">nick0ve</span>&gt;</div></td><td class="msg-cell">Also any other technical resource about spidermonkey memory management would be appreciated</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jun 20 2022 14:28:59 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">nick0ve</span>: there's a paragraph that mentions it <a href="https://firefox-source-docs.mozilla.org/js/gc.html#generational-collection">https://firefox-source-docs.mozilla.org/js/gc.html#generational-collection</a></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jun 20 2022 14:29:52 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also a blog post that explains Generational Garbage Collection <a href="https://hacks.mozilla.org/2014/09/generational-garbage-collection-in-firefox/">https://hacks.mozilla.org/2014/09/generational-garbage-collection-in-firefox/</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jun 20 2022 14:33:44 GMT-0700 (Pacific Daylight Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@nick0ve:mozilla.org">nick0ve</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-13">nick0ve</span>: there's a paragraph that mentions it <a href="https://firefox-source-docs.mozilla.org/js/gc.html#generational-collection">https://firefox-source-docs.mozilla.org/js/gc.html#generational-collection</a></blockquote></mx-reply>Thank you</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Jun 20 2022 16:23:52 GMT-0700 (Pacific Daylight Time)">23:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-10">pbone</span>: I am not aware of us using that. I know this has been used in the past by some moving garbage collector, to move object while making a fault on write for attempts to write on moved objects, to get the relocation address.<br>I also tried in the past (12y ago?), using this technique to reduce the overhead induced by memory consistency model of CPU, which did not play nicely with the prefecthing capabilities of modern CPUs.</blockquote></mx-reply>Thanks, Yeah, I think GC and JIT might be the most common reasons to do this.  (Even though JIT may be totally invalid for I&amp;D caches being seperate)  glandium pointed out that someone could be using it for a circular buffer.  I think I'll take my chance and assume we don't do this (very much).</td></tr>

</tbody></table></div></div></div>
</body></html>