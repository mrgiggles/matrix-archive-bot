<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-11-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-11-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-11-15" class="nav-link"><span>prev</span></a>
<a href="2024-11-19" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Nov 18 2024 07:28:39 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: <span class="nick-2">nika</span> back to my attempt to send back the compiled WASM module from the worker to the main thread (I used a message channel in the last attempt) -- <span class="nick-12">padenot|off</span> was kind enough to run it on his box and upload a pernosco profile <a href="https://pernos.co/debug/KVaNGAyX6UIizLMDhDTRrQ/index.html#f{m[Ahst,7wI_,t[0w,70A_,f{e[Ahst,7vU_,s{afAtwoAAA,bAZY,uKwTKGg,oKxueNw___/">https://pernos.co/debug/KVaNGAyX6UIizLMDhDTRrQ/index.html#f{m[Ahst,7wI_,t[0w,70A_,f{e[Ahst,7vU_,s{afAtwoAAA,bAZY,uKwTKGg,oKxueNw___/</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Nov 18 2024 07:29:32 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">the failure happens on <a href="https://searchfox.org/mozilla-central/source/dom/messagechannel/MessagePort.cpp#115">assertion</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Nov 18 2024 07:31:13 GMT-0800 (Pacific Standard Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">on a side note, Paul also suggested to create an URL with the array buffer and pass it through. <span class="nick-16">Ryan Hunt</span> in that case would this make it cacheable across the board for all workers with zero extra prep work ?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Nov 18 2024 07:43:00 GMT-0800 (Pacific Standard Time)">15:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Don't we have alternate data to provide some caching for WebAssembly? I would expect it to work if we have no service worker, and that the alternate data is saved in Necko.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Nov 18 2024 07:43:14 GMT-0800 (Pacific Standard Time)">15:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: how do you serve the WebAssembly code?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Nov 18 2024 07:43:48 GMT-0800 (Pacific Standard Time)">15:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">it's an array buffer I pull directly from remote settings</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Nov 18 2024 07:44:20 GMT-0800 (Pacific Standard Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">and the array buffer contains the WebAssembly code?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Nov 18 2024 07:47:42 GMT-0800 (Pacific Standard Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Nov 18 2024 07:56:41 GMT-0800 (Pacific Standard Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Do we have anything like godbolt for sharing SpiderMonkey examples?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Nov 18 2024 07:58:41 GMT-0800 (Pacific Standard Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">we used to, but it wasn't used much so it was decomissionned</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Nov 18 2024 08:00:05 GMT-0800 (Pacific Standard Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">do you mean JS code snippets? or SM embedding examples?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Nov 18 2024 08:00:06 GMT-0800 (Pacific Standard Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: I do not know if using the file API would help. Necko provides the alternate data stream to save the compiled bytes, but the File API not being persistent, we probably have not implemented the alternate data api for it.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Nov 18 2024 08:00:48 GMT-0800 (Pacific Standard Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">I think that'd be a problem from a security POV</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Nov 18 2024 08:01:25 GMT-0800 (Pacific Standard Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Well, the alternate data is anything made by the browser for it-self.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Nov 18 2024 08:01:52 GMT-0800 (Pacific Standard Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-16">Ryan Hunt</span>: <span class="nick-2">nika</span> back to my attempt to send back the compiled WASM module from the worker to the main thread (I used a message channel in the last attempt) -- <span class="nick-12">padenot|off</span> was kind enough to run it on his box and upload a pernosco profile <a href="https://pernos.co/debug/KVaNGAyX6UIizLMDhDTRrQ/index.html#f{m[Ahst,7wI_,t[0w,70A_,f{e[Ahst,7vU_,s{afAtwoAAA,bAZY,uKwTKGg,oKxueNw___/">https://pernos.co/debug/KVaNGAyX6UIizLMDhDTRrQ/index.html#f{m[Ahst,7wI_,t[0w,70A_,f{e[Ahst,7vU_,s{afAtwoAAA,bAZY,uKwTKGg,oKxueNw___/</a></blockquote></mx-reply>Just above that assertion I see this: <a href="https://searchfox.org/mozilla-central/source/dom/ipc/SharedMessageBody.cpp#73-77">https://searchfox.org/mozilla-central/source/dom/ipc/SharedMessageBody.cpp#73-77</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Nov 18 2024 08:01:52 GMT-0800 (Pacific Standard Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I am not sure anymore, but maybe service workers provide the alternate data API.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Nov 18 2024 08:02:18 GMT-0800 (Pacific Standard Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">so it looks like the message channel intentionally is disallowing wasm modules</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Nov 18 2024 08:02:55 GMT-0800 (Pacific Standard Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> on a side note, Paul also suggested to create an URL with the array buffer and pass it through. <span class="nick-16">Ryan Hunt</span> in that case would this make it cacheable across the board for all workers with zero extra prep work ?</blockquote></mx-reply>what do you mean by creating a URL with the array buffer? how would that work?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Nov 18 2024 08:03:51 GMT-0800 (Pacific Standard Time)">16:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">our caching system works by storing the optimized code in the network 'alt data' cache (as nbp mentioned). So if the URL thing you're talking about connects to that, it would work. But I'm not an expert here</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Nov 18 2024 08:04:06 GMT-0800 (Pacific Standard Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">arraybuffer -&gt; Blob -&gt; URL</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Nov 18 2024 08:04:10 GMT-0800 (Pacific Standard Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/dom/fetch/FetchDriver.cpp#1255-1266">https://searchfox.org/mozilla-central/source/dom/fetch/FetchDriver.cpp#1255-1266</a></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Nov 18 2024 08:04:13 GMT-0800 (Pacific Standard Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">but I don't know if it's been considered</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Nov 18 2024 08:04:37 GMT-0800 (Pacific Standard Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">it's something we do often in media land for various reasons so I suggested it, but I haven't tested</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Nov 18 2024 08:05:02 GMT-0800 (Pacific Standard Time)">16:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">I'm guessing that would not connect to the network alt data cache? but TBH I don't know</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Nov 18 2024 08:05:43 GMT-0800 (Pacific Standard Time)">16:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><del>Apparently this has not been implemented in ServiceWorker either :/</del><br><a href="https://searchfox.org/mozilla-central/query/default?q=inheritance-diagram%3A%27nsICacheInfoChannel%27%20depth%3A4">https://searchfox.org/mozilla-central/query/default?q=inheritance-diagram%3A%27nsICacheInfoChannel%27%20depth%3A4</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Nov 18 2024 08:06:40 GMT-0800 (Pacific Standard Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">I guess I'm curious why message channel is disallowing wasm modules</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Nov 18 2024 08:06:56 GMT-0800 (Pacific Standard Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><code>IntercepterHttpChannel</code> are service workers, but I am not sure if it provides the alternate data storage in case of manually registered WebAssembly code.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Nov 18 2024 08:07:16 GMT-0800 (Pacific Standard Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">if it's all in the same process, we should be able to share a wasm module</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Nov 18 2024 08:07:30 GMT-0800 (Pacific Standard Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">SAB certainly works though so I'm not sure about the comment</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Nov 18 2024 08:07:59 GMT-0800 (Pacific Standard Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">would that comment refer to something cross <em>process</em> ? tarek mentioned something weird with his workload</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Nov 18 2024 08:08:08 GMT-0800 (Pacific Standard Time)">16:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">the pernosco link will show what's up with that</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Nov 18 2024 08:09:49 GMT-0800 (Pacific Standard Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">padenot|off</span>: (first, aren't you "off") second, do you happen to know what channel implementation is used for these URL objects?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Nov 18 2024 08:10:09 GMT-0800 (Pacific Standard Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">oh I see more comments in there about allowing wasm modules when they're in the same agent cluster. I should have read more</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Nov 18 2024 08:10:32 GMT-0800 (Pacific Standard Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">I'm not able to access the pernosco trace. It says I'm not authorized</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Nov 18 2024 08:11:35 GMT-0800 (Pacific Standard Time)">16:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@padenot:mozilla.org">padenot|off</span>&gt;</div></td><td class="msg-cell">not off anymore</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Nov 18 2024 08:12:56 GMT-0800 (Pacific Standard Time)">16:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: I think you need to authorize pernosco via github's auth, and the github account needs to be linked to the moz SSO</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Nov 18 2024 08:14:19 GMT-0800 (Pacific Standard Time)">16:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">but that should be fairly straightforward it should redirect to the right pages, not sure what's up</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Nov 18 2024 08:15:13 GMT-0800 (Pacific Standard Time)">16:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I guess this is likely to be a <a href="https://searchfox.org/mozilla-central/query/default?q=inheritance-diagram%3A%27nsIChannel%27+depth%3A4"><code>BlobURLChannel</code></a>, which does not implement the <a href="https://searchfox.org/mozilla-central/query/default?q=inheritance-diagram%3A%27nsICacheInfoChannel%27%20depth%3A4"><code>nsICacheInfoChannel</code></a>. So I suspect there would be no caching of the generated code on it, unless it is registered in a ServiceWorker.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Nov 18 2024 08:23:23 GMT-0800 (Pacific Standard Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> at least, I don't think I pushed that yet</blockquote></mx-reply>Yeah, it's still compressed, but I think that's fine?</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Nov 18 2024 08:28:09 GMT-0800 (Pacific Standard Time)">16:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-16">Ryan Hunt</span>: I think you need to authorize pernosco via github's auth, and the github account needs to be linked to the moz SSO</blockquote></mx-reply>I -think- just need a confirmed @<a href="http://mozilla.com">mozilla.com</a> email on your github profile</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Nov 18 2024 08:28:22 GMT-0800 (Pacific Standard Time)">16:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-16">Ryan Hunt</span>: I think you need to authorize pernosco via github's auth, and the github account needs to be linked to the moz SSO</blockquote></mx-reply>Ah, I was authenticated with moz SSO, but I didn't have a confirmed @<a href="http://Mozilla.com">Mozilla.com</a> email</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Nov 18 2024 08:29:04 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">I have not used pernosco since 2018... let's see if I remember</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Nov 18 2024 08:29:09 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">lmk if you need help navigating pernosco</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Nov 18 2024 08:30:51 GMT-0800 (Pacific Standard Time)">16:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">you might be interested in <code>All processes</code> tool to confirm/infirm the process thing</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Nov 18 2024 08:49:27 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-13">Tarek</span> <span class="nick-2">padenot</span> : It looks like this line [1] is not running and so when we decode the message we're not able to decode wasm. the issue is that global-&gt;getAgentClusterId() on line 87 is returning nothing because it the global object this message is read on is a BackstagePass which doesn't have an agent cluster ID. The source of this message does have an ID.</p>
<p>[1] <a href="https://searchfox.org/mozilla-central/source/dom/ipc/SharedMessageBody.cpp#90">https://searchfox.org/mozilla-central/source/dom/ipc/SharedMessageBody.cpp#90</a></p>
</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Nov 18 2024 08:49:51 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(I too can pair pernosco wise should the need be there :) )</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon Nov 18 2024 08:50:34 GMT-0800 (Pacific Standard Time)">16:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">Tarek</span>: where are you reading this message from? Is a global of BackstagePass expected here?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon Nov 18 2024 08:51:56 GMT-0800 (Pacific Standard Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">BackstagePass is some sort of XPConnect thing that I never bothered learning about</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon Nov 18 2024 08:53:14 GMT-0800 (Pacific Standard Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">oh wait, the BackstagePass global is coming from a call to  xpc::CurrentNativeGlobal(aCx);</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon Nov 18 2024 08:55:11 GMT-0800 (Pacific Standard Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">which is getting its value from MessagePort::getparentobject</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon Nov 18 2024 09:18:58 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">sorry I am back now</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon Nov 18 2024 09:20:13 GMT-0800 (Pacific Standard Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell">BackstagePass ? not sure. I am sending the Module through postMessage</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon Nov 18 2024 09:21:34 GMT-0800 (Pacific Standard Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p>the worker is mostly doing:</p>
<pre><code>    const wasmModule = await WebAssembly.compile(arrayBuffer);
    port.postMessage({ module: wasmModule });
</code></pre>
</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon Nov 18 2024 09:23:10 GMT-0800 (Pacific Standard Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@tarek:mozilla.org">Tarek</span>&gt;</div></td><td class="msg-cell"><p>and the main thread:</p>
<pre><code>    const worker = new Worker(
      "chrome://global/content/ml/WASMCompile.worker.mjs"
    );

    const messageChannel = new MessageChannel();
    messageChannel.port1.onmessage = event =&gt; {
      if (event.data.error) {
        reject(event.data.error);
        worker.terminate();
      } else {
        resolve(event.data.module);
        worker.terminate();
      }
    };
    worker.postMessage(
      {
        arrayBuffer,
        port: messageChannel.port2,
      },
      [arrayBuffer, messageChannel.port2]
    );
</code></pre>
</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon Nov 18 2024 09:28:03 GMT-0800 (Pacific Standard Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> BackstagePass is some sort of XPConnect thing that I never bothered learning about</blockquote></mx-reply>Backstage pass is roughly the class of chrome JS globals</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon Nov 18 2024 09:28:20 GMT-0800 (Pacific Standard Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">The name is pretty bad.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon Nov 18 2024 09:29:13 GMT-0800 (Pacific Standard Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">oh thanks, that helps</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon Nov 18 2024 15:10:04 GMT-0800 (Pacific Standard Time)">23:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: I don't have the access yet, but I am told that many urls look like<code>moz-extension://69a57da7-a4b5-4c24-ac9e-132fd72dc335/popup/index.html?uilocation=popout&amp;singleActionPopout=auth_unlockExtension#/lock</code></td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon Nov 18 2024 15:10:31 GMT-0800 (Pacific Standard Time)">23:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">extension + popup? not sure if it rings any bell..</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon Nov 18 2024 15:11:48 GMT-0800 (Pacific Standard Time)">23:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">sefeng</span>: Do you have a link to a crash report? I have access to crash data, some experience digging in, and some free time while my tests run</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon Nov 18 2024 15:12:39 GMT-0800 (Pacific Standard Time)">23:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Is it this one? <a href="https://crash-stats.mozilla.org/report/index/33592329-04f5-4205-83a7-ce7820241108">https://crash-stats.mozilla.org/report/index/33592329-04f5-4205-83a7-ce7820241108</a></td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon Nov 18 2024 15:17:18 GMT-0800 (Pacific Standard Time)">23:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: thanks, yeah!</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon Nov 18 2024 15:17:58 GMT-0800 (Pacific Standard Time)">23:17</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span></div></td><td class="msg-cell">is logging off</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon Nov 18 2024 15:19:35 GMT-0800 (Pacific Standard Time)">23:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay, yeah, I can confirm that the URL for the crashes (based on sampling ~20 crashes in IsProxy with crash address 0x0007800000000000) is almost always an extension. about:blank showed up once in my sample, and there were some reports that didn't include a URL.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon Nov 18 2024 15:27:22 GMT-0800 (Pacific Standard Time)">23:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Unfortunately, it looks like none of those crashes has any user comments.</td></tr>

</tbody></table></div></div></div>
</body></html>