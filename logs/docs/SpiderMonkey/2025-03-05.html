<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-03-05</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-03-05<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-03-04" class="nav-link"><span>prev</span></a>
<a href="2025-03-06" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Mar 04 2025 21:26:28 GMT-0800 (Pacific Standard Time)">05:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sagu:mozilla.org">Samson</span>&gt;</div></td><td class="msg-cell">GC will not move/mutate any rooted stuff, right?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Mar 04 2025 21:27:48 GMT-0800 (Pacific Standard Time)">05:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Samson</span>: GC can move rooted things. The reason you root it is so that the GC knows where you are storing pointers to GC things, so that it can update them.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Mar 04 2025 21:29:10 GMT-0800 (Pacific Standard Time)">05:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">For example, if you allocate an object in the nursery and root it, then the root will hold a pointer pointing into the nursery. If you trigger a minor GC while that root is still alive, then when the GC moves your object to promote it to the tenured space, the root will be updated to point to the new location.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Mar 04 2025 21:30:34 GMT-0800 (Pacific Standard Time)">05:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sagu:mozilla.org">Samson</span>&gt;</div></td><td class="msg-cell">Yeah, I just read <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr78/docs/GC%20Rooting%20Guide.md#jshandlet">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr78/docs/GC%20Rooting%20Guide.md#jshandlet</a> and facepalmed</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Mar 04 2025 21:34:34 GMT-0800 (Pacific Standard Time)">05:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">doesnt it become opposite of rooted because every gc would uproot the ptr ðŸ˜„</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Mar 05 2025 08:43:38 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I guess with the rooting analogy, data is floating around in the air. Data floats around and can detach and fly away unless it's rooted in the ground, or connected to something else rooted in the ground.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Mar 05 2025 08:43:44 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">The rooting doesn't stop it from moving, it just stops it from floating away.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Mar 05 2025 08:44:27 GMT-0800 (Pacific Standard Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(so, upside down from the way I usually think of data users being fungible and the data being a base layer)</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Mar 05 2025 08:45:31 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Maybe we should think of GC things like zeppelins</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Mar 05 2025 08:45:38 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">And then instead of rooting we are mooring</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Mar 05 2025 08:46:24 GMT-0800 (Pacific Standard Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Analogies to the Hindenburg disaster are left as an exercise for the reader</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Mar 05 2025 12:50:10 GMT-0800 (Pacific Standard Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">silly me thinking this S24 phone had only 3 types of CPU core.. turns out there two different sets of Cortex-A720 core that run at different frequency ranges, is it is 4+3+2+1 core heterogenous ðŸ« </td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Mar 05 2025 14:04:51 GMT-0800 (Pacific Standard Time)">22:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: perhaps you recall, does  JSCLASS_FOREGROUND_FINALIZE usually mean the relevant object won't be nursery allocated?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Mar 05 2025 14:05:35 GMT-0800 (Pacific Standard Time)">22:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: ah, you've been looking at scheduling ? Aren't the Android devices fun ðŸ™‚</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Mar 05 2025 14:06:11 GMT-0800 (Pacific Standard Time)">22:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, warming up very slowly to looking at scheduling too</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Mar 05 2025 14:07:15 GMT-0800 (Pacific Standard Time)">22:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">perfetto is of course a nice tool for that, especially now that we have some annotations for tasks</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Mar 05 2025 15:21:26 GMT-0800 (Pacific Standard Time)">23:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Yes, that's correct. Including the "usually" part -- if a class does not have a finalization hook but has <code>JSCLASS_FOREGROUND_FINALIZE</code>, I think it is still possible to nursery allocate. (Such objects would also need to set the JSCLASS_SKIP_NURSERY_FINALIZE flag.) But that's an edge case.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Mar 05 2025 15:40:06 GMT-0800 (Pacific Standard Time)">23:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: I'm trying to come up with some sort of minimal constraint on CC being run. Within T1 seconds of idle is easy. In the absence of T1 seconds of idle, it seems like it should not run if there has been no activity at all, and it should definitely run within T2 (T2 &gt; T1) seconds if there has been some minimum threshold amount of activity.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Mar 05 2025 15:42:02 GMT-0800 (Pacific Standard Time)">23:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm not saying I'll implement it exactly like that, but still: would using some #suspected serve as a useful minimum threshold for that?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Mar 05 2025 15:47:44 GMT-0800 (Pacific Standard Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I guess I'm trying to figure out what the boundaries on "make sure to always eventually CC" are.</td></tr>

</tbody></table></div></div></div>
</body></html>