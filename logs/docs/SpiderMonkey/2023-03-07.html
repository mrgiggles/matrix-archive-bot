<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-03-07</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-03-07<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-03-06" class="nav-link"><span>prev</span></a>
<a href="2023-03-08" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Mar 07 2023 02:53:48 GMT-0800 (Pacific Standard Time)">10:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell">hi <span class="nick-4">jonco</span> Is this assertion here because we don't want to be "late" giving the off-thread sweeping new zones to sweep?  <a href="https://searchfox.org/mozilla-central/source/js/src/gc/Sweeping.cpp#404">https://searchfox.org/mozilla-central/source/js/src/gc/Sweeping.cpp#404</a>  I was trying to figure out why we check this flag and not something like the state of <code>sweepTask</code> itself.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Mar 07 2023 03:24:23 GMT-0800 (Pacific Standard Time)">11:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">The flag is used to indicate to the task that it should trigger a slice when it has finished.  It's set when the GC yields to the mutator when a background task is still running.  It's cleared when the task completes and triggers a slice.  Therefore, it should not be set before the task has been started.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Mar 07 2023 03:25:32 GMT-0800 (Pacific Standard Time)">11:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell">Okay, so it could equally be "Has background sweep been started?".</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Mar 07 2023 03:26:01 GMT-0800 (Pacific Standard Time)">11:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell">I'm concerned that when I use this flag for background free also, because of merging the background free and background sweep tasks.  Then this assertion won't always be true.  Well, except it will because this code is run on the main thread and the main thread won't be doing GC work if the flag is true.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Mar 07 2023 03:27:06 GMT-0800 (Pacific Standard Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">No, it's checking that the flag is set as expected</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Mar 07 2023 03:27:28 GMT-0800 (Pacific Standard Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>it will because this code is run on the main thread and the main thread won't be doing GC work if the flag is true.</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Mar 07 2023 03:27:32 GMT-0800 (Pacific Standard Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yes, exactly</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Mar 07 2023 03:27:51 GMT-0800 (Pacific Standard Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell">Okay thanks.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Mar 07 2023 08:12:41 GMT-0800 (Pacific Standard Time)">16:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: do you have any idea what's going on with bug 1819532?  that stack looks totally bogus to me</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Mar 07 2023 08:12:43 GMT-0800 (Pacific Standard Time)">16:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1819532">https://bugzil.la/1819532</a> — NEW (nobody) — Crash in [@ OOM | large | js::AutoEnterOOMUnsafeRegion::crash | js::AutoEnterOOMUnsafeRegion::crash | JS::CallbackTracer::onEdge]</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Mar 07 2023 08:45:19 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: I was trying to trace how things get set up (and getting confused because I was looking for something that doesn't exist).  I thought maybe some kind of barrier was firing when it shouldn't. But I couldn't find anything.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Mar 07 2023 10:03:04 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: ok, thanks for looking</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Mar 07 2023 10:03:29 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'm guessing this is another signature for OOM during nursery collection, but I don't know what the stack is coming out like that</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Mar 07 2023 10:16:41 GMT-0800 (Pacific Standard Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm guessing this is another signature for OOM during nursery collection, but I don't know what the stack is coming out like that</blockquote></mx-reply>Kind of weird that the signature disappeared entirely for a few betas. You could try doing some proto signature matching against those specific betas to try to find what it was looking like there.</td></tr>

</tbody></table></div></div></div>
</body></html>