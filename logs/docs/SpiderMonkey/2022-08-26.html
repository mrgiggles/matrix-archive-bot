<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-08-26</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-08-26<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-08-25" class="nav-link"><span>prev</span></a>
<a href="2022-08-27" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Aug 26 2022 02:22:56 GMT-0700 (Pacific Daylight Time)">09:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I want to attach to gnome-shell with gdb, and then dispatch some javascript code to the js engine, and since I'm not familiar with js engine internals, I hope it's not that hard, and I'd like some help with this.</blockquote></mx-reply>One trick used in Gecko, is to add a call to <code>Math.sin</code> and break on the equivalent symbol in spidermonkey.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Aug 26 2022 07:23:54 GMT-0700 (Pacific Daylight Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: I updated the patch.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Aug 26 2022 07:24:37 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thanks! I'll look into it</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Aug 26 2022 07:58:10 GMT-0700 (Pacific Daylight Time)">14:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Is there a way to inspect passed JavaScript objects in C++ and print out all the properties (member variables)?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Aug 26 2022 07:59:00 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Or do you need to know the property name ahead of time?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Aug 26 2022 07:59:34 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>if it's for debugging purpose, <a href="https://searchfox.org/mozilla-central/rev/8dd35cd8f5284fbaa506aab02fe42fc87efb249e/js/public/friend/DumpFunctions.h#87">https://searchfox.org/mozilla-central/rev/8dd35cd8f5284fbaa506aab02fe42fc87efb249e/js/public/friend/DumpFunctions.h#87</a></p>
<pre><code class="language-cpp">extern JS_PUBLIC_API void DumpObject(JSObject* obj);
</code></pre>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Aug 26 2022 07:59:52 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that prints the internal of the object</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Aug 26 2022 08:06:25 GMT-0700 (Pacific Daylight Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Not sure how I could find this stuff on my own. Is it in the examples or <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/tree/esr91/docs">github readme docs</a>?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Aug 26 2022 08:08:03 GMT-0700 (Pacific Daylight Time)">15:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Or is it more expected to read all the header files under <code>js/</code>?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Aug 26 2022 08:08:21 GMT-0700 (Pacific Daylight Time)">15:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">if I'm looking for a functionality as a new user to SpiderMonkey JS API</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Aug 26 2022 08:16:58 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the example is very limited right now</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Aug 26 2022 08:17:26 GMT-0700 (Pacific Daylight Time)">15:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and yeah, please search through the public headers, or just ask here</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Aug 26 2022 08:18:40 GMT-0700 (Pacific Daylight Time)">15:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">right, I was wondering because I didn't want to spam chat for every single question I have where you could easily look it up
as i'm a new user to the code base</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Aug 26 2022 08:22:30 GMT-0700 (Pacific Daylight Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">is there a way I can search for just header files on searchfox? <code>js\/.*\.h</code> in the path filter isn't cutting it</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Aug 26 2022 08:22:58 GMT-0700 (Pacific Daylight Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">js/public in the path would be sufficient</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Aug 26 2022 08:23:18 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there are only headers</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Aug 26 2022 08:23:37 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">Or "js/**.h$" for the path filter</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Aug 26 2022 08:23:40 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">but for esr68 I noticed <code>DumpObject</code> being in js/src <a href="https://searchfox.org/mozilla-esr68/source/js/src/jsfriendapi.cpp">https://searchfox.org/mozilla-esr68/source/js/src/jsfriendapi.cpp</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Aug 26 2022 08:23:47 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Aug 26 2022 08:24:24 GMT-0700 (Pacific Daylight Time)">15:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">on older versions, many functions would still be in js/src/jsapi.h</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Aug 26 2022 08:24:39 GMT-0700 (Pacific Daylight Time)">15:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">ah whatever, i'll just browse the source on my drive instead of the website</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Aug 26 2022 08:24:55 GMT-0700 (Pacific Daylight Time)">15:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and jsfriendapi.h maybe?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Aug 26 2022 08:26:09 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, searching through those 2 files would work?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Aug 26 2022 08:26:38 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Or "js/**.h$" for the path filter</blockquote></mx-reply>I noticed with <code>.h$</code> that the results were cut off with no next page ability (since i didn't see any <code>js/</code> in the results)<br>So I don't trust the search for listing all .h files even with <code>js/**.h$</code></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Aug 26 2022 08:26:43 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">here's list of public headers <a href="https://searchfox.org/mozilla-esr68/source/js/src/moz.build#108">https://searchfox.org/mozilla-esr68/source/js/src/moz.build#108</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Aug 26 2022 08:27:00 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the file lists with <code>EXPORTS*</code></td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Aug 26 2022 08:35:22 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I noticed with <code>.h$</code> that the results were cut off with no next page ability (since i didn't see any <code>js/</code> in the results)<br>So I don't trust the search for listing all .h files even with <code>js/**.h$</code></blockquote></mx-reply>Yeah, I realized I forgot to put the "js/**" 😊, sorry!</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Aug 26 2022 08:44:13 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">The SpiderMonkey helper threads are using <code>ErrorAllocator</code> (for example, <a href="https://searchfox.org/mozilla-central/source/js/src/vm/JSScript.cpp#2085">here</a> ) while at the same time using <code>JSContext</code> as the <code>AllocPolicy</code> for types like Vector. Will mixing these allocators cause any problems? <span class="nick-2">nbp</span> or <span class="nick-12">sfink</span> perhaps you have an idea?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Aug 26 2022 08:47:20 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1786819">https://bugzilla.mozilla.org/show_bug.cgi?id=1786819</a></td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Aug 26 2022 08:51:07 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>: Reading the code, it seems to matter if we were to track allocations <a href="https://searchfox.org/mozilla-central/search?q=updateMallocCounter&amp;path=&amp;case=true&amp;regexp=false"><code>updateMallocCounter</code></a>, or if we were interested in reporting OOM to a specific context with <code>onOutOfMemory</code>. So, I would say that probably not during the migration process from <code>JSContext</code> to <code>ErrorContext</code></td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Aug 26 2022 08:51:28 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">But that in general it would be better to have consistency.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Aug 26 2022 09:33:51 GMT-0700 (Pacific Daylight Time)">16:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>, <span class="nick-8">Mohamed Atef</span> :  sorry, I didn't notice the bug for XDR part is already filed and assigned</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Aug 26 2022 09:37:30 GMT-0700 (Pacific Daylight Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">And I apologize for marking bug 1786117 duplicate without looking to see if there was any work done on it already</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Aug 26 2022 09:37:32 GMT-0700 (Pacific Daylight Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1786117">https://bugzil.la/1786117</a> — RESOLVED (mohamedatef1698) — Use ErrorContext-variant of `ReportOutOfMemory` in Stencil XDR</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Aug 26 2022 09:38:30 GMT-0700 (Pacific Daylight Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm leaning toward going with <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1786117">bug 1786117</a> patch, with extra review from <span class="nick-7">Bryan Thrall [:bthrall]</span> .  does it sound good?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Aug 26 2022 09:40:41 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'd like to avoid exposing <code>ErrorContext</code> to public header, at least for now</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Aug 26 2022 09:41:56 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">That is fine with me, I will review 1786117's changes</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Aug 26 2022 09:42:06 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Aug 26 2022 09:53:38 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-7">Bryan Thrall [:bthrall]</span>, <span class="nick-8">Mohamed Atef</span> :  sorry, I didn't notice the bug for XDR part is already filed and assigned</blockquote></mx-reply>No problem.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Aug 26 2022 09:55:08 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">And I am sorry,  I saw bug 1783951 but i thought it's for another part. I should have mention it.
</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Aug 26 2022 09:55:11 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1783951">https://bugzil.la/1783951</a> — ASSIGNED (bthrall) — Use ErrorContext variant of js::ReportOutOfMemory() when encoding/decoding Stencils</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Aug 26 2022 09:56:12 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1786819">https://bugzilla.mozilla.org/show_bug.cgi?id=1786819</a></blockquote></mx-reply>arai: what about this?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Aug 26 2022 10:00:35 GMT-0700 (Pacific Daylight Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I haven't yet looked into the details of the oomTest case about how it should be solved or dependency with other bugs</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Aug 26 2022 10:07:22 GMT-0700 (Pacific Daylight Time)">17:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">is there one where you can use the properties and values without needing to know the actual property name?<br>i.e. not just print them but interact with the properties</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Aug 26 2022 10:10:19 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">maybe the issue simply disappear when we switch to <code>SystemAllocPolicy</code></td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri Aug 26 2022 10:11:25 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and in that case, there's nothing to do in the bug</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri Aug 26 2022 10:11:47 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">davidj361</span>: what's the actual use case, and what are the input and expected output?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri Aug 26 2022 10:12:35 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><p>if we have an arbitrary class</p>
<pre><code class="language-js">var data = {
    "data": [
        {
            "MainId": 1111,
            "firstName": "Sherlock",
            "lastName": "Homes",
            "categories": [
                {
                    "CategoryID": 1,
                    "CategoryName": "Example"
                }
            ]
        },
        {
            "MainId": 122,
            "firstName": "James",
            "lastName": "Watson",
            "categories": [
                {
                    "CategoryID": 2,
                    "CategoryName": "Example2"
                }
            ]
        }
    ],
    "messages": [], // blank json
    "success": true // boolean value
}
``
</code></pre>
</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Aug 26 2022 10:13:02 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">for example can I get all the categories without knowing the property names?</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Aug 26 2022 10:13:58 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what are "the property names" ?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Aug 26 2022 10:14:18 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you provide some pseudo code that utilizes what you want?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Aug 26 2022 10:14:53 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">like can i get "categories" in <code>data</code> without having to write "getMemberVariable("categories")"</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Aug 26 2022 10:15:48 GMT-0700 (Pacific Daylight Time)">17:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">could i iterate through all the member variables of the object, get its name, type, etc, without knowing ahead of time what it is?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Aug 26 2022 10:16:13 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">I don't mean solely to print for debugging, but interact with it like adding numbers, concatenating strings, etc</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Aug 26 2022 10:16:25 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell">Bug 1786834</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Aug 26 2022 10:16:26 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1786834">https://bugzil.la/1786834</a> — NEW (nobody) — Integrate SharedImmutableStringsCache into frontend context</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Aug 26 2022 10:16:43 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, you want to walk through the object tree, right?</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Aug 26 2022 10:16:50 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Aug 26 2022 10:20:28 GMT-0700 (Pacific Daylight Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Mohamed Atef</span>: sorry I should've set the proper dependency.  the "frontend context" struct doesn't yet exist (or, it partially exists as <code>OffThreadErrorContext</code> but needs cleanup before adding more)</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Aug 26 2022 10:21:49 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">I'm getting an assertion js::GlobalHelperThreadState::cancelParseTask(): MOZ_ASSERT(task-&gt;kind == kind);   when loading a big WASM app.   
(rr) p kind
$2 = js::ParseTaskKind::ModuleStencil
(rr) p task-&gt;kind
$3 = js::ParseTaskKind::StencilDecode
Anything useful I can gather?  Stack: <a href="https://paste.mozilla.org/yv2SJCY0/raw">https://paste.mozilla.org/yv2SJCY0/raw</a></td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Aug 26 2022 10:21:51 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">let me tidy up the bug tree</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Aug 26 2022 10:26:51 GMT-0700 (Pacific Daylight Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">jesup</span>: thanks!  yeah, the branch in <code>ScriptLoadContext::MaybeCancelOffThreadScript</code> is incorrect and calls wrong function</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Aug 26 2022 10:27:12 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">jesup</span>: can you file a bug and CC me?</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Aug 26 2022 10:27:16 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">sure</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Aug 26 2022 10:30:59 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1787529">https://bugzilla.mozilla.org/show_bug.cgi?id=1787529</a></td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri Aug 26 2022 10:31:11 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thank you!</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri Aug 26 2022 10:31:52 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">It may get triggered by race conditions because Adobe CC iloops when you try to log in, switching between the homepage and the login page</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri Aug 26 2022 10:32:50 GMT-0700 (Pacific Daylight Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, it's cancelling off-thread script decode task, that happens only when navigating away in the middle of the operation</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Fri Aug 26 2022 10:33:57 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">davidj361</span>: sorry, I'll prepare example but it may take some time</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Fri Aug 26 2022 10:34:52 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">no worries, you don't have to go too much out of the way for me</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Fri Aug 26 2022 10:35:33 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">basically, what you need is a recursive function receives <code>JS::Handle&lt;JS::Value&gt;</code> and check the type, and iterate over properties and recurse</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Fri Aug 26 2022 10:36:33 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">right so if it's an object you receive, how do you obtain the list of stuff inside the object?</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Fri Aug 26 2022 10:37:05 GMT-0700 (Pacific Daylight Time)">17:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><a href="https://searchfox.org/mozilla-central/rev/8dd35cd8f5284fbaa506aab02fe42fc87efb249e/js/src/vm/Iteration.h#461">https://searchfox.org/mozilla-central/rev/8dd35cd8f5284fbaa506aab02fe42fc87efb249e/js/src/vm/Iteration.h#461</a></p>
<pre><code class="language-cpp">[[nodiscard]] bool EnumerateProperties(JSContext* cx, HandleObject obj,
</code></pre>
</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Fri Aug 26 2022 10:37:06 GMT-0700 (Pacific Daylight Time)">17:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">and are you even able to see the name of that member-variable/property?</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Fri Aug 26 2022 10:37:07 GMT-0700 (Pacific Daylight Time)">17:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it could be used</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Fri Aug 26 2022 10:37:41 GMT-0700 (Pacific Daylight Time)">17:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">err, sorry, it was private function</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Fri Aug 26 2022 10:38:16 GMT-0700 (Pacific Daylight Time)">17:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-13">davidj361</span>: <a href="https://searchfox.org/mozilla-central/rev/8dd35cd8f5284fbaa506aab02fe42fc87efb249e/js/public/PropertyAndElement.h#434-435">https://searchfox.org/mozilla-central/rev/8dd35cd8f5284fbaa506aab02fe42fc87efb249e/js/public/PropertyAndElement.h#434-435</a></p>
<pre><code class="language-cpp">extern JS_PUBLIC_API bool JS_Enumerate(JSContext* cx, JS::Handle&lt;JSObject*&gt; obj,
                                       JS::MutableHandle&lt;JS::IdVector&gt; props);
</code></pre>
</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Fri Aug 26 2022 10:38:18 GMT-0700 (Pacific Daylight Time)">17:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">this one instead</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Fri Aug 26 2022 10:38:58 GMT-0700 (Pacific Daylight Time)">17:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that gives you a list of property keys</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Fri Aug 26 2022 10:39:15 GMT-0700 (Pacific Daylight Time)">17:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and you can perform <code>JS_GetPropertyById</code></td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Fri Aug 26 2022 10:55:54 GMT-0700 (Pacific Daylight Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">jesup</span>: can you test with <a href="https://phabricator.services.mozilla.com/D155740">https://phabricator.services.mozilla.com/D155740</a> ?</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Fri Aug 26 2022 10:56:18 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell">sure, I can add that to the stack</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Fri Aug 26 2022 10:59:17 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-13">davidj361</span>: here's example case that used both of them <a href="https://searchfox.org/mozilla-central/rev/839718c65b62ad1fca710390f472f834994da819/js/loader/ImportMap.cpp#115-116,121-122,137-139">https://searchfox.org/mozilla-central/rev/839718c65b62ad1fca710390f472f834994da819/js/loader/ImportMap.cpp#115-116,121-122,137-139</a></p>
<pre><code class="language-cpp">JS::Rooted&lt;JS::IdVector&gt; specifierKeys(aCx, JS::IdVector(aCx));
if (!JS_Enumerate(aCx, aOriginalMap, &amp;specifierKeys)) {
...
for (size_t i = 0; i &lt; specifierKeys.length(); i++) {
  const JS::RootedId specifierId(aCx, specifierKeys[i]);
...
  JS::RootedValue idVal(aCx);
  NS_ENSURE_TRUE(JS_GetPropertyById(aCx, aOriginalMap, specifierId, &amp;idVal),
                 nullptr);
</code></pre>
</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Fri Aug 26 2022 11:02:23 GMT-0700 (Pacific Daylight Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Mohamed Atef</span>: so, right now, there's no already-filed-and-available bug around frontend context.  one option is to look into bugs that has dependency and figure out other task that unblocks them</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Fri Aug 26 2022 11:03:35 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">other option is to work on other part of the code meanwhile</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Fri Aug 26 2022 11:43:02 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aswan:mozilla.org">aswan</span>&gt;</div></td><td class="msg-cell"><p>Hey folks, not sure if this is the right channel, but I was playing with cloning Errors and ran into some confusing behavior.  Wondering if this is a bug or not?</p>
<pre><code>let e = new Error("outer", { cause: new Error("inner") });
let e2 = new Error("outer");
e2.cause = new Error("inner");

let eClone = structuredClone(e);
console.log(eClone.cause);  // all good, cause is the "innner" error!

let e2Clone = structuredClone(e2);
console.log(e2Clone.cause);  // huh, undefined?
</code></pre>
</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Fri Aug 26 2022 11:53:50 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">is the <code>global</code> an oversight? <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/4ce99da2a6f1b01ff6b38702c157261c72d07c88/examples/cookbook.cpp#L513">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/4ce99da2a6f1b01ff6b38702c157261c72d07c88/examples/cookbook.cpp#L513</a></td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Fri Aug 26 2022 11:58:36 GMT-0700 (Pacific Daylight Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Hey folks, not sure if this is the right channel, but I was playing with cloning Errors and ran into some confusing behavior.  Wondering if this is a bug or not?</p>
<pre><code>let e = new Error("outer", { cause: new Error("inner") });
let e2 = new Error("outer");
e2.cause = new Error("inner");

let eClone = structuredClone(e);
console.log(eClone.cause);  // all good, cause is the "innner" error!

let e2Clone = structuredClone(e2);
console.log(e2Clone.cause);  // huh, undefined?
</code></pre>
</blockquote></mx-reply>cloning <code>cause</code> is not specified so we can not say if it's a bug. But basically we only create (and clone) an internal slot for cause when using the constructor. We could fix this by doing a [[Get]] lookup instead.</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Fri Aug 26 2022 12:10:30 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><p>Do I really have to declare an extra tmp variable to convert each RootedValue to a HandleObject? For example if I wanted to manually traverse down an object tree.</p>
<pre><code class="language-c++">    JS::RootedObject yobj(cx);
    if (!JS_ValueToObject(cx, y, &amp;yobj)) return false;

    JS::RootedValue data(cx);
    if (!JS_GetProperty(cx, yobj, "data", &amp;data)) return false;
    JS::RootedValue signals(cx);
    if (!JS_GetProperty(cx, data, "foo", &amp;signals)) return false;
</code></pre>
</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Fri Aug 26 2022 12:13:23 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><code>myObj { data: { foo: 5 } };</code> for example</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Fri Aug 26 2022 12:14:34 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">at least I'm wondering if there are JS API functions that do the same thing as <code>JS_ValueToObject</code> but returns an handleobject instead, otherwise I'll just utilize 2 iterator buffer variables</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Fri Aug 26 2022 12:15:12 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the <code>RootedValue</code> can be reused across multiple calls</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Fri Aug 26 2022 12:17:25 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><p>right but it will look slightly ugly like this:</p>
<pre><code class="language-c++">    JS::RootedObject obj(cx); // iterator
    JS::RootedValue rv(cx); // iterator
    if (!JS_ValueToObject(cx, y, &amp;obj)) return false;
    if (!JS_GetProperty(cx, obj, "data", &amp;rv)) return false;
    if (!JS_ValueToObject(cx, rv, &amp;obj)) return false;
    if (!JS_GetProperty(cx, obj, "foo", &amp;rv)) return false;
    if (!JS_ValueToObject(cx, rv, &amp;obj)) return false;
    if (!JS_GetProperty(cx, obj, "use", &amp;rv)) return false;

</code></pre>
</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Fri Aug 26 2022 12:18:29 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the value is known to be object, you don't need <code>JS_ValueToObject</code></td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Fri Aug 26 2022 12:18:56 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><pre><code>JS::RootedValue rv(cx);
JS::RootedObject obj(cx, &amp;y.toObject());
if (!JS_GetProperty(cx, obj, "data", &amp;rv)) return false;
obj = &amp;rv.toObject();
if (!JS_GetProperty(cx, obj, "foo", &amp;rv)) return false;
</code></pre>
</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Fri Aug 26 2022 12:43:33 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aswan:mozilla.org">aswan</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-15">evilpie</span>: thanks, I haven't read the spec, but mdn says:|</p>
<blockquote>
<p>Browsers must serialize the properties name and message, and are expected to serialize other "interesting" properties of the errors such as stack, cause, etc.</p>
</blockquote>
<p>and fwiw, v8 clones cause in both cases.  Is it worth filing a bug?</p>
</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Fri Aug 26 2022 12:44:03 GMT-0700 (Pacific Daylight Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p><span class="nick-15">evilpie</span>: thanks, I haven't read the spec, but mdn says:|</p>
<blockquote>
<p>Browsers must serialize the properties name and message, and are expected to serialize other "interesting" properties of the errors such as stack, cause, etc.</p>
</blockquote>
<p>and fwiw, v8 clones cause in both cases.  Is it worth filing a bug?</p>
</blockquote></mx-reply>can't hurt</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Fri Aug 26 2022 12:44:20 GMT-0700 (Pacific Daylight Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aswan:mozilla.org">aswan</span>&gt;</div></td><td class="msg-cell">ha, okay.  thanks!</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Fri Aug 26 2022 12:58:31 GMT-0700 (Pacific Daylight Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p><span class="nick-13">davidj361</span>: here's example case that used both of them <a href="https://searchfox.org/mozilla-central/rev/839718c65b62ad1fca710390f472f834994da819/js/loader/ImportMap.cpp#115-116,121-122,137-139">https://searchfox.org/mozilla-central/rev/839718c65b62ad1fca710390f472f834994da819/js/loader/ImportMap.cpp#115-116,121-122,137-139</a></p>
<pre><code class="language-cpp">JS::Rooted&lt;JS::IdVector&gt; specifierKeys(aCx, JS::IdVector(aCx));
if (!JS_Enumerate(aCx, aOriginalMap, &amp;specifierKeys)) {
...
for (size_t i = 0; i &lt; specifierKeys.length(); i++) {
  const JS::RootedId specifierId(aCx, specifierKeys[i]);
...
  JS::RootedValue idVal(aCx);
  NS_ENSURE_TRUE(JS_GetPropertyById(aCx, aOriginalMap, specifierId, &amp;idVal),
                 nullptr);
</code></pre>
</blockquote></mx-reply>from what i'm reading you can only get the values of the enumerated properties but you cannot get the names of them, correct?</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Fri Aug 26 2022 12:59:02 GMT-0700 (Pacific Daylight Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the "id" is the name</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Fri Aug 26 2022 12:59:20 GMT-0700 (Pacific Daylight Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it can be one of string, integer, or symbol</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Fri Aug 26 2022 13:00:16 GMT-0700 (Pacific Daylight Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">this? <code>const JS::RootedId specifierId(cx, props[i]);</code> the struct looks like bits or an int?<br><a href="https://searchfox.org/mozilla-esr68/rev/4b79eedfe95ef427490a16e7c96f3a0930ab0c32/js/public/Id.h#45">https://searchfox.org/mozilla-esr68/rev/4b79eedfe95ef427490a16e7c96f3a0930ab0c32/js/public/Id.h#45</a></td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Fri Aug 26 2022 13:01:06 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>JSID_IS_STRING</code> and <code>JSID_TO_STRING</code> etc for type check and convert</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Fri Aug 26 2022 13:01:21 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">what is this magic? converting "bits" to a string? lol</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Fri Aug 26 2022 13:01:38 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Just noticed those functions after looking over again</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Fri Aug 26 2022 13:01:44 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">"bits" is tagged pointer</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Fri Aug 26 2022 13:01:54 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">ahh</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Fri Aug 26 2022 13:02:41 GMT-0700 (Pacific Daylight Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">newer version of <code>JS::PropertyKey</code> has accessor methods</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Fri Aug 26 2022 13:02:55 GMT-0700 (Pacific Daylight Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><a href="https://searchfox.org/mozilla-central/rev/839718c65b62ad1fca710390f472f834994da819/js/public/Id.h#83">https://searchfox.org/mozilla-central/rev/839718c65b62ad1fca710390f472f834994da819/js/public/Id.h#83</a></p>
<pre><code class="language-cpp">MOZ_ALWAYS_INLINE bool isString() const {
</code></pre>
</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Fri Aug 26 2022 13:17:49 GMT-0700 (Pacific Daylight Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">how would I go about printing to stdout <code>JSID_TO_STRING(id)</code>?</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Fri Aug 26 2022 13:18:44 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p><a href="https://searchfox.org/mozilla-esr68/rev/4b79eedfe95ef427490a16e7c96f3a0930ab0c32/js/src/jsfriendapi.h#279">https://searchfox.org/mozilla-esr68/rev/4b79eedfe95ef427490a16e7c96f3a0930ab0c32/js/src/jsfriendapi.h#279</a></p>
<pre><code class="language-cpp">extern JS_FRIEND_API void DumpString(JSString* str);
</code></pre>
</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Fri Aug 26 2022 13:18:47 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">I'm familiar with <code>JS_EncodeStringToUTF8(cx, str)</code> but would it be needed?</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Fri Aug 26 2022 13:22:45 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Ah I guess that's just for GC purposes</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Fri Aug 26 2022 13:37:19 GMT-0700 (Pacific Daylight Time)">20:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>JS_EncodeStringToUTF8</code> is for retrieving UTF8 buffer for the string</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Fri Aug 26 2022 13:37:39 GMT-0700 (Pacific Daylight Time)">20:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>DumpString</code> prints the internal representation of the string</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Fri Aug 26 2022 14:01:51 GMT-0700 (Pacific Daylight Time)">21:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">is there any difference in performance between setting <code>trace</code> in object's <code>JSClassOps</code> vs manually propagating <code>trace</code> from the corresponding global object?</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Fri Aug 26 2022 14:13:16 GMT-0700 (Pacific Daylight Time)">21:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">or in other words: is there any demerit in defining <code>trace</code> in non-global object?</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Fri Aug 26 2022 14:32:27 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">TheQwertiest</span>: You need <code>trace</code> when an object has references to other garbage-collected things. The GC uses it when marking live objects.</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Fri Aug 26 2022 14:32:49 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I don't understand how you think the global object gets involved.</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Fri Aug 26 2022 14:36:50 GMT-0700 (Pacific Daylight Time)">21:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I don't understand how you think the global object gets involved.</blockquote></mx-reply><p>the way that I was doing it till now was smth like this:</p>
<p>NativeGlobal::Trace() {  childObject-&gt;Trace() }; // NativeGlobal is a private native of a global object, childObject is a private native object of some ChildJsObject that is stored in global</p>
<p>I've never gave it much thought, but now I'm starting to think that I've overcomplicated things a bit =)</p>
</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Fri Aug 26 2022 14:38:08 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">so now I'm wondering, if I can just define <code>trace</code> for every native js object without doing stuff like that</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Fri Aug 26 2022 14:40:13 GMT-0700 (Pacific Daylight Time)">21:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><p>unrelated question: what is the best way to define a property in native object that contains an object with contants<br>i.e. in js land said property would look something like this:</p>
<pre><code>obj.contants = {
  CONST_1: 1,
  CONST_2: 42,
  CONST_3: 69,
};
</code></pre>
</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Fri Aug 26 2022 14:43:55 GMT-0700 (Pacific Daylight Time)">21:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">GC works by tracing everything that's reachable from the roots. So it starts by looking at every Rooted&lt;X&gt;, and calling <code>trace</code> on those objects.</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Fri Aug 26 2022 14:44:08 GMT-0700 (Pacific Daylight Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Those objects may have edges to other objects</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Fri Aug 26 2022 14:46:16 GMT-0700 (Pacific Daylight Time)">21:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If an object has another GC thing in a slot (eg for <code>var o1 = {}; var o2 = {x: o1}</code>, there will be an ObjectValue pointing to <code>o1</code> in one of the slots in <code>o2</code>, then the GC already knows how to trace it.</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Fri Aug 26 2022 14:46:31 GMT-0700 (Pacific Daylight Time)">21:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If you're doing something fancier, you may need a trace method to tell the GC what to do.</td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Fri Aug 26 2022 14:48:40 GMT-0700 (Pacific Daylight Time)">21:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">from your answer it seems that defining a <code>trace</code> in <code>JSClassOps</code> is a standard tool that does not carry much overhead (in my case those native childObjects contain GC things, so I have to trace them manually)</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Fri Aug 26 2022 14:49:09 GMT-0700 (Pacific Daylight Time)">21:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">It's a standard tool without too much overhead, but depending on what you're doing you may not need it</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Fri Aug 26 2022 14:50:22 GMT-0700 (Pacific Daylight Time)">21:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">For example: RegExpObject has four reserved slots: <a href="https://searchfox.org/mozilla-central/source/js/src/vm/RegExpObject.h#41-53">https://searchfox.org/mozilla-central/source/js/src/vm/RegExpObject.h#41-53</a></td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Fri Aug 26 2022 14:50:49 GMT-0700 (Pacific Daylight Time)">21:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But they're all normal values, so <code>RegExpObject</code> doesn't need a <code>trace</code> hook</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Fri Aug 26 2022 14:51:05 GMT-0700 (Pacific Daylight Time)">21:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">MapObject is an example that needs a <code>trace</code> hook</td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Fri Aug 26 2022 14:51:30 GMT-0700 (Pacific Daylight Time)">21:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/builtin/MapObject.cpp#537-544">https://searchfox.org/mozilla-central/source/js/src/builtin/MapObject.cpp#537-544</a></td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Fri Aug 26 2022 14:51:50 GMT-0700 (Pacific Daylight Time)">21:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Because one of its slots contains a PrivateValue, which is a raw pointer to (in this case) a malloc-allocated hashtable</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Fri Aug 26 2022 14:52:05 GMT-0700 (Pacific Daylight Time)">21:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">By default the GC will ignore that slot</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Fri Aug 26 2022 14:52:39 GMT-0700 (Pacific Daylight Time)">21:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So we need a <code>trace</code> hook to trace the contents of the hashtable</td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Fri Aug 26 2022 14:53:08 GMT-0700 (Pacific Daylight Time)">21:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">yea, I know the basics :)<br>my question was mainly related to the overhead of defining <code>trace</code></td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Fri Aug 26 2022 14:53:39 GMT-0700 (Pacific Daylight Time)">21:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">anyway thanks for all the clarifications, this will allow to clean my code quite a bit :)</td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Fri Aug 26 2022 14:55:23 GMT-0700 (Pacific Daylight Time)">21:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">ps: regretfully, the way I've implemented generic my wrapper that defines native js objects makes it difficult to use reserved slots to store js things, so I usually store them with JS::Heap + trace...</td></tr>
  <tr class="msg" id="L138"><td class="ts-cell"><a class="ts" href="#L138" alt="Fri Aug 26 2022 14:56:13 GMT-0700 (Pacific Daylight Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>unrelated question: what is the best way to define a property in native object that contains an object with contants<br>i.e. in js land said property would look something like this:</p>
<pre><code>obj.contants = {
  CONST_1: 1,
  CONST_2: 42,
  CONST_3: 69,
};
</code></pre>
</blockquote></mx-reply>ps: any tips on this would be greatly appreciated</td></tr>
  <tr class="msg" id="L139"><td class="ts-cell"><a class="ts" href="#L139" alt="Fri Aug 26 2022 15:11:50 GMT-0700 (Pacific Daylight Time)">22:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">I mean I can generate object in runtime via <code>JS_DefineProperties</code> that has a getter method for <code>constants</code>, but that doesn't seem optimal. Especially since this property (and it's keys) might be accessed frequently, so I'm trying to minimize the crossing between jsLand and nativeLand</td></tr>
  <tr class="msg" id="L140"><td class="ts-cell"><a class="ts" href="#L140" alt="Fri Aug 26 2022 15:14:37 GMT-0700 (Pacific Daylight Time)">22:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Why accessor? Can't you just specify values?</td></tr>
  <tr class="msg" id="L141"><td class="ts-cell"><a class="ts" href="#L141" alt="Fri Aug 26 2022 15:15:17 GMT-0700 (Pacific Daylight Time)">22:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, just about to say: JSPropertySpec can also specify constants</td></tr>
  <tr class="msg" id="L142"><td class="ts-cell"><a class="ts" href="#L142" alt="Fri Aug 26 2022 15:16:17 GMT-0700 (Pacific Daylight Time)">22:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">See here: <a href="https://searchfox.org/mozilla-central/source/js/public/PropertySpec.h#385-392">https://searchfox.org/mozilla-central/source/js/public/PropertySpec.h#385-392</a></td></tr>
  <tr class="msg" id="L143"><td class="ts-cell"><a class="ts" href="#L143" alt="Fri Aug 26 2022 15:17:01 GMT-0700 (Pacific Daylight Time)">22:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>Can't you just specify values?<br>JSPropertySpec can also specify constants</p>
</blockquote>
<p>but is it possible to use an object as a constant value?</p>
</td></tr>
  <tr class="msg" id="L144"><td class="ts-cell"><a class="ts" href="#L144" alt="Fri Aug 26 2022 15:18:22 GMT-0700 (Pacific Daylight Time)">22:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">since in my case I want to have <code>Object1</code> that has property <code>constants</code>, which has multiple primitive constant values</td></tr>
  <tr class="msg" id="L145"><td class="ts-cell"><a class="ts" href="#L145" alt="Fri Aug 26 2022 15:19:57 GMT-0700 (Pacific Daylight Time)">22:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Create an object for all the constants. Create another object and assign the property <code>constants</code> with the previous object?</td></tr>
  <tr class="msg" id="L146"><td class="ts-cell"><a class="ts" href="#L146" alt="Fri Aug 26 2022 15:22:47 GMT-0700 (Pacific Daylight Time)">22:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>and assign the property</p>
</blockquote>
<p>you mean via JS_DefineProperty? Or is it possible to do so with JS_DefineProperties as well? (without accessor)</p>
</td></tr>
  <tr class="msg" id="L147"><td class="ts-cell"><a class="ts" href="#L147" alt="Fri Aug 26 2022 15:23:30 GMT-0700 (Pacific Daylight Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">You would need the former </td></tr>
  <tr class="msg" id="L148"><td class="ts-cell"><a class="ts" href="#L148" alt="Fri Aug 26 2022 15:24:32 GMT-0700 (Pacific Daylight Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">oh well, guess there is no simple way to hide it all in JSPropertySpec =)</td></tr>
  <tr class="msg" id="L149"><td class="ts-cell"><a class="ts" href="#L149" alt="Fri Aug 26 2022 15:24:35 GMT-0700 (Pacific Daylight Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>

</tbody></table></div></div></div>
</body></html>