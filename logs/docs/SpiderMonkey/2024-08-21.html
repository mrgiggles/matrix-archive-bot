<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-08-21</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-08-21<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-08-20" class="nav-link"><span>prev</span></a>
<a href="2024-08-22" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Aug 21 2024 04:24:58 GMT-0700 (Pacific Daylight Time)">11:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: I put some patches up in bug 1914004 to allow rooting multiple things at once. The second patch is an example to show the API use since I don't know what the actual performance sensitive cases are.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Aug 21 2024 04:31:52 GMT-0700 (Pacific Daylight Time)">11:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: looks very nice</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Aug 21 2024 04:35:17 GMT-0700 (Pacific Daylight Time)">11:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Aug 21 2024 04:35:36 GMT-0700 (Pacific Daylight Time)">11:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">were there any particular hotspots that we should think about using this for?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Aug 21 2024 04:51:27 GMT-0700 (Pacific Daylight Time)">11:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I wonder if the difference would be measurable for object.assign <a href="https://searchfox.org/mozilla-central/rev/e942f7bc56cd103bba86b396ddeba5b1ab04f1a4/js/src/builtin/Object.cpp#1209-1218">here</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Aug 21 2024 04:52:25 GMT-0700 (Pacific Daylight Time)">11:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">also can we use this to replace the interpreter's <code>ReservedRooted</code> and the roots <a href="https://searchfox.org/mozilla-central/rev/e942f7bc56cd103bba86b396ddeba5b1ab04f1a4/js/src/vm/Interpreter.cpp#2087-2094">here</a>?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Aug 21 2024 05:07:13 GMT-0700 (Pacific Daylight Time)">12:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">what's a good benchmark for testing object.assign?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Aug 21 2024 05:26:13 GMT-0700 (Pacific Daylight Time)">12:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">maybe just a micro-benchmark where you <code>Object.assign(obj, obj)</code> in a loop and it's just an empty object</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Aug 21 2024 05:38:07 GMT-0700 (Pacific Daylight Time)">12:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">there are probably similar builtins with more roots but can't think of any right now</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Aug 21 2024 05:40:04 GMT-0700 (Pacific Daylight Time)">12:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">looks like a 3% improvement for Object.assign(obj, obj)</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Aug 21 2024 05:55:04 GMT-0700 (Pacific Daylight Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">nice. That's a very hot function and there must be other builtins with more than two roots</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Aug 21 2024 06:22:18 GMT-0700 (Pacific Daylight Time)">13:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">anba</span>: hey, I wonder if you have a minute to look at something for me. Do you agree that <a href="https://searchfox.org/mozilla-central/source/js/src/tests/non262/class/superElemDelete.js#49-50">https://searchfox.org/mozilla-central/source/js/src/tests/non262/class/superElemDelete.js#49-50</a> is incorrect since the changes in <a href="https://github.com/tc39/ecma262/pull/3307/files#diff-181371b08d71216599b0acccbaabd03c306da6de142ea6275c2135810999805aR19804">https://github.com/tc39/ecma262/pull/3307/files#diff-181371b08d71216599b0acccbaabd03c306da6de142ea6275c2135810999805aR19804</a> ?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Aug 21 2024 06:51:53 GMT-0700 (Pacific Daylight Time)">13:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><code>Error: got 3.0528675044947478, expected a number near 3.052867504494748 (relative error: 1.793662034335766e-43)</code> ðŸ¤¦</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Aug 21 2024 06:57:49 GMT-0700 (Pacific Daylight Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@anba:mozilla.org">anba</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Ms2ger</span>: Yes, it looks like that the test is no longer correct.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Aug 21 2024 07:00:12 GMT-0700 (Pacific Daylight Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Thanks!</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Aug 21 2024 09:06:43 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: I've invited you to the weekly GC meeting for next week (I thought you were on the invite list already or I would have done it in time for this week's meeting)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Aug 21 2024 09:07:17 GMT-0700 (Pacific Daylight Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Thanks. I think I used to be on it, but must have removed myself last year</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Aug 21 2024 09:25:44 GMT-0700 (Pacific Daylight Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">One of these days I'll go to the GC meeting again.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Aug 21 2024 10:50:02 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">hello i am back with more jittery questions, its not possible right to allocate a NativeObject/some subclass of the same using BaselineCodeGen? i have found examples of pushing existing stuff to an array <a href="https://searchfox.org/mozilla-central/source/js/src/jit/BaselineCodeGen.cpp#6120">example</a> but no example of say allocating something and then pushing all of them are VM calls</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Aug 21 2024 10:53:15 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The jitcode to allocate an object bakes in a variety of realm-specific data, but the baseline interpreter is generated once and shared across an entire runtime, so in general you can't allocate an object directly from BaselineCodeGen. For ops like NewObject, we generally use an inline cache instead.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Aug 21 2024 10:56:23 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Oh, one semi-related thing that occurs to me: assuming that the array you're using is never directly exposed to the user, you should probably be using a <a href="https://searchfox.org/mozilla-central/source/js/src/vm/List.h#32">ListObject</a> instead</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Aug 21 2024 10:56:51 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">ArrayObject has some magic involving the <code>length</code> property that you don't need</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Aug 21 2024 10:58:07 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Oh, one semi-related thing that occurs to me: assuming that the array you're using is never directly exposed to the user, you should probably be using a <a href="https://searchfox.org/mozilla-central/source/js/src/vm/List.h#32">ListObject</a> instead</blockquote></mx-reply>its indeed not exposed to the user yes and intial implementation used ListObject but later switched it to ArrayObject because bytecode cant operate on ListObject</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Aug 21 2024 10:59:11 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Huh, interesting</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Aug 21 2024 10:59:15 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">It seems like we should be able to fix that</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Aug 21 2024 10:59:20 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But it's not a big deal either way</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Aug 21 2024 11:01:17 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The jitcode to allocate an object bakes in a variety of realm-specific data, but the baseline interpreter is generated once and shared across an entire runtime, so in general you can't allocate an object directly from BaselineCodeGen. For ops like NewObject, we generally use an inline cache instead.</blockquote></mx-reply>but this should be possible to do in MIR?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Aug 21 2024 11:01:29 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yes, Ion code is not shared</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Aug 21 2024 11:06:22 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">also since i assume array handling is already very optimised so repeated index access and all would be automatically handled by existing jit code i assume ðŸ˜…</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Aug 21 2024 11:11:37 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I would generally expect arrays and non-arrays to be optimized more-or-less the same unless you're actually calling array methods on them</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Aug 21 2024 11:11:57 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But maybe I'm forgetting something</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Aug 21 2024 11:14:04 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Out of curiosity, what does the bytecode actually look like for a simple case?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Aug 21 2024 11:15:31 GMT-0700 (Pacific Daylight Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Like, what is the output of <code>function foo(o) { using o; } dis(foo)</code>?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Aug 21 2024 11:17:58 GMT-0700 (Pacific Daylight Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><p>its very long ðŸ˜…</p>
<pre><code>loc   line  op
----- ----  --
main:
00000:   1  PushLexicalEnv function lexical {x: env slot 4} # 
00005:   1  Try                         # 
00006:   2  NewInit                     # OBJ
00007:   3  GetGName "Symbol"           # OBJ Symbol
00012:   3  GetProp "dispose"           # OBJ Symbol.dispose
00017:   3  ToPropertyKey               # OBJ TOPROPERTYKEY(Symbol.dispose)
00018:   3  Lambda () =&gt; {}             # OBJ TOPROPERTYKEY(Symbol.dispose) FUN
00023:   3  DupAt 1                     # OBJ TOPROPERTYKEY(Symbol.dispose) FUN TOPROPERTYKEY(Symbol.dispose)
00027:   3  SetFunName 0                # OBJ TOPROPERTYKEY(Symbol.dispose) FUN
00029:   3  InitElem                    # OBJ
00030:   3  IsNullOrUndefined           # OBJ IS_NULL_OR_UNDEF
00031:   3  Not                         # OBJ (!IS_NULL_OR_UNDEF)
00032:   3  JumpIfFalse 116 (+84)       # OBJ
00037:   3  JumpTarget (ic: 7)          # OBJ
00042:   3  IsNullOrUndefined           # OBJ IS_NULL_OR_UNDEF
00043:   3  JumpIfFalse 61 (+18)        # OBJ
00048:   3  JumpTarget (ic: 8)          # OBJ
00053:   3  Undefined                   # OBJ undefined
00054:   3  Undefined                   # OBJ undefined undefined
00055:   3  False                       # OBJ undefined undefined false
00056:   3  Goto 109 (+53)              # OBJ undefined undefined false

# from JumpIfFalse @ 00043
00061:   3  JumpTarget (ic: 8)          # OBJ
00066:   3  CheckIsObj 5                # OBJ
00068:   3  Dup                         # OBJ OBJ
00069:   3  Dup                         # OBJ OBJ OBJ
00070:   3  Symbol 13                   # OBJ OBJ OBJ Symbol.dispose
00072:   3  GetElem                     # OBJ OBJ OBJ[Symbol.dispose]
00073:   3  False                       # OBJ OBJ OBJ[Symbol.dispose] false
00074:   3  DupAt 1                     # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose]
00078:   3  GetIntrinsic "IsCallable"   # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose] IsCallable
00083:   3  Undefined                   # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose] IsCallable undefined
00084:   3  DupAt 2                     # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose] IsCallable undefined OBJ[Symbol.dispose]
00088:   3  Call 1                      # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose] IsCallable(...)
00091:   3  JumpIfTrue 103 (+12)        # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose]
00096:   3  JumpTarget (ic: 12)         # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose]
00101:   3  ThrowMsg 9                  # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose]

# from JumpIfTrue @ 00091
00103:   3  JumpTarget (ic: 12)         # OBJ OBJ OBJ[Symbol.dispose] false OBJ[Symbol.dispose]
00108:   3  Pop                         # OBJ OBJ OBJ[Symbol.dispose] false

# from Goto @ 00056
00109:   3  JumpTarget (ic: 12)         # OBJ merged&lt;undefined&gt; merged&lt;undefined&gt; merged&lt;false&gt;
00114:   3  AddDisposable 0             # OBJ

# from JumpIfFalse @ 00032
00116:   3  JumpTarget (ic: 12)         # OBJ
00121:   3  InitAliasedLexical "x" (hops = 0, slot = 4) # OBJ
00126:   3  Pop                         # 
00127:   3  False                       # false
00128:   3  Undefined                   # false undefined
00129:   3  TakeDisposeCapability       # false undefined DISPOSECAPABILITY
00130:   3  IsNullOrUndefined           # false undefined DISPOSECAPABILITY IS_NULL_OR_UNDEF
00131:   3  JumpIfFalse 147 (+16)       # false undefined DISPOSECAPABILITY
00136:   3  JumpTarget (ic: 13)         # false undefined DISPOSECAPABILITY
00141:   3  Zero                        # false undefined DISPOSECAPABILITY 0
00142:   3  Goto 158 (+16)              # false undefined DISPOSECAPABILITY 0

# from JumpIfFalse @ 00131
00147:   3  JumpTarget (ic: 13)         # false undefined DISPOSECAPABILITY
00152:   3  Dup                         # false undefined DISPOSECAPABILITY DISPOSECAPABILITY
00153:   3  GetProp "length"            # false undefined DISPOSECAPABILITY DISPOSECAPABILITY.length

# from Goto @ 00142
00158:   3  JumpTarget (ic: 14)         # false undefined DISPOSECAPABILITY merged&lt;0&gt;
00163:   3  Dec                         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;)

# from Goto @ 00303
00164:   3  LoopHead (ic: 15, depthHint: 1) # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;)
00170:   3  Dup                         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) (dec merged&lt;0&gt;)
00171:   3  Zero                        # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) (dec merged&lt;0&gt;) 0
00172:   3  Ge                          # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) ((dec merged&lt;0&gt;) &gt;= 0)
00173:   3  JumpIfFalse 308 (+135)      # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;)
00178:   3  JumpTarget (ic: 17)         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;)
00183:   3  Dup2                        # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY (dec merged&lt;0&gt;)
00184:   3  GetElem                     # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00185:   3  Dup                         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00186:   3  GetProp "hint"              # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint
00191:   3  DupAt 1                     # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00195:   3  GetProp "method"            # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00200:   3  Pick 2                      # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00202:   3  GetProp "value"             # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00207:   3  DupAt 1                     # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00211:   3  IsNullOrUndefined           # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method IS_NULL_OR_UNDEF
00212:   3  JumpIfTrue 289 (+77)        # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00217:   3  JumpTarget (ic: 22)         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00222:   3  Pop                         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00223:   3  Try                         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00224:   3  Dup2                        # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00225:   3  Call 0                      # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method()
00228:   3  Pop                         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00229:   3  Goto 276 (+47)              # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value

# try-catch from Try @ 00223
00234:   3  JumpTarget (ic: 23)         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00239:   3  Exception                   # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION
00240:   3  Pick 6                      # false DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION undefined
00242:   3  Pick 7                      # DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION undefined false
00244:   3  JumpIfFalse 265 (+21)       # DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION undefined
00249:   3  JumpTarget (ic: 24)         # DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION undefined
00254:   3  CreateSuppressedError       # DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value &lt;unknown&gt;
00255:   3  Unpick 5                    # &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00257:   3  True                        # &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value true
00258:   3  Unpick 6                    # true &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00260:   3  Goto 276 (+16)              # true &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value

# from JumpIfFalse @ 00244
00265:   3  JumpTarget (ic: 24)         # DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION undefined
00270:   3  Pop                         # DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION
00271:   3  Unpick 5                    # EXCEPTION DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00273:   3  True                        # EXCEPTION DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value true
00274:   3  Unpick 6                    # true EXCEPTION DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value

# from Goto @ 00229, from Goto @ 00260
00276:   3  JumpTarget (ic: 24)         # merged&lt;false&gt; merged&lt;undefined&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00281:   3  PopN 3                      # merged&lt;false&gt; merged&lt;undefined&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;)
00284:   3  Goto 297 (+13)              # merged&lt;false&gt; merged&lt;undefined&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;)

# from JumpIfTrue @ 00212
00289:   3  JumpTarget (ic: 24)         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00294:   3  PopN 4                      # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;)

# from Goto @ 00284
00297:   3  JumpTarget (ic: 24)         # merged&lt;false&gt; merged&lt;undefined&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;)
00302:   3  Dec                         # merged&lt;false&gt; merged&lt;undefined&gt; DISPOSECAPABILITY (dec (dec merged&lt;0&gt;))
00303:   3  Goto 164 (-139)             # merged&lt;false&gt; merged&lt;undefined&gt; DISPOSECAPABILITY (dec (dec merged&lt;0&gt;))

# from JumpIfFalse @ 00173
00308:   3  JumpTarget (ic: 25)         # false undefined DISPOSECAPABILITY (dec merged&lt;0&gt;)
00313:   3  Pop                         # false undefined DISPOSECAPABILITY
00314:   3  Pop                         # false undefined
00315:   3  Swap                        # undefined false
00316:   3  JumpIfFalse 332 (+16)       # undefined
00321:   3  JumpTarget (ic: 26)         # undefined
00326:   3  Throw                       # 
00327:   3  Goto 338 (+11)              # !!! UNREACHABLE !!!

# from JumpIfFalse @ 00316
00332:   3  JumpTarget (ic: 26)         # undefined
00337:   3  Pop                         # 
00338:   3  JumpTarget (ic: 26)         # 
00343:   3  Goto 571 (+228)             # 

# try-finally from Try @ 00005
00348:   3  JumpTarget (ic: 26)         # PC STACK THROWING
00353:   3  Finally                     # PC STACK THROWING
00354:   3  Pick 2                      # STACK THROWING PC
00356:   3  True                        # STACK THROWING PC true
00357:   3  Swap                        # STACK THROWING true PC
00358:   3  TakeDisposeCapability       # STACK THROWING true PC DISPOSECAPABILITY
00359:   3  IsNullOrUndefined           # STACK THROWING true PC DISPOSECAPABILITY IS_NULL_OR_UNDEF
00360:   3  JumpIfFalse 376 (+16)       # STACK THROWING true PC DISPOSECAPABILITY
00365:   3  JumpTarget (ic: 27)         # STACK THROWING true PC DISPOSECAPABILITY
00370:   3  Zero                        # STACK THROWING true PC DISPOSECAPABILITY 0
00371:   3  Goto 387 (+16)              # STACK THROWING true PC DISPOSECAPABILITY 0

# from JumpIfFalse @ 00360
00376:   3  JumpTarget (ic: 27)         # STACK THROWING true PC DISPOSECAPABILITY
00381:   3  Dup                         # STACK THROWING true PC DISPOSECAPABILITY DISPOSECAPABILITY
00382:   3  GetProp "length"            # STACK THROWING true PC DISPOSECAPABILITY DISPOSECAPABILITY.length

# from Goto @ 00371
00387:   3  JumpTarget (ic: 28)         # STACK THROWING true PC DISPOSECAPABILITY merged&lt;0&gt;
00392:   3  Dec                         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;)

# from Goto @ 00532
00393:   3  LoopHead (ic: 29, depthHint: 1) # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;)
00399:   3  Dup                         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) (dec merged&lt;0&gt;)
00400:   3  Zero                        # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) (dec merged&lt;0&gt;) 0
00401:   3  Ge                          # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) ((dec merged&lt;0&gt;) &gt;= 0)
00402:   3  JumpIfFalse 537 (+135)      # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;)
00407:   3  JumpTarget (ic: 31)         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;)
00412:   3  Dup2                        # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY (dec merged&lt;0&gt;)
00413:   3  GetElem                     # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00414:   3  Dup                         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00415:   3  GetProp "hint"              # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint
00420:   3  DupAt 1                     # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00424:   3  GetProp "method"            # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)] DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00429:   3  Pick 2                      # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)]
00431:   3  GetProp "value"             # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00436:   3  DupAt 1                     # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00440:   3  IsNullOrUndefined           # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method IS_NULL_OR_UNDEF
00441:   3  JumpIfTrue 518 (+77)        # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00446:   3  JumpTarget (ic: 36)         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00451:   3  Pop                         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00452:   3  Try                         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00453:   3  Dup2                        # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00454:   3  Call 0                      # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method()
00457:   3  Pop                         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00458:   3  Goto 505 (+47)              # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value

# try-catch from Try @ 00452
00463:   3  JumpTarget (ic: 37)         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00468:   3  Exception                   # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION
00469:   3  Pick 6                      # STACK THROWING true DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION PC
00471:   3  Pick 7                      # STACK THROWING DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION PC true
00473:   3  JumpIfFalse 494 (+21)       # STACK THROWING DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION PC
00478:   3  JumpTarget (ic: 38)         # STACK THROWING DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION PC
00483:   3  CreateSuppressedError       # STACK THROWING DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value &lt;unknown&gt;
00484:   3  Unpick 5                    # STACK THROWING &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00486:   3  True                        # STACK THROWING &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value true
00487:   3  Unpick 6                    # STACK THROWING true &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00489:   3  Goto 505 (+16)              # STACK THROWING true &lt;unknown&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value

# from JumpIfFalse @ 00473
00494:   3  JumpTarget (ic: 38)         # STACK THROWING DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION PC
00499:   3  Pop                         # STACK THROWING DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value EXCEPTION
00500:   3  Unpick 5                    # STACK THROWING EXCEPTION DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00502:   3  True                        # STACK THROWING EXCEPTION DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value true
00503:   3  Unpick 6                    # STACK THROWING true EXCEPTION DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value

# from Goto @ 00458, from Goto @ 00489
00505:   3  JumpTarget (ic: 38)         # STACK THROWING merged&lt;true&gt; merged&lt;PC&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value
00510:   3  PopN 3                      # STACK THROWING merged&lt;true&gt; merged&lt;PC&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;)
00513:   3  Goto 526 (+13)              # STACK THROWING merged&lt;true&gt; merged&lt;PC&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;)

# from JumpIfTrue @ 00441
00518:   3  JumpTarget (ic: 38)         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;) DISPOSECAPABILITY[(dec merged&lt;0&gt;)].hint DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method DISPOSECAPABILITY[(dec merged&lt;0&gt;)].value DISPOSECAPABILITY[(dec merged&lt;0&gt;)].method
00523:   3  PopN 4                      # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;)

# from Goto @ 00513
00526:   3  JumpTarget (ic: 38)         # STACK THROWING merged&lt;true&gt; merged&lt;PC&gt; DISPOSECAPABILITY (dec merged&lt;0&gt;)
00531:   3  Dec                         # STACK THROWING merged&lt;true&gt; merged&lt;PC&gt; DISPOSECAPABILITY (dec (dec merged&lt;0&gt;))
00532:   3  Goto 393 (-139)             # STACK THROWING merged&lt;true&gt; merged&lt;PC&gt; DISPOSECAPABILITY (dec (dec merged&lt;0&gt;))

# from JumpIfFalse @ 00402
00537:   3  JumpTarget (ic: 39)         # STACK THROWING true PC DISPOSECAPABILITY (dec merged&lt;0&gt;)
00542:   3  Pop                         # STACK THROWING true PC DISPOSECAPABILITY
00543:   3  Pop                         # STACK THROWING true PC
00544:   3  Swap                        # STACK THROWING PC true
00545:   3  Pop                         # STACK THROWING PC
00546:   3  Unpick 2                    # PC STACK THROWING
00548:   3  JumpIfFalse 564 (+16)       # PC STACK
00553:   3  JumpTarget (ic: 40)         # PC STACK
00558:   3  ThrowWithStack              # 
00559:   3  Goto 571 (+12)              # !!! UNREACHABLE !!!

# from JumpIfFalse @ 00548
00564:   3  JumpTarget (ic: 40)         # PC STACK
00569:   3  Pop                         # PC
00570:   3  Pop                         # 

# from Goto @ 00343
00571:   3  JumpTarget (ic: 40)         # 
00576:   3  PopLexicalEnv               # 
00577:   5  Undefined                   # undefined
00578:   5  SetRval                     # 
00579:   5  RetRval                     # 

Source notes:
 ofs line column    pc  delta desc             args
---- ---- ------ ----- ------ ---------------- ------
  0:    1     12     0 [   0] colspan          colspan 3
  2:    1     15     6 [   6] newlinecolumn    column 13
  4:    2     13     6 [   0] breakpoint-step-sep
  5:    2     13     7 [   1] newlinecolumn    column 5
  7:    3      5   134 [ 127] xdelta          
  8:    3      5   261 [ 127] xdelta          
  9:    3      5   388 [ 127] xdelta          
 10:    3      5   515 [ 127] xdelta          
 11:    3      5   577 [  62] xdelta          
 12:    3      5   577 [   0] setline          lineno 5
 14:    5      1   579 [   2] breakpoint      

Exception table:
kind               stack    start      end
 catch                 7      224      234
 loop                  4      164      308
 catch                 9      453      463
 loop                  6      393      537
 finally               0        6      348

Scope notes:
   index   parent    start      end
       1   (none)        5      577

GC things:
   index   type       value
       0   Scope      function {} -&gt; global
       1   Scope      function lexical {
                         0: using x (env slot 4)
                      } -&gt; function -&gt; global
       2   Atom       "Symbol"
       3   Atom       "dispose"
       4   Function   (anonymous) @ 3:23
       5   Atom       "IsCallable"
       6   Atom       "length"
       7   Atom       "hint"
       8   Atom       "method"
       9   Atom       "value"
</code></pre>
</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Aug 21 2024 11:18:21 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Oh wow</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Aug 21 2024 11:19:42 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">yeah originally all of it was implemented in a single bytecode but spec adds a await step in the <a href="https://arai-a.github.io/ecma262-compare/?pr=3000&amp;id=sec-disposeresources">midst of a loop hence</a> have to move the full handling into bytecode</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Aug 21 2024 11:26:29 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><p>its more or less equal to what the desugared form of the syntax is which looks some what like <a href="https://github.com/tc39/proposal-explicit-resource-management">this</a></p>
<pre><code>{
  const $$try = { stack: [], error: undefined, hasError: false };
  try {
    ... // (1)

    const x = expr1;
    if (x !== null &amp;&amp; x !== undefined) {
      const $$dispose = x[Symbol.dispose];
      if (typeof $$dispose !== "function") {
        throw new TypeError();
      }
      $$try.stack.push({ value: x, dispose: $$dispose });
    }

    ... // (2)
  }
  catch ($$error) {
    $$try.error = $$error;
    $$try.hasError = true;
  }
  finally {
    while ($$try.stack.length) {
      const { value: $$expr, dispose: $$dispose } = $$try.stack.pop();
      try {
        $$dispose.call($$expr);
      }
      catch ($$error) {
        $$try.error = $$try.hasError ? new SuppressedError($$error, $$try.error) : $$error;
        $$try.hasError = true;
      }
    }
    if ($$try.hasError) {
      throw $$try.error;
    }
  }
}
</code></pre>
</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Aug 21 2024 12:00:52 GMT-0700 (Pacific Daylight Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">debadree25</span>: You mentioned yesterday that we can actually know how big the stack should be at parse time. Is it the case that at any particular point where we do TakeDisposeCapability, we can statically determine the corresponding set of AddDisposables?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Aug 21 2024 12:02:39 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">we can only know the maximum size the stack can go to but no we cannot statically determine how many AddDisposables will be there </td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Aug 21 2024 12:02:43 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">because consider the case </td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Aug 21 2024 12:03:32 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><pre><code>function fn() {
  switch (cond) {
    case 1:
      using x = {
        [Symbol.dispose]() {}
      }
    case 2:
      using y = {
        [Symbol.dispose]() {}
      }
  }
}
</code></pre>
</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Aug 21 2024 12:03:39 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">the above code is allowed</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Aug 21 2024 12:04:00 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">could be other cases like conditionals etc where all the disposables may not be added</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Aug 21 2024 12:05:02 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If I have <code>function foo(o) { if (cond) { using o; a(); } b(); }</code>, do we dispose of <code>o</code> after <code>a()</code>, or <code>b()</code>?</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Aug 21 2024 12:05:17 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <pre><code>function fn() {
  switch (cond) {
    case 1:
      using x = {
        [Symbol.dispose]() {}
      }
    case 2:
      using y = {
        [Symbol.dispose]() {}
      }
  }
}
</code></pre>
</blockquote></mx-reply>For this specific case, Shu from the V8 team opened an issue asking if it can be banned. It might be worth it for you SM folks to chime in</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Aug 21 2024 12:05:30 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> If I have <code>function foo(o) { if (cond) { using o; a(); } b(); }</code>, do we dispose of <code>o</code> after <code>a()</code>, or <code>b()</code>?</blockquote></mx-reply>After a()</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Aug 21 2024 12:05:36 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay, good</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Aug 21 2024 12:06:42 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> If I have <code>function foo(o) { if (cond) { using o; a(); } b(); }</code>, do we dispose of <code>o</code> after <code>a()</code>, or <code>b()</code>?</blockquote></mx-reply>after a()</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Aug 21 2024 12:08:50 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Ah, that's a good pointer. I will leave a comment. (Edit: <a href="https://github.com/tc39/proposal-explicit-resource-management/issues/215#issuecomment-2302865619">comment is here</a>)</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Aug 21 2024 12:34:08 GMT-0700 (Pacific Daylight Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay, assume that we manage to ban the switch fallthrough case, because it's terrible. In every other case, I think we can effectively desugar each <code>using</code> into a single try-finally and eliminate the need for the loop.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Aug 21 2024 12:35:01 GMT-0700 (Pacific Daylight Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Although I'm not sure how the await stuff interacts.</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Aug 21 2024 12:35:34 GMT-0700 (Pacific Daylight Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(That is to say, there is one try-finally per using, not one try-finally overall)</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Aug 21 2024 12:45:46 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">It might be possible to store disposables either on the stack (roughly like we do with for-of) or in local slots, and skip the environment storage entirely</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Aug 21 2024 12:51:04 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Although I'm not sure how the await stuff interacts.</blockquote></mx-reply>most of the problem is here only :-(</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Aug 21 2024 12:51:38 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">but yes theres a bug for this <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1899502">https://bugzilla.mozilla.org/show_bug.cgi?id=1899502</a> once finished implementing will work on it</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Aug 21 2024 13:08:31 GMT-0700 (Pacific Daylight Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: so you can do a try-finally desugaring in all cases, if the thing you're disposing is a DisposableStack instead of each individual <code>using</code> resource, one-by-one (i.e. unrolled)</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Aug 21 2024 13:09:18 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">that is, if for each scope with <code>using</code> decls, have an internal stack structure that tracks how many resources are in scope</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Aug 21 2024 13:10:23 GMT-0700 (Pacific Daylight Time)">20:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I think you can also do a try-finally destructuring for individual <code>using</code> if you are prepared to generate nested try-finally statements</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed Aug 21 2024 13:12:34 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think you can also do a try-finally destructuring for individual <code>using</code> if you are prepared to generate nested try-finally statements</blockquote></mx-reply>that feels right, yeah</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed Aug 21 2024 13:13:20 GMT-0700 (Pacific Daylight Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Our try-finally is pretty lightweight if you aren't throwing anything, so that's the direction I would lean</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed Aug 21 2024 13:14:06 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Although <span class="nick-12">debadree25</span>, who is the one who's actually been looking at this, says that the await stuff is the hard part, and I haven't thought it through at all.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Wed Aug 21 2024 13:14:11 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">to start, V8 opted to use a disposable stack internally, for maximal code sharing with the <code>DisposableStack</code> constructor which needs to exist anyways</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Wed Aug 21 2024 13:14:17 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">and for smaller bytecode</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Wed Aug 21 2024 13:14:27 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">fully unrolled might be worth it up to N resources for small N</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Wed Aug 21 2024 13:14:34 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">but we'll investigate that as an optimization later</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Wed Aug 21 2024 13:15:17 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">the awaits are annoying, for sure. something that tripped us up as an FYI: the spec is written with Await()s inside a loop</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Wed Aug 21 2024 13:15:33 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> the awaits are annoying, for sure. something that tripped us up as an FYI: the spec is written with Await()s inside a loop</blockquote></mx-reply>yeah its very sad</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Wed Aug 21 2024 13:15:37 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">you can't convert that to a promise chain in the implementation</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Wed Aug 21 2024 13:15:45 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">like, it's non-compliant to do so</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Wed Aug 21 2024 13:15:46 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Doesn't that get better if you unroll?</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Wed Aug 21 2024 13:16:26 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">sorry my Awaits point has nothing to do with performance, it's that the spec prescribes a certain number of ticks because it uses inline Await in a loop</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Wed Aug 21 2024 13:16:59 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">and if you are tempted to implement a dispose loop via promise chaining, just FYI that it's technically non-compliant because that'll double the number of ticks</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Wed Aug 21 2024 13:18:31 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I haven't looked closely. If I know at each point what resources are being disposed (which I think is possible if we close the switch hole), and I know whether each using was async or not, then inside my per-using finally, I only need an await iff the corresponding using was async, right?</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Wed Aug 21 2024 13:18:47 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">yep</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Wed Aug 21 2024 13:19:21 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">though there is this additional complexity about "at least one await" that got consensus in a recent plenary</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Wed Aug 21 2024 13:19:42 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">where if you have a bunch of <code>await using</code>s where the RHS end up being null, instead of awaiting once per null, adjacent nulls are coalesced into one await</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Wed Aug 21 2024 13:19:46 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i forget the exact details it's in the spec</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Wed Aug 21 2024 13:20:33 GMT-0700 (Pacific Daylight Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Oh, that's what the needsAwait/hasAwaited stuff is about <a href="https://arai-a.github.io/ecma262-compare/?pr=3000&amp;id=sec-disposeresources">here</a>?</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Wed Aug 21 2024 13:21:07 GMT-0700 (Pacific Daylight Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Wed Aug 21 2024 13:21:08 GMT-0700 (Pacific Daylight Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Oh, that's what the needsAwait/hasAwaited stuff is about <a href="https://arai-a.github.io/ecma262-compare/?pr=3000&amp;id=sec-disposeresources">here</a>?</blockquote></mx-reply>yess</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Wed Aug 21 2024 13:21:39 GMT-0700 (Pacific Daylight Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Gross</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Wed Aug 21 2024 13:27:11 GMT-0700 (Pacific Daylight Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Ugh, it's especially bad because of the possibility of an early exit from the middle of a sequence of <code>await using</code></td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Wed Aug 21 2024 13:27:56 GMT-0700 (Pacific Daylight Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">early exit?</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Wed Aug 21 2024 13:27:56 GMT-0700 (Pacific Daylight Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Why exactly do we need any ticks for <code>await using undefined</code>?</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Wed Aug 21 2024 13:28:11 GMT-0700 (Pacific Daylight Time)">20:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">take that up with mark miller and co</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Wed Aug 21 2024 13:29:14 GMT-0700 (Pacific Daylight Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Suppose you have a sequence of several await usings, and you want to desugar them to individual finally blocks. If you throw/return/whatever before you reach the last one, you will execute some suffix of the finally sequence (since disposal is done in reverse order)</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Wed Aug 21 2024 13:29:42 GMT-0700 (Pacific Daylight Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">ah, jumps during evaluation of the declarations themselves you mean</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Wed Aug 21 2024 13:30:18 GMT-0700 (Pacific Daylight Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Even between them</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Wed Aug 21 2024 13:30:30 GMT-0700 (Pacific Daylight Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Suppose you have a sequence of several await usings, and you want to desugar them to individual finally blocks. If you throw/return/whatever before you reach the last one, you will execute some suffix of the finally sequence (since disposal is done in reverse order)</blockquote></mx-reply>you can add an async generator here too even more fun!</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Wed Aug 21 2024 13:30:41 GMT-0700 (Pacific Daylight Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">haha yeah</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Wed Aug 21 2024 13:30:44 GMT-0700 (Pacific Daylight Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">anyway have fun</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Wed Aug 21 2024 13:31:05 GMT-0700 (Pacific Daylight Time)">20:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">It just seems complicated to track the state of needsAwait / hasAwaited in an unrolled loop when you can jump into arbitrary points in the middle of the "loop"</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Wed Aug 21 2024 13:36:02 GMT-0700 (Pacific Daylight Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> you can add an async generator here too even more fun!</blockquote></mx-reply>I guess a case like <a href="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/explicit-resource-management/async-disposal-during-throw-async-generator.js#69">this</a> wont be statically analysable ?</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Wed Aug 21 2024 13:37:31 GMT-0700 (Pacific Daylight Time)">20:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">debadree25</span>: Why not?</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Wed Aug 21 2024 13:38:04 GMT-0700 (Pacific Daylight Time)">20:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Do you mean what happens when we <del>return</del> throw from <a href="https://searchfox.org/mozilla-central/source/js/src/jit-test/tests/explicit-resource-management/async-disposal-during-throw-async-generator.js#53">here</a>?</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Wed Aug 21 2024 13:38:28 GMT-0700 (Pacific Daylight Time)">20:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Wed Aug 21 2024 13:41:30 GMT-0700 (Pacific Daylight Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><p>Doesn't it desugar to something like this:</p>
<pre><code> async function* gen() {
  yield 1;
  let a_async_disposer = ...
  try {
    yield 2;
    let b_async_disposer = ...
    try {
      yield 3;
    } finally {
      await b_async_disposer();
    }
  } finally {
    await a_async_disposer();
  }
}
</code></pre>
</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Wed Aug 21 2024 13:42:44 GMT-0700 (Pacific Daylight Time)">20:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(Setting aside the whole needsAwait/hasAwaited nonsense for the moment)</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Wed Aug 21 2024 13:43:28 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">ohh ok yes i see it</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Wed Aug 21 2024 13:59:33 GMT-0700 (Pacific Daylight Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><p>With needsAwait/hasAwaited it gets more complicated. I think maybe if there are multiple <code>await using</code> in a single scope, then we have a three-value enum (Initial/NeedsAwait/HasAwaited) living ~somewhere~ that gets initialized sometime before the first <code>await using</code>, and gets checked/updated in each of the finally blocks. Something like this:</p>
<pre><code> async function* gen() {
  let awaitState = Initial;
  yield 1;
  let a_async_disposer = ...
  try {
    yield 2;
    let b_async_disposer = ...
    try {
      yield 3;
    } finally {
      if (b_async_disposer) {
        await b_async_disposer();
	awaitState = HasAwaited;
      } else if (awaitState == Initial) {
        awaitState = NeedsAwait;
      }
    }
  } finally {
    if (a_async_disposer) {
      await a_async_disposer();
      awaitState = HasAwaited;
    } else if (awaitState == Initial) {
      awaitState = NeedsAwait;
    }
    if (awaitState == NeedsAwait) {
      await undefined;
    }
  }
}
</code></pre>
</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Wed Aug 21 2024 14:03:10 GMT-0700 (Pacific Daylight Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">finallys will also have to be special cased so that each of them suppress over the previous one's thrown error, but i get your idea now</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Wed Aug 21 2024 14:03:43 GMT-0700 (Pacific Daylight Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, I have deliberately avoided thinking about the error suppression stuff.</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Wed Aug 21 2024 14:04:22 GMT-0700 (Pacific Daylight Time)">21:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">You can tell that this proposal came from somebody who does not have to do any implementation work ðŸ˜†</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Wed Aug 21 2024 14:09:52 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Ugh, I thought for a moment that we could simplify the needsAwait/hasAwait stuff to a single check in the last <code>finally</code> to see whether we had done any awaits at all, but sadly the <em>timing</em> of the <code>await(undefined)</code> is also observable, and my simplification wouldn't preserve it.</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Wed Aug 21 2024 14:12:11 GMT-0700 (Pacific Daylight Time)">21:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Anyway, I think I've convinced myself that a) a try-finally desugaring is workable, and b) I really don't want to be the person who has to make it work in the bytecode emitter</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Wed Aug 21 2024 14:14:29 GMT-0700 (Pacific Daylight Time)">21:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Anyway, I think I've convinced myself that a) a try-finally desugaring is workable, and b) I really don't want to be the person who has to make it work in the bytecode emitter</blockquote></mx-reply>i will explore the possibilities ðŸ˜„</td></tr>

</tbody></table></div></div></div>
</body></html>