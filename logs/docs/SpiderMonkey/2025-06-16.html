<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-06-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-06-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-06-14" class="nav-link"><span>prev</span></a>
<a href="2025-06-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jun 16 2025 07:25:11 GMT-0700 (Pacific Daylight Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell">CPU arch differences/details question.  We have these two branches of the code: <a href="https://searchfox.org/mozilla-central/source/toolkit/components/resistfingerprinting/nsRFPService.cpp#1675-1719">https://searchfox.org/mozilla-central/source/toolkit/components/resistfingerprinting/nsRFPService.cpp#1675-1719</a> and ran an experiment to see which was faster.
When broken down by CPU arch, it showed that ARM is generally slower and x86 is generally faster: <a href="https://protosaur.dev/perf-reports/canvas-randomization-siphash-arch.html">https://protosaur.dev/perf-reports/canvas-randomization-siphash-arch.html</a>
Does anyone have any intuition that this makes sense; or does it seem surprising?  At one point I was wondering "wouldn't it matter based on specific chip capabilities" - but this is compiled code, we're shipping the same code to an old ARM chip as a brand new one...</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jun 16 2025 12:42:04 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">padenot</span>: courtesy note that I took your name in vain in <a href="https://blog.mozilla.org/sfink/2025/06/16/small-speedometer3-performance-investigation/">https://blog.mozilla.org/sfink/2025/06/16/small-speedometer3-performance-investigation/</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jun 16 2025 12:49:28 GMT-0700 (Pacific Daylight Time)">19:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">tjr</span>: So arm64 was much worse, and x86 was much better? Have you controlled for desktop vs mobile? I would assume that most x86 machines are desktop, and most arm64 machines are mobile, so if there's some sort of systematic difference in terms of eg memory latency, I could imagine that having an effect.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jun 16 2025 12:50:11 GMT-0700 (Pacific Daylight Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Broadly speaking I would say that my default expectation would be that improvements on one architecture would also improve performance on other architectures, but I wouldn't be incredibly surprised to be proven wrong</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jun 16 2025 13:56:12 GMT-0700 (Pacific Daylight Time)">20:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Two blog posts from sfink to read :) Nice </td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jun 16 2025 13:58:41 GMT-0700 (Pacific Daylight Time)">20:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: Guh, I always forget about Android.  (Which is persistent push from the company "Hey yeah don't forget about Android it's pretty important you know!" and yet I still forget.)  However in this situation, the way I forgot about it was that this experiment was <em>only</em> run on Desktop.  So we did accidently control for that.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jun 16 2025 14:00:45 GMT-0700 (Pacific Daylight Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Don't get your expectations up. These are because I've been feeling like I get sucked into rabbit holes, learn some minor thing, then completely forget. So I'm trying to do mini blog posts immediately before moving on to something else. They're short but longer than they'd be if I were actually trying to get a point across or something.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jun 16 2025 14:09:30 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I wholeheartedly support this</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jun 16 2025 14:31:51 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I think I have seen you use convenience variables before (maybe at a presentation in Berlin?), but I've never remembered enough details to look them up / use them myself. I wonder if today is the day that I actually figure out how to use them.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jun 16 2025 14:35:28 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">tjr</span>: I would assume that most arm64 desktop machines are Apple M1s (or successors). If that's the case, then I would once again not be surprised if they have different performance characteristics than the median x86 machine.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jun 16 2025 14:36:19 GMT-0700 (Pacific Daylight Time)">21:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(I should mention that this is all theory-crafting; I haven't looked at the actual code you're comparing in any detail.)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jun 16 2025 15:28:01 GMT-0700 (Pacific Daylight Time)">22:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the basic convenience variables are just named values in the gdb repl: <code>set $foo = v.toObjectOrNull()</code></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jun 16 2025 15:28:09 GMT-0700 (Pacific Daylight Time)">22:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">They're not often all that useful, since you may as well just use <code>$35</code> or whatever.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jun 16 2025 15:28:55 GMT-0700 (Pacific Daylight Time)">22:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">The ones I use are the same thing, but the fun part is that I wrap the print command with something that replaces values in the output with the corresponding variable. So <code>label STR=v.toObjectOrNull()</code> ... <code>p s.d.u2.left</code> displays <code>$18 = (JSString*) $STR</code> in place of <code>$18 = (JSString*) 0xdeadbeef</code> (where the rope <code>s</code>'s left child happens to be that same string.)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jun 16 2025 15:29:42 GMT-0700 (Pacific Daylight Time)">22:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Ah, right, that's the secret magic that I have seen and coveted</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jun 16 2025 15:46:38 GMT-0700 (Pacific Daylight Time)">22:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that requires sourcing the gdbinit scripts (eg conf/<a href="http://gdbstart.py">gdbstart.py</a>, or a subset of what it grabs) from <a href="https://github.com/hotsphink/sfink-tools">https://github.com/hotsphink/sfink-tools</a> (which I can understand people might be reluctant to dive into!). It should be in a reasonable state right now for other people to use. (It has some weird rr log persistence stuff, and I changed from text to json format semi-recently, so there's been churn but it's all <em>supposed</em> to work now.)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jun 16 2025 15:48:46 GMT-0700 (Pacific Daylight Time)">22:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: is your <code>mach try</code> stuff still borked? I wanted to take a look at what's going on there if so. I've run into similar problems a couple of times, and I'd like to teach... something? to report errors better. (At least, I think it's the same symptom? You push to try, it seems happy, then you get a rejection email from lando.)</td></tr>

</tbody></table></div></div></div>
</body></html>