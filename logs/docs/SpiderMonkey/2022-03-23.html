<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-03-23</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-03-23<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-03-22" class="nav-link"><span>prev</span></a>
<a href="2022-03-24" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Mar 22 2022 22:29:51 GMT-0700 (Pacific Daylight Time)">05:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell">Hi, I have a question about using gdb to debug ASan issues -- <a href="https://searchfox.org/mozilla-central/source/tools/sanitizer/docs/asan.rst">https://searchfox.org/mozilla-central/source/tools/sanitizer/docs/asan.rst</a> says "To stop the app in a debugger before ASan exits it, set a<br>breakpoint on <code>__asan::ReportGenericError</code>." Setting a breakpoint on __asan::ReportGenericError has no effect -- anyone know the correct function to set the breakpoint on?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Mar 23 2022 00:50:29 GMT-0700 (Pacific Daylight Time)">07:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">Tim</span>: if you haven't tried it yet, you might consider using rr</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Mar 23 2022 00:51:57 GMT-0700 (Pacific Daylight Time)">07:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell"><code>rr record ./js ....</code> then <code>rr replay</code>, then you are in gdb just like usual, when you continue the program it does what it did last time, and concretely if it runs off the end and exits you can "reverse-continue"</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Mar 23 2022 00:52:04 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">or reverse-step etc</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Mar 23 2022 00:52:22 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">takes away the gdb anxiety of missing your breakpoint</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Mar 23 2022 00:53:00 GMT-0700 (Pacific Daylight Time)">07:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">at the end you can <code>b _exit</code> or whatever the exit function is, and then <code>reverse-finish</code> to get back to where it was called from</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Mar 23 2022 03:44:13 GMT-0700 (Pacific Daylight Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">Tim</span>: <code>__asan_report_error</code> usually works, and then <code>__asan_describe_address(addr)</code>, but yeah, rr is best (both work well)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Mar 23 2022 03:44:51 GMT-0700 (Pacific Daylight Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><code>reverse-continue</code> with <code>watch -l  &lt;variable&gt;</code> on your bad pointer it's really good</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Mar 23 2022 04:05:40 GMT-0700 (Pacific Daylight Time)">11:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: What would be a good place for <code>GlobalObject::isRuntimeCodeGenEnabled</code> now that it doesn't actually require a GlobalObject?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Mar 23 2022 04:38:38 GMT-0700 (Pacific Daylight Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: maybe a stand-alone function in JSContext.h/cpp or else a new Security/CSP file in vm/ ?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Mar 23 2022 05:07:51 GMT-0700 (Pacific Daylight Time)">12:07</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-2" title="@nbp:mozilla.org">nbp</span></div></td><td class="msg-cell">attempt to figure out why when starting firefox from the command line as headless it some times load the same page twice …</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Mar 23 2022 06:29:01 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: WritableStreams are enabled on nightly now. </td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Mar 23 2022 06:29:03 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Mar 23 2022 06:29:19 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(patch originally bounced for inaccurate WPT expectations)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Mar 23 2022 06:29:36 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Thanks to <span class="nick-15">evilpie</span> for doing all the work on implementation!</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Mar 23 2022 07:00:42 GMT-0700 (Pacific Daylight Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">Oh wow, that's huge, nice work!</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Mar 23 2022 07:01:40 GMT-0700 (Pacific Daylight Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">is there a way to disable the session restore? Apparently we are preloading and executing scripts when they are in the session restore tab …</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Mar 23 2022 07:02:52 GMT-0700 (Pacific Daylight Time)">14:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: (guess) flip <code>fission.bfcacheInParent</code>?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Mar 23 2022 07:03:50 GMT-0700 (Pacific Daylight Time)">14:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">There's also some stuff under <code>browser.sessionstore</code> that looks relevant</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Mar 23 2022 07:04:09 GMT-0700 (Pacific Daylight Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I already set all of these to false :/</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Mar 23 2022 07:04:22 GMT-0700 (Pacific Daylight Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">In about:preferences, you can try unchecking "open previous windows and tabs"</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Mar 23 2022 07:10:27 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Thanks, I will check if I can still reproduce, and do that next.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Mar 23 2022 07:14:13 GMT-0700 (Pacific Daylight Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">If that doesn't help, you could see if there's somebody around in maybe <a href="https://matrix.to/#/#dom:mozilla.org">#dom:mozilla.org</a> who actually knows something about session restore.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Mar 23 2022 07:36:40 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: (maybe also <span class="nick-12">annevk</span>) Results for the ReadableStream global test are now accessible: <a href="https://wpt.fyi/results/streams/readable-streams/global.html?label=master&amp;label=experimental&amp;aligned">https://wpt.fyi/results/streams/readable-streams/global.html?label=master&amp;label=experimental&amp;aligned</a></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Mar 23 2022 07:43:18 GMT-0700 (Pacific Daylight Time)">14:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">mgaudet</span>: (maybe also <span class="nick-12">annevk</span>) Results for the ReadableStream global test are now accessible: <a href="https://wpt.fyi/results/streams/readable-streams/global.html?label=master&amp;label=experimental&amp;aligned">https://wpt.fyi/results/streams/readable-streams/global.html?label=master&amp;label=experimental&amp;aligned</a></blockquote></mx-reply><p>Oh cool.</p>
<p>That’s more alignment than I had hoped for</p></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Mar 23 2022 07:43:45 GMT-0700 (Pacific Daylight Time)">14:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Not sure why Safari is broken tho</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Mar 23 2022 07:46:29 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I had the exact same reaction</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Mar 23 2022 07:47:25 GMT-0700 (Pacific Daylight Time)">14:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">maybe Safari doesn't create a real window object for the iframe because it's empty?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Mar 23 2022 15:48:45 GMT-0700 (Pacific Daylight Time)">22:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">What are the semantics of JSOp::SetRval / JSOp::GetRval in top-level scripts? They can be generated for finally blocks, but they don't make much sense.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Mar 23 2022 16:03:54 GMT-0700 (Pacific Daylight Time)">23:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">In baseline/blinterp we just ignore the immutable NoScriptRval flag, but Warp currently asserts that we don't emit them in NoScriptRval scripts. I wonder if we should fix this in the bytecode emitter.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Mar 23 2022 16:11:00 GMT-0700 (Pacific Daylight Time)">23:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">they're for eval's return value</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Mar 23 2022 16:12:01 GMT-0700 (Pacific Daylight Time)">23:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, for NoScriptRval, they're not used I think?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Mar 23 2022 16:14:47 GMT-0700 (Pacific Daylight Time)">23:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, I see that they're emitted even in NoScriptRval top-level, inside finally.  they should be removed</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Mar 23 2022 16:17:57 GMT-0700 (Pacific Daylight Time)">23:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I should be able to look at <code>bce_-&gt;sc-&gt;noScriptRval()</code>, right? Testing a patch right now</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Mar 23 2022 16:22:21 GMT-0700 (Pacific Daylight Time)">23:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, here's the same condition used for expression statement <a href="https://searchfox.org/mozilla-central/rev/630b197be00e3df3f2e3fe995bf31ca50d146eaa/js/src/frontend/BytecodeEmitter.cpp#7042-7044">https://searchfox.org/mozilla-central/rev/630b197be00e3df3f2e3fe995bf31ca50d146eaa/js/src/frontend/BytecodeEmitter.cpp#7042-7044</a></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Mar 23 2022 16:43:59 GMT-0700 (Pacific Daylight Time)">23:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The tests all pass. The code you linked checks <code>isTopLevelContext()</code>; do I need to check that too, or is <code>noScriptRval()</code> enough?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Mar 23 2022 16:46:46 GMT-0700 (Pacific Daylight Time)">23:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">maybe <code>noScriptRval</code> alone would work?  if that's the case, the code above should be rewritten with assertion about <code>isTopLevelContext</code></td></tr>

</tbody></table></div></div></div>
</body></html>