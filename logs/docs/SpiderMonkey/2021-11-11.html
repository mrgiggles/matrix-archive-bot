<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-11-11</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-11-11<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-11-09" class="nav-link"><span>prev</span></a>
<a href="2021-11-15" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Nov 10 2021 23:36:28 GMT-0800 (Pacific Standard Time)">07:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: if there is single inheritance then a type check could be O(1) right?  the usual trick of each type having a field which is a linear array of its parent types; to know of T is an subtype of U, you check if T.parents[U.parents.len] == U</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Nov 10 2021 23:38:37 GMT-0800 (Pacific Standard Time)">07:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">or is canonicalization the problem</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Nov 11 2021 04:36:21 GMT-0800 (Pacific Standard Time)">12:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">wingo: yeah, we could use the super type display trick with the current design of the MVP. Itâ€™s just a missing optimization (amongst others)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Nov 11 2021 04:38:14 GMT-0800 (Pacific Standard Time)">12:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">ok :)  was wondering if the problem of equirecursive type equality somehow bled into subtyping</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Nov 11 2021 04:46:28 GMT-0800 (Pacific Standard Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-16">Ryan Hunt</span> hi, I've just run this simple test in SM:</p>
<pre><code>(module 
    (type $t1 (struct (field i32)))
    (type $t2 (struct (field i32) (field i32)))

    (func (export "main") (result i32)
        (ref.test (struct.new_with_rtt $t2 (i32.const 37) (i32.const 19) (rtt.canon $t2)) (rtt.canon $t1))
    )
)
</code></pre>
<p>and revealed that the result of <code>ref.test</code> is <code>0</code>. I thought that structs in the current MVP desing should follow "width and depth" rule</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 11 2021 04:47:12 GMT-0800 (Pacific Standard Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell">btw, I see that we initialize <code>RttValue::Parent</code> slot only inside <code>rttSub</code></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 11 2021 04:53:31 GMT-0800 (Pacific Standard Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">I believe that the results of your simple test are correct.. canon $t2 has no rtt parent, so it cannot be cast to canon $t1. Even though $t2 &lt;: $t1, you have to construct the rtts using this relationship (via rtt sub) in order to use it at runtime</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 11 2021 04:53:51 GMT-0800 (Pacific Standard Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">Is V8 giving a different result?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 11 2021 04:54:23 GMT-0800 (Pacific Standard Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell">no, SM and V8 return the same results</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 11 2021 05:00:23 GMT-0800 (Pacific Standard Time)">13:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">i didn't realize casts+subtyping required rtt's</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 11 2021 05:00:50 GMT-0800 (Pacific Standard Time)">13:00</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-9" title="@awingo:igalia.com">wingo</span></div></td><td class="msg-cell">ignorant apparently</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 11 2021 05:05:43 GMT-0800 (Pacific Standard Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">i guess that's the "subtyping between nominal and structural types is not allowed currently" point from <a href="https://docs.google.com/document/d/1DklC3qVuOdLHSXB5UXghM_syCh-4cMinQ50ICiXnK3Q/edit#">https://docs.google.com/document/d/1DklC3qVuOdLHSXB5UXghM_syCh-4cMinQ50ICiXnK3Q/edit#</a></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 11 2021 05:20:31 GMT-0800 (Pacific Standard Time)">13:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">Upcasting does not require rtt's. So in the example, you could cast from $t2 to $t1 for free by just passing a $t2 value to $t1 param/local. This works entirely at compile time. Downcasting requires runtime assistance via rtt's. My understanding is that you construct a GC value with the right chain of rtt's for which you'll desire to be able to do downcasts on (the chain is verified at compile time to follow the static subtyping relationship). What you get from this is the ability to do O(1) casts, as you mentioned</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Nov 11 2021 06:06:48 GMT-0800 (Pacific Standard Time)">14:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger ðŸ’‰ðŸ’‰</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: hey, I was wondering if you had thoughts on passing wasm functions to <code>new WebAssembly.Function()</code> - I realized that the existing import-export trick doesn't really work for them</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Nov 11 2021 06:12:32 GMT-0800 (Pacific Standard Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">Ms2ger ðŸ’‰ðŸ’‰</span>: I don't have a strong opinion on it, except that I don't really see the use-case in passing a wasm function to that constructor. It would be nice to not have to handle that case, but I think it might not be terrible to do if we have to. I was hoping the CG would come to a consensus on it, but it doesn't seem like they have (<a href="https://github.com/WebAssembly/js-types/issues/13">https://github.com/WebAssembly/js-types/issues/13</a>).</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Nov 11 2021 06:14:00 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger ðŸ’‰ðŸ’‰</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: fair enough, thanks</td></tr>

</tbody></table></div></div></div>
</body></html>