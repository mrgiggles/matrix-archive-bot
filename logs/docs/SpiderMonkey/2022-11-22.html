<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-11-22</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-11-22<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-11-21" class="nav-link"><span>prev</span></a>
<a href="2022-11-23" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Nov 21 2022 19:54:42 GMT-0800 (Pacific Standard Time)">03:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@diipak:mozilla.org">diipak</span>&gt;</div></td><td class="msg-cell">Hey Community, I am looking forward to embed the Spidermonkey 91 esr to my exisiting C application. Since the JSAPI is already C++fied now. I am thinking creating the C layer as a separate shared library and link it to my C application. But then it leaves me in a situation where I can't use my C application utility to interact with SM.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Nov 21 2022 19:55:24 GMT-0800 (Pacific Standard Time)">03:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@diipak:mozilla.org">diipak</span>&gt;</div></td><td class="msg-cell">Any easy or alternative way around it?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Nov 22 2022 05:54:32 GMT-0800 (Pacific Standard Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">I don't quite understand why you won't be able to use your c application to interact with SM if you have the C layer?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Nov 22 2022 05:56:06 GMT-0800 (Pacific Standard Time)">13:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">I vaguely remember someone doing this ages ago to parse dates in C: <a href="https://gist.github.com/jstepien/2180739">https://gist.github.com/jstepien/2180739</a> -- but I am not sure I understand the second half of the question</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Nov 22 2022 05:57:02 GMT-0800 (Pacific Standard Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">I suspect you've already seen our embedding guide? <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Nov 22 2022 06:00:01 GMT-0800 (Pacific Standard Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: the problem would be the GC, if the global is used as-is with a bare pointer, then the GC is not aware of it, and the second call to <code>JS_EvaluateScript</code> might experience a use-after-free. (in case the heap is compacted and the global move)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Nov 22 2022 06:01:16 GMT-0800 (Pacific Standard Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">oh, that script is 11 years old. It's just the only simple example of embedding SM in C that I can think of off the top of my head</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Nov 22 2022 06:01:56 GMT-0800 (Pacific Standard Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">diipak</span>: If you are looking at making a C embedding, I would look at how mozjs Rust library did, as they could not rely on fixed addresses known by the Garbage Collector, and use a vector of object which are known by the GC.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Nov 22 2022 07:22:30 GMT-0800 (Pacific Standard Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell">Hey, is there a programmatic way (or an example) to create an ES Module, defining exported elements? I mean without doing it through compiling the a generated string containing JS source?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Nov 22 2022 08:28:38 GMT-0800 (Pacific Standard Time)">16:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Not yet, bug 1722802, which was supposed to add one has been stalled for a while though.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Nov 22 2022 08:28:39 GMT-0800 (Pacific Standard Time)">16:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1722802">https://bugzil.la/1722802</a> — UNCONFIRMED (nobody) — Add JSAPI functions to create JS modules w/ custom exports</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Nov 22 2022 08:30:20 GMT-0800 (Pacific Standard Time)">16:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">Treviño</span>: Bug 1670176 would also add some of the infrastructure for this</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Nov 22 2022 08:30:22 GMT-0800 (Pacific Standard Time)">16:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1670176">https://bugzil.la/1670176</a> — NEW (jon4t4n) — Implement the JSON modules proposal</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Nov 22 2022 09:49:48 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@3v1n0:matrix.org">Treviño</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Not yet, bug 1722802, which was supposed to add one has been stalled for a while though.</blockquote></mx-reply>thanks for the pointer</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Nov 22 2022 10:28:34 GMT-0800 (Pacific Standard Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@lgoodacre:matrix.org">liam_g</span>&gt;</div></td><td class="msg-cell">I'd like to compute a hash value of a JSString and separately an std::string for a hash table. Ideally I'd like to be able to have one function which is specialized for both types, meaning probably a function which takes a const char* or string_view argument. I'm not sure how to access this from JSString though. Ideally I'd like to do it without allocation, just iterating over the characters. Any suggestions?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Nov 22 2022 15:19:23 GMT-0800 (Pacific Standard Time)">23:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><code>JS_GetLatin1StringCharsAndLength</code> and <code>JS_GetTwoByteStringCharsAndLength</code> give you a <code>uint8_t*</code> and <code>uint16_t*</code> respectively</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Nov 22 2022 15:19:35 GMT-0800 (Pacific Standard Time)">23:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">You could probably just use those for your hashing</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Nov 22 2022 15:23:30 GMT-0800 (Pacific Standard Time)">23:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">You can use <code>JSString::hasLatin1Chars</code> to check if you should use the former or the latter</td></tr>

</tbody></table></div></div></div>
</body></html>