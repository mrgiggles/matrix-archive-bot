<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-03-21</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-03-21<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-03-20" class="nav-link"><span>prev</span></a>
<a href="2025-03-22" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Mar 20 2025 17:17:19 GMT-0700 (Pacific Daylight Time)">00:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Something like `std::u16string foo(<a href="http://edge.name">edge.name</a>.get())` probably gets you what you want</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Mar 20 2025 18:21:14 GMT-0700 (Pacific Daylight Time)">01:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">maybe you can tweak the testharness, so that the crash details are shown on automation?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Mar 20 2025 18:21:19 GMT-0700 (Pacific Daylight Time)">01:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the message there mentions MOZ_CRASHREPORTER_SHUTDOWN</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Mar 20 2025 18:22:22 GMT-0700 (Pacific Daylight Time)">01:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://firefox-source-docs.mozilla.org/toolkit/crashreporter/crashreporter/index.html">https://firefox-source-docs.mozilla.org/toolkit/crashreporter/crashreporter/index.html</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Mar 20 2025 18:22:47 GMT-0700 (Pacific Daylight Time)">01:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">people in <a href="https://matrix.to/#/#test:mozilla.org">#test:mozilla.org</a> or <a href="https://matrix.to/#/#web-platform:mozilla.org">#web-platform:mozilla.org</a> would know better about how to debug crashes there</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Mar 21 2025 11:29:59 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell">I'm running into an assertion failure when attempting a ubi::Node breadth first traversal

"Assertion failure: get().wantNames, at /home/dj/host_workspace/firefox-102.5.0/js/src/vm/UbiNode.cpp:466"

I think it corresponds to the following line:

<a href="https://searchfox.org/mozilla-central/source/js/src/vm/UbiNode.cpp#479">https://searchfox.org/mozilla-central/source/js/src/vm/UbiNode.cpp#479</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Mar 21 2025 12:34:39 GMT-0700 (Pacific Daylight Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Any ideas on how to make sure this wantNames flag is true?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Mar 21 2025 13:10:31 GMT-0700 (Pacific Daylight Time)">20:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><p>Here's the code where I attempt the traversal.  It gets as far as "Mark 4" before I see the assertion error.</p>
<p>Does anyone know what  I may be doing wrong?</p>
<pre><code>struct EdgeInfo {

};

struct TraversalHandler {
    using NodeData = EdgeInfo;
    using Traversal = JS::ubi::BreadthFirst&lt;TraversalHandler&gt;;

    bool operator() (Traversal&amp; /*traversal*/, JS::ubi::Node /*origin*/, const JS::ubi::Edge&amp; edge, EdgeInfo* /*edgeInfo*/, bool /*first*/) {
        
        std::wcout &lt;&lt; L"operator(): Mark 1" &lt;&lt; std::endl;
        std::u16string edgeName{edge.name.get()};
        std::wcout &lt;&lt; L"operator(): Mark 2" &lt;&lt; std::endl;

        //JS::RootedString edgeStr(traversal.cx, edge.name)
        std::wcout &lt;&lt; L"EDGE NAME: " &lt;&lt; edgeName.c_str() &lt;&lt; std::endl;
        std::wcout &lt;&lt; L"operator(): Mark 3" &lt;&lt; std::endl;

        return true;
    }
};

void printDebugMozJSMemoryUse(JSContext* ctx) {
    JS::ubi::RootList rootList{ctx};
    std::wcout &lt;&lt; L"Mark 1" &lt;&lt; std::endl;
    auto [ok, nogc] = rootList.init();
    std::wcout &lt;&lt; L"Mark 2" &lt;&lt; std::endl;
    if (!ok) {
        ara::log::LogDebug() &lt;&lt; "Could not initialize root list.";
        return;
    }

    JS::ubi::Node root{&amp;rootList};
    
    TraversalHandler handler;
    TraversalHandler::Traversal traversal(ctx, handler, nogc);

    std::wcout &lt;&lt; L"Mark 3" &lt;&lt; std::endl;

    if (!traversal.addStart(root)) {
        ara::log::LogDebug() &lt;&lt; "Out of memory!";
        return;
    }
    std::wcout &lt;&lt; L"Mark 4" &lt;&lt; std::endl;
    
    if (!traversal.traverse()) {
        ara::log::LogDebug() &lt;&lt; "Error with traversal.";
        return;
    }
    std::wcout &lt;&lt; L"Mark 5" &lt;&lt; std::endl;
}
</code></pre>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Mar 21 2025 14:23:20 GMT-0700 (Pacific Daylight Time)">21:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Solved!  The solution was just to pass in wantNames=true to the rootList constructor.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Mar 21 2025 14:34:22 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@sefeng:mozilla.org">sefeng</span>&gt;</div></td><td class="msg-cell">maybe it wasn't my issue...it seems fine now after rebased to latest m-c..weird..  </td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Mar 21 2025 15:03:30 GMT-0700 (Pacific Daylight Time)">22:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">When you create the root list you probably need to pass the second wantnames=true argument to constructor</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Mar 21 2025 15:04:08 GMT-0700 (Pacific Daylight Time)">22:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The assert you hit leads me back to there</td></tr>

</tbody></table></div></div></div>
</body></html>