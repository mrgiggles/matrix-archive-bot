<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-03-12</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-03-12<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-03-11" class="nav-link"><span>prev</span></a>
<a href="2023-03-13" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Mar 12 2023 08:02:42 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">that might work in some cases, and in other cases DOM code could pre-allocate certain strings as nsStringBuffer, since those can be handled as external strings already </td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Mar 12 2023 10:53:39 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><p>Is there something in SpiderMonkey that produces output like <code>%DebugPrint()</code> in V8?:</p>
<pre><code>0x3570040ae115: [Map] in OldSpace
 - type: JS_OBJECT_TYPE
 - instance size: 100
 - inobject properties: 22
 - elements kind: HOLEY_ELEMENTS
 - unused property fields: 0
 - enum length: invalid
 - stable_map
 - back pointer: 0x3570040ae0ed &lt;Map[100](HOLEY_ELEMENTS)&gt;
 - prototype_validity cell: 0x3570040added &lt;Cell value= 0&gt;
 - instance descriptors (own) #22: 0x35700266fc59 &lt;DescriptorArray[22]&gt;
 - prototype: 0x35700266fc21 &lt;Object map = 0x3570040add9d&gt;
 - constructor: 0x3570027e2da9 &lt;JSFunction FiberNode (sfi = 0x3570022a0451)&gt;
 - dependent code: 0x3570000001d9 &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;
 - construction counter: 0

DebugPrint: 0x357002f8cfd5: [JS_OBJECT_TYPE]
 - map: 0x3570040ae115 &lt;Map[100](HOLEY_ELEMENTS)&gt; [FastProperties]
 - prototype: 0x35700266fc21 &lt;Object map = 0x3570040add9d&gt;
 - elements: 0x3570000001c9 &lt;FixedArray[0]&gt; [HOLEY_ELEMENTS]
 - properties: 0x3570000001c9 &lt;FixedArray[0]&gt;
 - All own properties (excluding elements): {
    0x35700019aeed: [String] in OldSpace: #tag: 2 (data field 0), location: in-object
    0x35700019a7c1: [String] in OldSpace: #key: 0x3570001a2d39 &lt;String[4]: #menu&gt; (const data field 1), location: in-object
    0x35700201e1b9: [String] in OldSpace: #elementType: 0x3570000001e5 &lt;null&gt; (data field 2), location: in-object
    0x357000003ead: [String] in ReadOnlySpace: #type: 0x3570000001e5 &lt;null&gt; (data field 3), location: in-object
    0x357002019b35: [String] in OldSpace: #stateNode: 0x3570000001e5 &lt;null&gt; (data field 4), location: in-object
    0x3570000053c9: [String] in ReadOnlySpace: #return: 0x3570000001e5 &lt;null&gt; (data field 5), location: in-object
    0x3570001a1351: [String] in OldSpace: #child: 0x3570000001e5 &lt;null&gt; (data field 6), location: in-object
    0x3570001a2a01: [String] in OldSpace: #sibling: 0x3570000001e5 &lt;null&gt; (data field 7), location: in-object
    0x357000004b21: [String] in ReadOnlySpace: #index: 0 (data field 8), location: in-object
    0x3570001a049d: [String] in OldSpace: #ref: 0x3570000001e5 &lt;null&gt; (data field 9), location: in-object
    0x35700201e0c5: [String] in OldSpace: #pendingProps: 0x357002f8c48d &lt;Object map = 0x3570046d58e9&gt; (data field 10), location: in-object
    0x3570040adb1d: [String] in OldSpace: #memoizedProps: 0x3570000001e5 &lt;null&gt; (data field 11), location: in-object
    0x35700201da61: [String] in OldSpace: #updateQueue: 0x3570000001e5 &lt;null&gt; (data field 12), location: in-object
    0x35700201ed8d: [String] in OldSpace: #memoizedState: 0x3570000001e5 &lt;null&gt; (data field 13), location: in-object
    0x357001fffb15: [String] in OldSpace: #dependencies: 0x3570000001e5 &lt;null&gt; (data field 14), location: in-object
    0x35700019a7a1: [String] in OldSpace: #mode: 0 (const data field 15), location: in-object
    0x357000004845: [String] in ReadOnlySpace: #flags: 0 (data field 16), location: in-object
    0x35700201fbb5: [String] in OldSpace: #subtreeFlags: 0 (data field 17), location: in-object
    0x357002015d65: [String] in OldSpace: #deletions: 0x3570000001e5 &lt;null&gt; (data field 18), location: in-object
    0x35700201a099: [String] in OldSpace: #lanes: 0 (data field 19), location: in-object
    0x3570040adb39: [String] in OldSpace: #childLanes: 0 (data field 20), location: in-object
    0x357002004545: [String] in OldSpace: #alternate: 0x3570000001e5 &lt;null&gt; (data field 21), location: in-object
 }
</code></pre>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sun Mar 12 2023 10:55:07 GMT-0700 (Pacific Daylight Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><code>dumpObject()</code>?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sun Mar 12 2023 14:42:37 GMT-0700 (Pacific Daylight Time)">21:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">How does SM decide what size of object to allocate at given site?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sun Mar 12 2023 16:47:16 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">jrmuizel</span>: Object literals are based on their size. Objects with reserved slots round up. Everything else gets a default of 4, I think</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sun Mar 12 2023 16:47:47 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: what are Objects with reserved slots?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sun Mar 12 2023 16:49:30 GMT-0700 (Pacific Daylight Time)">23:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">jrmuizel</span>: Builtins with internal state, like Map or Function</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sun Mar 12 2023 16:50:52 GMT-0700 (Pacific Daylight Time)">23:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-4">iain</span>: so is it expected that something like</p>
<pre><code class="language-js">function FiberNode(tag, pendingProps, key, mode) {
  this.tag = tag;
  this.key = key;
  this.sibling = this.child = this.return = this.stateNode = this.type = this.elementType = null;
  this.index = 0;
  this.ref = null;
  this.pendingProps = pendingProps;
  this.dependencies = this.memoizedState = this.updateQueue = this.memoizedProps = null;
  this.mode = mode;
  this.subtreeFlags = this.flags = 0;
  this.deletions = null;
  this.childLanes = this.lanes = 0;
  this.alternate = null;
}
let new f = new FiberNode([args])
</code></pre>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sun Mar 12 2023 16:51:02 GMT-0700 (Pacific Daylight Time)">23:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">would resize on during construction?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sun Mar 12 2023 16:51:12 GMT-0700 (Pacific Daylight Time)">23:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yes</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sun Mar 12 2023 16:51:48 GMT-0700 (Pacific Daylight Time)">23:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">it seems like V8 tries to not (and succeeds)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sun Mar 12 2023 16:52:10 GMT-0700 (Pacific Daylight Time)">23:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">IonBuilder used to have a very complicated optimization for avoiding it</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sun Mar 12 2023 16:53:40 GMT-0700 (Pacific Daylight Time)">23:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">but was deemed not worth it? or just not compelling enough to rebuild yet?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sun Mar 12 2023 16:54:46 GMT-0700 (Pacific Daylight Time)">23:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">It depended pretty heavily on TI, which is what WarpBuilder was designed to let us remove</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sun Mar 12 2023 16:55:19 GMT-0700 (Pacific Daylight Time)">23:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I have some thoughts about simpler versions</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sun Mar 12 2023 16:56:49 GMT-0700 (Pacific Daylight Time)">23:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">is there a bug or anything associated with it?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sun Mar 12 2023 16:59:03 GMT-0700 (Pacific Daylight Time)">23:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Not to the best of my knowledge</td></tr>

</tbody></table></div></div></div>
</body></html>