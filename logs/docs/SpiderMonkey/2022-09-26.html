<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-09-26</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-09-26<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-09-25" class="nav-link"><span>prev</span></a>
<a href="2022-09-27" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Sep 26 2022 02:37:42 GMT-0700 (Pacific Daylight Time)">09:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@mohamed_atef:matrix.org">Mohamed Atef</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <a href="https://phabricator.services.mozilla.com/D157842">https://phabricator.services.mozilla.com/D157842</a></blockquote></mx-reply>Ping</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Sep 26 2022 02:50:13 GMT-0700 (Pacific Daylight Time)">09:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thank you for ping</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Sep 26 2022 07:45:10 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">Hello all. I'm facing a simple issue with rooting where I'm sure I'm taking the long way around. I'm currently rooting on the stack a temporary variable which I initialize with a HandleValue; say <code>JS::RootedObject o(ctx, &amp;someHandleValue.toObject())</code>. This conversion is necessary because later on I use another JSAPI which takes a HandleObject. Is there an easy way out of this? Are conversions from HandleValue implemented somewhere I'm not looking at?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Sep 26 2022 07:46:14 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger ðŸ’‰ðŸ’‰</span>&gt;</div></td><td class="msg-cell">No, this is the way to go</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Sep 26 2022 07:49:39 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">Thanks, just felt silly to go through this.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Sep 26 2022 08:41:39 GMT-0700 (Pacific Daylight Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">Is it normal that when you try to use <code>toInt32()</code> on a return rval from <code>JS_CallFunctionName</code> that some assertion fails?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Sep 26 2022 08:44:21 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">if you didn't check <code>isInt32()</code> first, maybe?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Sep 26 2022 08:44:57 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">Another less silly question.  My app only has one thread and I would like to decouple a simple UDP listener from the main thread. I can spawn a thread from C and create a new context to do some JS interactions on the new thread. Another options would be to spawn a thread from a JSNATIVE and start the UDP listener there. I'm not sure which approach to take and it would be nice to hear if one of the two is (already) doomed to fail.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Sep 26 2022 08:46:02 GMT-0700 (Pacific Daylight Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger ðŸ’‰ðŸ’‰</span>&gt;</div></td><td class="msg-cell">If your first approach implies touching the same js objects from different threads, that's doomed :)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Sep 26 2022 08:49:01 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">I understand that two different contexts and different (separated) realms cannot share JS objects but I also saw the "transplant" part of the API. I'm not going to share JS objects between the two until I  <strong>really</strong> need to.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Sep 26 2022 08:50:27 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">Ideally I would use a very simple <code>network.js</code> script to read the incoming packets, do some book-keeping on the senders and transplant an array buffer to the <code>main.js</code></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Sep 26 2022 08:50:56 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Transplanting is extremely complex so you really do not want to use it. Also transplanting only involves objects on the same thread and in the same JS runtime.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Sep 26 2022 08:51:24 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">excellent XD</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Sep 26 2022 08:51:37 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">In Firefox, "moving" objects between threads like that would involve structured clone.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Sep 26 2022 08:52:04 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">You structured clone an object from one thread into a buffer, transfer the buffer, then deserialize it out. I don't know if it supports whatever types you need, though. Also it is fairly complex.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Sep 26 2022 08:52:43 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger ðŸ’‰ðŸ’‰</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Transplanting is extremely complex so you really do not want to use it. Also transplanting only involves objects on the same thread and in the same JS runtime.</blockquote></mx-reply><pre><code>This place is not a place of honorâ€¦no highly esteemed deed is commemorated hereâ€¦nothing valued is here.
</code></pre>
</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Sep 26 2022 08:58:05 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">How do you know when to use HandleValue vs RootedValue? Like would I use RootedValue for obtaining return values from JS and for passing C++ values to JS?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Sep 26 2022 08:58:43 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger ðŸ’‰ðŸ’‰</span>&gt;</div></td><td class="msg-cell">Rooted for variables, Handle for arguments</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Sep 26 2022 08:59:05 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/GC%20Rooting%20Guide.md">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/GC%20Rooting%20Guide.md</a></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Sep 26 2022 08:59:33 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">I've read it</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Sep 26 2022 09:00:24 GMT-0700 (Pacific Daylight Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Rooted for variables, Handle for arguments</blockquote></mx-reply>in what context? handle for passing arguments to calling a JS function in C++?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Sep 26 2022 09:01:24 GMT-0700 (Pacific Daylight Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> You structured clone an object from one thread into a buffer, transfer the buffer, then deserialize it out. I don't know if it supports whatever types you need, though. Also it is fairly complex.</blockquote></mx-reply>For more context. I receive some UDP packets, join them together when I see all I needed, expose them as an ArrayBuffer to a <code>network.js</code> script which may decide to drop it all-together or forward it to <code>main.js</code> which is executed on a different thread because I don't want the network to block. Structured clone sounds good enough for me and would allow me to keep allocation and deallocation in the same thread (network) which should be a plus. Thanks a lot for the input.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Sep 26 2022 09:05:47 GMT-0700 (Pacific Daylight Time)">16:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">Maybe my initial question would be best rephrased as how bad am I going to suffer to spawn a thread from inside a JSNATIVE? </td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Sep 26 2022 09:07:37 GMT-0700 (Pacific Daylight Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@edoput:mozilla.org">edoput</span>&gt;</div></td><td class="msg-cell">I guess this is the approach a Workers like API would take but I'm unsure if I'm actually better with just two C threads spawned at the beginning of time</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Sep 26 2022 09:31:45 GMT-0700 (Pacific Daylight Time)">16:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">how do you properly check if converting a <code>BigInt</code> into a <code>uint64_t</code> will cause an overflow or not?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Sep 26 2022 09:32:54 GMT-0700 (Pacific Daylight Time)">16:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">using the static functions <code>JS::BigInt::lessThan</code>?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Sep 26 2022 09:37:20 GMT-0700 (Pacific Daylight Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">use <code>JS::BigIntFits(JS::BigInt*, uint64_t*)</code>: <a href="https://searchfox.org/mozilla-central/source/js/public/BigInt.h#208">https://searchfox.org/mozilla-central/source/js/public/BigInt.h#208</a></td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Sep 26 2022 09:53:34 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> use <code>JS::BigIntFits(JS::BigInt*, uint64_t*)</code>: <a href="https://searchfox.org/mozilla-central/source/js/public/BigInt.h#208">https://searchfox.org/mozilla-central/source/js/public/BigInt.h#208</a></blockquote></mx-reply>ah thank you, was looking in src/vm/BigIntType.h as that's where I found ToBigInt and all the other API I needed.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Sep 26 2022 09:59:57 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">oh...I don't have it from the patches at the bottom...
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1606568">https://bugzilla.mozilla.org/show_bug.cgi?id=1606568</a></td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Sep 26 2022 10:03:50 GMT-0700 (Pacific Daylight Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">i.e. it doesn't exist in esr78</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Sep 26 2022 10:13:38 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">also as a SM embedder, am I supposed to not have access to JS::BigInt::SomeStaticFunction?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Sep 26 2022 10:27:51 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">if it's in <code>src/vm/</code>, then those are not exposed in the headers and shared library</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Sep 26 2022 10:33:31 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">I forgot I added more public BigInt APIs in a different bug: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1706866">https://bugzilla.mozilla.org/show_bug.cgi?id=1706866</a></td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Sep 26 2022 10:53:15 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">thank you for the link</td></tr>

</tbody></table></div></div></div>
</body></html>