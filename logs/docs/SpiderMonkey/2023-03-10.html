<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-03-10</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-03-10<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-03-09" class="nav-link"><span>prev</span></a>
<a href="2023-03-11" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Mar 09 2023 16:29:56 GMT-0800 (Pacific Standard Time)">00:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: it seems there's a lot of stuff that ends up as uncompressed text data so doesn't benefit much from wasm-opt. I'm seeing the optimized build getting from about 26MB to 23MB where the reduction is almost exactly the same as for the non-Intl build. Cost may be prohibitive, so this may just be an area we actually need to research some better techniques. For now though at least we've worked around some of the APIs at the JS level. Thanks again for the help.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Mar 10 2023 09:05:29 GMT-0800 (Pacific Standard Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@sili:mozilla.org">sili</span>&gt;</div></td><td class="msg-cell">Is there a way to register callback (or something else) that will trigger moment Object is garbage collected? I have a scenario where a JS Object is linked to a C++ instance and I want to properly dispose the C++ counter part once the Object is garbage collected.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Mar 10 2023 09:06:43 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">sili</span>: Give the object a class with a finalize hook</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Mar 10 2023 09:10:25 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Here's an example of an <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/intl/ListFormat.h#23">object</a> with a <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/intl/ListFormat.cpp#31-42">finalize</a> <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/intl/ListFormat.cpp#123-132">hook</a>.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Mar 10 2023 09:22:23 GMT-0800 (Pacific Standard Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Is there an example for how to extend from another class when defining classes in spidermonkey?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Mar 10 2023 09:25:58 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">ah, I see there's an example about the prototype chain.  That would probably be it.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Mar 10 2023 09:32:29 GMT-0800 (Pacific Standard Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@caleb.distributive:mozilla.org">caleb.distributive</span>&gt;</div></td><td class="msg-cell">Hey I'm embedding Spidermonkey, is there a way in the API to create a JSExternalString from a char* buffer for latin1 strings (rather than a char16_t* buffer for UTF16 strings)? I'm aware of JS_NewExternalString but it only takes char16_t*.

Basically I have a char* buffer that I want to make a JSString from, but I don't want Spidermonkey to take ownership for freeing that memory, I already handle that myself</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Mar 10 2023 09:34:27 GMT-0800 (Pacific Standard Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@caleb.distributive:mozilla.org">caleb.distributive</span>&gt;</div></td><td class="msg-cell">and I also don't want to copy that memory ideally</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Mar 10 2023 09:58:17 GMT-0800 (Pacific Standard Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Here's an example of an <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/intl/ListFormat.h#23">object</a> with a <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/intl/ListFormat.cpp#31-42">finalize</a> <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/intl/ListFormat.cpp#123-132">hook</a>.</blockquote></mx-reply>Is there a similar example for when the object gets relocated?  specifically for JitCode so we can emit a JIT_CODE_MOVE in the jitdump and remove this hack <a href="https://searchfox.org/mozilla-central/source/js/src/jit/Ion.cpp#622-628">https://searchfox.org/mozilla-central/source/js/src/jit/Ion.cpp#622-628</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Mar 10 2023 10:02:52 GMT-0800 (Pacific Standard Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is there a similar example for when the object gets relocated?  specifically for JitCode so we can emit a JIT_CODE_MOVE in the jitdump and remove this hack <a href="https://searchfox.org/mozilla-central/source/js/src/jit/Ion.cpp#622-628">https://searchfox.org/mozilla-central/source/js/src/jit/Ion.cpp#622-628</a></blockquote></mx-reply>objectMovedOp maybe? <a href="https://searchfox.org/mozilla-central/source/js/public/Class.h#465">https://searchfox.org/mozilla-central/source/js/public/Class.h#465</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Mar 10 2023 10:03:21 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">nsWrapperCache::UpdateWrapper talks about that, though hopefully you can find a simpler example...</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Mar 10 2023 10:11:14 GMT-0800 (Pacific Standard Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">mccr8</span>: thanks, I can probably try to follow that</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Mar 10 2023 10:15:12 GMT-0800 (Pacific Standard Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Looks like MapIteratorObject defines that hook so hopefully that's in the simpler end of things.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Mar 10 2023 10:20:55 GMT-0800 (Pacific Standard Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell">I guess maybe I need something in <a href="https://searchfox.org/mozilla-central/source/js/src/gc/Compacting.cpp#211">https://searchfox.org/mozilla-central/source/js/src/gc/Compacting.cpp#211</a> ?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Mar 10 2023 10:21:38 GMT-0800 (Pacific Standard Time)">18:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">caleb.distributive</span>: JSExternalString only supports two-byte strings. There is also <a href="https://searchfox.org/mozilla-central/source/js/src/jsapi.cpp#1457">JS_NewMaybeExternalString</a>, which will copy the data inline if it's short enough and otherwise create an external string, but that takes char* input too.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Mar 10 2023 10:22:07 GMT-0800 (Pacific Standard Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I can only assume that Gecko never needed external char* strings, so we never implemented them</td></tr>

</tbody></table></div></div></div>
</body></html>