<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-06-10</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-06-10<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-06-08" class="nav-link"><span>prev</span></a>
<a href="2024-06-11" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jun 10 2024 01:15:42 GMT-0700 (Pacific Daylight Time)">08:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Shu in Bug 1263355, apparently</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jun 10 2024 01:15:45 GMT-0700 (Pacific Daylight Time)">08:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1263355">https://bugzil.la/1263355</a> — RESOLVED (shu) — Rewrite the frontend: bindings</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jun 10 2024 02:31:24 GMT-0700 (Pacific Daylight Time)">09:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">say we wrote some bad code and we encounter a crash! something like this</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jun 10 2024 02:31:31 GMT-0700 (Pacific Daylight Time)">09:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><pre><code>[16192] Assertion failure: scope == &amp;env_-&gt;as&lt;BlockLexicalEnvironmentObject&gt;().scope(), at /Users/debadreechatterjee/Documents/personal/mozilla-unified/js/src/vm/EnvironmentObject.cpp:1480
#01: js::EnvironmentIter::settle() (.cold.2)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x2a4634]
#02: js::EnvironmentIter::settle()[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x2823dc]
#03: js::EnvironmentIter::EnvironmentIter(JSContext*, js::AbstractFramePtr, unsigned char const*)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x28280c]
#04: js::Interpret(JSContext*, js::RunState&amp;)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0xdcbf8]
#05: js::RunScript(JSContext*, js::RunState&amp;)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0xc3ac8]
#06: js::ExecuteKernel(JSContext*, JS::Handle&lt;JSScript*&gt;, JS::Handle&lt;JSObject*&gt;, js::AbstractFramePtr, JS::MutableHandle&lt;JS::Value&gt;)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0xc5b80]
#07: js::Execute(JSContext*, JS::Handle&lt;JSScript*&gt;, JS::Handle&lt;JSObject*&gt;, JS::MutableHandle&lt;JS::Value&gt;)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0xc5ebc]
#08: ExecuteScript(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::Handle&lt;JSScript*&gt;, JS::MutableHandle&lt;JS::Value&gt;)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x278768]
#09: JS_ExecuteScript(JSContext*, JS::Handle&lt;JSScript*&gt;)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x278948]
#10: RunFile(JSContext*, char const*, __sFILE*, CompileUtf8, bool, bool)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x51a24]
#11: Process(JSContext*, char const*, bool, FileKind)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x51504]
#12: Shell(JSContext*, js::cli::OptionParser*)[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0xed40]
#13: main[/Users/debadreechatterjee/Documents/personal/mozilla-unified/obj-debug-aarch64-apple-darwin23.4.0/dist/bin/js +0x82d4]
</code></pre>
</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jun 10 2024 02:31:54 GMT-0700 (Pacific Daylight Time)">09:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">note that the first line gives the full information including the file and the line numbers</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jun 10 2024 02:32:50 GMT-0700 (Pacific Daylight Time)">09:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">but from the second line onwards all the line numbers seem to be from within the generated binary anyway we can prevent this and have line numbers every where?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jun 10 2024 02:35:52 GMT-0700 (Pacific Daylight Time)">09:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">oh i realise the line number in the first place maybe coming because its a MOZ_ASSERT that failed </td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jun 10 2024 02:36:13 GMT-0700 (Pacific Daylight Time)">09:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Yeah, that line is baked into the binary</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jun 10 2024 02:37:18 GMT-0700 (Pacific Daylight Time)">09:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">There's probably a way to recover the others, but I don't recall how</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jun 10 2024 02:48:22 GMT-0700 (Pacific Daylight Time)">09:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">debadree25</span>: it should work, but doesn't. when that happens you can usually feed the text to <code>tools/rb/fix_stacks.py</code></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jun 10 2024 02:50:19 GMT-0700 (Pacific Daylight Time)">09:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">worst case you can do manual calls to <code>addr2line</code></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jun 10 2024 03:00:56 GMT-0700 (Pacific Daylight Time)">10:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">debadree25</span>: it should work, but doesn't. when that happens you can usually feed the text to <code>tools/rb/fix_stacks.py</code></blockquote></mx-reply>how does one use this script? something like tools/rb/fix_stacks.py &lt;stack trace&gt;</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jun 10 2024 03:01:17 GMT-0700 (Pacific Daylight Time)">10:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">feed the stack to its stdin</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jun 10 2024 03:01:48 GMT-0700 (Pacific Daylight Time)">10:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">e.g. <code>cat | tools/rb/fix_stacks.py</code>, then paste what you had sent above, then ctrl+d a couple times</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jun 10 2024 03:02:19 GMT-0700 (Pacific Daylight Time)">10:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">it can take some time (multiple seconds depending on your machine)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jun 10 2024 03:08:10 GMT-0700 (Pacific Daylight Time)">10:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">trying! thank you!!</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jun 10 2024 03:33:41 GMT-0700 (Pacific Daylight Time)">10:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">it worked \o/</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jun 10 2024 06:29:31 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@fitch86:matrix.org">fitch86</span>&gt;</div></td><td class="msg-cell">I'm planning to use <code>Stencil</code> to pre-compile and share some common JS code across multiple global objects (with one thread and one JSContext). What can I expect from the memory consumption POV? Can I expect some significant savings or is only the runtime that's going to improve?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jun 10 2024 06:41:09 GMT-0700 (Pacific Daylight Time)">13:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if it's shared within single process, there won't be much effect on the memory consumption, except for not having multiple temporary Stencil objects during compilation+instantiation</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jun 10 2024 06:42:17 GMT-0700 (Pacific Daylight Time)">13:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, it will mostly affect the runtime performance, where extra compilation step can be skipped</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jun 10 2024 06:44:06 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you have multiple processes, Stencil can share the underlying data between them, by putting the stencil XDR in the shared memory and decoding from it, instead of compiling in each process</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jun 10 2024 15:27:49 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">iain's explanation in bug 1901166 is quite the tale of madness and deceit</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jun 10 2024 15:27:52 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1901166">https://bugzil.la/1901166</a> — NEW (nobody) — Assertion failure: cx_-&gt;hadResourceExhaustion(), at jit/WarpOracle.cpp:206</td></tr>

</tbody></table></div></div></div>
</body></html>