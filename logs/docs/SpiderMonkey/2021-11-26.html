<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-11-26</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-11-26<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-11-25" class="nav-link"><span>prev</span></a>
<a href="2021-11-27" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Nov 25 2021 17:51:45 GMT-0800 (Pacific Standard Time)">01:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">jakechampion</span>: for debug print, you can use <a href="https://searchfox.org/mozilla-central/rev/7fe9421af35256a95acc4620e9e0b76df7867287/js/src/builtin/Utilities.js#15-20"><code>dbg</code> macro</a>, or <a href="https://searchfox.org/mozilla-central/rev/7fe9421af35256a95acc4620e9e0b76df7867287/js/src/vm/SelfHosting.cpp#2133"><code>DumpMessage</code> function</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Nov 25 2021 17:52:10 GMT-0800 (Pacific Standard Time)">01:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">both works only in debug build (<code>ac_add_options --enable-debug</code>)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Nov 25 2021 17:52:35 GMT-0800 (Pacific Standard Time)">01:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">on non-debug build, they're no-op</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Nov 25 2021 19:44:02 GMT-0800 (Pacific Standard Time)">03:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's the conceptual difference between <a href="https://searchfox.org/mozilla-central/rev/7fe9421af35256a95acc4620e9e0b76df7867287/js/public/RealmOptions.h#71"><code>RealmCreatingOptions</code></a> vs <a href="https://searchfox.org/mozilla-central/rev/7fe9421af35256a95acc4620e9e0b76df7867287/js/public/ContextOptions.h#20"><code>ContextOptions</code></a> for experimental spec feature options?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Nov 25 2021 19:45:59 GMT-0800 (Pacific Standard Time)">03:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">for example, streams options are defined in <code>RealmCreationOptions</code>, and private class fields options are defined in <code>ContextOptions</code></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 25 2021 19:46:20 GMT-0800 (Pacific Standard Time)">03:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm now wondering if there's any rule about which one to use for which case</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 25 2021 20:16:37 GMT-0800 (Pacific Standard Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</div></td><td class="msg-cell">realms are great and something quite easily confused w/ zones</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 25 2021 20:19:05 GMT-0800 (Pacific Standard Time)">04:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</div></td><td class="msg-cell">it is very similar to iframes and this seems to be a solved problem</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 25 2021 20:21:09 GMT-0800 (Pacific Standard Time)">04:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: zones vs realms; there was some conclusion about naming iirc</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 25 2021 20:22:14 GMT-0800 (Pacific Standard Time)">04:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</div></td><td class="msg-cell">zones became extinct at some point, no?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 25 2021 20:24:52 GMT-0800 (Pacific Standard Time)">04:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</div></td><td class="msg-cell">haven't an idea how to help, but iirc there was some conclusion about zones no longer moving forward</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 25 2021 20:26:24 GMT-0800 (Pacific Standard Time)">04:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</div></td><td class="msg-cell">anyways, wish i could point you to something, but there is so much code to look through lol</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 25 2021 20:32:49 GMT-0800 (Pacific Standard Time)">04:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">DerekNonGeneric</span>: thanks, but I think it's about unrelated topic</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Nov 26 2021 05:55:56 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> what's the conceptual difference between <a href="https://searchfox.org/mozilla-central/rev/7fe9421af35256a95acc4620e9e0b76df7867287/js/public/RealmOptions.h#71"><code>RealmCreatingOptions</code></a> vs <a href="https://searchfox.org/mozilla-central/rev/7fe9421af35256a95acc4620e9e0b76df7867287/js/public/ContextOptions.h#20"><code>ContextOptions</code></a> for experimental spec feature options?</blockquote></mx-reply>can anyone look into this?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Nov 26 2021 05:56:06 GMT-0800 (Pacific Standard Time)">13:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">or, can anyone answer <a href="https://phabricator.services.mozilla.com/D131799#4300998">https://phabricator.services.mozilla.com/D131799#4300998</a> ?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Nov 26 2021 06:05:16 GMT-0800 (Pacific Standard Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jakechampion:mozilla.org">jakechampion</span>&gt;</div></td><td class="msg-cell">@arai would it be that by using RealmCreatingOptions then each realm can decide whether to enable the experimental features or not to?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Nov 26 2021 06:16:57 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, but I'm not sure if experimental feature options currently listed there requires such detailed control, compared to ContextOptions</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Nov 26 2021 06:19:23 GMT-0800 (Pacific Standard Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I wonder if there's any other thing than granularity of the control</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Nov 26 2021 06:25:50 GMT-0800 (Pacific Standard Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">jakechampion</span>: if there is not anything else, your patch can use only <code>ContextOptions</code>, reverting the change to <code>RealmCreationOptions</code>, and use <code>cx-&gt;options()</code> in <code>js::ShouldIgnorePropertyDefinition</code></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Nov 26 2021 06:28:25 GMT-0800 (Pacific Standard Time)">14:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">uh, I was about to ask people who wrote/reviewed the patch that adds experimental feature options in <code>RealmCreationOptions</code>, and turns out it's me :P</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Nov 26 2021 06:28:36 GMT-0800 (Pacific Standard Time)">14:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jakechampion:mozilla.org">jakechampion</span>&gt;</div></td><td class="msg-cell">Okay, I think I'll also need to remove <code>getRealmConfiguration().enableNewSetMethods</code> from the tests as well 👍️</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Nov 26 2021 06:28:53 GMT-0800 (Pacific Standard Time)">14:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">err, wait</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Nov 26 2021 06:29:09 GMT-0800 (Pacific Standard Time)">14:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">you need to check runtime options in some way</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Nov 26 2021 06:30:23 GMT-0800 (Pacific Standard Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and <code>GetRealmConfiguration</code> function name sounds misleading, or maybe we're abusing, but properties returned by the testing function are all from <code>ContextOptions</code></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Nov 26 2021 06:30:38 GMT-0800 (Pacific Standard Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/65d4d3399afa79c8de5a0cc11752d2ba7c31edc1/js/src/builtin/TestingFunctions.cpp#187-216">https://searchfox.org/mozilla-central/rev/65d4d3399afa79c8de5a0cc11752d2ba7c31edc1/js/src/builtin/TestingFunctions.cpp#187-216</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Nov 26 2021 06:31:00 GMT-0800 (Pacific Standard Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">jakechampion</span>: so, for now, you can keep using <code>GetRealmConfiguration</code> to return <code>ContextOptions</code> field</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Nov 26 2021 06:31:11 GMT-0800 (Pacific Standard Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to provide the runtime option to testcase</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Nov 26 2021 06:31:40 GMT-0800 (Pacific Standard Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the testcase should check both compile-time option and runtime option</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Nov 26 2021 06:31:49 GMT-0800 (Pacific Standard Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and performs the test only if both are enabled</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Nov 26 2021 07:05:31 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">jandem: can I have your opinion for the above RealmCreationOptions vs ContextOptions for experimental features?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Nov 26 2021 07:08:27 GMT-0800 (Pacific Standard Time)">15:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: what I like about realm options is that <code>xpc::SetPrefableRealmOptions</code> is also called for worker realms, whereas a lot of context options have to be set in multiple places so we end up setting them only for the main thread's context...</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Nov 26 2021 07:09:02 GMT-0800 (Pacific Standard Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">ideally these would be process-wide flags IMO, the current system where context options are set in multiple places is brittle</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Nov 26 2021 07:10:10 GMT-0800 (Pacific Standard Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell">how can i log something from the js shell on windows so it shows up in the log output captured by the tryserver?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Nov 26 2021 07:10:10 GMT-0800 (Pacific Standard Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">ah, good to know</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Nov 26 2021 07:12:54 GMT-0800 (Pacific Standard Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">jakechampion: okay, let's use  <code>RealmCreationOptions</code>, reverting <code>ContextOptions</code> change, and replacing any <code>cx-&gt;options()</code> with realm options</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Nov 26 2021 07:15:46 GMT-0800 (Pacific Standard Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">lth: passing --show-output to test command executed in <a href="http://autospider.py">autospider.py</a> might work</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Nov 26 2021 07:16:01 GMT-0800 (Pacific Standard Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: thanks, will look into that</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Nov 26 2021 07:16:16 GMT-0800 (Pacific Standard Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">otherwise all output will be filtered by test harness</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Nov 26 2021 09:30:52 GMT-0800 (Pacific Standard Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">Hi people, I'm currently poking AbortSignal and want to store a <code>JS::Handle&lt;JS::Value&gt;</code> as a member of C++ class and then pass it to another C++ object. Using <code>JS::Heap&lt;&gt;</code> is seemingly recommended for the member's type, but then how can I pass that object as a JS::Handle again?</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Nov 26 2021 09:39:49 GMT-0800 (Pacific Standard Time)">17:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">(I initially used JS::Heap as parameter types but then found it's not allowed)</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Nov 26 2021 10:09:14 GMT-0800 (Pacific Standard Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">Wait, seems I can just use JS::Value for the parameter type and everything is okay?</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Nov 26 2021 10:09:30 GMT-0800 (Pacific Standard Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">krosylight</span>: If you want a JS::Handle, the easiest approach is to root the value. <code>Rooted&lt;T&gt;</code> auto-coerces to <code>Handle&lt;T&gt;</code>. (See the SMDOC comment <a href="https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#33">here</a>.)</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Nov 26 2021 10:09:55 GMT-0800 (Pacific Standard Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If you are passing the value to something that can't trigger a GC, then you can potentially pass a JS::Value</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Nov 26 2021 10:10:26 GMT-0800 (Pacific Standard Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(The hazard analysis should yell at you if the thing you're calling can in fact GC)</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Nov 26 2021 10:12:07 GMT-0800 (Pacific Standard Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I also see a variety of places that pass a reference to a <code>Heap&lt;&gt;</code> (<a href="https://searchfox.org/mozilla-central/source/dom/base/Pose.cpp#62">example</a>)</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri Nov 26 2021 10:14:05 GMT-0800 (Pacific Standard Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">Actually it seems JS::Value is also not allowed as parameter type, will try the reference way</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri Nov 26 2021 10:21:28 GMT-0800 (Pacific Standard Time)">18:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, passing bare values is scary</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri Nov 26 2021 10:21:36 GMT-0800 (Pacific Standard Time)">18:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I was surprised that it seemed to work for you</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Nov 26 2021 10:26:35 GMT-0800 (Pacific Standard Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><p>Yeah; I'd store as heap. You'll need to make sure your class is marked as a script-holder (<code>NS_DECL_CYCLE_COLLECTION_SCRIPT_HOLDER_CLASS</code>), then implement the <code>TRACE</code> macros (<code>NS_IMPL_CYCLE_COLLECTION_TRACE_BEGIN</code> / <code>NS_IMPL_CYCLE_COLLECTION_TRACE_JS_MEMBER_CALLBACK</code>), and be sure to call <code>mozilla::HoldJSObjects(this)</code> in the constructor, and <code>mozilla::DropJSObjects(this)</code> in the destructor.</p>
<p>When it comes time to pass it to a method, then just re-root the local; (you may be able to get away with just using <code>RootingCx()</code>)</p>
</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Nov 26 2021 10:30:14 GMT-0800 (Pacific Standard Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(Oh, good, somebody who's actually written gecko code showed up!)</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Nov 26 2021 10:33:18 GMT-0800 (Pacific Standard Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">Thank you! I think I'll copy what dom/CustomEvent does</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Nov 26 2021 10:35:26 GMT-0800 (Pacific Standard Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">(And passing by reference helps! That doesn't require any SpiderMonkey specific knowledge and now I feel dumb)</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Nov 26 2021 12:04:12 GMT-0800 (Pacific Standard Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">krosylight</span>: CustomEvent looks like a pretty reasonable template (with the small warning that you'll need to trace the Wrapper, should your type be WrapperCached)</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Nov 26 2021 12:07:40 GMT-0800 (Pacific Standard Time)">20:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-1">krosylight</span>: CustomEvent looks like a pretty reasonable template (with the small warning that you'll need to trace the Wrapper, should your type be WrapperCached)</blockquote></mx-reply><p>Thanks! That seems related to the failure I'm getting:</p>
<blockquote>
<p>Assertion failure: callback.mFound (Cycle collection participant didn't traverse to preserved wrapper! This will probably crash.),</p>
</blockquote>
<p>The code looks like below, not sure what I did wrong, do you see anything?</p>
<pre><code>NS_IMPL_CYCLE_COLLECTION_CLASS(AbortController)
NS_IMPL_CYCLE_COLLECTION_UNLINK_BEGIN(AbortController)
  NS_IMPL_CYCLE_COLLECTION_UNLINK(mGlobal, mSignal)
  NS_IMPL_CYCLE_COLLECTION_UNLINK_PRESERVED_WRAPPER
NS_IMPL_CYCLE_COLLECTION_UNLINK_END
NS_IMPL_CYCLE_COLLECTION_TRAVERSE_BEGIN(AbortController)
  NS_IMPL_CYCLE_COLLECTION_TRAVERSE(mGlobal, mSignal)
NS_IMPL_CYCLE_COLLECTION_TRAVERSE_END

NS_IMPL_CYCLE_COLLECTION_TRACE_BEGIN(AbortController)
  NS_IMPL_CYCLE_COLLECTION_TRACE_PRESERVED_WRAPPER
  NS_IMPL_CYCLE_COLLECTION_TRACE_JS_MEMBER_CALLBACK(mReason)
NS_IMPL_CYCLE_COLLECTION_TRACE_END
</code></pre>
</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Nov 26 2021 12:09:11 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Hmm. Now we're beyond my skills; to me that looks fine mostly (you may want to do <code>tmp-&gt;mReason.setNull()</code> in the unlink stanza)</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Nov 26 2021 12:09:26 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I'm not sure I've encountered that specific assert yet</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Nov 26 2021 12:09:56 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">did you remember <code>mozilla::HoldJSObjects</code>?</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Nov 26 2021 12:10:18 GMT-0800 (Pacific Standard Time)">20:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell"><p>Yup,</p>
<pre><code>AbortController::AbortController(nsIGlobalObject* aGlobal)
    : mGlobal(aGlobal), mAborted(false), mReason(JS::UndefinedHandleValue) {
  mozilla::HoldJSObjects(this);
}
</code></pre>
</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Nov 26 2021 12:11:41 GMT-0800 (Pacific Standard Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">hrm. Yeah; I've got nothing here alas. This is the point where I either ask in #dom, or start looking at an RR trace to see if I can understand what the assert is concerned about on a broader level</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Nov 26 2021 12:23:12 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">Thank you! Never mind, that was nothing to do with JS and was about not correctly using _INHERITED elsewhere (me again being dumb)</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Nov 26 2021 12:23:14 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Cheating at implementing streams (the same way our JS impl has cheated thus far) </td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Nov 26 2021 12:23:16 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Nov 26 2021 12:23:42 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">What update?!</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Nov 26 2021 12:24:07 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">krosylight</span>: no worries. The CC is harsh to work with sometimes.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Nov 26 2021 12:24:30 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">krosylight</span>: you mean botzilla? I just use that for tracking my status :P You can follow the link to see people's updates</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri Nov 26 2021 12:24:42 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@krosylight:mozilla.org">krosylight</span>&gt;</div></td><td class="msg-cell">TIL that thing exists!</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri Nov 26 2021 12:26:03 GMT-0800 (Pacific Standard Time)">20:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">It's nice; used to be a bot called 'standups' that worked similarly. I think I'm the dominant user of confession right now but I like doing it. </td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri Nov 26 2021 14:44:46 GMT-0800 (Pacific Standard Time)">22:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Implemented the queueing strategies, and their size functions... properly (ish?) this time. </td></tr>

</tbody></table></div></div></div>
</body></html>