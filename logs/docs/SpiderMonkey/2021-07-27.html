<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-07-27</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-07-27<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-07-26" class="nav-link"><span>prev</span></a>
<a href="2021-07-28" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jul 26 2021 23:50:56 GMT-0700 (Pacific Daylight Time)">06:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">exceptions are wrapped in the context's compartment at the point where you call <code>cx-&gt;getPendingException</code></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jul 27 2021 03:49:08 GMT-0700 (Pacific Daylight Time)">10:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: aren't Private slots used by embedders as well?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jul 27 2021 04:12:46 GMT-0700 (Pacific Daylight Time)">11:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: yeah, they'll have to change too unfortunately</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jul 27 2021 04:24:08 GMT-0700 (Pacific Daylight Time)">11:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><p>Hi, I want to upgrade the SpiderMonkey embedded into MongoDB. It's been using <code>60.3.0esr</code> and I want to upgrade to <code>91.0b7</code>. Is there any tutorial on how to embed a recent version of SpiderMonkey to another project? I found this: <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/next/docs/Building%20SpiderMonkey.md">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/next/docs/Building%20SpiderMonkey.md</a>, which suggests:</p>
<pre><code>cd js/src
mkdir _build
cd _build
../configure --disable-jemalloc --with-system-zlib \
    --with-intl-api --enable-debug --enable-optimize
make
make install  # sudo if necessary
</code></pre>
<p>However, there's no <code>configure</code> in <code>js/src</code>. If I do a <code>autoconf</code>, I get this error:</p>
<pre><code>autoconf                                         ubuntu@ip-10-122-9-106 04:22:22
../../build/autoconf/hooks.m4:6: error: defn: undefined macro: AC_INIT_PREPARE
../../build/autoconf/hooks.m4:6: the top level
autom4te: /usr/bin/m4 failed with exit status: 1

</code></pre>
<p>As far as I see, using <code>configure</code> is not the suggested way of compiling SpiderMonkey (suggested in <a href="https://firefox-source-docs.mozilla.org/js/build.html">https://firefox-source-docs.mozilla.org/js/build.html</a>).</p>
<p>Now, I'm stuck and would appreciate any help or suggestion.</p>
</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jul 27 2021 04:24:59 GMT-0700 (Pacific Daylight Time)">11:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">you have to use autoconf2.13</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jul 27 2021 04:25:09 GMT-0700 (Pacific Daylight Time)">11:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>sh ./<a href="http://configure.in">configure.in</a></code>, or <code>cp <a href="http://configure.in">configure.in</a> configure; ./configure</code> would work</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jul 27 2021 04:25:13 GMT-0700 (Pacific Daylight Time)">11:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">but there are ways to build using mach that are better supported</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jul 27 2021 04:28:00 GMT-0700 (Pacific Daylight Time)">11:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell">Thanks <span class="nick-9">wingo</span> and <span class="nick-15">arai</span></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jul 27 2021 04:28:46 GMT-0700 (Pacific Daylight Time)">11:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell">Another newbie question: what are the dependencies required for SpiderMonkey. Is <code>rust</code> a dependency?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jul 27 2021 04:30:18 GMT-0700 (Pacific Daylight Time)">11:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yes it is</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jul 27 2021 04:32:32 GMT-0700 (Pacific Daylight Time)">11:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell">Thanks <span class="nick-10">jandem</span>. When I search under <code>js/src</code> I find a few rust files. Is it possible to avoid the dependency on rust by excluding those?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jul 27 2021 04:32:56 GMT-0700 (Pacific Daylight Time)">11:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger üíâüíâ</span>&gt;</div></td><td class="msg-cell">No</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jul 27 2021 04:33:38 GMT-0700 (Pacific Daylight Time)">11:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell">Thanks <span class="nick-6">Ms2ger üíâüíâ</span> . Is there a place that lists all the dependencies for SpiderMonkey?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jul 27 2021 04:34:30 GMT-0700 (Pacific Daylight Time)">11:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger üíâüíâ</span>&gt;</div></td><td class="msg-cell">Hmmm</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jul 27 2021 04:34:40 GMT-0700 (Pacific Daylight Time)">11:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger üíâüíâ</span>&gt;</div></td><td class="msg-cell">Maybe somewhere reachable from <a href="https://firefox-source-docs.mozilla.org/js/build.html">https://firefox-source-docs.mozilla.org/js/build.html</a> ?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jul 27 2021 04:36:02 GMT-0700 (Pacific Daylight Time)">11:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">there's also <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/next/docs/Building%20SpiderMonkey.md">some info here</a></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jul 27 2021 04:37:59 GMT-0700 (Pacific Daylight Time)">11:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> there's also <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/next/docs/Building%20SpiderMonkey.md">some info here</a></blockquote></mx-reply>I'd looked at this one, but seem that it doesn't list everything, e.g., Rust</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jul 27 2021 04:39:55 GMT-0700 (Pacific Daylight Time)">11:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">apart from Rust (and Rust crates) I can't think of a hard dependency we've added since ESR 60, but I could be missing something of course</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jul 27 2021 04:41:34 GMT-0700 (Pacific Daylight Time)">11:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><p>Another question: I'm using <code>clang++</code>:</p>
<pre><code>$ clang++ --version
MongoDB clang version 7.0.1 (tags/RELEASE_701/final) (based on LLVM 7.0.1)
Target: x86_64-mongodb-linux
Thread model: posix
InstalledDir: /opt/mongodbtoolchain/v3/bin
</code></pre>
<p>But when I want to build SpiderMonkey, (via either <code>make</code> or <code>mach build</code>), I get this error:</p>
<pre><code>The following warnings were emitted during compilation:

warning: In file included from wrappers.cpp:11:
warning: In file included from /home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/include/mozilla/Assertions.h:342:
warning: /home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/system_wrappers/type_traits:3:15: fatal error: 'type_traits' file not found
warning: #include_next &lt;type_traits&gt;
warning:               ^~~~~~~~~~~~~
warning: 1 error generated.

error: failed to run custom build command for `mozglue-static v0.1.0 (/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/mozglue/static/rust)`

Caused by:
  process didn't exit successfully: `/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/debug/build/mozglue-static-6591852ff4a484c3/build-script-build` (exit status: 1)
  --- stdout
  TARGET = Some("x86_64-unknown-linux-gnu")
  OPT_LEVEL = Some("2")
  HOST = Some("x86_64-unknown-linux-gnu")
  CXX_x86_64-unknown-linux-gnu = None
  CXX_x86_64_unknown_linux_gnu = Some("/opt/mongodbtoolchain/v3/bin/clang++")
  CXXFLAGS_x86_64-unknown-linux-gnu = None
  CXXFLAGS_x86_64_unknown_linux_gnu = Some("-std=gnu++17 -I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/system_wrappers -include /home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/config/gcc_hidden.h -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fstack-protector-strong -DDEBUG=1 -DEXPORT_JS_API -DMOZ_HAS_MOZGLUE -I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/rust -I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src/rust -I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/include -DMOZILLA_CLIENT -include /home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src/js-confdefs.h -Qunused-arguments -Qunused-arguments -Wall -Wbitfield-enum-conversion -Wdeprecated-this-capture -Wempty-body -Wignored-qualifiers -Wpointer-arith -Wshadow-field-in-constructor-modified -Wshadow-uncaptured-local -Wsign-compare -Wtype-limits -Wno-error=tautological-type-limit-compare -Wunreachable-code -Wunreachable-code-return -Wno-invalid-offsetof -Wclass-varargs -Wfloat-overflow-conversion -Wfloat-zero-conversion -Wloop-analysis -Wno-range-loop-analysis -Wc++2a-compat -Wcomma -Wimplicit-fallthrough -Wstring-conversion -Wno-inline-new-delete -Wno-error=deprecated-declarations -Wno-error=array-bounds -Wno-error=backend-plugin -Wno-error=return-std-move -Wno-error=atomic-alignment -Wformat -Wformat-security -Wno-gnu-zero-variadic-macro-arguments -Wno-unknown-warning-option -fno-sized-deallocation -fno-aligned-new -fPIC -fno-rtti -ffunction-sections -fdata-sections -fno-exceptions -fno-math-errno -pthread -pipe -g -O3 -fno-omit-frame-pointer -funwind-tables -DMOZILLA_CONFIG_H")
  CRATE_CC_NO_DEFAULTS = None
  DEBUG = Some("true")
  running: "/opt/mongodbtoolchain/v3/bin/clang++" "-O2" "-ffunction-sections" "-fdata-sections" "-fPIC" "-g" "-fno-omit-frame-pointer" "--target=x86_64-unknown-linux-gnu" "-std=gnu++17" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/system_wrappers" "-include" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/config/gcc_hidden.h" "-U_FORTIFY_SOURCE" "-D_FORTIFY_SOURCE=2" "-fstack-protector-strong" "-DDEBUG=1" "-DEXPORT_JS_API" "-DMOZ_HAS_MOZGLUE" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/rust" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src/rust" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/include" "-DMOZILLA_CLIENT" "-include" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src/js-confdefs.h" "-Qunused-arguments" "-Qunused-arguments" "-Wall" "-Wbitfield-enum-conversion" "-Wdeprecated-this-capture" "-Wempty-body" "-Wignored-qualifiers" "-Wpointer-arith" "-Wshadow-field-in-constructor-modified" "-Wshadow-uncaptured-local" "-Wsign-compare" "-Wtype-limits" "-Wno-error=tautological-type-limit-compare" "-Wunreachable-code" "-Wunreachable-code-return" "-Wno-invalid-offsetof" "-Wclass-varargs" "-Wfloat-overflow-conversion" "-Wfloat-zero-conversion" "-Wloop-analysis" "-Wno-range-loop-analysis" "-Wc++2a-compat" "-Wcomma" "-Wimplicit-fallthrough" "-Wstring-conversion" "-Wno-inline-new-delete" "-Wno-error=deprecated-declarations" "-Wno-error=array-bounds" "-Wno-error=backend-plugin" "-Wno-error=return-std-move" "-Wno-error=atomic-alignment" "-Wformat" "-Wformat-security" "-Wno-gnu-zero-variadic-macro-arguments" "-Wno-unknown-warning-option" "-fno-sized-deallocation" "-fno-aligned-new" "-fPIC" "-fno-rtti" "-ffunction-sections" "-fdata-sections" "-fno-exceptions" "-fno-math-errno" "-pthread" "-pipe" "-g" "-O3" "-fno-omit-frame-pointer" "-funwind-tables" "-DMOZILLA_CONFIG_H" "-I" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src" "-I" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/include" "-DMOZ_HAS_MOZGLUE" "-o" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/x86_64-unknown-linux-gnu/debug/build/mozglue-static-771c2dd5635951dd/out/wrappers.o" "-c" "wrappers.cpp"
  cargo:warning=In file included from wrappers.cpp:11:
  cargo:warning=In file included from /home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/include/mozilla/Assertions.h:342:
  cargo:warning=/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/system_wrappers/type_traits:3:15: fatal error: 'type_traits' file not found
  cargo:warning=#include_next &lt;type_traits&gt;
  cargo:warning=              ^~~~~~~~~~~~~
  cargo:warning=1 error generated.
  exit status: 1

  --- stderr


  error occurred: Command "/opt/mongodbtoolchain/v3/bin/clang++" "-O2" "-ffunction-sections" "-fdata-sections" "-fPIC" "-g" "-fno-omit-frame-pointer" "--target=x86_64-unknown-linux-gnu" "-std=gnu++17" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/system_wrappers" "-include" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/config/gcc_hidden.h" "-U_FORTIFY_SOURCE" "-D_FORTIFY_SOURCE=2" "-fstack-protector-strong" "-DDEBUG=1" "-DEXPORT_JS_API" "-DMOZ_HAS_MOZGLUE" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/rust" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src/rust" "-I/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/include" "-DMOZILLA_CLIENT" "-include" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src/js-confdefs.h" "-Qunused-arguments" "-Qunused-arguments" "-Wall" "-Wbitfield-enum-conversion" "-Wdeprecated-this-capture" "-Wempty-body" "-Wignored-qualifiers" "-Wpointer-arith" "-Wshadow-field-in-constructor-modified" "-Wshadow-uncaptured-local" "-Wsign-compare" "-Wtype-limits" "-Wno-error=tautological-type-limit-compare" "-Wunreachable-code" "-Wunreachable-code-return" "-Wno-invalid-offsetof" "-Wclass-varargs" "-Wfloat-overflow-conversion" "-Wfloat-zero-conversion" "-Wloop-analysis" "-Wno-range-loop-analysis" "-Wc++2a-compat" "-Wcomma" "-Wimplicit-fallthrough" "-Wstring-conversion" "-Wno-inline-new-delete" "-Wno-error=deprecated-declarations" "-Wno-error=array-bounds" "-Wno-error=backend-plugin" "-Wno-error=return-std-move" "-Wno-error=atomic-alignment" "-Wformat" "-Wformat-security" "-Wno-gnu-zero-variadic-macro-arguments" "-Wno-unknown-warning-option" "-fno-sized-deallocation" "-fno-aligned-new" "-fPIC" "-fno-rtti" "-ffunction-sections" "-fdata-sections" "-fno-exceptions" "-fno-math-errno" "-pthread" "-pipe" "-g" "-O3" "-fno-omit-frame-pointer" "-funwind-tables" "-DMOZILLA_CONFIG_H" "-I" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src" "-I" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/dist/include" "-DMOZ_HAS_MOZGLUE" "-o" "/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/x86_64-unknown-linux-gnu/debug/build/mozglue-static-771c2dd5635951dd/out/wrappers.o" "-c" "wrappers.cpp" with args "clang++" did not execute successfully (status code exit status: 1).


warning: build failed, waiting for other jobs to finish...
warning: 18 warnings emitted

error: build failed
/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/config/makefiles/rust.mk:391: recipe for target 'force-cargo-library-build' failed
make[3]: *** [force-cargo-library-build] Error 101
make[3]: Leaving directory '/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build/js/src/rust'
/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/config/recurse.mk:72: recipe for target 'js/src/rust/target' failed
make[2]: *** [js/src/rust/target] Error 2
make[2]: Leaving directory '/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build'
/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/config/recurse.mk:32: recipe for target 'compile' failed
make[1]: *** [compile] Error 2
make[1]: Leaving directory '/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/js/src/_build'
/home/ubuntu/mongo/src/third_party/mozjs-60/mozilla-release/config/rules.mk:355: recipe for target 'default' failed
make: *** [default] Error 2
</code></pre>
<p>Is it because of my <code>clang++</code> version? Have you encountered this issue before?</p>
</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jul 27 2021 04:50:38 GMT-0700 (Pacific Daylight Time)">11:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">according to <a href="https://firefox-source-docs.mozilla.org/code-quality/coding-style/using_cxx_in_firefox_code.html">https://firefox-source-docs.mozilla.org/code-quality/coding-style/using_cxx_in_firefox_code.html</a> , current minimal requirement for clang version is 5.0. so using 7.0 won't be a problem</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jul 27 2021 04:51:28 GMT-0700 (Pacific Daylight Time)">11:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">but the log looks strange, that fatal error is marked as warning</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jul 27 2021 04:53:23 GMT-0700 (Pacific Daylight Time)">11:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> according to <a href="https://firefox-source-docs.mozilla.org/code-quality/coding-style/using_cxx_in_firefox_code.html">https://firefox-source-docs.mozilla.org/code-quality/coding-style/using_cxx_in_firefox_code.html</a> , current minimal requirement for clang version is 5.0. so using 7.0 won't be a problem</blockquote></mx-reply>May I ask what's the version you're using?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jul 27 2021 04:54:10 GMT-0700 (Pacific Daylight Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">12.0.1. that's installed by <code>./mach bootstrap</code> command, into <code>~/.mozbuild/clang/bin/</code></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jul 27 2021 04:54:53 GMT-0700 (Pacific Daylight Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">anyway, can you try compiling minimal C++ code that includes <code>type_traits</code> ?  does it work outside of SpiderMonkey's build system?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jul 27 2021 04:55:51 GMT-0700 (Pacific Daylight Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> anyway, can you try compiling minimal C++ code that includes <code>type_traits</code> ?  does it work outside of SpiderMonkey's build system?</blockquote></mx-reply>How can I do "compiling minimal C++ code that includes <code>type_traits</code>?"</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jul 27 2021 04:57:53 GMT-0700 (Pacific Daylight Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">create a temporary file <code>test.cpp</code> with <code>#include &lt;type_traits&gt;</code> content, and run <code>PATH_TO/clang++ -std=gnu++17 test.cpp</code> maybe?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Jul 27 2021 05:03:06 GMT-0700 (Pacific Daylight Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> create a temporary file <code>test.cpp</code> with <code>#include &lt;type_traits&gt;</code> content, and run <code>PATH_TO/clang++ -std=gnu++17 test.cpp</code> maybe?</blockquote></mx-reply><p>Ah, that's what you mean. I though there's a "minimal C++ code" for SpiderMonkey üòÅ!</p>
<pre><code>~/mongo master ‚á£16‚á°1 *34 !1478 ?5 ‚ùØ cat test.cpp 
#include &lt;type_traits&gt;
#include &lt;iostream&gt;
int main() {
	std::cout &lt;&lt; "Hellow World!" &lt;&lt; std::endl;
	return 0;
}
~/mongo master ‚á£16‚á°1 *34 !1478 ?5 ‚ùØ clang++ test.cpp &amp;&amp; ./a.out
Hellow World!
</code></pre>
<p>It works.</p>
</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Jul 27 2021 05:04:25 GMT-0700 (Pacific Daylight Time)">12:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hm, in that case some command line parameter (or maybe environment variable) used in the build system is causing the issue?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Jul 27 2021 05:04:44 GMT-0700 (Pacific Daylight Time)">12:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the output you've pasted above contains the command line (<code>running: ...</code> line)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Jul 27 2021 05:05:18 GMT-0700 (Pacific Daylight Time)">12:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you try checking if any of them are related?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Jul 27 2021 05:08:00 GMT-0700 (Pacific Daylight Time)">12:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">maybe the system wrappers are causing trouble?  I'm not sure the details tho</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Jul 27 2021 05:08:29 GMT-0700 (Pacific Daylight Time)">12:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> maybe the system wrappers are causing trouble?  I'm not sure the details tho</blockquote></mx-reply>What do you mean by "system wrappers"?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Jul 27 2021 05:09:10 GMT-0700 (Pacific Daylight Time)">12:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>dist/system_wrappers/type_traits</code> file there</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Jul 27 2021 05:09:47 GMT-0700 (Pacific Daylight Time)">12:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it looks like we're wrapping system headers with them, and the error happens when searching the next file after <code>type_traits</code> there</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Jul 27 2021 05:34:40 GMT-0700 (Pacific Daylight Time)">12:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span> added <code>/home/ubuntu/.mozbuild/clang/bin</code> to my path and apparently, it's making some progress. Then,  it's either my specific <code>clang++</code> version that's missing some headers, or maybe it's worth revisiting the minimum <code>clang++</code> version requirement.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Jul 27 2021 05:57:29 GMT-0700 (Pacific Daylight Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell">Ask for opinion: Let's say if another system that already embeds SpiderMonkey ESR 60 wants to upgrade to 91 (e.g., MongoDB), but there's a hard constraint on not introducing a dependency on Rust (as it wants to remain a C++-only repo), is there a workaround? Is there a way to avoid having some features in SpiderMonkey that's implemented in Rust and only capture the C++ part of it?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Jul 27 2021 06:15:31 GMT-0700 (Pacific Daylight Time)">13:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">mdashti</span>: the encoding_rs dependency is a hard one, it's used for character encoding/conversion. A no-rust build would be quite a lot of work and isn't something we support</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Jul 27 2021 06:29:03 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: ping? I have questions about jsapi-tests/testGCOutOfMemory.cpp</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Jul 27 2021 06:30:57 GMT-0700 (Pacific Daylight Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: hey</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Jul 27 2021 06:31:22 GMT-0700 (Pacific Daylight Time)">13:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">With my self-host changes, I no longer use the nursery during startup which seems to break the test case when running JS_GC_ZEAL=GenerationalGC</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Jul 27 2021 06:32:28 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">There are a bunch of comments in the test about this having weird issues with nursery behaviour, but I do not quite understand them.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Jul 27 2021 06:33:09 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Increasing the heap from 1MB to 4MB does solve problem, but that seems like wrong fix</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Jul 27 2021 06:34:41 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><em>reading comments</em></td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Jul 27 2021 06:35:45 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'm not sure why it would fail with generational GC zeal because it disables that in createContext</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Jul 27 2021 06:36:47 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I don't really understand the comments either</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Jul 27 2021 06:37:27 GMT-0700 (Pacific Daylight Time)">13:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">oh, I think you need to GC after setting the max nursery size for it to take effect, that may help</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Jul 27 2021 06:37:48 GMT-0700 (Pacific Daylight Time)">13:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I expect the failure is unrelated to your changes and just because the test is weird</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Jul 27 2021 06:37:56 GMT-0700 (Pacific Daylight Time)">13:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">the disabling does evict the nursery</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Jul 27 2021 06:38:11 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">agreed that it is probably the test</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Jul 27 2021 06:38:23 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">should I just set size to 4mb and open a followup bug?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Jul 27 2021 06:38:48 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yes that's fine, I'll try and work out what this test is all about</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Jul 27 2021 06:39:13 GMT-0700 (Pacific Daylight Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">it doesn't look like a terribly useful one tbh</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Jul 27 2021 06:39:51 GMT-0700 (Pacific Daylight Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">no, but I wanted to confirm there aren't subtle impacts to dynamic nursery sizing or anything</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Jul 27 2021 06:40:06 GMT-0700 (Pacific Daylight Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">sure</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Jul 27 2021 07:01:24 GMT-0700 (Pacific Daylight Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: sorry, I didn't mean to ask how the exception gets wrapped into the correct compartment. I'm talking about the realm that the underlying Error object is in, as in what Error.prototype does it chain to?</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Jul 27 2021 07:03:48 GMT-0700 (Pacific Daylight Time)">14:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">eg what I could test with <code>g = newGlobal({newCompartment: true}); Error.prototype.whence = 'main global'; g.eval("Error.prototype.whence = 'other global'"); try { g.eval(...) } catch (e) { print(e.whence) }</code></td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Jul 27 2021 07:05:24 GMT-0700 (Pacific Daylight Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger üíâüíâ</span>&gt;</div></td><td class="msg-cell">Objects were a mistake</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Jul 27 2021 07:08:18 GMT-0700 (Pacific Daylight Time)">14:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it'd be "other global"? based on <code>cx-&gt;global</code> when the error object is allocated</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Jul 27 2021 07:11:41 GMT-0700 (Pacific Daylight Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">right, in that case it would <em>probably</em> be that, assuming the <code>...</code> isn't doing something that crosses compartments. But generally speaking, if I do something as simple as GetOwnProperty on a CCW and it throws, it seems to me like the way we'd implement that is with an <code>AutoRealm</code> on the unwrapped object.</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Jul 27 2021 07:11:56 GMT-0700 (Pacific Daylight Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">which is fine most of the time, since the cause of the Error <em>is</em> in that compartment</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Jul 27 2021 07:13:10 GMT-0700 (Pacific Daylight Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but if I'm doing some operation (here, structured cloning) that semantically lives in the main global, and it encounters an error while doing its thing, but the error is something like retrieving something disallowed by the cloning algorithm, then I would think we'd want the Error to be in "main global" yet it would naturally be in "other global" (since that's where we were when trying to retrieve.)</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Jul 27 2021 07:13:43 GMT-0700 (Pacific Daylight Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">hm, I guess maybe writing that out kind of answered my question</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Jul 27 2021 07:14:05 GMT-0700 (Pacific Daylight Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">if it is a structured cloning error, then I should be throwing the error while in the cloning compartment, not some random cloned object's compartment</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Jul 27 2021 07:14:51 GMT-0700 (Pacific Daylight Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but if the error is triggered by an operation on a CCW object, then the error should properly be in that object's compartment -- that's not an error running the cloning algorithm, that's an error retrieving something from the object</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Jul 27 2021 07:16:35 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it seems important to be careful, since at the point of discovering a structured clone related error, you could very well be in some random compartment and you'd better hang onto whatever you need to remember in order to throw the right error after you get back out</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Jul 27 2021 07:17:23 GMT-0700 (Pacific Daylight Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(and if you're doing something even trickier, like with Streams you're manipulating objects potentially in multiple different compartments, you have to be even more careful)</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Jul 27 2021 07:17:40 GMT-0700 (Pacific Daylight Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">or at least, that's my current understanding until someone beats something more sensible into me</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Jul 27 2021 07:19:34 GMT-0700 (Pacific Daylight Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">crap, had to go back and edit one of those above from "other global" -&gt; "main global", oops.</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Jul 27 2021 07:24:18 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ugh, and now I have a simple test case that behaves counter to my expectations. <code>try { <a href="http://obj.foo">obj.foo</a> = 7 }</code> results in a main global error when <code>obj</code> is a CCW to a frozen object in the other global.</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Jul 27 2021 07:25:08 GMT-0700 (Pacific Daylight Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">...how? Shouldn't the error be constructed while we're doing a SetProperty in the other global's realm? I guess it's rr time.</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Jul 27 2021 07:30:42 GMT-0700 (Pacific Daylight Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Especially with methods we will often create errors objects in the wrong compartment, because of  CallNonGeneri</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Jul 27 2021 07:31:10 GMT-0700 (Pacific Daylight Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Unrelated to SetProp, just something to keep in mind</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Jul 27 2021 07:37:48 GMT-0700 (Pacific Daylight Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">argh, never mind, my test case was throwing a different error.</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Jul 27 2021 07:38:15 GMT-0700 (Pacific Daylight Time)">14:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">apparently global.eval("{}") returns undefined. Probably those brackets are parsed as a scope, not an object literal. :-(</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Jul 27 2021 07:39:48 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">...and adding a property to a frozen object doesn't throw unless you're in strict mode...</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Jul 27 2021 07:40:01 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger üíâüíâ</span>&gt;</div></td><td class="msg-cell">Hmm, does ctypes still exist?</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Jul 27 2021 07:40:20 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I <em>still</em> get "main global". Ok, I'll stop spamming this channel and figure this out.</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Jul 27 2021 07:40:35 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes, ctypes is still being used in Firefox, though there's work afoot to remove that usage.</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Jul 27 2021 07:41:14 GMT-0700 (Pacific Daylight Time)">14:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">more importantly, the hazard analysis uses it, and that's really the most important thing that Mozilla produces so clearly ctypes should never be removed</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Jul 27 2021 07:41:54 GMT-0700 (Pacific Daylight Time)">14:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(I probably ought to remove that dependency. It wouldn't be too hard.)</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Jul 27 2021 07:43:07 GMT-0700 (Pacific Daylight Time)">14:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ms2ger:igalia.com">Ms2ger üíâüíâ</span>&gt;</div></td><td class="msg-cell">(Sounds like more fun than what you were doing before)</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Jul 27 2021 07:43:17 GMT-0700 (Pacific Daylight Time)">14:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">you're not wrong</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Tue Jul 27 2021 07:44:48 GMT-0700 (Pacific Daylight Time)">14:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and just a leetle bit more spam: the actual error thrown is <code>TypeError: can't define property "foo": Proxy is not extensible</code> even though I'm just trying to define a property on a plain object that happens to be a CCW. That seems like a bug, and explains why it's throwing an Error in the main global.</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Tue Jul 27 2021 07:45:32 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">as in, I don't think the fact that a CCW is a proxy should be visible to JS.</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Tue Jul 27 2021 07:47:25 GMT-0700 (Pacific Daylight Time)">14:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ah, it's mostly the right error, it's just that it fills in the "%s is not extensible" with excessively helpful info on what the obj is</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Tue Jul 27 2021 07:48:40 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm wondering if we ought to have a <code>cx-&gt;errorRealm_</code> for this stuff and the CallNonGeneric stuff... bleh.</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Tue Jul 27 2021 08:10:57 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <code>sh ./<a href="http://configure.in">configure.in</a></code>, or <code>cp <a href="http://configure.in">configure.in</a> configure; ./configure</code> would work</blockquote></mx-reply><span class="nick-10">jandem</span> <span class="nick-9">wingo</span> How do you run tests after <code>./configure --disable-jemalloc --with-system-zlib --with-intl-api --enable-debug --enable-optimize</code> followed by <code>make</code> (without using <code>mach</code>)?</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Tue Jul 27 2021 08:11:25 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">which tests?</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Tue Jul 27 2021 08:11:41 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">jstests and jit-test?</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Tue Jul 27 2021 08:11:48 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> which tests?</blockquote></mx-reply>Let's say all tests.</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Tue Jul 27 2021 08:12:02 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> jstests and jit-test?</blockquote></mx-reply>Yes.</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Tue Jul 27 2021 08:12:40 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there are <code>js/src/test/<a href="http://jstests.py">jstests.py</a></code> and <code>js/src/jit-test/jit_test.py</code></td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Tue Jul 27 2021 08:13:03 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">running then with passing js shell's path will run tests with the shell you've built</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Tue Jul 27 2021 08:13:20 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">iirc, you're supposed to be in <code>js/src/test</code> when running <a href="http://jstests.py">jstests.py</a></td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Tue Jul 27 2021 08:13:47 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">another test is jsapi-test, that's in {OBJDIR}/dist/bin, next to js shell</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Tue Jul 27 2021 08:14:06 GMT-0700 (Pacific Daylight Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it's executable and just running it will run all C++ tests</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Tue Jul 27 2021 08:20:47 GMT-0700 (Pacific Daylight Time)">15:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><p><code> {OBJDIR}/dist/bin/js</code> is the js shell, right?</p>
<p>Then, I have to <code>cd mozilla-release/js/src/tests</code> and then run <code>./<a href="http://jstests.py">jstests.py</a> --js-shell /home/ubuntu/mozilla-release/js/src/_build/dist/bin/js</code>.</p>
<p>Not sure why I still get a <code><a href="http://jstests.py">jstests.py</a>: error: missing JS_SHELL argument</code> error. Will figure it out.</p>
</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Tue Jul 27 2021 08:23:29 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I guess <code>--js-shell</code> part isn't necessary</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Tue Jul 27 2021 08:25:14 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hmm, the command line help looks wrong :/</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Tue Jul 27 2021 08:25:30 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: Right. Then, we need to fix the command line help.</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Tue Jul 27 2021 08:25:54 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@mdashti:mozilla.org">mdashti</span>&gt;</div></td><td class="msg-cell">Can be my first contribution üòÅ</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Tue Jul 27 2021 08:47:49 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oops, looks like I messed that up when going from optparse -&gt; argparse. It's very clearly wrong.</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Tue Jul 27 2021 08:50:07 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> and just a leetle bit more spam: the actual error thrown is <code>TypeError: can't define property "foo": Proxy is not extensible</code> even though I'm just trying to define a property on a plain object that happens to be a CCW. That seems like a bug, and explains why it's throwing an Error in the main global.</blockquote></mx-reply>Mostly a bug of error message though right? (Trying to follow along). If <code>obj</code> is a frozen object, you'd expect it to throw a not-extensible error... the fact that it's a CCW ought to be invisible normally though, right?</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Tue Jul 27 2021 08:50:48 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that's my thinking</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Tue Jul 27 2021 08:52:11 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and yes, it seems like for most things it should be just about error objects. But whenever you have callbacks getting invoked, or other objects being created, then you might need to worry about more than just error objects.</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Tue Jul 27 2021 08:52:25 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(I'm guessing Streams fall squarely in that category.)</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Tue Jul 27 2021 08:52:44 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">üò¨ Gonna be fun</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Tue Jul 27 2021 08:58:46 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">to answer my own question: SetProperty does exactly what I described would be needed above. It enters the target realm, detects the error, and fills the relevant information into an <code>ObjectOpResult</code> structure. Then it leaves the target realm, examines the result, and constructs the Error object in the calling realm.</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Tue Jul 27 2021 10:10:37 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">is there some way to make unwrapping a CCW fail in the shell, without nuking it? I tried playing with the shell principals stuff, but I could only get that to elide stack frames.</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Tue Jul 27 2021 10:11:03 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(it's unlikely to give me what I want for this test, but it seems like something we'd want to expose)</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Tue Jul 27 2021 10:11:14 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">maybe the fake WIndowProxy thing would help?</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Tue Jul 27 2021 10:24:25 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I think E4X objects were unwrappable, if that helps.</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Tue Jul 27 2021 10:27:41 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">so I could like use <code>os.spawn</code> to update to an E4X-compatible version, build it, and run the test with that version? Might work.</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Tue Jul 27 2021 10:28:27 GMT-0700 (Pacific Daylight Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">also, why are my SM(f) and SM(fuzzilli) jobs failing with bizarro linker errors involving jsrust?</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Tue Jul 27 2021 10:28:31 GMT-0700 (Pacific Daylight Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">maybe I need to trim down my patch stack</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Tue Jul 27 2021 10:29:27 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: ^ some pasta issues</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Tue Jul 27 2021 10:30:24 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">feel free to send me failure logs, I will look tomorrow :)</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Tue Jul 27 2021 10:30:56 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">decoder: <a href="https://treeherder.mozilla.org/logviewer?job_id=346366814&amp;repo=try&amp;lineNumber=3722">https://treeherder.mozilla.org/logviewer?job_id=346366814&amp;repo=try&amp;lineNumber=3722</a> but would you prefer email?</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Tue Jul 27 2021 11:04:50 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: you can just send me a pm here, then ill remember it tomorrow</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Tue Jul 27 2021 11:05:14 GMT-0700 (Pacific Daylight Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">will do, thanks</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Tue Jul 27 2021 12:29:39 GMT-0700 (Pacific Daylight Time)">19:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@fitzgen:mozilla.org">fitzgen</span>&gt;</div></td><td class="msg-cell">is there a way, via JSAPI, to add new bindings to a script's top-level environment before I execute it? (in this case, I'm dealing with a module's script, if it matters)</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Tue Jul 27 2021 12:49:23 GMT-0700 (Pacific Daylight Time)">19:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><pre><code class="language-js">"use strict";

var g = newGlobal({newCompartment: true});
Error.prototype.whence = "main global";
g.eval("Error.prototype.whence = 'other global'");

var obj = g.eval("[]");
Object.freeze(obj);
try { obj.foo = 7; } catch(e) { print(e.whence); print(e); }
</code></pre>
</td></tr>

</tbody></table></div></div></div>
</body></html>