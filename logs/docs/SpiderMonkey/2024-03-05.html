<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-03-05</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-03-05<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-03-04" class="nav-link"><span>prev</span></a>
<a href="2024-03-06" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Mar 05 2024 02:22:49 GMT-0800 (Pacific Standard Time)">10:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">yet another <strong>Stupid Idea</strong>: what if we had an instant-GC mode where memory gets collected as soon as it can be reclaimed to help web developers figure out from a memory profile where is the memory not being reclaimed as expected? Of course, at the expense of more time to compute the liveness of objects.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Mar 05 2024 07:03:45 GMT-0800 (Pacific Standard Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">possibly dumb question: I'm running IONFLAGS=logs with a browser build (tried both opt and debug) -- and I am not getting any scripts from the page I am loading. Is this a known issue? is there a simple fix?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Mar 05 2024 07:06:34 GMT-0800 (Pacific Standard Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> possibly dumb question: I'm running IONFLAGS=logs with a browser build (tried both opt and debug) -- and I am not getting any scripts from the page I am loading. Is this a known issue? is there a simple fix?</blockquote></mx-reply>Where does it log to? stdout or a file? If the latter, you are probably hitting the content process sandbox.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Mar 05 2024 07:06:59 GMT-0800 (Pacific Standard Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ah, it logs to a file</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Mar 05 2024 07:07:18 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: is the sandbox disabled?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Mar 05 2024 07:07:20 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> ah, it logs to a file</blockquote></mx-reply>You can run with MOZ_DISABLE_CONTENT_SANDBOX=t to disable the sandbox</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Mar 05 2024 07:07:23 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">no</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Mar 05 2024 07:07:27 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">cool, thanks</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Mar 05 2024 09:56:28 GMT-0800 (Pacific Standard Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> yet another <strong>Stupid Idea</strong>: what if we had an instant-GC mode where memory gets collected as soon as it can be reclaimed to help web developers figure out from a memory profile where is the memory not being reclaimed as expected? Of course, at the expense of more time to compute the liveness of objects.</blockquote></mx-reply>In the limit, I think this is impractically expensive, because you'd basically need to do it after every write to a GC field to get an exact result. But you could probably get much of the benefit with a much coarser version—eg after draining the microtask queue, or perhaps at the end of every task.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Mar 05 2024 09:57:25 GMT-0800 (Pacific Standard Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I guess I'd want to be sure of the benefit, though. How would this help? It's not like it's easy to tell whether a specific object has been collected.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Mar 05 2024 09:58:47 GMT-0800 (Pacific Standard Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Also, the memory tool in devtools has a lot of raw capability that I kind of have the sense we haven't put in the time or effort to making useful. In theory, it should be able to provide exactly the information you'd need here: this object is still alive, and this is a chain of objects that are retaining it.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Mar 05 2024 09:59:15 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">My guess is that it's not going to be that useful in actual practice, but I haven't tried using it enough on real examples to know why.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Mar 05 2024 09:59:59 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Like, would it be useful to "flag" an object in advance (while it's obviously still alive and you have an easy handle to it in JS), and then when you take a later heap dump, it'll highlight flagged objects that are still alive? Maybe, but I don't know.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Mar 05 2024 10:01:05 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">You can do some of this manually now with WeakRef/FinalizationGroup—or at least, the part where you detect whether a specific object of interest is still being kept alive.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Mar 05 2024 10:01:18 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(but maybe that's something you'd already know?)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Mar 05 2024 10:01:54 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'd be interested in looking at specific scenarios to better understand what would or wouldn't be useful, and what we already have that maybe isn't exposed or known well enough.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Mar 05 2024 10:03:54 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Also, the memory tool in devtools has a lot of raw capability that I kind of have the sense we haven't put in the time or effort to making useful. In theory, it should be able to provide exactly the information you'd need here: this object is still alive, and this is a chain of objects that are retaining it.</blockquote></mx-reply>I was reading through old V8 blog posts, and I thought <a href="https://v8.dev/blog/optimizing-v8-memory">this one</a> was interesting, not because of the actual changes they made, but because of the tooling that they were using to find optimization opportunities. It feels like we have a lot of the information available to do good heap analysis, but we don't do a good job exposing it.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Mar 05 2024 10:11:02 GMT-0800 (Pacific Standard Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(reading...)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Mar 05 2024 10:14:46 GMT-0800 (Pacific Standard Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">In particular I wonder what we would find if we looked at our own version of figure 1</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Mar 05 2024 10:17:49 GMT-0800 (Pacific Standard Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, it seems like we have just about everything needed to generate a similar graph</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Mar 05 2024 10:20:32 GMT-0800 (Pacific Standard Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">my machine takes about 10sec to write a snapshot from the memory tool. That should be good enough for a graph like that.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Mar 05 2024 10:20:43 GMT-0800 (Pacific Standard Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(for this Element tab)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Mar 05 2024 10:24:29 GMT-0800 (Pacific Standard Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">confession: string optimization works, and only slows down jit-test by a factor of 8. Shipit?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Mar 05 2024 10:24:31 GMT-0800 (Pacific Standard Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Mar 05 2024 10:30:50 GMT-0800 (Pacific Standard Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">o.o did you get the optimize-bit backwards?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Mar 05 2024 10:33:58 GMT-0800 (Pacific Standard Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I guess it's unfair to call it an optimization. It enables optimizations, but forces some stupidity right now just to be able to test it. (Specifically: substrings should always be allocated in the tenured heap! Because why would you want a substring to die young? Are you a monster?)</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Mar 05 2024 10:34:20 GMT-0800 (Pacific Standard Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I guess I should disable that part to make sure it doesn't still slow things down when it's supposedly a no-op.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Mar 05 2024 10:37:26 GMT-0800 (Pacific Standard Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">:) </td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Mar 05 2024 15:13:10 GMT-0800 (Pacific Standard Time)">23:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@jib:mozilla.org">jib</span>&gt;</div></td><td class="msg-cell">Hi, I'm trying to fix a read-write WebIDL interface attribute to be readonly to match the spec, but review suggested I make it a nightly-only pref for a while in case there are compat problems. — But I'm having trouble replicating how readonly throws in strict mode and is ignored in sloppy mode. How do I tell whether the caller is using strict mode?</td></tr>

</tbody></table></div></div></div>
</body></html>