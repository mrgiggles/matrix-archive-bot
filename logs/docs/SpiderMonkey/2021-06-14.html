<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-06-14</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-06-14<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-06-13" class="nav-link"><span>prev</span></a>
<a href="2021-06-15" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jun 14 2021 02:10:21 GMT-0700 (Pacific Daylight Time)">09:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">I'm trying to understand the difference between JS_FN and JS_INLINABLE_FN. only JS_INLINABLE_FN can be called from ion code, i.e. a js function calling a JS_FN cannot be ion optimized, correct? why would a function be JS_FN instead of JS_INLINABLE_FN?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jun 14 2021 02:23:27 GMT-0700 (Pacific Daylight Time)">09:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: all functions can be called from Ion code, but the ones marked JS_INLINABLE_FN have special JIT optimizations (see <a href="https://searchfox.org/mozilla-central/source/js/src/jit/InlinableNatives.h">this list</a>), for example <code>Math.abs</code> can be just a few machine instructions without a call. Doing this requires extra code and is a lot of work for more complicated builtins</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jun 14 2021 02:34:26 GMT-0700 (Pacific Daylight Time)">09:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">That's why we should not regress Octane raytrace benchmark!</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jun 14 2021 02:38:46 GMT-0700 (Pacific Daylight Time)">09:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-4">l11d</span>: all functions can be called from Ion code, but the ones marked JS_INLINABLE_FN have special JIT optimizations (see <a href="https://searchfox.org/mozilla-central/source/js/src/jit/InlinableNatives.h">this list</a>), for example <code>Math.abs</code> can be just a few machine instructions without a call. Doing this requires extra code and is a lot of work for more complicated builtins</blockquote></mx-reply>thank you. seems like I just didn't call the js function often enough but I got it to work</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jun 14 2021 02:39:21 GMT-0700 (Pacific Daylight Time)">09:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/public/experimental/JitInfo.h#139">https://searchfox.org/mozilla-central/source/js/public/experimental/JitInfo.h#139</a>  The JS engine and the DOM can register some function calls and provide properties about them, such as AliasAnalysis info. This is useful for the optimizing JIT to fold similar operation, even if these calls are in-between</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jun 14 2021 02:41:14 GMT-0700 (Pacific Daylight Time)">09:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">so I could write a custom function (in cpp) that doesn't invalidate aliasanalysis?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jun 14 2021 02:42:18 GMT-0700 (Pacific Daylight Time)">09:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">(edit: Yes, but …) not invalidate, but refine anlias analysis.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jun 14 2021 02:43:17 GMT-0700 (Pacific Daylight Time)">09:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">For example: <code>x = obj.a; foo(); x += obj.a;</code> will avoid loading <code>obj.a</code> twice if <code>foo</code> alias set is <code>None</code>.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jun 14 2021 02:44:11 GMT-0700 (Pacific Daylight Time)">09:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">The alias set determines what can be mutated by the function.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jun 14 2021 02:48:39 GMT-0700 (Pacific Daylight Time)">09:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">sounds like something I'd like use, I'll give it a try 🙂</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jun 14 2021 05:42:56 GMT-0700 (Pacific Daylight Time)">12:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">Hello. I'm hoping that someone might be able to help me with a RegExp issue I'm having in my embedding.
I'm using ESR 78 and a user has reported getting a "too much recursion" error.
I've managed to reproduce it with a very simple script.
const str = "Check this sentence for non-whitespace characters";
const patt = /\S/g;
var result = str.match(patt);    // this is the line that provokes the error/exception "too much recursion"
I've tested this in the current version of Firefox and in the js shell I made when compiling 78 and it works without any problems.
I'm clearly missing something obvious or doing something stupid in my embedding.
Does anybody have any idea what I could be doing wrong?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jun 14 2021 06:03:47 GMT-0700 (Pacific Daylight Time)">13:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">miles</span>: the current version of Firefox embeds [the latest] v8 regexp engine.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jun 14 2021 06:04:04 GMT-0700 (Pacific Daylight Time)">13:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">miles</span>: just to make sure, you're calling JS_SetNativeStackQuota?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jun 14 2021 06:04:47 GMT-0700 (Pacific Daylight Time)">13:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">Aha! I'm definitely <em>not</em> calling JS_SetNativeStackQuota. Do I need to do that when I start up the engine then?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jun 14 2021 06:05:47 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">miles</span>: this is how it is done in Firefox: <a href="https://searchfox.org/mozilla-central/source/js/xpconnect/src/XPCJSContext.cpp#1206-1339">https://searchfox.org/mozilla-central/source/js/xpconnect/src/XPCJSContext.cpp#1206-1339</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jun 14 2021 06:06:19 GMT-0700 (Pacific Daylight Time)">13:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah on each thread you execute JS on. Just to test if it helps, you could try calling it with a value of 128 KB or so</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jun 14 2021 06:07:50 GMT-0700 (Pacific Daylight Time)">13:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">miles</span>: if I am correct, this test case might even work in SpiderMonkey shell: <a href="https://searchfox.org/mozilla-central/source/js/xpconnect/tests/chrome/test_bug732665_meta.js">https://searchfox.org/mozilla-central/source/js/xpconnect/tests/chrome/test_bug732665_meta.js</a></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jun 14 2021 06:08:58 GMT-0700 (Pacific Daylight Time)">13:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">Many thanks. I'll try that very shortly...
I've been using <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/tree/next/examples">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/tree/next/examples</a> for examples.
I can't see a call to JS_SetNativeStackQuota in the examples.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jun 14 2021 06:09:21 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">Are there any other function calls that I need to ensure I do?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jun 14 2021 06:21:00 GMT-0700 (Pacific Daylight Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I filed bug 1716324 to use a reasonable default here for when the embedder forgets to set the stack quota (or doesn't really care)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jun 14 2021 06:21:02 GMT-0700 (Pacific Daylight Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>yeah on each thread you execute JS on. Just to test if it helps, you could try calling it with a value of 128 KB or so</p>
</blockquote>
<p>OK. I've tested that and it does the trick. Fantastic 😀<br>Is 128kB a sensible value to use or should I be using something else? If so, how do I determine it?<br>I'm also slightly concerned that there might be other functions that I should be calling at startup as well as this.<br>Is there anywhere that I can see what I should be calling?<br>Apologies for all the questions. It's great that you've manged to fix my problem straight away...</p>
</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jun 14 2021 06:21:02 GMT-0700 (Pacific Daylight Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1716324">https://bugzil.la/1716324</a> — ASSIGNED (jandem) — Call JS_SetNativeStackQuota when creating the JSContext</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jun 14 2021 06:22:21 GMT-0700 (Pacific Daylight Time)">13:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">So, erm, I still haven't figured out how to turn a rust String into a JSString 🙁</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Jun 14 2021 06:22:41 GMT-0700 (Pacific Daylight Time)">13:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">miles</span>: <a href="https://searchfox.org/mozilla-central/rev/bea2345ce636dc329ac7133fc0a13c9171777e40/js/src/shell/js.cpp#301-305">this</a> is what we use for the JS shell</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Jun 14 2021 06:23:26 GMT-0700 (Pacific Daylight Time)">13:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(I'll probably use those values for the default stack quota)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Jun 14 2021 06:26:21 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>(I'll probably use those values for the default stack quota)</p>
</blockquote>
<p>OK. I'll use those then.<br>Many thanks for the help</p>
</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Jun 14 2021 07:21:54 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That's why we should not regress Octane raytrace benchmark!</blockquote></mx-reply>is there a recent regression on octane somehow related to aliasanlaysis?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Jun 14 2021 07:35:27 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: did you take a look at how servo is doing it?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Jun 14 2021 07:36:07 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">this might be a good starting point: <a href="https://github.com/servo/servo/search?q=JS_NewStringCopyN">https://github.com/servo/servo/search?q=JS_NewStringCopyN</a></td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Jun 14 2021 07:43:45 GMT-0700 (Pacific Daylight Time)">14:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I didn't see any instances last time if I remember correctly</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Jun 14 2021 07:44:00 GMT-0700 (Pacific Daylight Time)">14:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">but I'll try again</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Jun 14 2021 07:46:43 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">something along the lines of this? <a href="https://github.com/servo/servo/blob/56d12d8a869467d292eec2b11d90669bf61c0b07/components/script/script_module.rs#L1465-L1469">https://github.com/servo/servo/blob/56d12d8a869467d292eec2b11d90669bf61c0b07/components/script/script_module.rs#L1465-L1469</a></td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Jun 14 2021 07:46:51 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">I think that is the same as_str as in rust</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Jun 14 2021 08:13:11 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: This was related to the fact that SpiderMonkey is embedded in Gimp.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Jun 14 2021 10:49:14 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>well.... that's a weird error</p>
<pre><code>Assertion failure: (attributes() &amp; ~(JSPROP_ENUMERATE | JSPROP_IGNORE_ENUMERATE | JSPROP_PERMANENT | JSPROP_IGNORE_PERMANENT | JSPROP_READONLY | JSPROP_IGNORE_READONLY | JSPROP_IGNORE_VALUE | JSPROP_GETTER | JSPROP_SETTER | JSPROP_RESOLVING)) == 0, at C:/Users/[REDACTED]/Software/spiderfire/target/debug/build/mozjs_sys-9268feb1144a9721/out/build/dist/include\js/PropertyDescriptor.h:214
</code></pre>
</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Jun 14 2021 11:01:10 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-release/source/js/public/PropertyDescriptor.h#214-218">https://searchfox.org/mozilla-release/source/js/public/PropertyDescriptor.h#214-218</a> that's this one</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Jun 14 2021 11:01:44 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">and I have no idea how I'm tripping it, flags are all <code>(JSPROP_ENUMERATE | JSPROP_READONLY | JSPROP_PERMANENT) as u16</code></td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Jun 14 2021 11:03:13 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Is this on esr-78? I'm a little worried this is some 64-bit mismatch garbage =\</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Jun 14 2021 11:03:48 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I believe this is SM 88</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Jun 14 2021 11:04:07 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">(SM 89 isn't merged into rust-mozjs yet)</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Jun 14 2021 11:04:07 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">eg We've had a few issues where the .dll/.do is built with JS_64BIT which gives one memory layout, while that flag is missing from public API consumer so the fields are in wrong spot</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Jun 14 2021 11:04:57 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">oh.. I fixed some of these in SM 90 :| <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1708330">https://bugzilla.mozilla.org/show_bug.cgi?id=1708330</a></td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Jun 14 2021 11:05:43 GMT-0700 (Pacific Daylight Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><a href="https://phabricator.services.mozilla.com/D113742">https://phabricator.services.mozilla.com/D113742</a> might be needed</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Jun 14 2021 11:06:24 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(the JS_64BIT in <a href="http://js-config.h.in">js-config.h.in</a>) You can also try just forcing JS_64BIT to be defined in your build setup</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Jun 14 2021 11:07:02 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(This may be way off base, but I recall a few people hitting bizarre failures in things like JSString recently-ish)</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Jun 14 2021 11:08:17 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I guess I should make an issue to <code>rust-mozjs</code> then?</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon Jun 14 2021 11:11:04 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">or is <code>JS_64BIT</code> an environment variable?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon Jun 14 2021 11:24:13 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">It is a cpp MACRO. And this is in rust-mozjs? hmm</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon Jun 14 2021 11:29:13 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">So the failure is when rust-mozjs compiles itself on windows?</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon Jun 14 2021 11:32:58 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>actually, issue might be me not including the "empty function" in the FunctionSpec thing, as in this one</p>
<pre><code class="language-rs">         JSFunctionSpecWithHelp {
		name: ptr::null_mut(),
		call: None,
		nargs: 0,
		flags: 0,
		jitInfo: ptr::null_mut(),
		usage: ptr::null_mut(),
		help: ptr::null_mut(),
	},
</code></pre>
</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon Jun 14 2021 11:33:28 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">oh, the end-of-list sentinel? yeah that would be a problem </td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon Jun 14 2021 11:33:33 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">appears to be working now</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon Jun 14 2021 11:33:41 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">👍️</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon Jun 14 2021 11:33:51 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">granted, my macro for functions is still utterly broken</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon Jun 14 2021 11:34:19 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>I was trying to do some stuff for a syntax like this</p>
<pre><code class="language-rs">#[macro_rules_attribute(js_fn!)]
fn log(cx: IonContext, #[varargs] values: Vec&lt;Value&gt;) -&gt; IonResult&lt;()&gt; {
	println!("logging_test");
	print_indent(false);
	print_args(cx, values, false);
	println!();

	Ok(())
}
</code></pre>
</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon Jun 14 2021 11:34:44 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><code>Value</code> is the equivalent of <code>JSVal</code></td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon Jun 14 2021 11:38:05 GMT-0700 (Pacific Daylight Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">And.... it's very complicated to debug because I decided to have recursive macros 🙃</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon Jun 14 2021 12:17:06 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">What is our current policy wrt <code>--without-intl-api</code>? I have a number of mozconfigs that use it to build slightly faster, but we don't test it in CI, and we've landed a couple of jit-tests lately that use Intl unguarded. Do we care about keeping it going?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon Jun 14 2021 12:21:04 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">It is unsupported. I think we use for the WASI experiment though, so if you want to fix simple things I can stamp the patch</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon Jun 14 2021 12:21:30 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I'm hoping that after ICU4X it will be easier to build with no data sources but still have the APIs around. In which case we'd always have the API.</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon Jun 14 2021 12:23:31 GMT-0700 (Pacific Daylight Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(we were hoping that WASI would be tier-2 to <em>build</em> so, might make sense to fix tests that are just a metadata update)</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon Jun 14 2021 12:34:35 GMT-0700 (Pacific Daylight Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay, sounds good. Patch submitted.</td></tr>

</tbody></table></div></div></div>
</body></html>