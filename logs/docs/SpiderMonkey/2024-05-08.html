<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-05-08</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-05-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-05-07" class="nav-link"><span>prev</span></a>
<a href="2024-05-09" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue May 07 2024 20:28:15 GMT-0700 (Pacific Daylight Time)">03:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> is there a cheatsheet on reading js spec like common terms and what they mean explained in noob terms like for example i am trying to read <a href="https://tc39.es/proposal-explicit-resource-management/">https://tc39.es/proposal-explicit-resource-management/</a> but looks like i should have paid more attention to compilers class :-/</blockquote></mx-reply>you may have a good reason, but just to check â€” do you need to read the spec? Are you interested in implementing it, reviewing the details of the proposal, making automated proofs, or fuzzing it? Those are the all the reasons I can think of for reading the spec. If you want to understand the proposal, or figure out what it'd be like to use it, or probably even most ways you'd want to review the proposal, then read the README at <a href="https://github.com/tc39/proposal-explicit-resource-management">https://github.com/tc39/proposal-explicit-resource-management</a> and any slide decks or explainers, but don't read the spec text itself. Spec text is mostly useless for understanding anything, imho.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue May 07 2024 22:56:15 GMT-0700 (Pacific Daylight Time)">05:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">i am trying my hand at implementing <a href="https://phabricator.services.mozilla.com/D207371">https://phabricator.services.mozilla.com/D207371</a> the implementation is based on what i read on the README on the repo wanted to know if I correctly covered everything</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue May 07 2024 22:59:06 GMT-0700 (Pacific Daylight Time)">05:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">I correctly covered everything on the suggested syntax </td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue May 07 2024 23:42:53 GMT-0700 (Pacific Daylight Time)">06:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I think in this case you need to read the proposal's spec text.  the explainer doesn't contain the syntax restriction that you need to be aware of when implementing parser</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue May 07 2024 23:43:08 GMT-0700 (Pacific Daylight Time)">06:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">commented on the phab revision</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed May 08 2024 00:02:43 GMT-0700 (Pacific Daylight Time)">07:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">debadree25</span>: for Parser implementation, <a href="https://tc39.es/ecma262/#sec-grammar-notation">https://tc39.es/ecma262/#sec-grammar-notation</a> is what you need</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed May 08 2024 00:16:13 GMT-0700 (Pacific Daylight Time)">07:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">aha got it! reading and updating the revision! tysm!!</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed May 08 2024 06:34:56 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell">Hi, I'm passing subarray (<code>let buffer = new Uint8Array(1024); buffer.subarray(37)</code>) to C++ and want to access raw data from the passed subarray and write data to it.<br>Right now I extract pointer to the base through <code>JS_GetArrayBufferViewData</code> and get offset via <code>JS_GetArrayBufferViewByteOffset</code> but I always write data to the begining of original buffer, because <code>JS_GetArrayBufferViewByteOffset</code> always returns 0.<br>How to get an offset from base, in my case <code>37</code>?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed May 08 2024 06:42:44 GMT-0700 (Pacific Daylight Time)">13:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">which version of spidermonkey are you using?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed May 08 2024 06:44:37 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell">from March 12, it is <code>JavaScript-C125.0a1</code></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed May 08 2024 06:46:28 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thanks.  iiuc, there's no major change in the typed array since then, so I'll check the behavior with the current m-c tip</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed May 08 2024 06:47:54 GMT-0700 (Pacific Daylight Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">So, <a href="https://searchfox.org/mozilla-central/rev/8ec3cc0472ad4f51b254728d024b696eaba82ba0/js/src/vm/ArrayBufferViewObject.cpp#498-506">JS_GetArrayBufferViewByteOffset</a> can return 0 for 2 reasons. one is that the object is not <code>ArrayBufferViewObject</code>, the other is when the buffer is not available for some reason or detached or out-of-bounds</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed May 08 2024 06:49:15 GMT-0700 (Pacific Daylight Time)">13:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Do you call <code>JS_GetArrayBufferViewData</code> immediately before/after <code>JS_GetArrayBufferViewByteOffset</code> with exactly same object?  if so, as long as <a href="https://searchfox.org/mozilla-central/rev/8ec3cc0472ad4f51b254728d024b696eaba82ba0/js/src/vm/ArrayBufferViewObject.cpp#401,404-406">JS_GetArrayBufferViewData</a> returns non-null, it should be <code>ArrayBufferViewObject</code></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed May 08 2024 06:50:36 GMT-0700 (Pacific Daylight Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell"><code>args[1].toObject().is&lt;js::ArrayBufferViewObject&gt;()</code> returns <code>true</code></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed May 08 2024 06:50:40 GMT-0700 (Pacific Daylight Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">also you don't need to account for the byte offset yourself - the view's data should point to buffer + 37</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed May 08 2024 06:55:59 GMT-0700 (Pacific Daylight Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@dbezhetskov:igalia.com">dbezhetskov</span>&gt;</div></td><td class="msg-cell">thanks <span class="nick-15">arai</span> and <span class="nick-10">jandem</span> , my bad, the pointer has been already adjusted</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed May 08 2024 07:24:09 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">Hi all, in our use case, we are running into a situation where the GC is not aware of memory consumption of the objects stored in private data slots of our JS objects. We allocate many JS Objects that they themselves don't consume a ton of memory, but the objects stored in the private data slot can be on the larger side. The objects stored in the private data slot are not allocated using using the allocation calls within spidermonkey, so we think this means the private slot data objects aren't being considered for invoking the garbage collector. Is there any way/API to provide the memory size consumed by private slot data to the GC ?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed May 08 2024 08:12:00 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">santiroche</span>: yes, JS::Add/RemoveAssociatedMemory. See <a href="https://searchfox.org/mozilla-central/source/js/public/MemoryFunctions.h#72-86">https://searchfox.org/mozilla-central/source/js/public/MemoryFunctions.h#72-86</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed May 08 2024 08:12:29 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">thank you!</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed May 08 2024 08:18:41 GMT-0700 (Pacific Daylight Time)">15:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ah yes, that is a good reason for reading the spec</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed May 08 2024 09:27:19 GMT-0700 (Pacific Daylight Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: I submitted further annoying comments on bug 1894005. I may be just confusing myself. Happy to discuss if needed.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed May 08 2024 09:27:21 GMT-0700 (Pacific Daylight Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1894005">https://bugzil.la/1894005</a> â€” ASSIGNED (jonco) â€” Investigate adding a per-script alloc site</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed May 08 2024 09:31:06 GMT-0700 (Pacific Daylight Time)">16:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">No, they are fair comments, I'll look at this again</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed May 08 2024 11:29:08 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">How critical is the  <code>MOZ_ASSERT(!cx-&gt;isExceptionPending());</code> in <code>JS::CheckForInterrupt(JSContext* cx)</code> ?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed May 08 2024 11:31:20 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">important. Sounds like there's an error happening that you're not handling.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed May 08 2024 11:47:37 GMT-0700 (Pacific Daylight Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">Generally, not safe to continue executing the interrupt handler when a JS Exception is pending? What kind of situations could we get into if we were to continue executing without handling the JS exception until after the interrupt check? </td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed May 08 2024 11:48:18 GMT-0700 (Pacific Daylight Time)">18:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">well, it's more that you shouldn't have made it to the interrupt handler with an exception pending</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed May 08 2024 11:49:02 GMT-0700 (Pacific Daylight Time)">18:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">in general, you don't want to continue doing anything in the engine with an exception pending</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed May 08 2024 11:50:13 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the state of things may not be consistent, so many guarantees are off</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed May 08 2024 11:50:31 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">maintaining this is mostly a matter of checking the bool return value and propagating false</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed May 08 2024 11:50:42 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(of most JSAPI functions)</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed May 08 2024 11:52:12 GMT-0700 (Pacific Daylight Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">got it. It looks like we are calling a javascript function from within our c++, which is what triggers the interrupt check, but we have the exception pending. Will have to add some additional checks to ensure we don't violate the interrupt code being called with the exception pending here. Thanks again.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed May 08 2024 11:56:14 GMT-0700 (Pacific Daylight Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the interrupt handler isn't strictly relevant here. It's just where the check was that you hit. There are similar assertions <a href="https://searchfox.org/mozilla-central/search?q=MOZ_ASSERT%28%21cx-%3EisExceptionPending&amp;path=&amp;case=false&amp;regexp=false">scattered across</a> many common entry points. The general rule is: if you call <code>JS::f(cx); JS::g(cx)</code>, then you're at risk of something asserting in <code>JS::g(cx)</code>. That needs to be <code>if (!JS::f(cx)) return false; if (!JS::g(cx)) return false;</code></td></tr>

</tbody></table></div></div></div>
</body></html>