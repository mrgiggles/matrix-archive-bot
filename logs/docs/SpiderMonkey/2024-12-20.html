<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-12-20</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-12-20<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-12-18" class="nav-link"><span>prev</span></a>
<a href="2024-12-31" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Dec 20 2024 10:48:16 GMT-0800 (Pacific Standard Time)">18:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">greetings. I'm one of the developers of the Haiku operating system, and as of last month we have an "at least functional" port of "Firefox" (no official branding yet). I'm working on tracking down bugs and things to optimize in Haiku for it, and while doing so noticed that the main process actually was calling fork() on a regular basis, and I tracked that down to here: <a href="https://searchfox.org/mozilla-esr128/source/js/src/shell/js.cpp#6602">https://searchfox.org/mozilla-esr128/source/js/src/shell/js.cpp#6602</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Dec 20 2024 10:48:59 GMT-0800 (Pacific Standard Time)">18:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">is there any particular reason for this using 'real' fork() here, instead of posix_spawn? on first glance I don't see one, but perhaps there's something I don't know about this code</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Dec 20 2024 10:53:43 GMT-0800 (Pacific Standard Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">waddlesplash</span>: That particular <code>fork</code> shouldn't be part of a Firefox build. It's part of the shell, which is a standalone JS repl that we use for testing.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Dec 20 2024 10:54:21 GMT-0800 (Pacific Standard Time)">18:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">hmm. then what's calling fork() I wonder? I thought it was that... let me get the stack trace</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Dec 20 2024 10:58:45 GMT-0800 (Pacific Standard Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">here's an example</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Dec 20 2024 11:00:29 GMT-0800 (Pacific Standard Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">I guess looking at this more closely it might be <code>os_spawn</code> instead?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Dec 20 2024 11:00:41 GMT-0800 (Pacific Standard Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">but that just raises the same question then</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Dec 20 2024 11:00:53 GMT-0800 (Pacific Standard Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">That stack trace doesn't make any sense to me</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Dec 20 2024 11:01:03 GMT-0800 (Pacific Standard Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">well, it's possible this debugger is unwinding the stack wrong</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Dec 20 2024 11:01:11 GMT-0800 (Pacific Standard Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">let's try real GDB and see if we get something different</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Dec 20 2024 11:01:32 GMT-0800 (Pacific Standard Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I would not be surprised if jitcode is confusing your debugger</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Dec 20 2024 11:03:35 GMT-0800 (Pacific Standard Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">yeah, our homegrown debugger doesn't necessarily handle JITs correctly, but IIRC such stack frames just aren't printed</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Dec 20 2024 11:04:01 GMT-0800 (Pacific Standard Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">OK, yeah, you're right, using GDB I get a very different stack trace... I wonder how we wound up with those other functions in this trace at all?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Dec 20 2024 11:04:19 GMT-0800 (Pacific Standard Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">the thing at the end of this stack trace is now <code>PosixProcessLauncher</code></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Dec 20 2024 11:05:00 GMT-0800 (Pacific Standard Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">which also doesn't use <code>posix_spawn</code> ever... so I guess it's the same question, but now not JS-specific. apologies for the confusion then!</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Dec 20 2024 11:08:41 GMT-0800 (Pacific Standard Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">waddlesplash</span>: <a href="https://firefox-source-docs.mozilla.org/dom/ipc/process_model.html#fork-server">This may be relevant</a></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Dec 20 2024 11:09:11 GMT-0800 (Pacific Standard Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">I did see references to that, yeah. But it says "Linux only" (i.e. it isn't even supported on the BSDs?)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Dec 20 2024 11:10:25 GMT-0800 (Pacific Standard Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/toolkit/moz.configure#3039-3046">Looks like at least the BSDs are included</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Dec 20 2024 11:11:02 GMT-0800 (Pacific Standard Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">ah, very nice. Well in that case it should be easy for us to add ourselves to that list and use it then. Thanks for the tip, would've saved me an hour of poking around in the code :)</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Dec 20 2024 11:12:32 GMT-0800 (Pacific Standard Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">FYI <a href="https://matrix.to/#/#ipc:mozilla.org">#ipc:mozilla.org</a> would be the relevant channel for fork server stuff, I think.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Dec 20 2024 11:13:19 GMT-0800 (Pacific Standard Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Though we're close to the end of year holidays so probably not a lot of people around.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Dec 20 2024 11:15:08 GMT-0800 (Pacific Standard Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">Yeah, I see all the people with "PTO" in their names, indeed.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Dec 20 2024 11:15:31 GMT-0800 (Pacific Standard Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@waddlesplash:mozilla.org">waddlesplash</span>&gt;</div></td><td class="msg-cell">I've filed a ticket in our bugtracker about our own Debugger's brokenness (<a href="https://dev.haiku-os.org/ticket/19309">https://dev.haiku-os.org/ticket/19309</a>). Sorry again for the confusion!</td></tr>

</tbody></table></div></div></div>
</body></html>