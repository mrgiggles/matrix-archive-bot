<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-12-03</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-12-03<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-12-02" class="nav-link"><span>prev</span></a>
<a href="2024-12-04" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Dec 03 2024 00:48:47 GMT-0800 (Pacific Standard Time)">08:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">itms</span>: which compiler and SM version are you using? can you pastebin these warnings somewhere?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Dec 03 2024 04:17:54 GMT-0800 (Pacific Standard Time)">12:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: right now we are using SM 115, so we're an ESR late and I assume the warnings we have are already fixed.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Dec 03 2024 04:19:38 GMT-0800 (Pacific Standard Time)">12:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">a warning under clang 18, hundreds under our minimum supported compilers in our CI which are clang 9 and GCC 8</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Dec 03 2024 04:23:21 GMT-0800 (Pacific Standard Time)">12:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">the reason I'm desperately asking here is because I can't figure out how to do that with mach, as we used to run configure+make while sending all stderr somewhere else. right now this is preventing us from moving to mach, which is really frustrating!</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Dec 03 2024 04:35:07 GMT-0800 (Pacific Standard Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">6-8% improvement on wasm-embenchen-validate : <a href="https://treeherder.mozilla.org/perfherder/graphs?highlightAlerts=1&amp;highlightChangelogData=1&amp;highlightCommonAlerts=0&amp;replicates=0&amp;series=mozilla-central,87324,1,13&amp;series=mozilla-central,87336,1,13&amp;series=mozilla-central,87312,1,13&amp;timerange=5184000&amp;zoom=1732476127991,1733296755898,50.764440323682386,59.990855664066245">https://treeherder.mozilla.org/perfherder/graphs?highlightAlerts=1&amp;highlightChangelogData=1&amp;highlightCommonAlerts=0&amp;replicates=0&amp;series=mozilla-central,87324,1,13&amp;series=mozilla-central,87336,1,13&amp;series=mozilla-central,87312,1,13&amp;timerange=5184000&amp;zoom=1732476127991,1733296755898,50.764440323682386,59.990855664066245</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Dec 03 2024 04:35:33 GMT-0800 (Pacific Standard Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">Can't see anything in that range except the rustc and clang update </td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Dec 03 2024 05:33:06 GMT-0800 (Pacific Standard Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: are you still interested in the warnings? or is it expected that I have warnings for SM115?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Dec 03 2024 05:34:59 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm not sure if there's easy way to suppress the warnings from config, but if there's not, I'd suggest apply a patch locally.  ESR 115 is almost reaching EOL (2 cycles remaining) and it's less likely a patch is uplifted there</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Dec 03 2024 05:37:38 GMT-0800 (Pacific Standard Time)">13:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://whattrainisitnow.com/calendar/">https://whattrainisitnow.com/calendar/</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Dec 03 2024 05:38:16 GMT-0800 (Pacific Standard Time)">13:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">yes I think I'll do that, but I don't manage to see where I should patch the build system to suppress the warnings, it looks a bit complicated to me</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Dec 03 2024 05:39:39 GMT-0800 (Pacific Standard Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the warning options are prepared in <a href="https://searchfox.org/mozilla-esr115/rev/be51e64f316775dab6e3dab5795d3b2f6112199c/build/moz.configure/warnings.configure#317-320">warnings.configure</a>, so modifying it may work?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Dec 03 2024 05:39:54 GMT-0800 (Pacific Standard Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">I know we're late, actually we are currently on SM91! We are in the process of upgrading to 115, we'll upgrade to 128 in a few months, but we're blocked by that transition to the mach build system</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Dec 03 2024 05:41:29 GMT-0800 (Pacific Standard Time)">13:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">yes I was trying something a bit more sophisticated like adding a <code>--disable-warnings</code> flag, in case it was of interest to you upstream.... but if it's not, I'll just patch away the warnings setup</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Dec 03 2024 05:53:44 GMT-0800 (Pacific Standard Time)">13:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm not sure about the criteria for adding that kind of configuration, but if it you can find a place where the existing code is doing something similar, and the option can simplify the situation, addressing it at the same time will increase the chance of accepting the patch</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Dec 03 2024 05:55:18 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">otherwise the option won't be tested, and likely it will stop working shortly</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Dec 03 2024 05:59:38 GMT-0800 (Pacific Standard Time)">13:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">yes, of course, it's a good point about it not being tested</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Dec 03 2024 06:00:41 GMT-0800 (Pacific Standard Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">if all warnings are fixed in newer ESRs I'll patch the warnings setup and remove that hack when catching the train</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Dec 03 2024 06:02:31 GMT-0800 (Pacific Standard Time)">14:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I suppose, all those warnings come from third-party code, and in that case it's less likely they're fully fixed</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Dec 03 2024 06:04:07 GMT-0800 (Pacific Standard Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">for non-third-party code, the <code>--enable-warnings-as-errors</code> configuration will catch warnings</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Dec 03 2024 06:04:20 GMT-0800 (Pacific Standard Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and that configuration is tested on automation</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Dec 03 2024 06:04:43 GMT-0800 (Pacific Standard Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(at least for SpiderMonkey.  not sure for the entire Firefox codebase)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Dec 03 2024 06:04:55 GMT-0800 (Pacific Standard Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">how do you folks disable third-party warnings while developing upstream?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Dec 03 2024 06:05:38 GMT-0800 (Pacific Standard Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">or maybe you don't and only catch errors with that flag you talk about?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Dec 03 2024 06:07:35 GMT-0800 (Pacific Standard Time)">14:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">iiuc the warnings-as-errors doesn't affect the third party code, but I don't know details</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Dec 03 2024 06:18:24 GMT-0800 (Pacific Standard Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@itms:mozilla.org">itms</span>&gt;</div></td><td class="msg-cell">Noted, thanks for the input arai!</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Dec 03 2024 08:33:28 GMT-0800 (Pacific Standard Time)">16:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: Working on your review feedback on those JIT code GC patches; there's a few that are not approved, but also have no comments... are they just missed or are there pedning phabricator comments that didn't get saved yet</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Dec 03 2024 08:38:10 GMT-0800 (Pacific Standard Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: oh sorry... there should only be one remaining now</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Dec 03 2024 08:38:31 GMT-0800 (Pacific Standard Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">:D No worries. Just wanted to make sure there wasn't pending stuff to take care of</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Dec 03 2024 08:49:25 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">jandem: What is the reason we cancel off-thread Ion compilation at the start of GC? I always thought it was in case the compilation jobs had pointers to dead GC things... but we can trace these, and we do for queued and finished jobs at least... So if that's the reason maybe we don't need to cancel the queued ones? (We also cancel off-thread Ion compilation jobs when we start sweeping unless we already did it in this slice.)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Dec 03 2024 09:06:12 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: I think it would be worth adding a testing flag to not cancel on gc.. We have to cancel for compacting gc because tenured gc thing pointers may be used by the MIR backend, but for non-compacting I agree it should be okay?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Dec 03 2024 09:10:19 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it's also related to discarding JIT code: we don't want to discard the baseline code when there's still an off-thread Ion compilation etc</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Dec 03 2024 09:10:42 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">but if we're not discarding we probably don't need to cancel compilations</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Dec 03 2024 09:11:04 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">oh ok, that makes sense</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Dec 03 2024 09:11:04 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Trying to put together a list of things that happen in off-thread compiles that are invalidated by compacting GC: 1. We bake GC pointers into the generated code, and we don't have the infrastructure to trace those pointers during the compilation process (eg in the masm buffer, in stack frames). 2. We sometimes dereference a script pointer off-thread (<a href="https://searchfox.org/mozilla-central/rev/ed26560fef073fd3f5e951fcadf5c2620778b00a/js/src/jit/WarpBuilder.cpp#178">eg</a>), which won't work if a compacting GC moves it. 3. ???</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Dec 03 2024 09:13:33 GMT-0800 (Pacific Standard Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I speculate that we might be able to fix #1 if we kept a side-table of relocations to fix up at link time, instead of baking in a possibly stale pointer. For #2, I would hope we only actually look at the immutable script data. I wonder if we could pass a pointer to that, instead of the script itself.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Dec 03 2024 09:13:46 GMT-0800 (Pacific Standard Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">also there's no synchronisation between the main thread and a running compilation task, so it's not enough to trace (we can trace some pointers in Ion compilation jobs; I don't know if we trace all of them)</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Dec 03 2024 09:16:27 GMT-0800 (Pacific Standard Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">We can trace the snapshot, at least, and in an ideal world that would contain all the GC things that the offthread code has access to. If we could avoid using raw GC pointers in the offthread code, then I think we could preserve an off-thread compilation through a compacting GC.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Dec 03 2024 09:19:44 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I guess there's a problem of inherent raciness for things like <a href="https://searchfox.org/mozilla-central/source/js/src/jit/MIR.cpp#1970-1976">this</a>, where we can look at the characters of a string because we will cancel the compilation if it could move.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Dec 03 2024 09:20:20 GMT-0800 (Pacific Standard Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">tracing the snapshot should be sufficient but there are some tricky cases like <code>CodeGenerator::zoneStubsToReadBarrier_</code></td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Dec 03 2024 09:21:49 GMT-0800 (Pacific Standard Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(maybe we can change that to instead look up the stub(s) at the start of the compilation and then record a pointer in the snapshot)</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Dec 03 2024 09:24:19 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I don't suppose we have a mechanism to tell the GC not to move particular objects, even for a compacting GC?</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Dec 03 2024 09:25:38 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: no</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Dec 03 2024 09:28:02 GMT-0800 (Pacific Standard Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I am realizing that I know very little about the mechanics of a compacting GC. Do we find emptier chunks and move their contents into fuller chunks?</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Dec 03 2024 09:28:20 GMT-0800 (Pacific Standard Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">we find emptier arenas and move their contents to fuller arenas</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Dec 03 2024 09:29:43 GMT-0800 (Pacific Standard Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">there's no support for 'pinning' GC things because 1) we want to be able to move everything for best results and 2) it makes working out which arenas to move much more complicated</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Dec 03 2024 09:30:33 GMT-0800 (Pacific Standard Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, we could just short-circuit arenas with pinned GC things into the list of destinations, but that would presumably make all of our other decisions worse unless there were very few pinned GC things.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Dec 03 2024 09:31:38 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">There's an even more complicated version of this where we try to compact into the pinned arenas, and then if the resulting plan ends up too inefficient, we just go ahead and cancel the off-thread compilation after all</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Dec 03 2024 09:32:56 GMT-0800 (Pacific Standard Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Our goal here is to make GC as complicated as possible, right?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Dec 03 2024 09:33:11 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">😂</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Dec 03 2024 09:33:45 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">yeah compacting GC is relatively rare so the extra complexity is probably not worth it</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Dec 03 2024 09:34:01 GMT-0800 (Pacific Standard Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, I am concluding that rewriting the offthread compilation code is a better use of our time</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Dec 03 2024 09:59:05 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">pinning by AllocKind ("don't move any JSScripts") would not be that complicated. Though the rules about whether or not to pin them might be. The big hammer would be to just make that whole AllocKind <a href="https://searchfox.org/mozilla-central/rev/ed26560fef073fd3f5e951fcadf5c2620778b00a/js/src/gc/AllocKind.h#58,62">non-compactable</a>.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Dec 03 2024 11:02:16 GMT-0800 (Pacific Standard Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><p>i am trying to debug something with lldb say i have stopped at a frame and i see something like this</p>
<pre><code>(JSContext *) cx = 0x0000000103b53a00
(js::jit::BaselineFrame *) frame = 0x000000016fdfc0d8
(js::jit::ICFallbackStub *) stub = 0x0000000103bcecf8
(JS::HandleValue) lhs = {
  ptr = 0x000000016fdfc068
}
(JS::HandleValue) rhs = {
  ptr = 0x000000016fdfc070
}
(JS::MutableHandleValue) res = {
  ptr = 0x000000016fdfc030
}
(jsbytecode *) pc = &lt;variable not available&gt;
</code></pre>
<p>now when i try to do something like <code>expr lhs.toObject()</code> i see an error like</p>
<pre><code>error: Couldn't look up symbols:
  __ZNK2js20WrappedPtrOperationsIN2JS5ValueENS1_6HandleIS2_EEvE8toObjectEv
</code></pre>
</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Dec 03 2024 11:02:31 GMT-0800 (Pacific Standard Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">any ideas on how i could lookup what the values maybe</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Dec 03 2024 11:04:02 GMT-0800 (Pacific Standard Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'd try <code>(*lhs.ptr)-&gt;toObject()</code> or something along that line</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Dec 03 2024 11:05:18 GMT-0800 (Pacific Standard Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it will skip the the WrappedPtrOperations template specialization for Handle</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Dec 03 2024 11:07:00 GMT-0800 (Pacific Standard Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">ohh nice this works! tysm! also for some reason the pc is unavailable can that be handled as well?</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Dec 03 2024 11:08:52 GMT-0800 (Pacific Standard Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in which function ?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Dec 03 2024 11:12:04 GMT-0800 (Pacific Standard Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you're using <code>--enable-optimize</code>, the variable might be optimized away, and in that case using <code>--disable-optimize</code> instead will help</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Dec 03 2024 11:14:16 GMT-0800 (Pacific Standard Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">looking at this rn <a href="https://searchfox.org/mozilla-central/source/js/src/jit/BaselineIC.cpp#714">https://searchfox.org/mozilla-central/source/js/src/jit/BaselineIC.cpp#714</a></td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Dec 03 2024 11:14:29 GMT-0800 (Pacific Standard Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">hmm i guess have to --disable-optimize</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Dec 03 2024 11:16:15 GMT-0800 (Pacific Standard Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, that can be optimized out</td></tr>

</tbody></table></div></div></div>
</body></html>