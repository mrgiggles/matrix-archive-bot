<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-04-21</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-04-21<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-04-20" class="nav-link"><span>prev</span></a>
<a href="2022-04-22" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Apr 21 2022 10:09:14 GMT-0700 (Pacific Daylight Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: I'm having Matrix trouble. I see you sent a message 20min ago, but it won't let me decrypt it. Nor many other messages right now.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Apr 21 2022 10:12:27 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">if you can read this, and you were saying you can talk now, find me at <a href="https://mozilla.zoom.us/j/7724538509">https://mozilla.zoom.us/j/7724538509</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Apr 21 2022 11:00:42 GMT-0700 (Pacific Daylight Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@jon4t4n:mozilla.org">jon4t4n</span>&gt;</div></td><td class="msg-cell">I was nagged by the release management bot on bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1764737">https://bugzilla.mozilla.org/show_bug.cgi?id=1764737</a>, asking if the bug is important enough to uplift to beta. I would say that the bug is not important enough to uplift to beta. But, that said, the bug is also trivial and would probably not cause any issues if uplifted. Could someone take a look? First time getting this question, so I am not familiar with how the decision is normally made. Also, I don't think I have the necessary access to mark as wontfix.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Apr 21 2022 11:04:37 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">We're pretty late in beta, so I think we can avoid backporting the fix. I'll mark it WONTFIX. Thanks for asking.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Apr 21 2022 11:06:05 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">It looks like it is an old regression. If it was first happening in 100, it might be worth considering, but it looks like we've been shipping it for a bit, and it hasn't caused issues.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Apr 21 2022 11:38:34 GMT-0700 (Pacific Daylight Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell">Hazards question.  <a href="https://paste.mozilla.org/ZcFcsdVw/raw">https://paste.mozilla.org/ZcFcsdVw/raw</a>
I introduced code in the mozilla::StaticPrefs::foo() function that hazards reports can GC.  It seems to say it can GC because eventually it can call '(any-function)' and that can GC.  </td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Apr 21 2022 11:39:07 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell">In reality I don't think it can; and even if it could - AddAccessCount is only present in debug builds, not shipping builds.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Apr 21 2022 11:40:14 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell">Should I add this to an ignore list?  Or is it trivial to just make the JSObject argument a RootedObject? <a href="https://searchfox.org/mozilla-central/rev/a019f4f233dc43af0ade38be0914010448c4ce03/dom/base/Navigator.cpp#1863">https://searchfox.org/mozilla-central/rev/a019f4f233dc43af0ade38be0914010448c4ce03/dom/base/Navigator.cpp#1863</a> </td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Apr 21 2022 12:48:22 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">tjr</span>: Looks like you might be able to change the type of that arg from JSObject* to JS::Handle&lt;JSObject*&gt; and it'll work. Two of the call sites are passing in handles anyways.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Apr 21 2022 12:48:48 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">(arguments are handles and not rooted objects. a handle is basically like "hey I promise I rooted this")</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Apr 21 2022 12:49:59 GMT-0700 (Pacific Daylight Time)">19:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">ugh this might cause issues though. <a href="https://searchfox.org/mozilla-central/rev/a019f4f233dc43af0ade38be0914010448c4ce03/dom/bindings/DOMJSClass.h#102">https://searchfox.org/mozilla-central/rev/a019f4f233dc43af0ade38be0914010448c4ce03/dom/bindings/DOMJSClass.h#102</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Apr 21 2022 12:50:22 GMT-0700 (Pacific Daylight Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">You can handlify that I'm sure but it might mean you have to handlify a bunch of code.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Apr 21 2022 12:52:00 GMT-0700 (Pacific Daylight Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">and you'd have to change isEnabled() to root the argument I think. Not a difficult thing to fix all in all, but it'll be a bit of code.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Apr 21 2022 12:53:12 GMT-0700 (Pacific Daylight Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Maybe <span class="nick-12">sfink</span> has a better idea.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Apr 21 2022 13:02:59 GMT-0700 (Pacific Daylight Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@tjr:mozilla.org">tjr</span>&gt;</div></td><td class="msg-cell">Yeah... I am quickly getting snarled up with issues like how to make the return value of JS::GetNonCCWObjectGlobal into a JS::Handle and not sure what to do there...</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Apr 21 2022 13:12:46 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">tjr</span>: you'd need to root that return value by assigning it to a local variable with a type like JS::Rooted&lt;JSObject*&gt;</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Apr 21 2022 13:13:13 GMT-0700 (Pacific Daylight Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">and hope that that code isn't perf sensitive enough that somebody cares about that. But there's enough wonky branches in that code I can't imagine it is that important.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Apr 21 2022 13:16:19 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">(then pass in the local variable of course)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Apr 21 2022 13:43:14 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">looking at it now</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Apr 21 2022 13:45:21 GMT-0700 (Pacific Daylight Time)">20:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">tjr</span>: at first glance, I'd probably prefer annotating it. If the analysis were able to track the function pointers stored in the hashtable lookup, it would know that it's not a problem.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Apr 21 2022 13:45:33 GMT-0700 (Pacific Daylight Time)">20:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I'll look a little closer to see what the right way is</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Apr 21 2022 13:54:11 GMT-0700 (Pacific Daylight Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I think you could add <code>JS::AutoSuppressGCAnalysis nogc; // Hash functions will not GC.</code> inside <a href="https://searchfox.org/mozilla-central/rev/a019f4f233dc43af0ade38be0914010448c4ce03/modules/libpref/Preferences.cpp#1237">AddAccessCount</a>.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Apr 21 2022 13:55:15 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I guess that'll require <code>#include "js/RootingAPI.h"</code></td></tr>

</tbody></table></div></div></div>
</body></html>