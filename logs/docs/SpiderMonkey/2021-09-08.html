<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-09-08</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-09-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-09-07" class="nav-link"><span>prev</span></a>
<a href="2021-09-09" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Sep 07 2021 19:29:42 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@spinda:mozilla.org">spinda [:mismith]</span>&gt;</div></td><td class="msg-cell">It passes the jstests and jit-tests. <span class="nick-4">iain</span> or <span class="nick-15">tcampbell</span>, would either of you take a review on a patch adding these asserts?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Sep 07 2021 19:30:34 GMT-0700 (Pacific Daylight Time)">02:30</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span></div></td><td class="msg-cell">stands very still</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Sep 07 2021 19:30:49 GMT-0700 (Pacific Daylight Time)">02:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">iain is probably a good reviewer here</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Sep 07 2021 19:46:40 GMT-0700 (Pacific Daylight Time)">02:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@spinda:mozilla.org">spinda [:mismith]</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1729596">https://bugzilla.mozilla.org/show_bug.cgi?id=1729596</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Sep 08 2021 03:59:54 GMT-0700 (Pacific Daylight Time)">10:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: I had a look at the module refactoring patches.  I agree with your approach.  I suspect getting the right interface to cater to the needs of both workers and main thread loader will have some annoying details to work through, but it all looks good so far.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Sep 08 2021 04:48:51 GMT-0700 (Pacific Daylight Time)">11:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">yes, this is what I am integrating right now -- the cut looks like it might be a little different but the idea is the same</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Sep 08 2021 09:45:42 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><p>TypedArray question: Trying to map some spec language to the implementation. In streams we have a couple of checks, where [[view]] is supposed to be a Uint8Array:</p>
<blockquote>
<p>Assert: this.[[view]].[[ByteLength]] &gt; 0.<br>Assert: this.[[view]].[[ViewedArrayBuffer]].[[ByteLength]] &gt; 0.</p>
</blockquote>
<p>So, I can check the typed array byte length with GetArrayBufferByteLength; but I don't understand the [[ViewedArrayBuffer]] internal slot -- is it just not a distinction we make in our implementation?</p>
</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Sep 08 2021 09:54:39 GMT-0700 (Pacific Daylight Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: [[view]] isn't an ArrayBuffer, so <code>GetArrayBufferByteLength</code> seems wrong?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Sep 08 2021 09:55:05 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">the TypedArray is backed by an ArrayBuffer (either user specified or implicitly allocated)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Sep 08 2021 09:55:34 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Ah! I was munging together things in my head then</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Sep 08 2021 09:56:15 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Very new here :) </td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Sep 08 2021 09:56:21 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">{ DataView, Int8Array, Uint32Array, etc } are "views" onto { ArrayBuffer }</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Sep 08 2021 09:56:51 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span></div></td><td class="msg-cell">has both spec and devtools open to avoid embarassing myself too much</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Sep 08 2021 09:57:52 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I was trying to struggle through the spec, missed the construction of typed array  / views while trying</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Sep 08 2021 09:58:27 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I think in my head typed arrays were instances of array buffer with specialization, not views of an underlying one. Which makes more sense anyhow</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Sep 08 2021 09:59:16 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ArrayBuffer (aka ArrayBufferObject) then has internal [[ArrayBufferData]] which is byte[] in the host, and may be "detached", leaving the JS ArrayBuffer object as a JSObject, but most uses of it will throw JS exceptions since there is no backing storage</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Sep 08 2021 10:00:48 GMT-0700 (Pacific Daylight Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">OK. Followup question: Do we have no public JSAPI header for typed arrays? </td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Sep 08 2021 10:00:48 GMT-0700 (Pacific Daylight Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, the other part that always confused me is we saw "TypedArray", but in JS the actual constructors are "Int8Array" etc. Also while TypedArray is a real web feature, TypedObject was a very experimental thing (which we mostly pulled out as it starts from ground up for wasm needs)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Sep 08 2021 10:01:07 GMT-0700 (Pacific Daylight Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">nvm; found it</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Sep 08 2021 10:01:18 GMT-0700 (Pacific Daylight Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">js/public/experimental/TypedData.h</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Sep 08 2021 10:02:51 GMT-0700 (Pacific Daylight Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(And then "UnboxedObject" was our internal magic to infer TypedObject-like behaviour from ordinary objects, which we have since ripped out for being exceedingly complex)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Sep 08 2021 16:30:30 GMT-0700 (Pacific Daylight Time)">23:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: sorry, I should be watching this channel better. Note that I am going to be landing a series of patches any day now, perhaps even today, that adds an additional API that is a perhaps a little nicer. It'll provide things like <code>JS::Uint8Array</code>.</td></tr>

</tbody></table></div></div></div>
</body></html>