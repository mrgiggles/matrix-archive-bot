<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-02-09</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-02-09<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-02-07" class="nav-link"><span>prev</span></a>
<a href="2024-02-10" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Feb 08 2024 16:35:02 GMT-0800 (Pacific Standard Time)">00:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: hi, I'd like to ask how can I pass a JSAtom as an argument to JS_ReportErrorNumber? If I use the latin1Chars(nogc) or twoByteChars(nogc), they both need a AutoCheckCannotGC, but calling JS_ReportErrorNumber will call new String and cause GC, which will cause an assertion</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Feb 08 2024 16:36:25 GMT-0800 (Pacific Standard Time)">00:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell">I've tried AutoStableStringChars, but the latin1Chars() won't end with '\0',</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Feb 08 2024 16:38:54 GMT-0800 (Pacific Standard Time)">00:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what I can think of is to convert to <code>UniqueChars</code> and pass <code>UniqueChars::get()</code></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Feb 08 2024 16:39:55 GMT-0800 (Pacific Standard Time)">00:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">with explicitly specifying the encoding</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Feb 08 2024 16:40:44 GMT-0800 (Pacific Standard Time)">00:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">at least I haven't seen a code that reports with Latin1/TwoBytes conditionally</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Feb 08 2024 16:42:39 GMT-0800 (Pacific Standard Time)">00:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell">okay, I'll try to convert to UniqueChars, thanks</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Feb 08 2024 16:43:15 GMT-0800 (Pacific Standard Time)">00:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>example: <a href="https://searchfox.org/mozilla-central/rev/54c9b4896fdc1e858cd4942f306d877f1f3d195e/js/src/builtin/temporal/Temporal.cpp#1519-1521">https://searchfox.org/mozilla-central/rev/54c9b4896fdc1e858cd4942f306d877f1f3d195e/js/src/builtin/temporal/Temporal.cpp#1519-1521</a></p>
<pre><code class="language-cpp">if (auto chars = StringToNewUTF8CharsZ(cx, *name)) {
  JS_ReportErrorNumberUTF8(cx, GetErrorMessage, nullptr,
                           JSMSG_PROPERTY_NOT_CALLABLE, chars.get());
</code></pre>
</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Feb 09 2024 15:46:58 GMT-0800 (Pacific Standard Time)">23:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@gijs:mozilla.org">Gijs</span>&gt;</div></td><td class="msg-cell"><p>I have a sort of basic JS engine question. In Firefox, in <code>browser.xhtml</code> (the main browser window, in the parent process) we load a significant number of scripts using either <code>&lt;script&gt;</code> tags or <code>Services.scriptloader.loadSubScript</code>. What kind of order of magnitude memory impact does having multiple windows have for each of these scripts? I assume we cache the actual script source and bytecode etc only once, but presumably all the live variables and so on have to be "duplicated" as they can have different values as each browser window is a different scope and global (though the same [system principal] compartment, I think).</p>
<p>(I suppose it depends on the script size and what it declares / does? If you have pointers as to how I might measure this overhead or look it up in about:memory or something, that'd also be helpful)</p>
</td></tr>

</tbody></table></div></div></div>
</body></html>