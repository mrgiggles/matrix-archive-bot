<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-10-12</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-10-12<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-10-11" class="nav-link"><span>prev</span></a>
<a href="2022-10-13" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Oct 11 2022 17:24:41 GMT-0700 (Pacific Daylight Time)">00:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell">Thanks for the check! I'll make a new version tomorrow!</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Oct 12 2022 01:13:45 GMT-0700 (Pacific Daylight Time)">08:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I don't think we have a good API for "cloning" DOM typed arrays</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Oct 12 2022 01:17:06 GMT-0700 (Pacific Daylight Time)">08:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell">but I don't think that spec with the current language is cloning the typed arrays itself, it's just setting the values in the cloned dictionary to the value from the original dictionary, and typed array values in WebIDL are just represented by their JS object</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Oct 12 2022 01:23:25 GMT-0700 (Pacific Daylight Time)">08:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell">so afaict this just needs to do <code>clone.mDescription.SetAsArrayBuffer().Init(config.mDescription.GetAsArrayBuffer().Obj())</code> and something similar for the view</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Oct 12 2022 01:23:35 GMT-0700 (Pacific Daylight Time)">08:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">chunmin</span>: ^</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Oct 12 2022 01:25:05 GMT-0700 (Pacific Daylight Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell">it could be that the spec really wants to clone the BufferSource too, but then it needs to make that clear</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Oct 12 2022 01:25:13 GMT-0700 (Pacific Daylight Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell">so I think that needs to be cleared up first</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Oct 12 2022 01:49:45 GMT-0700 (Pacific Daylight Time)">08:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">jon4t4n</span>: are you still working on bug 1670176?  I've got some changes I'd like to make to ModuleObject that may conflict with your patches</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Oct 12 2022 01:49:46 GMT-0700 (Pacific Daylight Time)">08:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1670176">https://bugzil.la/1670176</a> â€” NEW (jon4t4n) â€” Implement the JSON modules proposal</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Oct 12 2022 02:56:34 GMT-0700 (Pacific Daylight Time)">09:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jakechampion:mozilla.org">jakechampion</span>&gt;</div></td><td class="msg-cell">Is there a way to take ownership of the memory contained within a <code>JS::UniqueChars</code> without copying the memory? My reading of this comment about UniquePtr made me think it is not possible but I'm not 100% certain -- <a href="https://searchfox.org/mozilla-central/source/mfbt/UniquePtr.h#62-187">https://searchfox.org/mozilla-central/source/mfbt/UniquePtr.h#62-187</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Oct 12 2022 04:10:38 GMT-0700 (Pacific Daylight Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@ms2ger:igalia.com">Ms2ger ðŸ’‰ðŸ’‰ðŸ’‰</span>&gt;</div></td><td class="msg-cell">Yeah, std::move should work</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Oct 12 2022 04:13:16 GMT-0700 (Pacific Daylight Time)">11:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I think you actually want release() to take ownership of the pointer?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Oct 12 2022 04:59:28 GMT-0700 (Pacific Daylight Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">How exactly does one return an "iterator" from a native function (ie <code>JSNative</code>)?<br>Is it just an array? I'm specifically looking at <code>Headers.prototype.keys</code>, <code>Headers.prototype.values</code> and <code>Headers.prototype.entries</code> currently (<a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers">https://developer.mozilla.org/en-US/docs/Web/API/Headers</a>)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Oct 12 2022 05:10:56 GMT-0700 (Pacific Daylight Time)">12:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Also, if I want to make my object iterable, say <code>Headers</code> again, do I just define a property with the id <code>GetWellKnownSymbol(cx, SymbolCode::iterator)</code>?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Oct 12 2022 07:04:28 GMT-0700 (Pacific Daylight Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: meeting ?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Oct 12 2022 07:18:48 GMT-0700 (Pacific Daylight Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-4">jonco</span>: meeting ?</blockquote></mx-reply>it just finished :P</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Oct 12 2022 07:19:39 GMT-0700 (Pacific Daylight Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-5">jon4t4n</span>: are you still working on bug 1670176?  I've got some changes I'd like to make to ModuleObject that may conflict with your patches</blockquote></mx-reply><p><span class="nick-4">jonco</span>: Last I talked with <span class="nick-5">jon4t4n</span> he is continuing to work on this; most recent challenges have been the HTML integration stuff.</p>
<p>I would go ahead with your changes (I'm not sure how much time he's had for it recently, so probably wont land soon), we'll just have to help in the rebasing.</p>
</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Oct 12 2022 07:20:34 GMT-0700 (Pacific Daylight Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is there a way to take ownership of the memory contained within a <code>JS::UniqueChars</code> without copying the memory? My reading of this comment about UniquePtr made me think it is not possible but I'm not 100% certain -- <a href="https://searchfox.org/mozilla-central/source/mfbt/UniquePtr.h#62-187">https://searchfox.org/mozilla-central/source/mfbt/UniquePtr.h#62-187</a></blockquote></mx-reply>std::move into another UniquePtr, .release() into a raw pointer where you become responsible for freeing. :)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Oct 12 2022 07:27:58 GMT-0700 (Pacific Daylight Time)">14:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell">Hello, would anybody be able to land <a href="https://phabricator.services.mozilla.com/D148062">https://phabricator.services.mozilla.com/D148062</a> ?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Oct 12 2022 07:51:15 GMT-0700 (Pacific Daylight Time)">14:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Hello, would anybody be able to land <a href="https://phabricator.services.mozilla.com/D148062">https://phabricator.services.mozilla.com/D148062</a> ?</blockquote></mx-reply>Hey Tim: According to Lando that patch is dependent on the patch on bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1789315">https://bugzilla.mozilla.org/show_bug.cgi?id=1789315</a> which still needs review; having said that, you might be able to break that dependency now. I fixed the R&amp;T <code>jsapi.h</code> build problem the gross way in one of my patches; yours does it the right way, but regardless, I think if you disconnect that patch and re-test it on central it should be good to go.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Oct 12 2022 07:51:34 GMT-0700 (Pacific Daylight Time)">14:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">*The as-yet-unapproved patch</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Oct 12 2022 07:54:16 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Hey Tim: According to Lando that patch is dependent on the patch on bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1789315">https://bugzilla.mozilla.org/show_bug.cgi?id=1789315</a> which still needs review; having said that, you might be able to break that dependency now. I fixed the R&amp;T <code>jsapi.h</code> build problem the gross way in one of my patches; yours does it the right way, but regardless, I think if you disconnect that patch and re-test it on central it should be good to go.</blockquote></mx-reply>ah, yes. <span class="nick-12">anba</span> , did I address all your comments on <a href="https://phabricator.services.mozilla.com/D156494">https://phabricator.services.mozilla.com/D156494</a> to your satisfaction?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Oct 12 2022 07:54:21 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell">but I think it's ok to break the dependency</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Oct 12 2022 07:54:52 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(I don't think Anba is on here very frequently; very much a bursty contributor) </td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Oct 12 2022 07:55:53 GMT-0700 (Pacific Daylight Time)">14:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell">ok. well, I removed the dependency -- it's not strictly necessary anyway since CI doesn't seem to be building with ENABLE_RECORD_TUPLE (which is a separate problem)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Oct 12 2022 08:00:51 GMT-0700 (Pacific Daylight Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">Tim</span>: OK, I've pressed the button on D148062</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Oct 12 2022 08:12:35 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: thanks, will do</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Oct 12 2022 09:36:30 GMT-0700 (Pacific Daylight Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> ok. well, I removed the dependency -- it's not strictly necessary anyway since CI doesn't seem to be building with ENABLE_RECORD_TUPLE (which is a separate problem)</blockquote></mx-reply>That surprised me, so I looked, and it seems like there <em>is</em> an SM(rt) tier 1 build with <code>--enable-record-tuple</code> set, and I see it <a href="https://treeherder.mozilla.org/jobs?repo=autoland&amp;searchStr=spider&amp;selectedTaskRun=eJCQW3ruSM6xjxpMCC-StA.0">showing up</a> on autoland. That is the right thing, right?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Oct 12 2022 09:39:54 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That surprised me, so I looked, and it seems like there <em>is</em> an SM(rt) tier 1 build with <code>--enable-record-tuple</code> set, and I see it <a href="https://treeherder.mozilla.org/jobs?repo=autoland&amp;searchStr=spider&amp;selectedTaskRun=eJCQW3ruSM6xjxpMCC-StA.0">showing up</a> on autoland. That is the right thing, right?</blockquote></mx-reply>I've certainly ran into the job recently as well.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Oct 12 2022 09:52:29 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so afaict this just needs to do <code>clone.mDescription.SetAsArrayBuffer().Init(config.mDescription.GetAsArrayBuffer().Obj())</code> and something similar for the view</blockquote></mx-reply>Will the cloned.mDescription refer to the same buffer of the original one by doing so?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Oct 12 2022 09:53:03 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell">There is a test to make sure they refer to the different ones: <a href="https://searchfox.org/mozilla-central/rev/e94c6cb9649bfe4e6a3888460f41bcd4fe30a6ca/testing/web-platform/tests/webcodecs/videoDecoder-codec-specific.https.any.js#224">https://searchfox.org/mozilla-central/rev/e94c6cb9649bfe4e6a3888460f41bcd4fe30a6ca/testing/web-platform/tests/webcodecs/videoDecoder-codec-specific.https.any.js#224</a></td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Oct 12 2022 10:02:33 GMT-0700 (Pacific Daylight Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell"><p>I just tested this with the following code. It's weird that the results are inconsistent. Some <code>assert_false(support.config.description === config.description)</code> checks are passed, but some fail. Does the <code>ArrayBuffer</code> case and the <code>ArrayBufferView</code> case give different results? I'll have a look.</p>
<pre><code class="language-cpp">// aConfig is the original VideoDecoderConfig
VideoDecoderConfig cloned;
...
// mDescription is Optional&lt;OwningArrayBufferViewOrArrayBuffer&gt;
if (aConfig.mDescription.WasPassed()) {
    auto&amp; desc = cloned.mDescription.Construct();
    if (aConfig.mDescription.Value().IsArrayBuffer()) {
      desc.SetAsArrayBuffer().Init(
          aConfig.mDescription.Value().GetAsArrayBuffer().Obj());
    } else {
      MOZ_ASSERT(aConfig.mDescription.Value().IsArrayBufferView());
      desc.SetAsArrayBufferView().Init(
          aConfig.mDescription.Value().GetAsArrayBufferView().Obj());
    }
  }
...
</code></pre>
</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Oct 12 2022 10:04:40 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> it could be that the spec really wants to clone the BufferSource too, but then it needs to make that clear</blockquote></mx-reply><span class="nick-2">padenot</span>: Does spec ask for a deep copy?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Oct 12 2022 12:02:09 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">For <code>JS_FN("foo", GenericJSNative, 0, 0)</code> the last 2 arguments is nargs and flags right? nargs is basically the required amount of args to call the function right else it errors right? what flags are available?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Oct 12 2022 12:08:57 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@davidj361:matrix.org">davidj361</span>&gt;</div></td><td class="msg-cell">ah whatever found <a href="https://web.archive.org/web/20201017074148/https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_FS">https://web.archive.org/web/20201017074148/https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_FS</a>
Is there an up to date non-archive version of this?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Oct 12 2022 12:31:28 GMT-0700 (Pacific Daylight Time)">19:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That surprised me, so I looked, and it seems like there <em>is</em> an SM(rt) tier 1 build with <code>--enable-record-tuple</code> set, and I see it <a href="https://treeherder.mozilla.org/jobs?repo=autoland&amp;searchStr=spider&amp;selectedTaskRun=eJCQW3ruSM6xjxpMCC-StA.0">showing up</a> on autoland. That is the right thing, right?</blockquote></mx-reply>It seems like the right thing. Matthew said he pushed a fix, so i would expect the recent builds to succeed. still not sure why that previous change (a few weeks ago) broke the record/tuple build</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Oct 12 2022 13:32:31 GMT-0700 (Pacific Daylight Time)">20:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell">Aha, the results are actually consistent. Some of the <code>config.description</code> are unset so they won't be checked. All the tests are <code>ArrayBufferView</code> cases, and using <code>desc.SetAsArrayBufferView().Init(aConfig.mDescription.Value().GetAsArrayBufferView().Obj())</code> makes <code>support.config.description !== config.description</code> true, which violates the test's expectation.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Oct 12 2022 13:34:00 GMT-0700 (Pacific Daylight Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell">It seems the tests want a deep copy of the <code>BufferSource</code> instead of referring to the same one</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Oct 12 2022 13:46:06 GMT-0700 (Pacific Daylight Time)">20:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> It seems like the right thing. Matthew said he pushed a fix, so i would expect the recent builds to succeed. still not sure why that previous change (a few weeks ago) broke the record/tuple build</blockquote></mx-reply>My breakage was on a totally unrelated change; I suspect it was a unification change that caused it.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Oct 12 2022 15:00:19 GMT-0700 (Pacific Daylight Time)">22:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><p>Has anyone used JS::NewPromiseObject?  I'd like some details on what exactly the "executor" parameter is:</p>
<pre><code>/**
 * Returns a new instance of the Promise builtin class in the current
 * compartment, with the right slot layout.
 *
 * The `executor` can be a `nullptr`. In that case, the only way to resolve or
 * reject the returned promise is via the `JS::ResolvePromise` and
 * `JS::RejectPromise` JSAPI functions.
 *
 * If a `proto` is passed, that gets set as the instance's [[Prototype]]
 * instead of the original value of `Promise.prototype`.
 */
extern JS_PUBLIC_API JSObject* NewPromiseObject(
    JSContext* cx, JS::HandleObject executor, JS::HandleObject proto = nullptr);
</code></pre>
</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Oct 12 2022 15:10:51 GMT-0700 (Pacific Daylight Time)">22:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Has anyone used JS::NewPromiseObject?  I'd like some details on what exactly the "executor" parameter is:</p>
<pre><code>/**
 * Returns a new instance of the Promise builtin class in the current
 * compartment, with the right slot layout.
 *
 * The `executor` can be a `nullptr`. In that case, the only way to resolve or
 * reject the returned promise is via the `JS::ResolvePromise` and
 * `JS::RejectPromise` JSAPI functions.
 *
 * If a `proto` is passed, that gets set as the instance's [[Prototype]]
 * instead of the original value of `Promise.prototype`.
 */
extern JS_PUBLIC_API JSObject* NewPromiseObject(
    JSContext* cx, JS::HandleObject executor, JS::HandleObject proto = nullptr);
</code></pre>
</blockquote></mx-reply>Yeah, I've never used it... we don't seem to have much in the way of usage either. There's one test case: <a href="https://searchfox.org/mozilla-central/source/js/src/jsapi-tests/testPromise.cpp#16-44">https://searchfox.org/mozilla-central/source/js/src/jsapi-tests/testPromise.cpp#16-44</a></td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Oct 12 2022 15:11:43 GMT-0700 (Pacific Daylight Time)">22:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">The executor in js terms is a function like <code>function(resolve: (any) =&gt; void, reject: (any) =&gt; void): void</code></td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Oct 12 2022 15:12:11 GMT-0700 (Pacific Daylight Time)">22:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">It's the same as with the Promise constructor</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Oct 12 2022 15:13:22 GMT-0700 (Pacific Daylight Time)">22:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">See <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/Promise">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/Promise</a> for more details</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Oct 12 2022 15:15:19 GMT-0700 (Pacific Daylight Time)">22:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Thanks.  What I'm doing here is wrapping an existing C++ Future/Promise API to interface with JS.  So I presume I can have a null executor, and then call JS::ResolvePromise or JS::RejectPromise when I need to.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Oct 12 2022 15:15:35 GMT-0700 (Pacific Daylight Time)">22:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Yes you can</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Oct 12 2022 15:16:22 GMT-0700 (Pacific Daylight Time)">22:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Personally I use some shenanigans where I pass the functions of <code>resolve</code> and <code>reject</code> through a channel to send it to the event loop<br>(See <a href="https://github.com/Redfire75369/spiderfire/blob/master/runtime/src/promise.rs#L17-L48">https://github.com/Redfire75369/spiderfire/blob/master/runtime/src/promise.rs#L17-L48</a>)</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Oct 12 2022 15:17:32 GMT-0700 (Pacific Daylight Time)">22:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">chunmin</span>: then the test is not testing what's in the spec</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Oct 12 2022 15:19:35 GMT-0700 (Pacific Daylight Time)">22:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Personally I use some shenanigans where I pass the functions of <code>resolve</code> and <code>reject</code> through a channel to send it to the event loop<br>(See <a href="https://github.com/Redfire75369/spiderfire/blob/master/runtime/src/promise.rs#L17-L48">https://github.com/Redfire75369/spiderfire/blob/master/runtime/src/promise.rs#L17-L48</a>)</blockquote></mx-reply>Do you know if there are thread safety concerns with JS::Resolve/RejectPromise?  It's possible that whatever we're awaiting could come from another thread</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Oct 12 2022 15:20:55 GMT-0700 (Pacific Daylight Time)">22:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">There shouldn't be, <code>UnsafeAssertSend</code> is just there to get around rust's type system</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Oct 12 2022 15:21:17 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Each runtime corresponds to 1 thread iirc so it should be fine</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Oct 12 2022 15:21:34 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">unless you're mixing your main thread with worker threads and stuff</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Oct 12 2022 15:23:27 GMT-0700 (Pacific Daylight Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">What I'm trying to do is basically wrap a std::future</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Oct 12 2022 15:24:22 GMT-0700 (Pacific Daylight Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">My goal was to wrap Rust's <code>std::future::Future</code> so similar goals ðŸ™ƒ</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Oct 12 2022 15:24:43 GMT-0700 (Pacific Daylight Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">No idea how <code>std::future</code> works though so you can probably ask someone else</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Oct 12 2022 15:25:00 GMT-0700 (Pacific Daylight Time)">22:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">OK.  I'll try to read the rust.  Not very familiar with the language though.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Oct 12 2022 15:26:23 GMT-0700 (Pacific Daylight Time)">22:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">My codebase is a bit convoluted so you probably shouldn't anyways</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Oct 12 2022 15:27:03 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">OK.  Thanks for the help.  I'll do some more research into futures and promises, and probably come back tomorrow with more questions.</td></tr>

</tbody></table></div></div></div>
</body></html>