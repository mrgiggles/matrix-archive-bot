<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-03-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-03-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-03-15" class="nav-link"><span>prev</span></a>
<a href="2020-03-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Mar 15 2020 18:28:19 GMT-0700 (Pacific Daylight Time)">01:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">are there any utilities for helping figure out why something isn't being GCed?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Mar 15 2020 18:28:56 GMT-0700 (Pacific Daylight Time)">01:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if it's on browser, about:memory</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sun Mar 15 2020 18:29:13 GMT-0700 (Pacific Daylight Time)">01:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there you can write the GC/CC log to file</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sun Mar 15 2020 18:29:24 GMT-0700 (Pacific Daylight Time)">01:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the file describes the reference</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sun Mar 15 2020 18:30:18 GMT-0700 (Pacific Daylight Time)">01:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">in this case I'm trying to write an XPCshell test, calling <code>Components.utils.getWeakReference</code> and then trying to assert that the weak reference is <code>null</code> after calling <code>forceGC</code> and <code>forceCC</code></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sun Mar 15 2020 18:30:58 GMT-0700 (Pacific Daylight Time)">01:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">so it's a mix of SpiderMonkey and XPCOM stuff</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sun Mar 15 2020 18:30:58 GMT-0700 (Pacific Daylight Time)">01:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in shell test, I think you need to invoke the underlying impl from there</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sun Mar 15 2020 18:31:44 GMT-0700 (Pacific Daylight Time)">01:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">could you point me to what you mean by "underlying impl"?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sun Mar 15 2020 18:32:16 GMT-0700 (Pacific Daylight Time)">01:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">now I'm looking for it</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sun Mar 15 2020 18:33:35 GMT-0700 (Pacific Daylight Time)">01:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/rev/3f8c67d7fd836d559491e3fe497bc739f707c1a6/toolkit/components/aboutmemory/content/aboutMemory.js#571-601">https://searchfox.org/mozilla-central/rev/3f8c67d7fd836d559491e3fe497bc739f707c1a6/toolkit/components/aboutmemory/content/aboutMemory.js#571-601</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sun Mar 15 2020 18:34:14 GMT-0700 (Pacific Daylight Time)">01:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">cool, I'll take a look at that</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sun Mar 15 2020 18:34:17 GMT-0700 (Pacific Daylight Time)">01:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sun Mar 15 2020 18:34:21 GMT-0700 (Pacific Daylight Time)">01:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">that's the code called when you click "Save concise"/"Save verbose" buttons in about:memory</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sun Mar 15 2020 19:07:11 GMT-0700 (Pacific Daylight Time)">02:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: Are there tools view inspecting the log data graphically?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sun Mar 15 2020 19:07:58 GMT-0700 (Pacific Daylight Time)">02:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm not aware of.  I usually trace the graph manually inside text editor</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sun Mar 15 2020 19:09:32 GMT-0700 (Pacific Daylight Time)">02:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">cool, that's what I'm doing, wanted to make sure there wasn't another way</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sun Mar 15 2020 21:56:48 GMT-0700 (Pacific Daylight Time)">04:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: there is zero chance I would have figured that out without that log, thanks so much for the pointer</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sun Mar 15 2020 21:57:08 GMT-0700 (Pacific Daylight Time)">04:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">:D</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sun Mar 15 2020 22:00:59 GMT-0700 (Pacific Daylight Time)">05:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Assuming I'm not missing anything at this point, I think the leaking I was seeing is because mozIJSSubScriptLoader's "loadSubScript" caches the JSScript by default so that it can clone them into any new realms on the next call, which means that whichever global is the first to load a given script basically gets leaked because the JSScript is kept around</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Mar 16 2020 00:52:53 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: Let me know if you think the path is semi-super-safe enough to land without going through the sec-approval process.  IMO worrying about dual server/client bugs is too remote to count, as in principle any bugfix could be something some site relied on in JS to prevent XSS...</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Mar 16 2020 02:45:27 GMT-0700 (Pacific Daylight Time)">09:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">anba</span>: thanks for fixing bug 1618258</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Mar 16 2020 02:45:28 GMT-0700 (Pacific Daylight Time)">09:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1618258">https://bugzil.la/1618258</a> â€” ASSIGNED (anba) â€” Rename FinalizationGroup to FinalizationRegistry in line with the spec</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Mar 16 2020 02:45:40 GMT-0700 (Pacific Daylight Time)">09:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I had just stareted looking at this when I saw you had already done it</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Mar 16 2020 03:07:48 GMT-0700 (Pacific Daylight Time)">10:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Waldo: yeah, it should be sec-other or something</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Mar 16 2020 04:21:05 GMT-0700 (Pacific Daylight Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I was looking at <code>finishScopeNotes</code>, this is quite strange that the Span given as argument is meant to be initialized. I am used to see the opposite, that the data given as argument is used to initialize the content.  <code>stencil.finishScopeNotes(data-&gt;scopeNotes())</code>  --&gt; <code>data-&gt;initScopeNotes(stencil.scopeNotes())</code>.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Mar 16 2020 04:30:33 GMT-0700 (Pacific Daylight Time)">11:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it's because currently only the subclass of <code>stencil</code> knows how to initialize (copy).  it will be fixed later</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Mar 16 2020 05:43:46 GMT-0700 (Pacific Daylight Time)">12:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">loganfsmyth</span>: can you CC me on bug when you create it. That is super interesting.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Mar 16 2020 05:44:36 GMT-0700 (Pacific Daylight Time)">12:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">My understanding was the cache should be of things compiled in the services/jsm global, but it is possible weird things happen</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Mar 16 2020 05:45:16 GMT-0700 (Pacific Daylight Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Once stencil is done, we can rework all that caching to be much saner</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Mar 16 2020 06:17:33 GMT-0700 (Pacific Daylight Time)">13:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-10">jandem</span>: Hi Jan, I am getting failures with the fix to optional chaining that seems to be related to ion and the baseline compiler. <a href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=2b3968e3a42b470f221f9460fdbedd86a32ee48e&amp;selectedJob=293310573">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=2b3968e3a42b470f221f9460fdbedd86a32ee48e&amp;selectedJob=293310573</a></p>
<p>The error message is different. without the base line compiler or ion, the error message has the name of the field being accessed (in this case <code>[...].r</code> but with those two settings it comes back as undefined. This doesn't happen on mac so i am not getting the failures locally. Is this a known issue?</p>
</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Mar 16 2020 06:18:57 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: will take a look..</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Mar 16 2020 06:36:00 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: JITs have a different path for DelElem for no good reason. I'll write a patch</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Mar 16 2020 06:36:20 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">that may not fix Ion but we'll see</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Mar 16 2020 06:36:36 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ok, thank you!</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Mar 16 2020 06:38:01 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">np</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Mar 16 2020 07:36:25 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> My understanding was the cache should be of things compiled in the services/jsm global, but it is possible weird things happen</blockquote></mx-reply>@tcampbell:<a href="http://mozilla.org">mozilla.org</a>: I filed in in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1622718">https://bugzilla.mozilla.org/show_bug.cgi?id=1622718</a> I don't think the cache distinguishes what the target global is. The comment in the code certainly makes it sound like expected if surprising behavior. I think if we expose an option to force usage of the separate compilation scope the issue will be resolved.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Mar 16 2020 07:38:49 GMT-0700 (Pacific Daylight Time)">14:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">thanks</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Mar 16 2020 07:40:41 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Happy to hear if you have any thoughts on alternative fixes</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Mar 16 2020 12:24:11 GMT-0700 (Pacific Daylight Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: does <code>ReportError</code> mess with flags or not? Some parts you intentionally compute <code>isWarning</code> before and others you don't</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Mar 16 2020 12:27:34 GMT-0700 (Pacific Daylight Time)">19:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: as far as I can tell it's not modified, but you are right I should unify this</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Mar 16 2020 12:27:58 GMT-0700 (Pacific Daylight Time)">19:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">sounds good</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Mar 16 2020 13:08:35 GMT-0700 (Pacific Daylight Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: thanks for the reviews. Now to blow it all away</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Mar 16 2020 13:08:46 GMT-0700 (Pacific Daylight Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ðŸ˜ƒ</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Mar 16 2020 13:17:48 GMT-0700 (Pacific Daylight Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">:D </td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Mar 16 2020 13:17:59 GMT-0700 (Pacific Daylight Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Fire ze Missiles seems to be the tradition here</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Mar 16 2020 15:31:54 GMT-0700 (Pacific Daylight Time)">22:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">so if I have jitspew=scripts output that shows lots of Compiling output all the time, what's my next step?</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon Mar 16 2020 15:32:17 GMT-0700 (Pacific Daylight Time)">22:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">my impression is that we're spending a lot of time doing jit compiling every frame but not a lot of time executing the jitted code</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon Mar 16 2020 15:32:44 GMT-0700 (Pacific Daylight Time)">22:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">there's one particular fragment that was compiled 30 times over the course of ~10 seconds</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon Mar 16 2020 15:33:25 GMT-0700 (Pacific Daylight Time)">22:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Can you run with IONFLAGS=bailouts?</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon Mar 16 2020 15:34:55 GMT-0700 (Pacific Daylight Time)">22:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">will do</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon Mar 16 2020 15:35:08 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Actually, IONFLAGS=osi might also be good</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon Mar 16 2020 15:35:30 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The former is for cases where we have to leave Ion code and fall back to baseline</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon Mar 16 2020 15:35:48 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But we can continue running the Ion code in the future</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon Mar 16 2020 15:35:57 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The latter is for cases where we have to completely invalidate the Ion code</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon Mar 16 2020 15:36:15 GMT-0700 (Pacific Daylight Time)">22:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Enough bailouts trigger an invalidation, so they're correlated</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon Mar 16 2020 15:39:28 GMT-0700 (Pacific Daylight Time)">22:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell"><a href="https://gist.github.com/jdm/142b7cdca6fab921f1d8cd636744e16d">https://gist.github.com/jdm/142b7cdca6fab921f1d8cd636744e16d</a> is the raw log</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon Mar 16 2020 15:41:45 GMT-0700 (Pacific Daylight Time)">22:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">I have a suspicion that working with non-minified js would yield easier to understand results?</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon Mar 16 2020 16:05:35 GMT-0700 (Pacific Daylight Time)">23:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Probably, yes. The function name is addStubs, if that helps.</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon Mar 16 2020 16:06:28 GMT-0700 (Pacific Daylight Time)">23:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">At least for the first one?</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon Mar 16 2020 16:06:43 GMT-0700 (Pacific Daylight Time)">23:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Let me look at this a little closer instead of jumping to conclusions</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon Mar 16 2020 16:07:40 GMT-0700 (Pacific Daylight Time)">23:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">What was the fragment that you said was being recompiled 3 times/second?</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon Mar 16 2020 16:17:44 GMT-0700 (Pacific Daylight Time)">23:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">it was 16:108990 in <a href="https://joshmatthews.net/servo.org/hl-home/bbjs/preview.babylonjs.com/babylon.min.js">https://joshmatthews.net/servo.org/hl-home/bbjs/preview.babylonjs.com/babylon.min.js</a></td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon Mar 16 2020 16:23:01 GMT-0700 (Pacific Daylight Time)">23:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">ok, I have a log with unminified source this time: <a href="https://gist.github.com/jdm/9cea7277e1b8d0a23b7476aec88e657c">https://gist.github.com/jdm/9cea7277e1b8d0a23b7476aec88e657c</a></td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon Mar 16 2020 16:23:26 GMT-0700 (Pacific Daylight Time)">23:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I think it is e.prototype.scale, for some value of e</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon Mar 16 2020 16:24:28 GMT-0700 (Pacific Daylight Time)">23:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">mmm, I see an _update method being invalidated. that looks like it could cause trouble!</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Mon Mar 16 2020 16:27:06 GMT-0700 (Pacific Daylight Time)">23:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">is there a useful way to prioritize the output here?</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Mon Mar 16 2020 16:28:14 GMT-0700 (Pacific Daylight Time)">23:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">would looking for lines that contain "Invalidate" and then grouping them by the script:line:col and sorting by the most frequent be useful?</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Mon Mar 16 2020 16:29:33 GMT-0700 (Pacific Daylight Time)">23:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">That would probably be a good start, yeah</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Mon Mar 16 2020 16:29:45 GMT-0700 (Pacific Daylight Time)">23:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Not sure off the top of my head how inlining plays into this</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Mon Mar 16 2020 16:35:16 GMT-0700 (Pacific Daylight Time)">23:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">yeah, e.prototype.scale does show up in the highest invalidations</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Mon Mar 16 2020 16:35:20 GMT-0700 (Pacific Daylight Time)">23:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell"><a href="https://gist.github.com/jdm/9cea7277e1b8d0a23b7476aec88e657c#gistcomment-3215185">https://gist.github.com/jdm/9cea7277e1b8d0a23b7476aec88e657c#gistcomment-3215185</a></td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Mon Mar 16 2020 16:39:16 GMT-0700 (Pacific Daylight Time)">23:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">is there any writeup of how to go about investigating the root cause of invalidations?</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Mon Mar 16 2020 16:42:35 GMT-0700 (Pacific Daylight Time)">23:42</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-3" title="@jdm:mozilla.org">jdm</span></div></td><td class="msg-cell">wonders if <a href="https://blog.mozilla.org/javascript/2012/10/15/the-ins-and-outs-of-invalidation/">https://blog.mozilla.org/javascript/2012/10/15/the-ins-and-outs-of-invalidation/</a> is still useful</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Mon Mar 16 2020 16:50:55 GMT-0700 (Pacific Daylight Time)">23:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Skimming through it quickly, it all seems basically accurate</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Mon Mar 16 2020 16:51:05 GMT-0700 (Pacific Daylight Time)">23:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">At least the high-level ideas</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Mon Mar 16 2020 16:51:10 GMT-0700 (Pacific Daylight Time)">23:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Some of the names have changed</td></tr>

</tbody></table></div></div></div>
</body></html>