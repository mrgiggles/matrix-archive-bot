<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-06-15</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-06-15<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-06-14" class="nav-link"><span>prev</span></a>
<a href="2022-06-16" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jun 14 2022 22:17:22 GMT-0700 (Pacific Daylight Time)">05:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">okay thanks, I'll keep an eye on it</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jun 14 2022 22:22:27 GMT-0700 (Pacific Daylight Time)">05:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">Since the implementation is behind a config, I don't know if there's something special to add in the ini file. Maybe we could simply do a feature detection. I'll try to come-up with something and answer you on phabricator</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jun 14 2022 23:51:52 GMT-0700 (Pacific Daylight Time)">06:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">I'm hitting a wall again, trying to retrieve the prototype of a Tuple from the Debugger API. In <a href="https://searchfox.org/mozilla-central/rev/2398ab33adcea896838b3da678ff6480dbb98b9a/js/src/debugger/Object.cpp#1952">Object.cpp</a>, <code>GetPrototype</code> is returning <code>null</code>. I don't think there's issue with <code>GetPrototype</code> itself as I do get the Tuple prototype in JS with <code>Object.getPrototypeOf(#[])</code>. Any idea what could be wrong in <code>DebuggerObject::getPrototypeOf</code> ?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jun 14 2022 23:52:30 GMT-0700 (Pacific Daylight Time)">06:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">added a comment in Phabricator. Don't hesitate to DM me here if you have any question :)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Jun 15 2022 00:19:42 GMT-0700 (Pacific Daylight Time)">07:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Since the implementation is behind a config, I don't know if there's something special to add in the ini file. Maybe we could simply do a feature detection. I'll try to come-up with something and answer you on phabricator</blockquote></mx-reply>When I was trying it out, I enabled records and tuples unconditionally in my local branch, so that wasn't the reason why the test wasn't running. I can look it again, likely not till next week</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jun 15 2022 00:21:38 GMT-0700 (Pacific Daylight Time)">07:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm hitting a wall again, trying to retrieve the prototype of a Tuple from the Debugger API. In <a href="https://searchfox.org/mozilla-central/rev/2398ab33adcea896838b3da678ff6480dbb98b9a/js/src/debugger/Object.cpp#1952">Object.cpp</a>, <code>GetPrototype</code> is returning <code>null</code>. I don't think there's issue with <code>GetPrototype</code> itself as I do get the Tuple prototype in JS with <code>Object.getPrototypeOf(#[])</code>. Any idea what could be wrong in <code>DebuggerObject::getPrototypeOf</code> ?</blockquote></mx-reply>Not sure offhand. As far as I know, the DebuggerObject code hasn't been exercised for records/tuples, so it wouldn't be surprising if it didn't work. I don't have time to look at it right away (we have our Igalia summit this week), so could you file a bug and assign it to me so it doesn't get forgotten?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jun 15 2022 00:22:37 GMT-0700 (Pacific Daylight Time)">07:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">I created a small test and was able to run it locally. It has an early exit when we don't have Records/Tuples support, so it shouldn't fail on CI</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jun 15 2022 00:23:21 GMT-0700 (Pacific Daylight Time)">07:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Not sure offhand. As far as I know, the DebuggerObject code hasn't been exercised for records/tuples, so it wouldn't be surprising if it didn't work. I don't have time to look at it right away (we have our Igalia summit this week), so could you file a bug and assign it to me so it doesn't get forgotten?</blockquote></mx-reply>sure, will do</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jun 15 2022 00:23:30 GMT-0700 (Pacific Daylight Time)">07:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@tjc:igalia.com">Tim</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jun 15 2022 06:32:08 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">Is there a way to multithread these? <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jun 15 2022 06:51:32 GMT-0700 (Pacific Daylight Time)">13:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what kind of multithread are you thinking about?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jun 15 2022 07:03:01 GMT-0700 (Pacific Daylight Time)">14:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell">What is the schedule for updating <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples</a> ? I needed to <a href="https://github.com/yurydelendik/spidermonkey-embedding-examples/commit/6ee0d597d8c322ef9e7d2f95b83e0d73f38c1c92">poke it</a> a little and there is plenty of breaking stuff with 103 version: e.g. SetPrivate or JSID_TO_LINEAR_STRING</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jun 15 2022 07:04:19 GMT-0700 (Pacific Daylight Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> what kind of multithread are you thinking about?</blockquote></mx-reply>multithreading with multiple contexts running concurrently where if one crashes the others won't be affected</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jun 15 2022 07:07:02 GMT-0700 (Pacific Daylight Time)">14:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">crash there means exception in JavaScript, or real crash like segmentation fault?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jun 15 2022 07:07:54 GMT-0700 (Pacific Daylight Time)">14:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">running concurrently is possible</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jun 15 2022 07:09:06 GMT-0700 (Pacific Daylight Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if it's about exception in JavaScript, it's also possible.  if it's about segmentation fault etc, multithread doesn't achieve it, and you'll want multi-process</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jun 15 2022 07:13:41 GMT-0700 (Pacific Daylight Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'll create a multithread example</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jun 15 2022 07:16:46 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">I'm getting a segfault from running 2 std C++ threads on 2 functions running RunExample</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jun 15 2022 07:19:50 GMT-0700 (Pacific Daylight Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">try building SpiderMonkey with --enable-debug and link against it.  assertions there will catch something</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jun 15 2022 07:20:07 GMT-0700 (Pacific Daylight Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">I'm using ubuntu's (20.04) packages libmozjs-68-0 and libmozjs-68-dev</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jun 15 2022 07:22:28 GMT-0700 (Pacific Daylight Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">I'll look into building and linking against the compiled spidermonkey, though not sure how to link against the compiled one vs package manager's one (libmozjs-68-dev</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jun 15 2022 07:24:16 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">As I'm not familiar with building SpiderMonkey libraries or using meson and ninja</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jun 15 2022 07:25:08 GMT-0700 (Pacific Daylight Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I also don't know meson, but installing your own one in custom directory and passing <code>-I /path/to/the/directory/include/</code> and <code>-L /path/to/the/directory/lib/</code> to the compiler should work</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jun 15 2022 07:25:22 GMT-0700 (Pacific Daylight Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, maybe here <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/d9a734321de9394ac4cd30cb2889970622c12136/meson.build#L7">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/d9a734321de9394ac4cd30cb2889970622c12136/meson.build#L7</a></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jun 15 2022 08:13:04 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> What is the schedule for updating <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples</a> ? I needed to <a href="https://github.com/yurydelendik/spidermonkey-embedding-examples/commit/6ee0d597d8c322ef9e7d2f95b83e0d73f38c1c92">poke it</a> a little and there is plenty of breaking stuff with 103 version: e.g. SetPrivate or JSID_TO_LINEAR_STRING</blockquote></mx-reply>There's a <code>next</code> branch that I think you can just submit changes for tip to <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/tree/next">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/tree/next</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jun 15 2022 08:37:20 GMT-0700 (Pacific Daylight Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">I'm not finding any .lib files in my spidermonkey build utilizing <code>mach</code>, i.e. no results for <code>find -iname "*.lib"</code></td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jun 15 2022 08:38:14 GMT-0700 (Pacific Daylight Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">ah nevermind, just had to search for .so files...</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jun 15 2022 08:38:54 GMT-0700 (Pacific Daylight Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you've installed your spidermonkey build into custom directory, this PR contains how to specify it <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/54">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/54</a></td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jun 15 2022 09:17:20 GMT-0700 (Pacific Daylight Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I wonder if it would be possible to have the debug library available on ubuntu. Either in a mozjsdebug{,-dev} set of packages, or if it would make sense to have mozjs-dev include the debug .so using the argument that you can't really develop against spidermonkey without a debug build lying around. (But maybe -dev packages are restricted to headers?)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jun 15 2022 09:19:42 GMT-0700 (Pacific Daylight Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">pastah</span>: here's example with multithread <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/55">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/55</a></td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Jun 15 2022 09:22:51 GMT-0700 (Pacific Daylight Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">let me know if the example makes sense</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Jun 15 2022 10:21:52 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jdescottes:mozilla.org">jdescottes</span>&gt;</div></td><td class="msg-cell"><p>hi! I'm currently working on adding a script evaluation feature for WebDriver BiDi (<a href="https://w3c.github.io/webdriver-bidi/#command-script-evaluate">https://w3c.github.io/webdriver-bidi/#command-script-evaluate</a>).<br>tldr, that's a command used by automation tools to execute a JS expression in a given browsing context (similar to what the DevTools console does).</p>
<p>To do that I use SpiderMonkey's Debugger APIs. For my basic use case, I simply use Debugger's <code>makeGlobalObjectReference</code>, and then execute my expression with <code>executeInGlobal</code>. But I have an issue in order to retrieve the async error stack in case the expression returns a promise.</p>
<p>In DevTools we normally use <code>promiseResolutionSite</code> to get that information. But in my implementation it's unavailable, and I realized it's because I use <code>makeGlobalObjectReference</code> instead of <code>addDebuggee</code> to create my global reference. I was trying to avoid using <code>addDebuggee</code>, because in theory I don't need anything related to setting breakpoints here, I just want to execute code. And I heard that using <code>addDebuggee</code> might have a performance cost for the page compared to <code>makeGlobalObjectReference</code>.</p>
</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Jun 15 2022 10:23:48 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jdescottes:mozilla.org">jdescottes</span>&gt;</div></td><td class="msg-cell"><p>I sent the message while I was still editing, but most of the content is there. My question boils down to: is it expected that <code>promiseResolutionSite</code> is unavailable unless I used <code>addDebuggee</code>, and if yes, should I be concerned about the performance impact of using <code>addDebuggee</code> compared to <code>makeGlobalObjectReference</code>.</p>
<p>(hope that makes sense :))</p>
</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Jun 15 2022 10:24:33 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jdescottes:mozilla.org">jdescottes</span>&gt;</div></td><td class="msg-cell">my current stack of patches is at <a href="https://phabricator.services.mozilla.com/D149413">https://phabricator.services.mozilla.com/D149413</a> for more context</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Jun 15 2022 10:31:11 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jdescottes</span>: it probably boils down to this very specific code: <a href="https://searchfox.org/mozilla-central/rev/2398ab33adcea896838b3da678ff6480dbb98b9a/js/src/builtin/Promise.cpp#477-489">https://searchfox.org/mozilla-central/rev/2398ab33adcea896838b3da678ff6480dbb98b9a/js/src/builtin/Promise.cpp#477-489</a> and <a href="https://searchfox.org/mozilla-central/source/js/src/jsapi.cpp#4581-4588">https://searchfox.org/mozilla-central/source/js/src/jsapi.cpp#4581-4588</a> And so in theory you might be able to avoid having to register a debugger thanks to this pref <a href="https://searchfox.org/mozilla-central/source/modules/libpref/init/all.js#994-996">https://searchfox.org/mozilla-central/source/modules/libpref/init/all.js#994-996</a></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Jun 15 2022 11:07:04 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> let me know if the example makes sense</blockquote></mx-reply>I'm a bit confused, you make a context in your main thread then create 2 more contexts for those 2 threads?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Jun 15 2022 11:07:34 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">Also, are you not able to just use <code>RunExample</code> as 2 separate threads instead?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Jun 15 2022 11:08:37 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in the example, the main thread and 2 threads run js code</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Jun 15 2022 11:08:55 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, each of them need its own context</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Jun 15 2022 11:09:44 GMT-0700 (Pacific Daylight Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">but the JSContext in non-main thread needs to use the main thread's context's JSRuntime as parent</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Jun 15 2022 11:10:18 GMT-0700 (Pacific Daylight Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(it might not be required, but I don't know if there's different use case)</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Jun 15 2022 11:11:50 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's RunExample?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Jun 15 2022 11:12:20 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, boilerplate</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Jun 15 2022 11:12:54 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it might be possible, but I thought it's better be explicit</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Jun 15 2022 11:13:18 GMT-0700 (Pacific Daylight Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">given it focuses mostly on that part</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Jun 15 2022 11:19:38 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">note that, RunExample does some more thing than worker, e.g. JS_Init, and also the 2nd parameter for JS_NewContext is different</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Jun 15 2022 11:20:00 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the 1st parameter can be aligned to boilerplate</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Jun 15 2022 11:20:13 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(it's just copied from js shell</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Jun 15 2022 11:27:07 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">JS_Init and JS_Shutdown need to be called only once from main thread</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Jun 15 2022 11:34:04 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">that's probably what's causing my segfault then</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Jun 15 2022 11:34:14 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">since i'm doing that in the 2 created threads, init and shutdown</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Jun 15 2022 11:35:11 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">in your example, if one thread crashes or the javascript crashes will it affect the rest of the threads?</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Jun 15 2022 11:35:27 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">or if you have some kind of infinite loop</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Jun 15 2022 11:41:07 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: also <code>PKG_CONFIG_PATH=PATH/TO/MOZJS-91/lib/pkgconfig/ meson _build</code> doesn't seem to be changing the pkg-config and keeps using <code>/usr/bin/pkg-config</code> and defaulting to my package manager's <code>libmozjs-68</code></td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Jun 15 2022 11:45:05 GMT-0700 (Pacific Daylight Time)">18:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">js execution in one thread doesn't affect other threads</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Jun 15 2022 11:45:45 GMT-0700 (Pacific Daylight Time)">18:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">segfault affects entire process. this is not specific to jsapi</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Jun 15 2022 11:46:44 GMT-0700 (Pacific Daylight Time)">18:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hm, maybe you need to tweak the pkg config part for your system.  I've tested it on macOS</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Jun 15 2022 11:47:32 GMT-0700 (Pacific Daylight Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">just to make sure, have you replaced the path in the env var to match your installation?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed Jun 15 2022 11:47:53 GMT-0700 (Pacific Daylight Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">PATH/TO/... is just an example</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed Jun 15 2022 12:00:02 GMT-0700 (Pacific Daylight Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">i've linked it to the one in <code>$HOME/spiderMonkey/mozilla-unified/obj-debug/config.statusd/substs/PKG_CONFIG</code></td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed Jun 15 2022 12:04:15 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I think you need to install it to custom directory</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Wed Jun 15 2022 12:04:35 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't think files in obj dir works</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Wed Jun 15 2022 12:04:51 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jdescottes:mozilla.org">jdescottes</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: that was it, flipping the pref makes it work with <code>makeGlobalObjectReference</code>!  Thanks :)</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Wed Jun 15 2022 12:06:01 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">lib/pkg-config directory is created inside installation, and that directory contains mozjs config file</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Wed Jun 15 2022 12:08:23 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">I only get these for a <code>find -iname "pkg-config"</code> <a href="https://termbin.com/bep8b">https://termbin.com/bep8b</a></td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Wed Jun 15 2022 12:09:07 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the embedding example has commands to build and install</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Wed Jun 15 2022 12:09:34 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/Building%20SpiderMonkey.md">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/Building%20SpiderMonkey.md</a></td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Wed Jun 15 2022 12:10:06 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">note that configure file doesn't exist and you need to copy configure .in</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Wed Jun 15 2022 12:10:10 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">but I don't have that with the <code>mach</code> version I have <a href="https://firefox-source-docs.mozilla.org/js/build.html">https://firefox-source-docs.mozilla.org/js/build.html</a></td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Wed Jun 15 2022 12:10:47 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, I think you still need to use configure+make</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Wed Jun 15 2022 12:11:02 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to get the make install work</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Wed Jun 15 2022 12:11:12 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't know the equivalent for mach</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Wed Jun 15 2022 12:11:52 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then pass --prefix=... to configure</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Wed Jun 15 2022 12:12:01 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: there's no <code>configure</code> in <code>js/src</code></td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Wed Jun 15 2022 12:12:11 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I think <code>mach build install</code> works. In general, <code>mach build ...</code> is a replacement for <code>make ...</code></td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Wed Jun 15 2022 12:12:12 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to install it into custom directory</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Wed Jun 15 2022 12:12:45 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">copy configure .in file</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Wed Jun 15 2022 12:13:02 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/54">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/54</a></td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Wed Jun 15 2022 12:13:31 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'll check workflow with mach build install when I get home</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Wed Jun 15 2022 13:04:56 GMT-0700 (Pacific Daylight Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-14">pastah</span>: here's example with multithread <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/55">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/pull/55</a></blockquote></mx-reply>Trying these still don't work with make install with my prefix. I have set the spidermonkey dependency to <code>mozjs-103.0a1</code></td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Wed Jun 15 2022 13:06:11 GMT-0700 (Pacific Daylight Time)">20:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">and LD_LIBRARY_PATH and PKG_CONFIG_PATH is also set correctly. however it fails the sanity check saying it can't find the header files</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Wed Jun 15 2022 13:07:18 GMT-0700 (Pacific Daylight Time)">20:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">it finds mozjs-103a1 from the <code>make install</code> though</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Wed Jun 15 2022 13:11:05 GMT-0700 (Pacific Daylight Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what exact command did you do?</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Wed Jun 15 2022 13:12:06 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><pre><code class="language-bash">export PKG_CONFIG_PATH=/home/dj/spiderMonkey/install/lib/pkgconfig
export LD_LIBRARY_PATH=/home/dj/spiderMonkey/install/lib
meson _build
</code></pre>
</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Wed Jun 15 2022 13:12:55 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's in <code>.../lib/pkgconfig</code> directory?</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Wed Jun 15 2022 13:13:09 GMT-0700 (Pacific Daylight Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><code>mozjs-103a1.pc</code></td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Wed Jun 15 2022 13:13:21 GMT-0700 (Pacific Daylight Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and what's output for the command?</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Wed Jun 15 2022 13:13:27 GMT-0700 (Pacific Daylight Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if it's long, please use <a href="https://paste.mozilla.org/">https://paste.mozilla.org/</a></td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Wed Jun 15 2022 13:15:40 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if it's long, please use <a href="https://paste.mozilla.org/">https://paste.mozilla.org/</a></blockquote></mx-reply><a href="https://termbin.com/b79t">https://termbin.com/b79t</a></td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Wed Jun 15 2022 13:16:02 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's the content of meson-log.txt ?</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Wed Jun 15 2022 13:17:01 GMT-0700 (Pacific Daylight Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><a href="https://termbin.com/q2dc">https://termbin.com/q2dc</a></td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Wed Jun 15 2022 13:18:16 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">does <code>~/spiderMonkey/install/include/mozjs-103a1/js-config.h</code> exist?</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Wed Jun 15 2022 13:19:09 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> does <code>~/spiderMonkey/install/include/mozjs-103a1/js-config.h</code> exist?</blockquote></mx-reply>yes</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Wed Jun 15 2022 13:19:42 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I wonder if <code>-isystem</code> used there is not working</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Wed Jun 15 2022 13:20:06 GMT-0700 (Pacific Daylight Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I haven't used the option.  I often use <code>-I</code> instead.  not sure what's the case for pkg-config</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Wed Jun 15 2022 13:20:55 GMT-0700 (Pacific Daylight Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, mine also says <code>-isystem</code></td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Wed Jun 15 2022 13:23:20 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">can you try check without ccache?</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Wed Jun 15 2022 13:23:52 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to me, the options passed there looks reasonable, so I guess there's some issue with the compiler setup</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Wed Jun 15 2022 13:40:57 GMT-0700 (Pacific Daylight Time)">20:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>./mach build install</code> with <code>ac_add_options --prefix=...</code> in <code>mozconfig</code> seems to work</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Wed Jun 15 2022 13:41:07 GMT-0700 (Pacific Daylight Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'll update the document in <code>next</code> branch</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Wed Jun 15 2022 13:50:26 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>./mach bootstrap</code> doesn't support non-vcs source tree...</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Wed Jun 15 2022 13:50:39 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, downloading a source package doesn't work</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Wed Jun 15 2022 13:51:22 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> can you try check without ccache?</blockquote></mx-reply>not sure if i can even disable ccache, it's not in the <a href="http://meson.build">meson.build</a></td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Wed Jun 15 2022 13:51:54 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">try manually running the command in the log</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Wed Jun 15 2022 13:52:09 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">to see if it works</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Wed Jun 15 2022 13:54:13 GMT-0700 (Pacific Daylight Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I think I might move <a href="https://phabricator.services.mozilla.com/D136267">https://phabricator.services.mozilla.com/D136267</a> to another bug, to make landing all the JS specific stuff self-contained</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Wed Jun 15 2022 14:06:41 GMT-0700 (Pacific Daylight Time)">21:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: I get different errors running it manually, things like is_const_v is not a member of std. I'll maybe get back to you on this tomorrow</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Wed Jun 15 2022 14:07:18 GMT-0700 (Pacific Daylight Time)">21:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">i'm not even sure if I should bother jumping through so many hoops to get debugging working as I could just mainly see if I can avoid the segfault all together without debugging symbols on libmozjs</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Wed Jun 15 2022 14:09:17 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">i.e. trying your example earlier</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Wed Jun 15 2022 14:09:45 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what if you add <code>-std=c++17</code> to the command?</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Wed Jun 15 2022 14:11:10 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">it just says it cannot find -lmozjs-103a1 even though I already exported LD library path and pkg config path. i'm going to head out to exercise</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Wed Jun 15 2022 14:11:25 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@pastah:mozilla.org">pastah</span>&gt;</div></td><td class="msg-cell">thank you for all the help</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Wed Jun 15 2022 14:11:43 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">LD_LIBRARY_PATH is for runtime</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Wed Jun 15 2022 14:11:48 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">not for compile/link time</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Wed Jun 15 2022 14:12:15 GMT-0700 (Pacific Daylight Time)">21:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">linker needs <code>-L path/to/lib</code> option</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Wed Jun 15 2022 16:36:11 GMT-0700 (Pacific Daylight Time)">23:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: sorry, just saw this. But that makes sense. I commented on the isNumber/isInt32 thing. I'd like a quick check to be sure I'm not just being stupid before I try landing it. And it may need a followup bug for the ErrorObject fields' types, I'm not sure.</td></tr>

</tbody></table></div></div></div>
</body></html>