<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-12-23</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-12-23<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-12-21" class="nav-link"><span>prev</span></a>
<a href="2022-12-26" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Dec 23 2022 05:42:52 GMT-0800 (Pacific Standard Time)">13:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">Hello, in the spidermonkey-embedding-examples/cookbook the JS_NewObjectForConstructor and JS_InitClass use the same JSClass data as input but it's seems unrelated. My understanding is that JSClass is used to spesify some properties of the created object for both function and are unrelated</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Dec 23 2022 05:42:58 GMT-0800 (Pacific Standard Time)">13:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">is it correct ?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Dec 23 2022 05:46:14 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>JS_InitClass</code> creates the constructor and prototype objects for given class.  <code>JS_NewObjectForConstructor</code> creates <code>this</code> object that can be used inside the constructor of given class</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Dec 23 2022 05:58:29 GMT-0800 (Pacific Standard Time)">13:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">Yes, but they both use JSClass struct as input, and within the exemple the code use the same JSClass, but I'm not sure that they should be the same, I guess not. For exemple if I use JSCLASS_HAS_RESERVED_SLOTS(10) with JS_InitClass I get 10 reserved slot for the created class object, but it does not mean that I will get 10 reserved slot if I call JS_NewObjectForConstructor from the constructor created above</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Dec 23 2022 05:59:27 GMT-0800 (Pacific Standard Time)">13:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">I may use JSCLASS_HAS_RESERVED_SLOTS(1) in the call JS_NewObjectForConstructor to get an object instance with only one available slot</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Dec 23 2022 06:00:22 GMT-0800 (Pacific Standard Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">They are both unrelated even if within the exemple they use both the same JSClass</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Dec 23 2022 06:02:55 GMT-0800 (Pacific Standard Time)">14:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/b80c70cbe36bc648c272caa511d29ec7c85f5fdd/examples/cookbook.cpp#L800-L840">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/b80c70cbe36bc648c272caa511d29ec7c85f5fdd/examples/cookbook.cpp#L800-L840</a></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Dec 23 2022 06:04:13 GMT-0800 (Pacific Standard Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">another question the <a href="http://JSClass.name">JSClass.name</a> get copied or must be statically allocated ?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Dec 23 2022 06:09:33 GMT-0800 (Pacific Standard Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Yes, but they both use JSClass struct as input, and within the exemple the code use the same JSClass, but I'm not sure that they should be the same, I guess not. For exemple if I use JSCLASS_HAS_RESERVED_SLOTS(10) with JS_InitClass I get 10 reserved slot for the created class object, but it does not mean that I will get 10 reserved slot if I call JS_NewObjectForConstructor from the constructor created above</blockquote></mx-reply>pretty sure it does mean you will get an object with 10 reserved slots from <code>JS_NewObjectForConstructor</code></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Dec 23 2022 06:09:48 GMT-0800 (Pacific Standard Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> another question the <a href="http://JSClass.name">JSClass.name</a> get copied or must be statically allocated ?</blockquote></mx-reply>JSClass and all its members really should be static</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Dec 23 2022 06:18:14 GMT-0800 (Pacific Standard Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>:  thank does not look obvious</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Dec 23 2022 08:13:05 GMT-0800 (Pacific Standard Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: after deep investigation, it's seems that they are unrelated, within both call the JSClass point end up in the function NewObject (<a href="https://searchfox.org/mozilla-central/source/js/src/vm/JSObject.cpp#737">https://searchfox.org/mozilla-central/source/js/src/vm/JSObject.cpp#737</a>) In the case of JS_InitClass the JSClass pointer is used to create an object that will be bound to prototype property of the Class object and in the case of JS_NewObjectForConstructor it is used to create the instance object.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Dec 23 2022 08:16:10 GMT-0800 (Pacific Standard Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">also it' seems that JSClass pointer value is used as some kind of key, thus it seems that it's better to have it static</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Dec 23 2022 08:34:23 GMT-0800 (Pacific Standard Time)">16:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">And it seems stored as it is (somehow) and the content isn't copied thus it should be kept forever</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Dec 23 2022 08:34:52 GMT-0800 (Pacific Standard Time)">16:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">This is what I did understood :)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Dec 23 2022 08:35:23 GMT-0800 (Pacific Standard Time)">16:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@gschwind:matrix.org">gschwind</span>&gt;</div></td><td class="msg-cell">I will see how I can contribute to the exemple to explicit this</td></tr>

</tbody></table></div></div></div>
</body></html>