<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-06-13</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-06-13<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-06-12" class="nav-link"><span>prev</span></a>
<a href="2023-06-14" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jun 12 2023 23:20:26 GMT-0700 (Pacific Daylight Time)">06:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I have a question about the return bool in <code>BaseProxyHandler::getOwnPropertyDescriptor()</code>. Should I return false if the function throws an error, or if the property is not found, or both?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jun 12 2023 23:22:30 GMT-0700 (Pacific Daylight Time)">06:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: If a function takes <code>JSContext*</code> as 1st parameter and returns <code>bool</code>, returning <code>false</code> implies there's a pending exception.  so, it should return false if it throws an error, but it should return true if the property is not found</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jun 12 2023 23:24:39 GMT-0700 (Pacific Daylight Time)">06:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">That's what I thought, thanks for confirming.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jun 13 2023 00:42:08 GMT-0700 (Pacific Daylight Time)">07:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: Counterpoint: <code>JS_IsExceptionPending</code>, literally the opposite</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jun 13 2023 00:47:49 GMT-0700 (Pacific Daylight Time)">07:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, good point. functions named <code>JS_Is*</code> and <code>JS::Is*</code> (and maybe some other prediction-style things ?) would work differently, unless there's <code>bool</code> out-parameter</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jun 13 2023 04:57:10 GMT-0700 (Pacific Daylight Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@jesup:mozilla.org">jesup</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> we don't exactly GC more aggressively in DEBUG, but we do verification passes that look at lots (all?) of the heap and I think are about as slow as a GC.</blockquote></mx-reply>Right, I think that's what BZ and I looked at as an example.   If that's still done it's a prime target</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jun 13 2023 05:55:30 GMT-0700 (Pacific Daylight Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> can anyone point me to some details on how top-level async is meant to work? I'm debugging a divergence with some of my local changes and finding <code>ResumeKind</code> values differing, but in bytecode whose origin I can't pinpoint; I suspect maybe a toplevel driver loop of some sort is synthesized?</blockquote></mx-reply>This may also help a bit? <a href="https://www.mgaudet.ca/technical/2020/9/1/how-do-generators-generate-in-spidermonkey">https://www.mgaudet.ca/technical/2020/9/1/how-do-generators-generate-in-spidermonkey</a></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jun 13 2023 07:49:55 GMT-0700 (Pacific Daylight Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: I noticed that AutoStubFrame::enter takes an optional canGC argument, but it's never supplied so we always use the default.  Worth removing the arugment?  Most calls do look like they can GC.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jun 13 2023 07:53:26 GMT-0700 (Pacific Daylight Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: yes please remove. I vaguely remember that being leftover from some TI code</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jun 13 2023 07:53:41 GMT-0700 (Pacific Daylight Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">great, will do</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jun 13 2023 07:54:35 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">next question, what happens if we remove a stub that can GC?  The stub code could be executing and have triggered the current GC... but what does wrong?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jun 13 2023 07:55:42 GMT-0700 (Pacific Daylight Time)">14:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I mentioned that in our meeting but thinking about it more, it should be fine to unlink the stub. We'll still trace it through the pointer on the stack that's stored in the stub frame</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jun 13 2023 07:56:11 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">that unlinking would be similar to what happens when we mark the IC megamorphic or generic so it should just work</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jun 13 2023 07:57:21 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Great, that is simpler.  Thanks.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jun 13 2023 07:59:29 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(we want to continue discarding JIT code occasionally to ensure we don't waste too much space in the can-gc-stub LifoAlloc in edge cases..)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jun 13 2023 15:20:45 GMT-0700 (Pacific Daylight Time)">22:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">There's a <a href="https://searchfox.org/mozilla-central/source/js/src/jit/CompileWrappers.h#66-67">comment in CompileWrappers.h</a> that claims "Compilation does not occur off thread when the Gecko Profiler is enabled." That's no longer true, right?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jun 13 2023 15:21:15 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I don't see anywhere that we're enforcing it, and I'm pretty sure we have plenty of profiles with background Ion compiles</td></tr>

</tbody></table></div></div></div>
</body></html>