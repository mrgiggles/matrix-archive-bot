<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-02-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-02-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-02-17" class="nav-link"><span>prev</span></a>
<a href="2020-02-19" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Feb 18 2020 01:59:35 GMT-0800 (Pacific Standard Time)">09:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><code>Object.getOwnPropertyDescriptor</code> is too long to type :P</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Feb 18 2020 02:15:08 GMT-0800 (Pacific Standard Time)">10:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: I need some input on bug 1615265. I am going to suppress this issue but I need to know if that is related to the race that we discussed the other day. I have the feeling that we are suppressing more than one bug here :/</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Feb 18 2020 02:15:10 GMT-0800 (Pacific Standard Time)">10:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@botzilla:delire.party">Botzilla demo</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1615265">https://bugzil.la/1615265</a> — NEW (nobody) — Perma ThreadSanitizer: data race /builds/worker/workspace/build/src/js/xpconnect/loader/ScriptPreloader.cpp:930:17 in mozilla::ScriptPreloader::OffThreadDecodeCallback(JS::OffThreadToken*, void*) when Gecko 75 merges to Beta on 2020-03-09</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Feb 18 2020 03:08:35 GMT-0800 (Pacific Standard Time)">11:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: I need-info <span class="nick-1">kmag</span> on <a href="https://bugzil.la/1608462">https://bugzil.la/1608462</a> , which from what I understand is the same issue, and still not fixed.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Feb 18 2020 03:09:12 GMT-0800 (Pacific Standard Time)">11:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I do not think we should ignore this issue.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Feb 18 2020 03:09:28 GMT-0800 (Pacific Standard Time)">11:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">ah, im also commenting and needinfoing him on 1615265 now</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Feb 18 2020 03:10:05 GMT-0800 (Pacific Standard Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">I saw that the OffThreadDecodeCallback has a <code>MonitorAutoLock mal(cache-&gt;mMonitor);</code></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Feb 18 2020 03:10:22 GMT-0800 (Pacific Standard Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">but <code>ScriptPreloader::DoFinishOffThreadDecode()</code> has not</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Feb 18 2020 03:10:56 GMT-0800 (Pacific Standard Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">I wonder if that is intended. TSan is complaining about racing on <code>cache-&gt;mFinishDecodeRunnablePending</code> and thats correct. the code also looks problematic</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Feb 18 2020 03:11:06 GMT-0800 (Pacific Standard Time)">11:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/xpconnect/loader/ScriptPreloader.cpp#937">https://searchfox.org/mozilla-central/source/js/xpconnect/loader/ScriptPreloader.cpp#937</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Feb 18 2020 05:30:47 GMT-0800 (Pacific Standard Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I'm seeing this on a web page, any idea what it means ?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Feb 18 2020 05:31:13 GMT-0800 (Pacific Standard Time)">13:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">source code is <code>this._preDelay.set( Float32Array.from(inputs[0][0], (n, i) =&gt; (n + inputs[0][1][i]) * 0.5), this._pDWrite );</code></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Feb 18 2020 05:31:51 GMT-0800 (Pacific Standard Time)">13:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I'm particularly worried about the <code>self-hosted:4435</code> bit</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Feb 18 2020 05:33:15 GMT-0800 (Pacific Standard Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Does that mean Float32Array.from is self-hosted?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Feb 18 2020 05:34:31 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">I'm trying to find whether or not it's the case, but I'm a bit lost</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Feb 18 2020 05:35:11 GMT-0800 (Pacific Standard Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">if it's both for regular Array and also TypedArrays, it seems like it is</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Feb 18 2020 05:39:26 GMT-0800 (Pacific Standard Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">yeah it's self-hosted  <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/TypedArray.js#1409">https://searchfox.org/mozilla-central/source/js/src/builtin/TypedArray.js#1409</a></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Feb 18 2020 05:39:37 GMT-0800 (Pacific Standard Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">source is the name of the first parameter</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Feb 18 2020 05:40:21 GMT-0800 (Pacific Standard Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">hm I see</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Feb 18 2020 05:41:15 GMT-0800 (Pacific Standard Time)">13:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">ok that helps</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Feb 18 2020 05:41:24 GMT-0800 (Pacific Standard Time)">13:41</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-2" title="@padenot:mozilla.org">padenot</span></div></td><td class="msg-cell">continue tracking this down</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Feb 18 2020 06:05:03 GMT-0800 (Pacific Standard Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">well the cause was a chrome bug that people now seem to rely on</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Feb 18 2020 06:05:05 GMT-0800 (Pacific Standard Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">pikachusurprised.jpg</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Feb 18 2020 06:11:59 GMT-0800 (Pacific Standard Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: servo is trying to upgrade to the latest spidermonkey, and when ion is enabled we reliably get a crash accessing getter properties of the window object after a while where the specialized this pointer argument in the getter is garbage. I have an rr recording of the problem; what's a good next step?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Feb 18 2020 06:12:48 GMT-0800 (Pacific Standard Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">jdm</span>: nox mentioned that in #jsapi on IRC, there was some discussion here <a href="https://mozilla.logbot.info/jsapi/20200218#c16886383-c16886423">https://mozilla.logbot.info/jsapi/20200218#c16886383-c16886423</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Feb 18 2020 06:13:22 GMT-0800 (Pacific Standard Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it'd be good to double check the JS object is what you expect</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Feb 18 2020 06:13:36 GMT-0800 (Pacific Standard Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">what's in its first slot is then passed to the getter op by Ion</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Feb 18 2020 06:14:12 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">thanks</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Feb 18 2020 06:17:32 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">jdm</span>: is this groundhog day?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Feb 18 2020 06:17:46 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">it's divide and conquer :)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Feb 18 2020 06:17:56 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">next we'll take this to twitter</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Feb 18 2020 06:25:16 GMT-0800 (Pacific Standard Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@awingo:igalia.com">wingo</span>&gt;</div></td><td class="msg-cell">&amp; then turn the whole debugging session into a smart contract</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Feb 18 2020 07:11:24 GMT-0800 (Pacific Standard Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">if I have a JSObject pointer, what's the easiest way to print the value in reserved slot 0?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Feb 18 2020 07:11:27 GMT-0800 (Pacific Standard Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">(in gdb)</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Feb 18 2020 07:11:35 GMT-0800 (Pacific Standard Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">can someone check if this analysis is correct: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1615704#c3">https://bugzilla.mozilla.org/show_bug.cgi?id=1615704#c3</a> ?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Feb 18 2020 07:11:39 GMT-0800 (Pacific Standard Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">and similarly, how can I add a watchpoint to it?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Feb 18 2020 07:11:41 GMT-0800 (Pacific Standard Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: ^</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Feb 18 2020 07:13:26 GMT-0800 (Pacific Standard Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">jdm</span>: I think <code>$1-&gt;getSlot(0)</code></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Feb 18 2020 07:14:31 GMT-0800 (Pacific Standard Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">jdm</span>: oh, you have to cast to <code>js::NativeObject*</code> first</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Feb 18 2020 07:14:47 GMT-0800 (Pacific Standard Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">then you can <code>-&gt;getReservedSlot(0)</code> even</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Feb 18 2020 07:25:48 GMT-0800 (Pacific Standard Time)">15:25</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-3" title="@jdm:mozilla.org">jdm</span></div></td><td class="msg-cell">tries to figure out why every call to getReservedSlot on the window object ends up segfaulting</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Feb 18 2020 07:28:05 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Does it have reserved slots?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Feb 18 2020 07:28:14 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Globals used to be special, at least</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Feb 18 2020 07:28:41 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">globals and non-globals share the same layout now where slot 0 is the native object pointer</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Feb 18 2020 07:28:59 GMT-0800 (Pacific Standard Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">and afaict we're setting it up to match gecko's</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Feb 18 2020 07:29:21 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">can also call <code>obj-&gt;dump()</code>, it should print the slots</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Feb 18 2020 07:29:23 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">ooh</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Feb 18 2020 07:29:39 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">Cannot evaluate function -- may be inlined</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Feb 18 2020 07:30:14 GMT-0800 (Pacific Standard Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">this is a debug spidermonkey build :(</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Feb 18 2020 07:30:15 GMT-0800 (Pacific Standard Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><code>js::DumpObject(obj)</code>?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Feb 18 2020 07:30:32 GMT-0800 (Pacific Standard Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">hmm, seems bad that dumping the object segfaulted as well</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Feb 18 2020 07:31:15 GMT-0800 (Pacific Standard Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">we have a bad shape apparentl;y</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Feb 18 2020 07:37:00 GMT-0800 (Pacific Standard Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: you mean for the cross-compartment case? same-compartment realms are spec-compliant (we should enter the realm of the callee function)</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Feb 18 2020 07:38:17 GMT-0800 (Pacific Standard Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: oh neat. Are cross-compartment realms even observable from the normal web?</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Feb 18 2020 07:39:08 GMT-0800 (Pacific Standard Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: they are, when document.domain is involved for example (two compartments which can then access each other)</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Feb 18 2020 08:54:32 GMT-0800 (Pacific Standard Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Is there some way in the browser to get at the shell functions? I vaguely recall there being something along those lines, but I can't find it.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Feb 18 2020 08:54:40 GMT-0800 (Pacific Standard Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I don't remember if it was fuzzing only or something.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Feb 18 2020 09:00:19 GMT-0800 (Pacific Standard Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Different tabs have different zones, so <a href="http://window.open">window.open</a>() gives you a cross-compartment same-origin realm</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Feb 18 2020 09:00:24 GMT-0800 (Pacific Standard Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: That you can access</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Feb 18 2020 09:00:44 GMT-0800 (Pacific Standard Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@bzbarsky:mozilla.org">bzbarsky</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">mccr8</span>: Do you need shell functions or TestingFunctions?</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Feb 18 2020 09:02:42 GMT-0800 (Pacific Standard Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">bzbarsky</span>: Ah, TestingFunctions must be what I was thinking of. Thanks.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Feb 18 2020 09:02:58 GMT-0800 (Pacific Standard Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I'm reviewing a patch that is adding something to Cu and I'm trying to figure out if that's really necessary or not.</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Feb 18 2020 09:03:34 GMT-0800 (Pacific Standard Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Now I just need to figure out if this function that is being added is a testing function or not.</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Feb 18 2020 09:12:05 GMT-0800 (Pacific Standard Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">It is not. But I'll mention the alternative.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Feb 18 2020 09:16:29 GMT-0800 (Pacific Standard Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">jandem: thanks I had totally paged that out</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Feb 18 2020 09:17:29 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">bzbarsky: oh I had no idea about <a href="http://window.open">window.open</a></td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Feb 18 2020 10:14:36 GMT-0800 (Pacific Standard Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> hi. I have a <code>JS::PersistentRooted&lt;JSObject*&gt;</code>, and I need to pass it to something that takes a <code>HandleValue</code>, does someone has an example of this?</blockquote></mx-reply><p>Note that implicit conversion of <code>PersistentRooted&lt;T&gt;</code> to <code>Handle&lt;T&gt;</code> is sort of a footgun.  (And if it weren't for the claims here, I would have guessed we would <em>not</em> have such functionality.  I actually sort of think, if it exists, we should delete it...)</p>
<p>The former is basically a root allocated in the C++ heap: you have to manually keep it alive somewhere.  The latter is a pointer to a location that is <em>presumed</em> to remain rooted for the lifetime of whatever is using the <code>Handle</code>.</p>
<p>Now imagine you pass a <code>Handle&lt;T&gt;</code> created directly from a <code>PersistentRooted&lt;T&gt;</code> to a function.  And inside that function something is done that happens to deallocate the <code>PersistentRooted&lt;T&gt;</code>.  This will cause your handle to no longer point at rooted memory, and many hijinks will ensue.</p>
<p>On the other hand, if you store that <code>PersistentRooted&lt;T&gt;</code> into a (necessarily) stack-allocated <code>Rooted&lt;T&gt;</code>, even if that function happens to deallocate the <code>PersistentRooted&lt;T&gt;</code>, your <code>T</code> will still be kept alive and known to the GC by the stacked <code>Rooted</code>.</p>
</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Feb 18 2020 10:30:34 GMT-0800 (Pacific Standard Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">"The former is basically a root allocated in the C++ heap: you have to manually keep it alive somewhere." - huh? PersistentRooted keeps itself alive. Or do you mean the PersistentRooted itself has to be "kept alive" as in, not deleted? Your bug is still valid either way; PersistentRooteds are assumed to have a relatively long lifetime compared to anything you do with them.</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Feb 18 2020 10:35:29 GMT-0800 (Pacific Standard Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-15">Waldo</span>: ^</blockquote></mx-reply>Yeah, <code>.caller</code> and <code>.arguments</code> probably ought be written in fashion that does not use <code>CallNonGenericMethod</code> -- as ought most things, just it's a bit more fragile writing them and all.</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Feb 18 2020 10:36:57 GMT-0800 (Pacific Standard Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> "The former is basically a root allocated in the C++ heap: you have to manually keep it alive somewhere." - huh? PersistentRooted keeps itself alive. Or do you mean the PersistentRooted itself has to be "kept alive" as in, not deleted? Your bug is still valid either way; PersistentRooteds are assumed to have a relatively long lifetime compared to anything you do with them.</blockquote></mx-reply>Yeah, sorry, the <code>PersistentRooted&lt;T&gt;</code> itself has to be kept alive.  <em>Something</em> is keeping it alive manually, and if the function you pass the handle to can manage to un-keep the <code>PersistentRooted</code> alive, things go boom.</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Feb 18 2020 10:37:34 GMT-0800 (Pacific Standard Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@cfallin:mozilla.org">cfallin</span>&gt;</div></td><td class="msg-cell">If only we had a language-level way to track object lifetimes...</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Feb 18 2020 10:38:09 GMT-0800 (Pacific Standard Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">i no rite</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Feb 18 2020 10:38:50 GMT-0800 (Pacific Standard Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Gee, see that would be a good idea.</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Feb 18 2020 10:39:12 GMT-0800 (Pacific Standard Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">(^ read it out loud, you won't regret listening to me this once)</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Feb 18 2020 10:52:03 GMT-0800 (Pacific Standard Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Bwhahahaha</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Feb 18 2020 11:08:43 GMT-0800 (Pacific Standard Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: I am not sure I trust myself to implement that correctly, but it probably makes sense when overhauling this stuff anyway</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Feb 18 2020 11:10:04 GMT-0800 (Pacific Standard Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I've been practicing with the footguns lately, I think I can review a patch reasonably competently, or perhaps carry this aspect of it across the finish line.  😏</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Feb 18 2020 11:10:13 GMT-0800 (Pacific Standard Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">(flw)</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Feb 18 2020 11:14:00 GMT-0800 (Pacific Standard Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">@Waldo: Thanks, I will give it a shot.</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Feb 18 2020 11:15:50 GMT-0800 (Pacific Standard Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">The client-UI fussiness about properly invoking the nick of someone in a channel with Matrix is somewhat unfortunate, but at least there's <code>/stalk</code>-like reaction to mere mention of nicks too, at least with the web client and RiotX on Android both.</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Feb 18 2020 11:16:25 GMT-0800 (Pacific Standard Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">it's so unfortunate</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Feb 18 2020 11:16:36 GMT-0800 (Pacific Standard Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">(the client ui fussiness)</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Tue Feb 18 2020 11:16:44 GMT-0800 (Pacific Standard Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Speaking of which, I guess I'm also missing my IRC <code>/stalk pun</code> these days, aren't I.</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Tue Feb 18 2020 11:17:01 GMT-0800 (Pacific Standard Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I think I made the mistake of typing your name! I am such a bad person</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Tue Feb 18 2020 11:18:15 GMT-0800 (Pacific Standard Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I kind of liked the ability to mention a nick without triggering Riot to notice and wrap it up with excessive decoration. But I found the pref to not do that anymore, so now the marked-up version looks better than not.</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Tue Feb 18 2020 11:18:17 GMT-0800 (Pacific Standard Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">It alerted me, so no harm no foul for sure.</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Tue Feb 18 2020 11:27:49 GMT-0800 (Pacific Standard Time)">19:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">std::stable_sort allocates a temporary buffer internally, which sets off check_vanilla_allocations.py. Do we have our own implementation of stable sorting somewhere?</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Tue Feb 18 2020 11:49:41 GMT-0800 (Pacific Standard Time)">19:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: <code>ds/Sort*</code> has a merge sort algorithm in it that'll be stable.</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Tue Feb 18 2020 11:51:05 GMT-0800 (Pacific Standard Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: Perfect, thanks!</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Tue Feb 18 2020 11:51:46 GMT-0800 (Pacific Standard Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I wish I didn't have to remember that merge sort is a stable sort to answer that, but calling it "StableMergeSort" would be a bit gilding the lily probably.</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Tue Feb 18 2020 11:52:15 GMT-0800 (Pacific Standard Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">This came up for some <code>builtin/intl</code> patching recently, only reason I had the association nicely in memory.</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Tue Feb 18 2020 11:52:34 GMT-0800 (Pacific Standard Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Might be reasonable to add a comment saying "this is a stable sort"</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Tue Feb 18 2020 11:53:12 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Or "this is a stable sort StableSort stable_sort" for better searchability. ;)</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Tue Feb 18 2020 11:53:29 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/builtin/intl/LanguageTag.cpp#482">https://searchfox.org/mozilla-central/source/js/src/builtin/intl/LanguageTag.cpp#482</a></td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Tue Feb 18 2020 11:53:55 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">mccr8++</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Tue Feb 18 2020 11:53:57 GMT-0800 (Pacific Standard Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/ds/Sort.h#67">https://searchfox.org/mozilla-central/source/js/src/ds/Sort.h#67</a> does not actually mention stability.  It could, but also by the time you've found it there's a somewhat fair chance you had already thought of it as stable...</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Tue Feb 18 2020 12:48:52 GMT-0800 (Pacific Standard Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">So I am trying to figure out if something I implemented behaves like the spec</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Tue Feb 18 2020 12:49:33 GMT-0800 (Pacific Standard Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">per <a href="https://github.com/claudepache/es-legacy-function-reflection/blob/master/spec.md">https://github.com/claudepache/es-legacy-function-reflection/blob/master/spec.md</a> IsAllowedReceiverFunctionForCallerAndArguments Step 3. checks if the |f| in |f|.caller is in expectedRealm</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Tue Feb 18 2020 12:49:53 GMT-0800 (Pacific Standard Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">expectedRealm is "Let currentRealm be the current Realm Record."</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Tue Feb 18 2020 12:51:22 GMT-0800 (Pacific Standard Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">so to me I would imagine the following code would always throw because we are entering a different realm when calling the "otherCaller" function</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Tue Feb 18 2020 12:51:32 GMT-0800 (Pacific Standard Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><a href="https://paste.mozilla.org/hBObjxJr">https://paste.mozilla.org/hBObjxJr</a></td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Tue Feb 18 2020 12:52:55 GMT-0800 (Pacific Standard Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">yeah, this is pretty optimistic on the part of the proposal authors</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Tue Feb 18 2020 12:53:09 GMT-0800 (Pacific Standard Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">it doesn't throw in my implementation, and I am not sure why actually?</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Tue Feb 18 2020 12:53:18 GMT-0800 (Pacific Standard Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">yeah not even talking about that</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Tue Feb 18 2020 12:53:30 GMT-0800 (Pacific Standard Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">all those realm restrictions aren't implemented by anyone</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Tue Feb 18 2020 12:55:06 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">i know</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Tue Feb 18 2020 12:55:16 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">i'm saying the expectation that this does not break the web is optimistic</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Tue Feb 18 2020 12:55:31 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">but I think I agree with you that your example should throw</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Tue Feb 18 2020 12:55:55 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">I'm checking the (existing, already-spec'd) behavior of [[Call]] on builtins right now, just to be totally sure</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Tue Feb 18 2020 12:56:55 GMT-0800 (Pacific Standard Time)">20:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">yeah, step 6 is exactly what you'd expect <a href="https://tc39.es/ecma262/#sec-built-in-function-objects-call-thisargument-argumentslist">https://tc39.es/ecma262/#sec-built-in-function-objects-call-thisargument-argumentslist</a></td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Tue Feb 18 2020 12:57:48 GMT-0800 (Pacific Standard Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">so this is my patch <a href="https://phabricator.services.mozilla.com/D63248">https://phabricator.services.mozilla.com/D63248</a></td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Tue Feb 18 2020 12:59:15 GMT-0800 (Pacific Standard Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: well, you're unwrapping it</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Tue Feb 18 2020 12:59:23 GMT-0800 (Pacific Standard Time)">20:59</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span></div></td><td class="msg-cell">thinks</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Tue Feb 18 2020 12:59:42 GMT-0800 (Pacific Standard Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">yeah, i see, why is this not throwing</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Tue Feb 18 2020 13:00:11 GMT-0800 (Pacific Standard Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><code>AdvanceToActiveCallLinear(cx, iter, fun)</code> -&gt; <code>AdvanceToActiveCallLinear(cx, iter, unwrappedFun)</code> does not seem like a wholly safe/correct change to make.</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Tue Feb 18 2020 13:00:32 GMT-0800 (Pacific Standard Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I don't remember how that function works, but the idea that that change just works seems...optimistic.</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Tue Feb 18 2020 13:02:51 GMT-0800 (Pacific Standard Time)">21:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: oh, does it throw if you use <code>--more-compartments</code> or pass <code>{newCompartment: true}</code> to <code>newGlobal</code>?</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Tue Feb 18 2020 13:04:12 GMT-0800 (Pacific Standard Time)">21:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">no</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Tue Feb 18 2020 13:05:24 GMT-0800 (Pacific Standard Time)">21:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">ok, so the wrapping is irrelevant i guess?</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Tue Feb 18 2020 13:05:45 GMT-0800 (Pacific Standard Time)">21:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">i dunno, gotta debug</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Tue Feb 18 2020 13:20:33 GMT-0800 (Pacific Standard Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">sfink: ping</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Tue Feb 18 2020 13:20:38 GMT-0800 (Pacific Standard Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: ^</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Tue Feb 18 2020 13:20:45 GMT-0800 (Pacific Standard Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">wazzup?</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Tue Feb 18 2020 13:20:59 GMT-0800 (Pacific Standard Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Do you have a copy of your notes from the hazard workshop handy?</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Tue Feb 18 2020 13:21:13 GMT-0800 (Pacific Standard Time)">21:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I am running into hazard warnings in the regexp code</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Tue Feb 18 2020 13:22:09 GMT-0800 (Pacific Standard Time)">21:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><a href="http://hotsphink.github.io/sfink-tools/doc/hazards.html">http://hotsphink.github.io/sfink-tools/doc/hazards.html</a></td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Tue Feb 18 2020 13:22:47 GMT-0800 (Pacific Standard Time)">21:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Perfect, thanks!</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Tue Feb 18 2020 13:23:12 GMT-0800 (Pacific Standard Time)">21:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but if you send me a link to a try push, I can take a look</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Tue Feb 18 2020 13:25:51 GMT-0800 (Pacific Standard Time)">21:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The root of the issue is that I'm holding a JS::AutoCheckCannotGC over a call into ICU which internally uses an indirect call</td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Tue Feb 18 2020 13:26:40 GMT-0800 (Pacific Standard Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh. You may just need to annotate that away.</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Tue Feb 18 2020 13:27:31 GMT-0800 (Pacific Standard Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the file is js/src/devtools/rootAnalysis/annotations.js</td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Tue Feb 18 2020 13:27:46 GMT-0800 (Pacific Standard Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but which list to put it in depends on what the best way to identify it is</td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Tue Feb 18 2020 13:31:51 GMT-0800 (Pacific Standard Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><pre><code>void icu_65::UnicodeSet::applyFilter((int8)(int32,void*)*, void*, icu_65::UnicodeSet*, int32*)
IndirectCall: filter
</code></pre>
</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Tue Feb 18 2020 13:32:52 GMT-0800 (Pacific Standard Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, that looks like one for ignoreFunctions</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Tue Feb 18 2020 13:35:27 GMT-0800 (Pacific Standard Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Cool, I'll try that out and see if it helps</td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Tue Feb 18 2020 13:36:24 GMT-0800 (Pacific Standard Time)">21:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm assuming nobody's going to be passing in a function as the 1st argument that will call back into the JS engine</td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Tue Feb 18 2020 13:37:30 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I don't even think anybody's passing in a function at all. I'm pretty sure the function pointer is completely internal to ICU.</td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Tue Feb 18 2020 13:37:35 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">right</td></tr>
  <tr class="msg" id="L138"><td class="ts-cell"><a class="ts" href="#L138" alt="Tue Feb 18 2020 13:37:47 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The previous line in the call stack is: icu_65::UnicodeSet* icu_65::UnicodeSet::applyIntPropertyValue(int32, int32, int32*)
</td></tr>
  <tr class="msg" id="L139"><td class="ts-cell"><a class="ts" href="#L139" alt="Tue Feb 18 2020 13:37:49 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the alternative is to stick an AutoSuppressGCAnalysis into whatever's calling into ICU</td></tr>
  <tr class="msg" id="L140"><td class="ts-cell"><a class="ts" href="#L140" alt="Tue Feb 18 2020 13:38:10 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I should add a whole section to that hazards doc about how you actually deal with problems</td></tr>
  <tr class="msg" id="L141"><td class="ts-cell"><a class="ts" href="#L141" alt="Tue Feb 18 2020 13:38:14 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">That's tricky, because ICU is being called from V8 code</td></tr>
  <tr class="msg" id="L142"><td class="ts-cell"><a class="ts" href="#L142" alt="Tue Feb 18 2020 13:38:23 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which I am trying not to modify</td></tr>
  <tr class="msg" id="L143"><td class="ts-cell"><a class="ts" href="#L143" alt="Tue Feb 18 2020 13:38:25 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh. Then ignoreFunctions seems preferable.</td></tr>
  <tr class="msg" id="L144"><td class="ts-cell"><a class="ts" href="#L144" alt="Tue Feb 18 2020 13:38:52 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, annotations.js seems like the answer to my problems</td></tr>
  <tr class="msg" id="L145"><td class="ts-cell"><a class="ts" href="#L145" alt="Tue Feb 18 2020 13:53:45 GMT-0800 (Pacific Standard Time)">21:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote>Yeah, sorry, the <code>PersistentRooted&lt;T&gt;</code> itself has to be kept alive.  <em>Something</em> is keeping it alive manually, and if the function you pass the handle to can manage to un-keep the <code>PersistentRooted</code> alive, things go boom.</blockquote></mx-reply>This is absolutely guaranteed, in the code I'm writing, lifetimes are 100% decided by the C++ code. This is a very controlled environment (AudioWorkletGlobalScope) </td></tr>
  <tr class="msg" id="L146"><td class="ts-cell"><a class="ts" href="#L146" alt="Tue Feb 18 2020 13:55:53 GMT-0800 (Pacific Standard Time)">21:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">But if we feel there is something we could improve in terms of safety, I'm also very happy to listen to suggestions and implement them if possible </td></tr>
  <tr class="msg" id="L147"><td class="ts-cell"><a class="ts" href="#L147" alt="Tue Feb 18 2020 13:56:59 GMT-0800 (Pacific Standard Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Yeah, see, I'd be more scared than that if it were me.  :-)  Lack of <code>kungFuDeathGrip</code>s is absolutely a thing that has caused us bugs in the past, and this is sort of a variant of that problem.</td></tr>
  <tr class="msg" id="L148"><td class="ts-cell"><a class="ts" href="#L148" alt="Tue Feb 18 2020 13:57:43 GMT-0800 (Pacific Standard Time)">21:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">In particular, we're more or less encoding this lifetime property in the spec</td></tr>
  <tr class="msg" id="L149"><td class="ts-cell"><a class="ts" href="#L149" alt="Tue Feb 18 2020 13:58:11 GMT-0800 (Pacific Standard Time)">21:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">And especially when you've possibly got random JS code potentially running in places here, reentry to do most nearly anything is a frequent specter haunting things.</td></tr>
  <tr class="msg" id="L150"><td class="ts-cell"><a class="ts" href="#L150" alt="Tue Feb 18 2020 13:59:02 GMT-0800 (Pacific Standard Time)">21:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">Worklets are different in the sense that they don't decide when they run</td></tr>
  <tr class="msg" id="L151"><td class="ts-cell"><a class="ts" href="#L151" alt="Tue Feb 18 2020 14:00:11 GMT-0800 (Pacific Standard Time)">22:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">Plus: it's not like C++ can do anything to make handles ever safe</td></tr>
  <tr class="msg" id="L152"><td class="ts-cell"><a class="ts" href="#L152" alt="Tue Feb 18 2020 14:00:18 GMT-0800 (Pacific Standard Time)">22:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell">And the whole scope is destroyed at once when it's time to do so (per spec)</td></tr>
  <tr class="msg" id="L153"><td class="ts-cell"><a class="ts" href="#L153" alt="Tue Feb 18 2020 14:01:08 GMT-0800 (Pacific Standard Time)">22:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@padenot:mozilla.org">padenot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote>Plus: it's not like C++ can do anything to make handles ever safe</blockquote></mx-reply>Heh, I don't write this in c++ by choice, we have been saved more than once by rust in the media team</td></tr>
  <tr class="msg" id="L154"><td class="ts-cell"><a class="ts" href="#L154" alt="Tue Feb 18 2020 14:02:58 GMT-0800 (Pacific Standard Time)">22:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">hm, I wonder if PersistentRooted could hand out a Handle subclass that manages a numHandlesActive counter, and ~PersistentRooted could throw a hissy fit it it's nonzero. My grasp of C++'s temporary handling is not strong.</td></tr>
  <tr class="msg" id="L155"><td class="ts-cell"><a class="ts" href="#L155" alt="Tue Feb 18 2020 14:03:31 GMT-0800 (Pacific Standard Time)">22:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">subclassing probably wouldn't work that well with things that are using generic Handles</td></tr>
  <tr class="msg" id="L156"><td class="ts-cell"><a class="ts" href="#L156" alt="Tue Feb 18 2020 14:04:09 GMT-0800 (Pacific Standard Time)">22:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Just forcing you to store it in a <code>Rooted</code> to access its stored value does not seem terribly onerous to me, and it's simple and easy to understand and verify, unlike a shared-handle-with-refcount thing.</td></tr>
  <tr class="msg" id="L157"><td class="ts-cell"><a class="ts" href="#L157" alt="Tue Feb 18 2020 14:04:47 GMT-0800 (Pacific Standard Time)">22:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">true</td></tr>
  <tr class="msg" id="L158"><td class="ts-cell"><a class="ts" href="#L158" alt="Tue Feb 18 2020 14:59:36 GMT-0800 (Pacific Standard Time)">22:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ugh. Upgraded to fedora 31, which uses Python 3 as /usr/bin/python. So jstests and jit-tests fail. I guess I should land my partial migration of those scripts to Python 3 -- it works for everything but wpt.</td></tr>
  <tr class="msg" id="L159"><td class="ts-cell"><a class="ts" href="#L159" alt="Tue Feb 18 2020 15:07:04 GMT-0800 (Pacific Standard Time)">23:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The good news is that annotations.js fixed my hazard problem. The bad news is that it uncovered a new, real hazard. The good news is that it's only an issue when using named captures, which we don't currently support. The bad news is that we obviously want to support them. The good news is that this is all a problem for Tomorrow Iain.</td></tr>
  <tr class="msg" id="L160"><td class="ts-cell"><a class="ts" href="#L160" alt="Tue Feb 18 2020 15:09:20 GMT-0800 (Pacific Standard Time)">23:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: so you are getting pretty close now?</td></tr>
  <tr class="msg" id="L161"><td class="ts-cell"><a class="ts" href="#L161" alt="Tue Feb 18 2020 15:10:04 GMT-0800 (Pacific Standard Time)">23:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">My try build is ~3 known issues away from being green</td></tr>
  <tr class="msg" id="L162"><td class="ts-cell"><a class="ts" href="#L162" alt="Tue Feb 18 2020 15:12:30 GMT-0800 (Pacific Standard Time)">23:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Wait, make that 4, I forgot that there was a cgc/binast issue that I've been pretending doesn't exist</td></tr>
  <tr class="msg" id="L163"><td class="ts-cell"><a class="ts" href="#L163" alt="Tue Feb 18 2020 15:12:40 GMT-0800 (Pacific Standard Time)">23:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Plus any other issues that are hiding behind the known ones</td></tr>
  <tr class="msg" id="L164"><td class="ts-cell"><a class="ts" href="#L164" alt="Tue Feb 18 2020 15:12:58 GMT-0800 (Pacific Standard Time)">23:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Plus a lot of work to get the patches organized and reviewable</td></tr>

</tbody></table></div></div></div>
</body></html>