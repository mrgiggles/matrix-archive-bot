<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-01-14</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-01-14<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-01-13" class="nav-link"><span>prev</span></a>
<a href="2021-01-15" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Jan 13 2021 16:12:02 GMT-0800 (Pacific Standard Time)">00:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is SMDOC rendered to a standalone documentation?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Jan 13 2021 16:12:39 GMT-0800 (Pacific Standard Time)">00:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">does it follow certain syntax?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Jan 13 2021 16:19:00 GMT-0800 (Pacific Standard Time)">00:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">No, the only feature of [SMDOC] is that it's easy to find in searchfox</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Jan 13 2021 16:19:25 GMT-0800 (Pacific Standard Time)">00:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I see.  thanks :)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Jan 14 2021 02:28:52 GMT-0800 (Pacific Standard Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/ruffle-rs/ruffle/blob/master/core/src/ecma_conversions.rs">https://github.com/ruffle-rs/ruffle/blob/master/core/src/ecma_conversions.rs</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Jan 14 2021 09:23:46 GMT-0800 (Pacific Standard Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">(FYI, the 'weird bug' above was cause by incorrect usage of GCHashTable, as I had trouble with MovableCellHasher and tried not using it)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Jan 14 2021 09:24:22 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">The 'trouble' is that it GCHashTable&lt;JS::Heap&lt;X&gt;, T, MovableCellHasher&lt;Js::Heap&lt;&gt;&gt;&gt; doesn't compile on VS17</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Jan 14 2021 09:24:33 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">because of some weird undefined symbol error - probably a VS17 bug tbh</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Jan 14 2021 09:40:05 GMT-0800 (Pacific Standard Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">wtf? Over Thanksgiving, out of curiousity I tried building 0AD to better understand the SM embedding situation there. The compile failed on something, I forget what. Some Collada related thing, maybe? Anyway, yesterday I kicked off a build to recreate the error, and it appears to have built fine? I didn't update the 0ad source.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Jan 14 2021 09:40:27 GMT-0800 (Pacific Standard Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">maybe some header that Fedora updated, perhaps</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Jan 14 2021 09:40:39 GMT-0800 (Pacific Standard Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">could be</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Jan 14 2021 09:40:48 GMT-0800 (Pacific Standard Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">also since thanksgiving we've upgraded from SM45 to 78</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Jan 14 2021 09:40:53 GMT-0800 (Pacific Standard Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">and to C++17</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Jan 14 2021 09:41:01 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">and fixed a lot of bugs</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Jan 14 2021 09:41:03 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, but I didn't pull</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Jan 14 2021 09:41:29 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">ha, then dunno but \o/ I guess</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Jan 14 2021 09:43:30 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">huh? Ok, I'm not so good with git, but my HEAD is eb2fc5c53d0c55de308be6dc5bb7f952cfbc210d which seems to have a Date from 2018.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Jan 14 2021 09:44:16 GMT-0800 (Pacific Standard Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">yeah that's wrong</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Jan 14 2021 09:44:34 GMT-0800 (Pacific Standard Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">the GitHub mirror is <a href="http://GitHub.com/0ad/0ad">GitHub.com/0ad/0ad</a>, HEAD is currently 8e21eca984753c4d148395f8d91bf30adf3f0152</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Jan 14 2021 09:47:11 GMT-0800 (Pacific Standard Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ah! Somehow it looks like I pulled from <a href="https://github.com/Yves-G/0ad">https://github.com/Yves-G/0ad</a></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Jan 14 2021 09:47:21 GMT-0800 (Pacific Standard Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">this might be a checkout I did a few years ago</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Jan 14 2021 09:48:14 GMT-0800 (Pacific Standard Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Probably because Yves was working on the SM38 migration back then</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Jan 14 2021 09:49:29 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">uh, this is a big repo. My pull is at 6% at 136MB.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Jan 14 2021 09:49:47 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">It's about 7GB </td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Jan 14 2021 09:49:53 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">there's art in the git repo</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Jan 14 2021 09:49:56 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">which isn't great</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Jan 14 2021 09:50:24 GMT-0800 (Pacific Standard Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">you can skip some of it by using --depth 1, but not as much as I'd like</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Jan 14 2021 10:16:06 GMT-0800 (Pacific Standard Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Is there a reason why the MovableCellHasher implementation is in Barrier.cpp ? Or is it just for compiling efficiency?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Jan 14 2021 10:20:58 GMT-0800 (Pacific Standard Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Hm. I should know, but I'd guess either compilation speed, or it would pull in stuff that we can otherwise keep out of header files.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Jan 14 2021 10:21:40 GMT-0800 (Pacific Standard Time)">18:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it's using Zone internals, and perhaps that would require pulling in a large header in places we don't want.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Jan 14 2021 10:22:22 GMT-0800 (Pacific Standard Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh, wait. MovableCellHasher is probably exposed publicly, and we don't <em>want</em> to expose everything it needs in its implementation. So that's probably it.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Jan 14 2021 10:23:40 GMT-0800 (Pacific Standard Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Ok, I'm trying to sort out why this isn't compiling on VS17 and I'm not making progress :/</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Jan 14 2021 10:23:47 GMT-0800 (Pacific Standard Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah. js/public/{RootingAPI.h,GCHashTable.h} use MovableCellHasher, and the impl wants gc/Zone.h, which is internal.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Jan 14 2021 10:24:24 GMT-0800 (Pacific Standard Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">when did we (Gecko) drop official support for MSVC?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Jan 14 2021 10:26:00 GMT-0800 (Pacific Standard Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: 2019 maybe? <a href="https://groups.google.com/u/1/g/mozilla.dev.platform/c/me1ZMGgv6mI/m/u0xS5aapGQAJ">https://groups.google.com/u/1/g/mozilla.dev.platform/c/me1ZMGgv6mI/m/u0xS5aapGQAJ</a></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Jan 14 2021 10:26:52 GMT-0800 (Pacific Standard Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">wraitii</span>: what's the error?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Jan 14 2021 10:29:10 GMT-0800 (Pacific Standard Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Unresolved Symbols for MovableCellHasher&lt;Js::Heap&lt;JSObject*&gt;::hash (and a bunch of others, I get different ones on our CI but that's the idea)</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Jan 14 2021 10:29:44 GMT-0800 (Pacific Standard Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">as if it didn't use the specialization</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Jan 14 2021 10:29:57 GMT-0800 (Pacific Standard Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">or used it but somehow silently failed to generate code</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Jan 14 2021 10:32:24 GMT-0800 (Pacific Standard Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">does your version have the explicit <code>#if !MOZ_IS_GCC</code> check?</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Jan 14 2021 10:32:28 GMT-0800 (Pacific Standard Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">#if !MOZ_IS_GCC
template struct JS_PUBLIC_API MovableCellHasher&lt;JSObject*&gt;;
#endif</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Jan 14 2021 10:33:21 GMT-0800 (Pacific Standard Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I don't think so, and I believe MovableCellHasher&lt;JSObject*&gt; compiles</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Jan 14 2021 10:34:08 GMT-0800 (Pacific Standard Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">hm, ok. I was looking at bug 1560064.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Jan 14 2021 10:34:10 GMT-0800 (Pacific Standard Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1560064">https://bugzil.la/1560064</a> — RESOLVED (mail) — js::MovableCellHasher&lt;JSObject*&gt; is not exported when SpiderMonkey is compiled with gcc</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Jan 14 2021 10:34:31 GMT-0800 (Pacific Standard Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I don't think that's it, no.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Jan 14 2021 10:34:37 GMT-0800 (Pacific Standard Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, looks different</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Jan 14 2021 10:34:55 GMT-0800 (Pacific Standard Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">One thing I'm confused by: JS::GCHashMap&lt;JS::Heap&lt;JSObject*&gt;, u32, js::MovableCellHasher&lt;JSObject*&gt;, js::SystemAllocPolicy&gt; seems to compile</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Jan 14 2021 10:35:02 GMT-0800 (Pacific Standard Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">when I would expect to have to write JS::GCHashMap&lt;JS::Heap&lt;JSObject*&gt;, u32, js::MovableCellHasher&lt;JS::Heap&lt;JSObject*&gt;&gt;, js::SystemAllocPolicy&gt;</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Jan 14 2021 10:36:49 GMT-0800 (Pacific Standard Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Should I just use the first?</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Jan 14 2021 10:39:11 GMT-0800 (Pacific Standard Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it must autoconvert everywhere the HashPolicy is used, I guess? It should probably work to use either. HashPolicy will only be reading, and JS::Heap doesn't need read barriers.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Jan 14 2021 10:39:36 GMT-0800 (Pacific Standard Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(and if it did, I would guess it wouldn't be the <em>only</em> read that is happening, so it would still work)</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Jan 14 2021 10:47:43 GMT-0800 (Pacific Standard Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">ok</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Jan 14 2021 10:47:51 GMT-0800 (Pacific Standard Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Given that <em>that</em> compiles with VS17, I think I'll just switch to it</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu Jan 14 2021 10:48:50 GMT-0800 (Pacific Standard Time)">18:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">thanks for the help</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu Jan 14 2021 10:54:46 GMT-0800 (Pacific Standard Time)">18:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">if that causes problems, you might also try throwing a <code>template struct JS_PUBLIC_API MovableCellHasher&lt;JS::Heap&lt;JSObject*&gt;&gt;;</code> into <code>RootingAPI.h</code> or somewhere, and see if that fixes the compile.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu Jan 14 2021 10:59:44 GMT-0800 (Pacific Standard Time)">18:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Tried that, it didn't seem to unfortunately</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu Jan 14 2021 11:00:02 GMT-0800 (Pacific Standard Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">But From testing using MovableCellHasher&lt;JSObject*&gt; seems to work fine</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu Jan 14 2021 11:01:09 GMT-0800 (Pacific Standard Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ok, cool</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu Jan 14 2021 12:13:57 GMT-0800 (Pacific Standard Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: ping</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu Jan 14 2021 12:14:42 GMT-0800 (Pacific Standard Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: pong</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu Jan 14 2021 12:15:19 GMT-0800 (Pacific Standard Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">when there's a pending exception there's usually a pending savedStack --- not 100% but usually</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu Jan 14 2021 12:16:46 GMT-0800 (Pacific Standard Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: but it's not accessible from JS at all, right? I was looking into <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1684043">https://bugzilla.mozilla.org/show_bug.cgi?id=1684043</a> and it occurred to me, we have JS code that tries to send error messages across thread/process boundaries and it probably drops the savedStack on the floor (?)</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu Jan 14 2021 12:17:29 GMT-0800 (Pacific Standard Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: where does <code>.stack</code> get it from?</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu Jan 14 2021 12:18:08 GMT-0800 (Pacific Standard Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">inside the ErrorObject. and (of course) only if it's actually an ErrorObject</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu Jan 14 2021 12:19:25 GMT-0800 (Pacific Standard Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">again—that should usually be good enough by itself</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu Jan 14 2021 12:19:31 GMT-0800 (Pacific Standard Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">but, sometimes it's not</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu Jan 14 2021 12:20:21 GMT-0800 (Pacific Standard Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">actually you should use <code>ExceptionStack::stack()</code> for pending exceptions</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Thu Jan 14 2021 12:20:35 GMT-0800 (Pacific Standard Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">otherwise it only works for error objects as you said</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Thu Jan 14 2021 12:22:51 GMT-0800 (Pacific Standard Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">and we can structure clone stacks and send them across process: <a href="https://searchfox.org/mozilla-central/source/dom/ipc/ContentChild.cpp#488">https://searchfox.org/mozilla-central/source/dom/ipc/ContentChild.cpp#488</a></td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Thu Jan 14 2021 12:23:36 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Ooh, good to know. But still, this means if someone has written code to do this in JS, they cannot get it right. Right?</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Thu Jan 14 2021 12:24:01 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">normal JS no</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Thu Jan 14 2021 12:24:04 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">not sure about chrome JS</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Thu Jan 14 2021 12:25:15 GMT-0800 (Pacific Standard Time)">20:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">yeah, you'd need a method that basically implements try-catch but also catches the stack</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Thu Jan 14 2021 12:25:21 GMT-0800 (Pacific Standard Time)">20:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">it's annoyingly secret</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Thu Jan 14 2021 12:25:42 GMT-0800 (Pacific Standard Time)">20:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">there is also window.onerror</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Thu Jan 14 2021 12:25:53 GMT-0800 (Pacific Standard Time)">20:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I am actually not completely sure what you are getting at</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Thu Jan 14 2021 12:27:52 GMT-0800 (Pacific Standard Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Do you know what this code is? <a href="https://searchfox.org/mozilla-central/source/toolkit/components/promiseworker/worker/PromiseWorker.js#179">https://searchfox.org/mozilla-central/source/toolkit/components/promiseworker/worker/PromiseWorker.js#179</a></td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Thu Jan 14 2021 12:28:30 GMT-0800 (Pacific Standard Time)">20:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: (what I'm getting at:) I'm trying to figure out how we end up with bugs like this one, where a JS error happened but with no info at all <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1621861">https://bugzilla.mozilla.org/show_bug.cgi?id=1621861</a></td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Thu Jan 14 2021 12:29:04 GMT-0800 (Pacific Standard Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">ah a righteous cause</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Thu Jan 14 2021 12:29:45 GMT-0800 (Pacific Standard Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I tried debugging a few of these "no exception info" at all bugs</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Thu Jan 14 2021 12:29:54 GMT-0800 (Pacific Standard Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">it's usually a bad interaction with XPCOM</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Thu Jan 14 2021 13:00:53 GMT-0800 (Pacific Standard Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: If gijs wanted to try this idea of crashing whenever someone throws something that isn't an ErrorObject, is this the right place to do it? <a href="https://searchfox.org/mozilla-central/source/xpcom/base/CycleCollectedJSRuntime.cpp#1878">https://searchfox.org/mozilla-central/source/xpcom/base/CycleCollectedJSRuntime.cpp#1878</a></td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Thu Jan 14 2021 13:01:12 GMT-0800 (Pacific Standard Time)">21:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: understanding he's going to have to disable a lot of JS language tests</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Thu Jan 14 2021 13:02:20 GMT-0800 (Pacific Standard Time)">21:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">Or maybe not, since he would be crashing only if <em>system</em> code does it</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Thu Jan 14 2021 13:02:38 GMT-0800 (Pacific Standard Time)">21:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">seems reasonable? I was going to suggest JSContext::setPendingException, but that calls that code apparently</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Thu Jan 14 2021 13:02:45 GMT-0800 (Pacific Standard Time)">21:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I hadn't looked at this code before</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Thu Jan 14 2021 13:02:52 GMT-0800 (Pacific Standard Time)">21:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">right, and he wants to call some <code>xpc::</code> method to check for systemness</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Thu Jan 14 2021 13:03:07 GMT-0800 (Pacific Standard Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">i have a feeling something will still manage to go horribly wrong with this idea, but</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Thu Jan 14 2021 13:03:10 GMT-0800 (Pacific Standard Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">we'll see i guess</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Thu Jan 14 2021 13:33:54 GMT-0800 (Pacific Standard Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dana:mozilla.org">dana</span>&gt;</div></td><td class="msg-cell">hi folks - would anyone know if there's a particular reason why loading a js (es6) module in a chrome:// xhtml resource wouldn't work?</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Thu Jan 14 2021 13:34:14 GMT-0800 (Pacific Standard Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dana:mozilla.org">dana</span>&gt;</div></td><td class="msg-cell">(vs. an .html resource, which appears to work just fine)</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Thu Jan 14 2021 13:59:33 GMT-0800 (Pacific Standard Time)">21:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">hmm.. I wonder if we have any of the ES-module machinery hooked up to ChromeScriptLoader ..Edit: nope, the ChromeScriptLoader is only for specific ChromeUtils cases and unrelated</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Thu Jan 14 2021 14:23:13 GMT-0800 (Pacific Standard Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">dana</span>: what is your script tag in the xhtml case?</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Thu Jan 14 2021 14:24:06 GMT-0800 (Pacific Standard Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dana:mozilla.org">dana</span>&gt;</div></td><td class="msg-cell">my example is in that patch</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Thu Jan 14 2021 14:24:23 GMT-0800 (Pacific Standard Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dana:mozilla.org">dana</span>&gt;</div></td><td class="msg-cell">(we're also discussing this in #DOM, fyi)</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Thu Jan 14 2021 14:51:09 GMT-0800 (Pacific Standard Time)">22:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(Looks like xhtml case triggers an additional cache system (XUL cache) which does not support es-modules. None of our script caches do at the moment .. )</td></tr>

</tbody></table></div></div></div>
</body></html>