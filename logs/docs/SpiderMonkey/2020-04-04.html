<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-04-04</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-04-04<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-04-03" class="nav-link"><span>prev</span></a>
<a href="2020-04-05" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Apr 03 2020 17:31:50 GMT-0700 (Pacific Daylight Time)">00:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">So this piping stuff is pretty frequently wanting to register <code>NewHandler</code> functions to react to stuff -- where such functions are essentially a C++ function pointer and a single <code>PipeToState*</code> object value.  Is there any reason we can't have/introduce some sort of new way of recording a reaction, that records just those two values, rather than requiring creation of a full closure object and its associated GC pressure?  Doesn't <em>seem</em> like it to me, at least conceptually.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Apr 03 2020 17:32:41 GMT-0700 (Pacific Daylight Time)">00:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">A similar sort of consideration probably applies to how we implement <code>ReadableStream.prototype.tee</code>.  And I wouldn't be surprised if there are other potential consumers I wouldn't know about.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sat Apr 04 2020 12:10:27 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@aholm:matrix.org">aholm</span>&gt;</div></td><td class="msg-cell"><p>I'm using FF Developer Edition, and when I try to use the URL API, I get this error</p>
<pre><code>let aa = new URL("/", m);
TypeError: URL is not a constructor
</code></pre>
<p>(this was in the devtools console)<br>despite MDN showing FF supporting the URL API</p>
</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sat Apr 04 2020 12:19:07 GMT-0700 (Pacific Daylight Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">if you have an object with a custom JSClassOps, the idiom I've been using normally to figure out whether one of the ClassOps is being called on the prototype or an instance, is to not set private data on the prototype object, and check whether JS_GetPrivate returns null. what's the recommended idiom if you don't need to store private data at all, though?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sat Apr 04 2020 12:19:44 GMT-0700 (Pacific Daylight Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">give the class a reserved slot and store <code>true</code> in it if it's the prototype, for example?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sat Apr 04 2020 12:40:31 GMT-0700 (Pacific Daylight Time)">19:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">you could maybe just create a plain object as the prototype?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sat Apr 04 2020 12:41:01 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">internally we use this approach: <a href="https://searchfox.org/mozilla-central/source/js/src/builtin/MapObject.cpp#1146-1166">https://searchfox.org/mozilla-central/source/js/src/builtin/MapObject.cpp#1146-1166</a></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sat Apr 04 2020 12:41:38 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">we have a different class for the proto, because for annoying reasons (Xrays) we have to share protokeys with instances and proto</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sat Apr 04 2020 12:52:28 GMT-0700 (Pacific Daylight Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah the spec has been moving away from the prototype being an instance </td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sat Apr 04 2020 13:27:40 GMT-0700 (Pacific Daylight Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: thanks, will study that!</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sat Apr 04 2020 13:29:59 GMT-0700 (Pacific Daylight Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">I have not seen ClassSpec before</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sat Apr 04 2020 16:37:51 GMT-0700 (Pacific Daylight Time)">23:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><code>JS_InitClass</code> is not really an idiom well-designed for the modern world.  We probably would design something new that is a better fit, but all the JS stuff needs to be custom for spec reasons and efficiency, and DOM stuff is also highly specialized and not amenable to an initclass-like approach that works better.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sat Apr 04 2020 16:38:38 GMT-0700 (Pacific Daylight Time)">23:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">We keep <code>JS_InitClass</code> around mostly to not break embedders as it's harmless to us if we never use it, but that's about the only reason it still exists.</td></tr>

</tbody></table></div></div></div>
</body></html>