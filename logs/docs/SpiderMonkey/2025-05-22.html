<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-05-22</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-05-22<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-05-21" class="nav-link"><span>prev</span></a>
<a href="2025-05-23" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu May 22 2025 12:39:59 GMT-0700 (Pacific Daylight Time)">19:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">What is the protocol for "geez that's a lot of time spent in GC/CC" type issues? (I'm triaging a bug where high memory and CPU use were reported and they included a profile that shows us in Incremental CC for at least the entire 5.7s of the profile.)</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu May 22 2025 12:41:21 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">That's basically a normal thing that happens when you are leaking a lot of DOM stuff. The CC is pretty slow and leaked things can't be skipped easily by the CC so you get mega hangs. You need to figure out what is leaking and why.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu May 22 2025 13:07:17 GMT-0700 (Pacific Daylight Time)">20:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jlink:mozilla.org">jlink</span>&gt;</div></td><td class="msg-cell">So there isn't any mechanism to try and do incremental CC ... incrementally? I was thinking that there was something in place to try and do only a certain amount of work each time through. Am I mis-remembering?
The particular profile that I have doesn't have a whole lot in the way of markers (possibly the profile was ended too soon) but is there any marker that could tell how many "things" (GCThings, I presume) that we had to sort through in the CC? I'd like to get some idea how many is a lot.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu May 22 2025 13:11:44 GMT-0700 (Pacific Daylight Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Yes, cycle collection is done incrementally, but there's a basic limitation that we can't GC at the same time as we're doing an incremental CC, so when we decide we need to GC, we have to synchronously finish the CC. There's a fundamental trickiness where the CC will have anywhere from 5ms to 5s of work to do.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu May 22 2025 13:14:04 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">GC things are allocated in the GC heap. The CC traverses a combination of JS GC things and C++ DOM objects, although in the instance of a super slow CC, it is usually 90% or more GC things. We do gather some stats on the CC graph but I'm not sure if we expose that to the profiler.</td></tr>

</tbody></table></div></div></div>
</body></html>