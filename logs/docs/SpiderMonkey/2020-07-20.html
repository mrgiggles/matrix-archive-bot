<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-07-20</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-07-20<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-07-19" class="nav-link"><span>prev</span></a>
<a href="2020-07-21" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Jul 19 2020 23:04:12 GMT-0700 (Pacific Daylight Time)">06:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>, <span class="nick-12">sfink</span> <span class="nick-16">@allstarschh|afk</span> Hi GC folk.  I'm working on memshrink stuff for fission and I'll be visiting the GC and maybe the JS engine a little bit.  A while ago it was suggested that we move the GCTelemetry code from JS to C++ because it'll consume less memory.  But I don't know if anyone is actually using this, last time I asked no-one used it. This is the complex objects that describe whole GC events.  Because no-one uses them I propose to remove them completely, is that cool with you?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jul 20 2020 00:58:01 GMT-0700 (Pacific Daylight Time)">07:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">pbone</span>: Hi Paul.  Is this the JSON telemetry data added in bug 1308040?  We are not using that as far as I know.  If that's what you mean I'm happy for that to be removed.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jul 20 2020 00:58:05 GMT-0700 (Pacific Daylight Time)">07:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1308040">https://bugzil.la/1308040</a> — RESOLVED (billm) — Better GC telemetry</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jul 20 2020 02:11:04 GMT-0700 (Pacific Daylight Time)">09:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">chaircrusher</span>: taint tracing is the general principle, which comes from the principle that data can be converted from one type to another. I guess setting any string dirty except when they are issued from a specific location is a shortcut which avoid more advanced taint tracing and analysis.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jul 20 2020 03:05:36 GMT-0700 (Pacific Daylight Time)">10:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@pbone:mozilla.org">pbone</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: Yep. that one. Thanks, I know I've asked about it before and I thought the answer was "no" but wanted to double check incase things changed.  We can always reimplement it or something like it in C++ if we need to later.  FWIW I like the profiler better anyway.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jul 20 2020 07:57:59 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: hey, quick question about private methods: how to pref them</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jul 20 2020 07:58:31 GMT-0700 (Pacific Daylight Time)">14:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: is it likely we will want to ship private fields without private methods? if extremely unlikely, then <span class="nick-16">avandolder</span> can piggy-back on the existing pref</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jul 20 2020 07:58:54 GMT-0700 (Pacific Daylight Time)">14:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">but if it's plausible, he has to make a new one</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jul 20 2020 09:21:38 GMT-0700 (Pacific Daylight Time)">16:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: sorry for the delay. I'd use the same pref -- I'm OK with waiting till methods are complete before we ship the whole thing</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jul 20 2020 09:21:58 GMT-0700 (Pacific Daylight Time)">16:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">avandolder</span>: ☝️</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jul 20 2020 09:22:39 GMT-0700 (Pacific Daylight Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@avandolder:mozilla.org">avandolder</span>&gt;</div></td><td class="msg-cell">Sounds good</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jul 20 2020 09:23:04 GMT-0700 (Pacific Daylight Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">avandolder</span>: So you're doing methods? Lemme know if there are any questions. You'll want to build off of <a href="https://phabricator.services.mozilla.com/D83941">https://phabricator.services.mozilla.com/D83941</a> which has CheckPrivateField, which was designed to make the brand checks for methods substantially easier</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jul 20 2020 09:23:21 GMT-0700 (Pacific Daylight Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Not yet reviewed and landed) </td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jul 20 2020 09:24:18 GMT-0700 (Pacific Daylight Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: did you add a new slot for expandos to all proxies?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jul 20 2020 09:24:29 GMT-0700 (Pacific Daylight Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: Yes.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jul 20 2020 09:24:57 GMT-0700 (Pacific Daylight Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(I mean, that patch bounced this morning. But yes, that's the design. For DOM proxies that have a pre-existing expando, we piggy back on that. </td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jul 20 2020 09:25:07 GMT-0700 (Pacific Daylight Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">but the slot is there regardless)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jul 20 2020 09:25:21 GMT-0700 (Pacific Daylight Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">so we re-use the same slot for DOM proxies?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jul 20 2020 09:25:38 GMT-0700 (Pacific Daylight Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I don't really care about normal proxies, but DOM proxies are somewhat important</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jul 20 2020 09:26:25 GMT-0700 (Pacific Daylight Time)">16:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">(in the sense that I don't want us to waste slots)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jul 20 2020 09:26:47 GMT-0700 (Pacific Daylight Time)">16:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">We re-use the same slot and expando yes; but, we do have an empty slot. </td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jul 20 2020 09:27:09 GMT-0700 (Pacific Daylight Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">mhm ok. You mean pre-existing?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jul 20 2020 09:27:25 GMT-0700 (Pacific Daylight Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: see <a href="https://phabricator.services.mozilla.com/D83145">https://phabricator.services.mozilla.com/D83145</a> Proxy.h</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Jul 20 2020 09:30:54 GMT-0700 (Pacific Daylight Time)">16:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Adding an unused slot to DOM proxies isn't great</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Jul 20 2020 09:33:24 GMT-0700 (Pacific Daylight Time)">16:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I really wish we wouldn't have to support private names on proxies at all :/</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Jul 20 2020 09:35:40 GMT-0700 (Pacific Daylight Time)">16:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I definitely agree; but it's hard to avoid. </td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Jul 20 2020 09:37:30 GMT-0700 (Pacific Daylight Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">The alternative implementations I've thought about either really impact performance, or implementation complexity or both</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Jul 20 2020 09:39:00 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I am still busy at the moment. I will have a closer look in a few weeks</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Jul 20 2020 09:44:06 GMT-0700 (Pacific Daylight Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Given I've been backed out, what I'll do is take some time to do some memory tests. </td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Jul 20 2020 09:45:49 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">So we have a clear view of what we're looking at; then i can also open a followup bug to see if we can't find something more clever. The good news is that for -proxies- I'm OK with slowness. I'd prefer still to have as little complexity as possible though. </td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Jul 20 2020 11:52:52 GMT-0700 (Pacific Daylight Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: js/public/RootingAPI.h contains a line <code>static void rekey(Key&amp; k, const Key&amp; newKey) { k.unsafeSet(newKey); }</code> that I'm pretty sure would never compile; but it's apparently never instantiated</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Jul 20 2020 11:53:04 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: do you want a bug for this, or nah</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Jul 20 2020 11:53:36 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">bug please, yes</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Jul 20 2020 12:05:25 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>:  you got it, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1654058">https://bugzilla.mozilla.org/show_bug.cgi?id=1654058</a></td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Jul 20 2020 12:06:06 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">thx</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Jul 20 2020 15:02:02 GMT-0700 (Pacific Daylight Time)">22:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Landed preliminary proxy support for private fields (twice). Fought various test harnesses for a good chunk of time; working on enhancing test coverage and shaking out any bugs I -can- find. </td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Jul 20 2020 15:02:05 GMT-0700 (Pacific Daylight Time)">22:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>

</tbody></table></div></div></div>
</body></html>