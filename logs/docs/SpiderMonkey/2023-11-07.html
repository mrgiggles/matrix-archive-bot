<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-11-07</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-11-07<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-11-06" class="nav-link"><span>prev</span></a>
<a href="2023-11-08" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Nov 07 2023 03:33:48 GMT-0800 (Pacific Standard Time)">11:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: hi, thank you for your comment on bug 1863467.  now I'm wondering, how should I think about the static data when talking about memory consumption?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Nov 07 2023 03:33:51 GMT-0800 (Pacific Standard Time)">11:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1863467">https://bugzil.la/1863467</a> â€” NEW (nobody) â€” Can permanent atoms zone and table be stored as static data?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Nov 07 2023 03:35:40 GMT-0800 (Pacific Standard Time)">11:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if a static data (such as <code>WellKnownAtomInfo</code> array <a href="https://searchfox.org/mozilla-central/rev/e94bcd536a2a4caad0597d1b2d624342e6a389c4/js/src/vm/WellKnownAtom.h#40-44,46">here</a>) is loaded (mmaped, maybe?), is it treated in the same way as things dynamically allocated on heap?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Nov 07 2023 03:36:11 GMT-0800 (Pacific Standard Time)">11:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: oh hey, was just writing a followup comment</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Nov 07 2023 03:38:29 GMT-0800 (Pacific Standard Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I was thinking that not all systems mmap executables - in particular I don't know if Android does (IIRC you can't map some times of flash storage)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Nov 07 2023 03:39:48 GMT-0800 (Pacific Standard Time)">11:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1863347">https://bugzil.la/1863347</a> ðŸŽ‰</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Nov 07 2023 03:41:38 GMT-0800 (Pacific Standard Time)">11:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if a static data (such as <code>WellKnownAtomInfo</code> array <a href="https://searchfox.org/mozilla-central/rev/e94bcd536a2a4caad0597d1b2d624342e6a389c4/js/src/vm/WellKnownAtom.h#40-44,46">here</a>) is loaded (mmaped, maybe?), is it treated in the same way as things dynamically allocated on heap?</blockquote></mx-reply>treated the same in which way?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Nov 07 2023 03:42:27 GMT-0800 (Pacific Standard Time)">11:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">storing atom data in the executable should work, except it's tricky as you noted because of alignment and ensuring the data structures match</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Nov 07 2023 03:43:39 GMT-0800 (Pacific Standard Time)">11:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I mean, is there any difference between "having 100kB of static data" vs "malloc 100kB data and fill it", in term of how it affects memory consumption?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Nov 07 2023 03:45:21 GMT-0800 (Pacific Standard Time)">11:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'm not sure there is.  It has to live in pysical RAM somewhere.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Nov 07 2023 03:46:24 GMT-0800 (Pacific Standard Time)">11:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, then moving JSAtom into static data itself doesn't impact the memory consumption</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Nov 07 2023 03:46:51 GMT-0800 (Pacific Standard Time)">11:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the remaining thing is that we can remove the source data (<code>WellKnownAtomInfo</code>) from the binary</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Nov 07 2023 03:47:28 GMT-0800 (Pacific Standard Time)">11:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it has length, hash, and the text content.  all of them can be moved to JSAtom itself (or referred buffer)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Nov 07 2023 03:49:03 GMT-0800 (Pacific Standard Time)">11:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">So looking up an well known atom would just index into the zone somehow? </td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Nov 07 2023 03:50:02 GMT-0800 (Pacific Standard Time)">11:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">That's not trivial - there are different kinds of atom (FAT_INLINE_ATOM and plain ATOM)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Nov 07 2023 03:50:53 GMT-0800 (Pacific Standard Time)">11:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">One other issue is that the GC currently decommits unused parts of chunks. I don't know if that would be possible with a static chunk that was part of the binary.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Nov 07 2023 03:52:38 GMT-0800 (Pacific Standard Time)">11:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I was thinking that the lookup part remains same, except that the table points is also statically allocated and the table's field points the static data (maybe with pointer, or maybe offset)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Nov 07 2023 03:53:03 GMT-0800 (Pacific Standard Time)">11:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, I was looking into the commit/decommit part and that seems to be problematic with static data</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Nov 07 2023 03:53:15 GMT-0800 (Pacific Standard Time)">11:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Aha, yes that would work</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Nov 07 2023 03:54:13 GMT-0800 (Pacific Standard Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>does GC modify the atom zone data after <code>freezeSharedAtomsZone</code> ? <a href="https://searchfox.org/mozilla-central/rev/e94bcd536a2a4caad0597d1b2d624342e6a389c4/js/src/vm/JSAtomUtils.cpp#311">https://searchfox.org/mozilla-central/rev/e94bcd536a2a4caad0597d1b2d624342e6a389c4/js/src/vm/JSAtomUtils.cpp#311</a></p>
<pre><code class="language-cpp">if (!gc.freezeSharedAtomsZone()) {
</code></pre>
</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Nov 07 2023 03:54:51 GMT-0800 (Pacific Standard Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">it does not</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Nov 07 2023 03:55:01 GMT-0800 (Pacific Standard Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the modification happens only before that, we <em>could</em> generate the corresponding flags bits statically</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Nov 07 2023 03:55:18 GMT-0800 (Pacific Standard Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(it would be very complex tho...)</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Nov 07 2023 03:55:59 GMT-0800 (Pacific Standard Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">do you mean the mark bits or something else? </td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Nov 07 2023 03:57:03 GMT-0800 (Pacific Standard Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the zone's fields, arena's fields, chunk's field, and the actual JSAtom fields</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Nov 07 2023 03:57:22 GMT-0800 (Pacific Standard Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(it's first time looking into this parts.  maybe I'm missing something)</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Nov 07 2023 03:58:19 GMT-0800 (Pacific Standard Time)">11:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">arena, chunk and atom - these would be part of the static data and would have to be pre-generated</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Nov 07 2023 03:58:31 GMT-0800 (Pacific Standard Time)">11:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">zone - would could set this up dynamically</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Nov 07 2023 03:59:23 GMT-0800 (Pacific Standard Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">do you know how you would make the chunk aligned if it was part of the binary?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Nov 07 2023 04:00:55 GMT-0800 (Pacific Standard Time)">12:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I've experimented with <code>alignas</code> on a struct, and I get aligned pointer, even with <code>alignas</code> with 1MB</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Nov 07 2023 04:03:05 GMT-0800 (Pacific Standard Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Nice!</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Nov 07 2023 04:03:25 GMT-0800 (Pacific Standard Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Might be worth check that all toolchains support that</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Nov 07 2023 04:03:59 GMT-0800 (Pacific Standard Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, I've tested on clang, but not on others. I'll check</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Nov 07 2023 05:37:31 GMT-0800 (Pacific Standard Time)">13:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell"><p>I have a stupid question that will probably be more expedient to ask than to test (the build is taking a while): If i remember correctly, if we have the following html page:</p>
<pre><code>&lt;script src="./myjs.js"&gt;
&lt;script src="./myjs.js"&gt;
</code></pre>
<p>it should only load once.<br>If we have a nonce, (and this is where I am not sure) it should still only load once?</p>
<pre><code>&lt;script src="./myjs.js" nonce="1"&gt;
&lt;script src="./myjs.js" nonce="2"&gt;
</code></pre>
</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Nov 07 2023 06:06:46 GMT-0800 (Pacific Standard Time)">14:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: the memory cache and the reuse-ongoing-fetches behavior that browsers implement is not specified yet. See <a href="https://github.com/whatwg/fetch/issues/1400">https://github.com/whatwg/fetch/issues/1400</a> , <a href="https://github.com/whatwg/html/issues/2465">https://github.com/whatwg/html/issues/2465</a></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Nov 07 2023 06:08:06 GMT-0800 (Pacific Standard Time)">14:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: I'm not aware of <code>nonce</code> affecting the fetching though</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Nov 07 2023 06:13:45 GMT-0800 (Pacific Standard Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">Thanks, that explains why I wasn't able to find it in the spec, but that the code expects single loads per urls</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Nov 07 2023 06:14:58 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">We have a bug that results from a double loading of a tracked url: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1849519">https://bugzilla.mozilla.org/show_bug.cgi?id=1849519</a></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Nov 07 2023 06:15:23 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">One thought I have is: we should probably decouple this from the scriptLoadContext</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Nov 07 2023 06:17:09 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">but, on the other hand, we shouldn't be loading this file twice anyway, and it looks like there is a race condition. I think that race might occur somewhere upstream, maybe here? <a href="https://searchfox.org/mozilla-central/source/dom/script/ScriptElement.cpp#126">https://searchfox.org/mozilla-central/source/dom/script/ScriptElement.cpp#126</a></td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Nov 07 2023 06:17:27 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">I haven't gotten that far yet, I just wanted to make sure my expectation was correct</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Nov 07 2023 06:24:47 GMT-0800 (Pacific Standard Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">hm, my pernosco session seems to be down for now</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Nov 07 2023 07:57:33 GMT-0800 (Pacific Standard Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> okay, then moving JSAtom into static data itself doesn't impact the memory consumption</blockquote></mx-reply>Read only static data that does not contain pointers reduces memory usage, because the same memory can be used for all processes. With Fission, we have a large number of processes. If it does contain pointers, then it has to deal with the memory living at different addresses in different processes. I think maybe on Windows you'll still save memory but not Linux or MacOS. Unless the fork server is in use and then maybe?</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Nov 07 2023 07:58:58 GMT-0800 (Pacific Standard Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">You can try AWSY base to measure content process overhead. In about:memory terms, static pointerless data will continue to use resident (and thus address space) but not resident-unique.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Nov 07 2023 08:21:17 GMT-0800 (Pacific Standard Time)">16:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">mccr8: good point!</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Nov 07 2023 08:22:08 GMT-0800 (Pacific Standard Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">In this case, we probably need to put a pointer to the zone in arenas in the static data.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Nov 07 2023 08:22:49 GMT-0800 (Pacific Standard Time)">16:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">(I say probably because maybe nothing reads the zone from permanent atoms... so maybe we could get away without?  but this is getting pretty fragile and hacky)</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Nov 07 2023 11:55:18 GMT-0800 (Pacific Standard Time)">19:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: We see a hasOwnProperty IonIC under <code>shallowEqual</code> on react. But objB is monomorphic (the shape is always the same). Why would this be?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Nov 07 2023 11:59:31 GMT-0800 (Pacific Standard Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">jrmuizel</span>: I would guess it's because there are 2-6 distinct properties being checked. We attach a different stub per-property. If there were more than 6, then we would transition to megamorphic mode and attach a megamorphic hasprop.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Nov 07 2023 12:00:04 GMT-0800 (Pacific Standard Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">there are three distinct properties being checked</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Nov 07 2023 12:00:38 GMT-0800 (Pacific Standard Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Right, makes sense.</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Nov 07 2023 12:01:53 GMT-0800 (Pacific Standard Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">With 3 properties, it's likely that the Ion IC chain is faster than looking it up in the megamorphic property cache.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Nov 07 2023 15:45:39 GMT-0800 (Pacific Standard Time)">23:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, so I should be careful not to put pointers when creating large static data.  that applies also to the current prototype of the atomization patch stack, and also the current m-c, which uses an array of (length,hash,pointer) (<a href="https://searchfox.org/mozilla-central/rev/02841791400cf7cf5760c0cfaf31f5d772624253/js/src/vm/WellKnownAtom.h#46">WellKnownAtomInfo</a>), and rewriting it to use index would reduce the total memory consumption with multiple processes</td></tr>

</tbody></table></div></div></div>
</body></html>