<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-04-01</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-04-01<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-03-31" class="nav-link"><span>prev</span></a>
<a href="2020-04-02" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Mar 31 2020 19:27:13 GMT-0700 (Pacific Daylight Time)">02:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">in GNOME we have an "interesting" backwards compatibility problem that other spidermonkey embedders might have, I thought someone here might have some good ideas</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Mar 31 2020 19:27:44 GMT-0700 (Pacific Daylight Time)">02:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">exposing C APIs into JS that return 64-bit numbers, you always run the risk that the return value is larger than Number.MAX_SAFE_INTEGER</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Mar 31 2020 19:28:18 GMT-0700 (Pacific Daylight Time)">02:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">in the old days we just converted these into Numbers, and logged a warning in C++ before the conversion, if the value was unsafe</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Mar 31 2020 19:28:26 GMT-0700 (Pacific Daylight Time)">02:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">now we have BigInt in ESR68!</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Mar 31 2020 19:29:09 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">C APIs that take a 64-bit int as a parameter are easy to convert, we just accept either a Number or a BigInt</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Mar 31 2020 19:29:33 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">but C APIs that return a 64-bit int, the trick is to do it without breaking all of GNOME's code</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Mar 31 2020 19:29:58 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">if we just start returning BigInt from those APIs then they will break everywhere</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Mar 31 2020 19:30:32 GMT-0700 (Pacific Daylight Time)">02:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">has anyone else ever dealt with constraints like these?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Mar 31 2020 19:31:01 GMT-0700 (Pacific Daylight Time)">02:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">we have some brainstorming in <a href="https://gitlab.gnome.org/GNOME/gjs/-/merge_requests/412">https://gitlab.gnome.org/GNOME/gjs/-/merge_requests/412</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Mar 31 2020 20:22:19 GMT-0700 (Pacific Daylight Time)">03:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span> or anyone else around: Do you have any thoughts on who would be good to loop into reviewing <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1601179">https://bugzilla.mozilla.org/show_bug.cgi?id=1601179</a> ?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Mar 31 2020 20:24:37 GMT-0700 (Pacific Daylight Time)">03:24</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@arai:mozilla.org">arai</span></div></td><td class="msg-cell">looks</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Mar 31 2020 20:46:37 GMT-0700 (Pacific Daylight Time)">03:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what I can think of is, people in bug 1280819</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Mar 31 2020 20:46:38 GMT-0700 (Pacific Daylight Time)">03:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1280819">https://bugzil.la/1280819</a> — NEW (nobody) — Disable async stacks by default in more cases</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Mar 31 2020 20:46:50 GMT-0700 (Pacific Daylight Time)">03:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and <span class="nick-6">jorendorff</span></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Mar 31 2020 20:56:45 GMT-0700 (Pacific Daylight Time)">03:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: thanks!</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Mar 31 2020 21:19:10 GMT-0700 (Pacific Daylight Time)">04:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: Honestly, I don't think you have a good solution here that preserves all the existing API uses.  I would probably be inclined to create new, different APIs that always return a <code>BigInt</code>.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Mar 31 2020 22:38:49 GMT-0700 (Pacific Daylight Time)">05:38</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span></div></td><td class="msg-cell">rebuilds SpiderMonkey a bunch of times in non-unified mode to test his patches properly</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Apr 01 2020 01:49:09 GMT-0700 (Pacific Daylight Time)">08:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">sefeng</span>: the WindowNamedPropertiesHandler is the proxy handler for the named properties object (<a href="https://heycam.github.io/webidl/#named-properties-object">https://heycam.github.io/webidl/#named-properties-object</a>) for a Window object</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Apr 01 2020 01:50:04 GMT-0700 (Pacific Daylight Time)">08:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">sefeng</span>: so it's the prototype of the Window object which is the global object</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Apr 01 2020 01:55:19 GMT-0700 (Pacific Daylight Time)">08:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">sefeng</span>: sorry, the second object on the prototype chain of a Window object</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Apr 01 2020 01:57:51 GMT-0700 (Pacific Daylight Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@pvanderbeken:mozilla.org">peterv</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">sefeng</span>: so you could do Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(this)), "iframeName") in a page with a &lt;iframe name="iframeName"&gt;</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Apr 01 2020 06:05:05 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">confession: Add SMDOC for js::BaseScript (Bug 1622589)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Apr 01 2020 06:05:09 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Apr 01 2020 06:05:10 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1622589">https://bugzil.la/1622589</a> — ASSIGNED (tcampbell) — Add SMDOC for js::BaseScript</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Apr 01 2020 07:39:06 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">confession: Time to consider LazyScript / JSScript unified! Closing Bug 1529456.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Apr 01 2020 07:39:10 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1529456">https://bugzil.la/1529456</a> — RESOLVED (tcampbell) — [meta] Unify JSScript and LazyScript types</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Apr 01 2020 08:46:58 GMT-0700 (Pacific Daylight Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-13">ptomato</span>: Honestly, I don't think you have a good solution here that preserves all the existing API uses.  I would probably be inclined to create new, different APIs that always return a <code>BigInt</code>.</blockquote></mx-reply>yeah, that's what I was afraid of ... we autogenerate our APIs from C API description, so creating different ones is not an option, but I think the best course open to us is to add renamed versions of the same APIs, with <code>_bigint</code> appended or something like that. thanks for the advice.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Apr 01 2020 09:18:17 GMT-0700 (Pacific Daylight Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">tcampbell's bug is bug 1626132</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Apr 01 2020 09:18:18 GMT-0700 (Pacific Daylight Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1626132">https://bugzil.la/1626132</a> — NEW (nobody) — Large CycleCollector pause on new Slack UI</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Apr 01 2020 09:36:16 GMT-0700 (Pacific Daylight Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Hmm.. collecting CC log is just spinning a thread in parent process</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Apr 01 2020 09:44:38 GMT-0700 (Pacific Daylight Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: Your "best course" is what I meant by "creating different ones", so we seem to be in agreement.  :-)</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Apr 01 2020 09:52:54 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Argh. gcc 9 is getting too smart. I'm trying to avoid a warning that I'm passing a nullptr to a function, and trying to hide it in a function <code>static const char* zero() { return uintptr_t(&amp;zero) == 0x1 ? "never happens" : nullptr; }</code></td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Apr 01 2020 09:53:04 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">gcc <em>still</em> knows that I'm passing nullptr</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Apr 01 2020 09:53:15 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">if I replace <code>0x1</code> with <code>0xdeadbee0</code>, it works.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Apr 01 2020 09:54:07 GMT-0700 (Pacific Daylight Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><code>0xdeadbeef</code> does not work. I guess it knows the function is going to be aligned?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Apr 01 2020 09:56:01 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><code>0x2</code> also works! Wtf? If it knows it's aligned, surely it knows it'll be aligned on more than a 2 byte boundary??!</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Apr 01 2020 09:56:10 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I believe in principle implementations are permitted to know that numbers that are not synthesized from actual pointers, need not be treated as if they were the legitimate address that equals a valid pointer.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Apr 01 2020 09:56:29 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">But it sounds like that's not the behavior you're seeing.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Apr 01 2020 09:58:47 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, you're right that it would be fair to always return false or something. Or even always return true, though that would be mean.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Apr 01 2020 12:24:31 GMT-0700 (Pacific Daylight Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">if we build spidermonkey standalone and don't pass --enable-optimize, is it still optimized by default?</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Apr 01 2020 12:25:04 GMT-0700 (Pacific Daylight Time)">19:25</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-3" title="@jdm:mozilla.org">jdm</span></div></td><td class="msg-cell">reads <a href="https://github.com/servo/mozjs/blob/8c64c9441cc5941089c192af262d19fbc7f82580/mozjs/build/moz.configure/toolchain.configure#L33-L48">https://github.com/servo/mozjs/blob/8c64c9441cc5941089c192af262d19fbc7f82580/mozjs/build/moz.configure/toolchain.configure#L33-L48</a> and wonders if that assumption is false</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Apr 01 2020 12:25:17 GMT-0700 (Pacific Daylight Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: What about playing a bell every time you do it?  <a href="https://twitter.com/jfbastien/status/1245362601367760896">https://twitter.com/jfbastien/status/1245362601367760896</a></td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Apr 01 2020 12:25:39 GMT-0700 (Pacific Daylight Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">(handwaving the exact point at which this becomes UB)</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Apr 01 2020 12:56:50 GMT-0700 (Pacific Daylight Time)">19:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that would, uh, "work"</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Apr 01 2020 13:33:49 GMT-0700 (Pacific Daylight Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">jdm</span>: I believe it is optimized by default. The <code>js_option</code> line usually has the non-default state in it</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Apr 01 2020 13:35:19 GMT-0700 (Pacific Daylight Time)">20:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, seems to be optimized by default</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Apr 01 2020 13:38:15 GMT-0700 (Pacific Daylight Time)">20:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">curious; running sunspider in a build without an explicit --enable-optimize and one with it shows a significant difference</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Apr 01 2020 13:38:25 GMT-0700 (Pacific Daylight Time)">20:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">** TOTAL **:           1.102x as fast    185.3ms +/- 3.7%    168.2ms +/- 3.7%      significant</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Apr 01 2020 13:49:24 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jdm:mozilla.org">jdm</span>&gt;</div></td><td class="msg-cell">mmm, this might be a red herring based on other changes in the build, especially since the --enable-optimize build is reporting the slower times.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Apr 01 2020 14:13:20 GMT-0700 (Pacific Daylight Time)">21:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">caroline</span>: ping</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Apr 01 2020 14:14:25 GMT-0700 (Pacific Daylight Time)">21:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@caroline:mozilla.org">caroline</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: pong</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Apr 01 2020 14:24:32 GMT-0700 (Pacific Daylight Time)">21:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: are you around by chance?</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Apr 01 2020 14:24:50 GMT-0700 (Pacific Daylight Time)">21:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Apr 01 2020 14:25:30 GMT-0700 (Pacific Daylight Time)">21:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">weakrefs was just presented, and there are some questions around cleanup some -- are you familiar with it or should i ping jon and yoshi tomorrow morning?</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Apr 01 2020 14:26:09 GMT-0700 (Pacific Daylight Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I am probably as familiar with it as any of the GC team, though the wasm people are really the ones that is intended for</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Apr 01 2020 14:26:21 GMT-0700 (Pacific Daylight Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ok, i will run it by lars as well</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Apr 01 2020 14:26:46 GMT-0700 (Pacific Daylight Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">the idea is that there are some folks who are uncomfortable with cleanup some -- they think it is risky to allow something like that on the main thread</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Apr 01 2020 14:27:14 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">this can be achieved either by saying throwing on [[CanBlock]] or adding a host hook so hosts (HTML) can decide for itself </td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed Apr 01 2020 14:27:38 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">would this be an issue for us, implementation wise?</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed Apr 01 2020 14:27:56 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">I asked the champions for a write up with the change, its very short notice</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed Apr 01 2020 14:29:14 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">(i can also say "too short notice, please let us think about it" if it needs more time for us to discuss)</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Wed Apr 01 2020 14:29:26 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">[[CanBlock]] is an es thing, or a webidl thing, or ?</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Wed Apr 01 2020 14:30:19 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">i think it is a js thing but let mee double check</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Wed Apr 01 2020 14:30:47 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">is the idea that the host can prevent cleanupSome from doing anything?</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Wed Apr 01 2020 14:31:26 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh, I think I misparsed "throwing on [[CanBlock]]"</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Wed Apr 01 2020 14:31:34 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">you mean throwing an exception</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Wed Apr 01 2020 14:31:39 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Wed Apr 01 2020 14:31:49 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">implementation-wise, I don't see a problem</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Wed Apr 01 2020 14:32:01 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ok</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Wed Apr 01 2020 14:32:05 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">great</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Wed Apr 01 2020 14:32:15 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">what to think about this as a potential source of blocking the main thread, I don't know, but I'm probably not the right person</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Wed Apr 01 2020 14:32:43 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">is there anyone you can recommend that i can ping?</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Wed Apr 01 2020 14:32:58 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">sadly, bz was the first name to spring to mind :(</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Wed Apr 01 2020 14:33:38 GMT-0700 (Pacific Daylight Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm a little fuzzy on who deals with this sort of thing. emilio?</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Wed Apr 01 2020 14:34:07 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ok! i can probably also bug anne in that case</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Wed Apr 01 2020 14:34:17 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that's a good idea</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Wed Apr 01 2020 14:34:19 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">but both of them are in berlin. I will get in touch with them</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Wed Apr 01 2020 14:35:02 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I mean, in theory anything that cleanupSome would do would be done at the end of the current turn anyway</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Wed Apr 01 2020 14:35:38 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">or could be done</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Wed Apr 01 2020 14:37:26 GMT-0700 (Pacific Daylight Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I guess maybe the end of turn stuff could be considered to be host-controlled already?</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Wed Apr 01 2020 14:37:41 GMT-0700 (Pacific Daylight Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: minor nit bug for you to r?, fixup to the InflatedChar16Sequence  constructor</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Wed Apr 01 2020 14:37:42 GMT-0700 (Pacific Daylight Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">since if it really didn't want to block, it could always defer the finalizations</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Wed Apr 01 2020 14:38:15 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">then again, it could just refuse to do anything on cleanupSome in that case</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Wed Apr 01 2020 14:38:22 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">i just checked, it shouldn't block the main thread</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Wed Apr 01 2020 14:39:21 GMT-0700 (Pacific Daylight Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">what does "block the main thread" mean, though? I mean, you're running JS. You call cleanupSome, it runs more of your JS. When it's done, it'll return. It's not exactly blocking in a new way.</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Wed Apr 01 2020 14:41:17 GMT-0700 (Pacific Daylight Time)">21:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">hmm maybe i didn't understand this question you asked earlier? "what to think about this as a potential source of blocking the main thread"</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Wed Apr 01 2020 14:41:47 GMT-0700 (Pacific Daylight Time)">21:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">in fact, we're not going to be doing a GC just because someone called cleanupSome. So the only effect, normally, is to bring some finalization earlier than the end of the current turn.</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Wed Apr 01 2020 14:42:11 GMT-0700 (Pacific Daylight Time)">21:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I was probably misinterpreting the original concern. You didn't actually say that, that's just how I heard it.</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Wed Apr 01 2020 14:42:34 GMT-0700 (Pacific Daylight Time)">21:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">You said "they think it is risky to allow something like [cleanupSome] on the main thread"</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Wed Apr 01 2020 14:42:49 GMT-0700 (Pacific Daylight Time)">21:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I haven't yet figured out what's risky about it</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Wed Apr 01 2020 14:43:21 GMT-0700 (Pacific Daylight Time)">21:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">yes, so this is coming from the apple team, their position is that allowing synchronous observation of GCs via finalizations is a Bad Thing to do on the main thread</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Wed Apr 01 2020 14:43:53 GMT-0700 (Pacific Daylight Time)">21:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ah!</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Wed Apr 01 2020 14:44:25 GMT-0700 (Pacific Daylight Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that's a fair point, the spec went to some effort to reduce the observability by postponing things to the end of the turn (sorry for the dated terminology)</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Wed Apr 01 2020 14:44:41 GMT-0700 (Pacific Daylight Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and now cleanupSome can tell you whether a GC happened yet or not</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Wed Apr 01 2020 14:44:49 GMT-0700 (Pacific Daylight Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">exactly</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Wed Apr 01 2020 14:45:16 GMT-0700 (Pacific Daylight Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ugh, I'm inclined to agree, though I still think the wasm use case is very important</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Wed Apr 01 2020 14:45:18 GMT-0700 (Pacific Daylight Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">they also see this as a larger web compatibility risk (larger than the rest of the proposal which is considered a web compat risk)</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Wed Apr 01 2020 14:45:34 GMT-0700 (Pacific Daylight Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">right, i will need to clarify if this messes with the wasm story...</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Wed Apr 01 2020 14:47:35 GMT-0700 (Pacific Daylight Time)">21:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'd like to say that cleanupSome needs more work and we should accept the rest of the API, but drop cleanupSome until we do more work to figure it out. But I'm worried that it would make all of this useless to wasm. (I don't know if that is true for sure.)</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Wed Apr 01 2020 14:48:48 GMT-0700 (Pacific Daylight Time)">21:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ok, thats good feedback to have</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Wed Apr 01 2020 14:56:29 GMT-0700 (Pacific Daylight Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I keep trying to come up with ways  of fixing it. But either I only solve half the problem and make it less useful besides, or I require modes or privilege levels or similar.</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Wed Apr 01 2020 14:57:35 GMT-0700 (Pacific Daylight Time)">21:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">to some extent, it feels like it comes down to the question of whether wasm can really interoperate with JS if it's always running purely "within" JS, and thus can't make use of things that can happen at the end of or between turns.</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Wed Apr 01 2020 14:57:37 GMT-0700 (Pacific Daylight Time)">21:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">(here is the write up: <a href="https://github.com/tc39/proposal-weakrefs/issues/197">https://github.com/tc39/proposal-weakrefs/issues/197</a>)</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Wed Apr 01 2020 14:58:57 GMT-0700 (Pacific Daylight Time)">21:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">hmm question: how will not being able to do cleanupSome on the main thread affect wasm potentially interacting with the dom? i know that some people have wanted this but dont know if it is in the pipeline...</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Wed Apr 01 2020 15:02:15 GMT-0700 (Pacific Daylight Time)">22:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">my naive view: interacting with the dom creates garbage, which requires cleanup, which for wasm means FinalizationRegistry, which for long-running wasm (especially in a non-Web host) requires cleanupSome or similar because you never end the current synchronous execution, or at least don't do it for too long.</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Wed Apr 01 2020 15:02:42 GMT-0700 (Pacific Daylight Time)">22:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">right, and this would effectively move all wasm work to workers</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Wed Apr 01 2020 15:03:03 GMT-0700 (Pacific Daylight Time)">22:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">shu's 2(ii) is what I meant by "modes or privilege levels or similar"</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Wed Apr 01 2020 15:03:36 GMT-0700 (Pacific Daylight Time)">22:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Wed Apr 01 2020 15:03:52 GMT-0700 (Pacific Daylight Time)">22:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">or at least, all wasm work that wants to play with the dom</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Wed Apr 01 2020 15:04:02 GMT-0700 (Pacific Daylight Time)">22:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(or with nontrivial JS)</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Wed Apr 01 2020 15:05:15 GMT-0700 (Pacific Daylight Time)">22:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I feel kinda dumb for not noticing this issue with cleanupSome. I've been ignoring that API since I never liked it, but couldn't put my finger on why.</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Wed Apr 01 2020 15:06:20 GMT-0700 (Pacific Daylight Time)">22:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">djvj</span>: Done.</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Wed Apr 01 2020 15:06:41 GMT-0700 (Pacific Daylight Time)">22:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ok so the wasm story bugs me, i will try to find out more if this breaks anything that we are working on</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Wed Apr 01 2020 15:21:21 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: ping</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Wed Apr 01 2020 15:21:31 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: pong</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Wed Apr 01 2020 15:21:57 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">ReportCompileErrorLatin1 takes a va_list* argument: <a href="https://searchfox.org/mozilla-central/source/js/src/vm/ErrorReporting.cpp#128">https://searchfox.org/mozilla-central/source/js/src/vm/ErrorReporting.cpp#128</a></td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Wed Apr 01 2020 15:22:36 GMT-0700 (Pacific Daylight Time)">22:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If I want to call it from a non-varargs function, is there any standard way of ginning up a fake va_list*?</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Wed Apr 01 2020 15:24:32 GMT-0700 (Pacific Daylight Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: No.</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Wed Apr 01 2020 15:24:50 GMT-0700 (Pacific Daylight Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: We need to not use ellipsis functions at all in SpiderMonkey, really.</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Wed Apr 01 2020 15:25:32 GMT-0700 (Pacific Daylight Time)">22:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: It is on my list of things to do, to change error reporting to pass around some sort of pointer-length class to encapsulate a set of parameters.</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Wed Apr 01 2020 15:25:55 GMT-0700 (Pacific Daylight Time)">22:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: It is extremely unclear when I will ever get to it.</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Wed Apr 01 2020 15:27:36 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: In the interim, the work around is to ... make my function varargs, even though it doesn't need any extra arguments?</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Wed Apr 01 2020 15:28:01 GMT-0700 (Pacific Daylight Time)">22:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: Something like that, I guess.</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Wed Apr 01 2020 15:29:12 GMT-0700 (Pacific Daylight Time)">22:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: Being unable to cons up a <code>va_list</code> is possibly the most fundamental of its problems.  Other problems with it, are that <em>technically</em> you're supposed to <code>va_copy</code> a <code>va_list</code> if you want to copy it, can't just copy-construct or copy-assign it, and if you aren't copying it around, passing by pointer to it is the only real safe option but is just terrible.</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Wed Apr 01 2020 15:30:53 GMT-0700 (Pacific Daylight Time)">22:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay, thanks</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Wed Apr 01 2020 15:31:14 GMT-0700 (Pacific Daylight Time)">22:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I will go forth to write terrible code, safe in the knowledge that it's the language's fault, not mine</td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Wed Apr 01 2020 15:35:49 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">There is a great deal of ruin in C and C++.</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Wed Apr 01 2020 15:41:17 GMT-0700 (Pacific Daylight Time)">22:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: If I ask how to pre-barrier a GCCellPtr, you are gonna telling I'm doing something terribly wrong, aren't you?</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Wed Apr 01 2020 15:51:34 GMT-0700 (Pacific Daylight Time)">22:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">okay, I have a worse idea... </td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Wed Apr 01 2020 15:54:13 GMT-0700 (Pacific Daylight Time)">22:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><code>gc::ClearEdgesTracer</code>.. you certainly were not meant for my purposes</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Wed Apr 01 2020 15:54:29 GMT-0700 (Pacific Daylight Time)">22:54</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span></div></td><td class="msg-cell">wonders how anyone is using streams yet, seeing as they appear to have approximately no documentation...</td></tr>

</tbody></table></div></div></div>
</body></html>