<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-01-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-01-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-01-17" class="nav-link"><span>prev</span></a>
<a href="2023-01-19" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jan 17 2023 22:16:39 GMT-0800 (Pacific Standard Time)">06:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's the "shutdown" mentioned in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1762233">bug 1762233</a> ?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jan 17 2023 22:16:41 GMT-0800 (Pacific Standard Time)">06:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1762233">https://bugzil.la/1762233</a> — NEW (nobody) — Reconsider OOM handling in DOM Streams</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jan 17 2023 22:20:55 GMT-0800 (Pacific Standard Time)">06:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, the case where browser is shutting down and the global goes away?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jan 17 2023 23:08:00 GMT-0800 (Pacific Standard Time)">07:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">never mind. I think I got it and answered in the bug comment.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Jan 18 2023 04:45:10 GMT-0800 (Pacific Standard Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">Hi there</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jan 18 2023 04:45:15 GMT-0800 (Pacific Standard Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell"><p>I was wondering if someone around could shed some light on what <code>frontIsBreakablePoint</code> and <code>frontIsBreakableStepPoint</code> really mean?<br><a href="https://searchfox.org/mozilla-central/rev/9563aef5a0aeaedc73f363172a93b2f10e289c2e/js/src/vm/BytecodeUtil-inl.h#175-183">https://searchfox.org/mozilla-central/rev/9563aef5a0aeaedc73f363172a93b2f10e289c2e/js/src/vm/BytecodeUtil-inl.h#175-183</a></p>
<p>We have trouble in the debugger stepping on unexpected lines because of these two distinct types of "breakable" positions.<br>I wrote some lengthy description of the issue over here: <a href="https://phabricator.services.mozilla.com/D165164#5430203">https://phabricator.services.mozilla.com/D165164#5430203</a></p>
<p>I'd be happy to discuss here, on phabricator or hop on a crash course in 1:1.</p>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jan 18 2023 04:53:31 GMT-0800 (Pacific Standard Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: this seems related to <code>BytecodeEmitter::markStepBreakpoint</code> and <code>BytecodeEmitter::markSimpleBreakpoint</code>. If I understand this correctly, the former corresponds to <code>frontIsBreakableStepPoint</code> and is what we usually do. We only use <code>markSimpleBreakpoint</code> at the end of the script or right before a function call</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jan 18 2023 06:08:25 GMT-0800 (Pacific Standard Time)">14:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-10">jandem</span>: Shouldn't makeSimpleBreakpoint be called each time is called markStepBreakpoint given this implementation:</p>
<pre><code>bool frontIsBreakablePoint() const { return isBreakpoint; }
bool frontIsBreakableStepPoint() const {
    return isBreakpoint &amp;&amp; seenStepSeparator;
}
</code></pre>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jan 18 2023 06:09:57 GMT-0800 (Pacific Standard Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">Otherwise I'm wondering if <code>markSimpleBreakpoint</code> and <code>frontIsBreakablePoint</code> is any useful (for debugger needs)? Shouldn't we be able to set a breakpoint anywhere we could possibly step? Any idea why we would need to have two distinct set of "breakable positions"??</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jan 18 2023 06:11:01 GMT-0800 (Pacific Standard Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: <code>frontIsBreakablePoint</code> should match both <code>markStepBreakpoint</code> and <code>markSimpleBreakpoint</code>. <code>markStepBreakpoint</code> emits two source notes (step + breakpoint) and <code>markSimpleBreakpoint</code> only emits the breakpoint note</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jan 18 2023 06:11:40 GMT-0800 (Pacific Standard Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">ah ok! good catch!</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jan 18 2023 06:12:35 GMT-0800 (Pacific Standard Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: I think the idea was that you can break on a function call or end-of-script, but breaking in all those places when stepping is a bit too much?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jan 18 2023 06:14:41 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">but at the end, we can set breakpoint on many more positions other than function call and end-of-script (BTW, what is the definition of end-of-script? is it end of a &lt;script&gt; tag/file?)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jan 18 2023 06:16:55 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: also closing } in a function, see <a href="https://searchfox.org/mozilla-central/rev/9563aef5a0aeaedc73f363172a93b2f10e289c2e/js/src/frontend/FunctionEmitter.cpp#624-632">this comment</a> for example</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jan 18 2023 06:17:50 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">so we're not doing this for simple arrow functions like <code>x =&gt; x + 2</code></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jan 18 2023 06:22:05 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">You may set breakpoint on all these lines, except line 120. But none of them are function call or end-of-script right?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jan 18 2023 06:22:25 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">So we aren't really using this frontIsBreakablePoint logic, right?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jan 18 2023 06:23:29 GMT-0800 (Pacific Standard Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: <code>frontIsBreakablePoint</code> also matches where we call <code>markStepBreakpoint</code> and that probably happens for all of these statements</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jan 18 2023 06:25:48 GMT-0800 (Pacific Standard Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">so it is rather the other way around frontIsBreakablePoint is a super set of frontIsBreakableStepPoint </td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jan 18 2023 06:27:21 GMT-0800 (Pacific Standard Time)">14:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell">so that it looks like we could set breakpoint in more locations than we can step? we can set breakpoint in function call and end-of-script for not step?? Is that the translation of our current ongoing discussion?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jan 18 2023 06:28:43 GMT-0800 (Pacific Standard Time)">14:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">correct, there are step-breakpoints (at statements more or less) and additional non-step breakpoints (end of script, function calls)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jan 18 2023 07:02:44 GMT-0800 (Pacific Standard Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: (looking at the bugzilla bug.. I could try to repro this in the JS shell with the debugger API if you think it's reporting the wrong source code location to devtools..)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jan 18 2023 07:23:49 GMT-0800 (Pacific Standard Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: I can try to provide you a reduce Debugger API testcase for you. Here I was trying to make sense of the existing code. We don't understand enough how the underlying spidermonkey code is working...</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jan 18 2023 07:29:15 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: a Debugger API testcase would be nice. I'm happy to take a look or to answer questions if you want to understand the SM side better</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jan 18 2023 08:16:16 GMT-0800 (Pacific Standard Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ochameau:mozilla.org">ochameau</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: here you go <a href="https://phabricator.services.mozilla.com/D167162">https://phabricator.services.mozilla.com/D167162</a> hopefully a xpcshell script is ok for you?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jan 18 2023 08:25:49 GMT-0800 (Pacific Standard Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ochameau</span>: should be fine, thanks. I needinfo'd myself on the bug to take a look at this</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jan 18 2023 08:48:24 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: ping</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jan 18 2023 09:18:37 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Would someone be able to clarify how the executor parameter is used in NewPromiseObject?

It seems that it needs to be callable, but what are the parameters and return value, and when is it called?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jan 18 2023 09:22:52 GMT-0800 (Pacific Standard Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Would someone be able to clarify how the executor parameter is used in NewPromiseObject?<br><br>It seems that it needs to be callable, but what are the parameters and return value, and when is it called?</blockquote></mx-reply>The reason I'm asking is that I'm trying to make JS promise objects interact with a boost::asio executor.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jan 18 2023 09:37:55 GMT-0800 (Pacific Standard Time)">17:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The reason I'm asking is that I'm trying to make JS promise objects interact with a boost::asio executor.</blockquote></mx-reply>I see now that this is referring to an "executor" parameter in the JS specification for the promise constructorl.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Jan 18 2023 09:41:18 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@asingh:igalia.com">Aditi</span>&gt;</div></td><td class="msg-cell">Hey everybody, so I was looking into change array by copy implementation in spidermonkey, has that been shipped yet? </td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Jan 18 2023 09:50:52 GMT-0800 (Pacific Standard Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">Aditi</span>: It appears no, we've not shipped.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Jan 18 2023 09:54:37 GMT-0800 (Pacific Standard Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@asingh:igalia.com">Aditi</span>&gt;</div></td><td class="msg-cell">Oh, do you know, why that is? </td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Jan 18 2023 09:56:06 GMT-0800 (Pacific Standard Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">Aditi</span>: Just did a bit of bug-tree reorganization to track that a bit better, see Bug 1811054. I don't have a good answer as to why we haven't shipped, I wasn't tracking it particularly closely</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Jan 18 2023 09:56:07 GMT-0800 (Pacific Standard Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1811054">https://bugzil.la/1811054</a> — NEW (nobody) — [meta] Change Array By Copy proposal</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Jan 18 2023 09:59:00 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">Aditi</span>: Looks like <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1784092">https://bugzilla.mozilla.org/show_bug.cgi?id=1784092</a> suggests we were waiting for some test262 tests that have since landed; so we probably could pref-flip this now</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Jan 18 2023 09:59:50 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Having said that, I don't think our implementation has been fuzzed, so I wouldn't really do that right away) </td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Jan 18 2023 10:00:01 GMT-0800 (Pacific Standard Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">The most honest answer here looks like it just got dropped by accident</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Jan 18 2023 10:07:19 GMT-0800 (Pacific Standard Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@asingh:igalia.com">Aditi</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> (Having said that, I don't think our implementation has been fuzzed, so I wouldn't really do that right away) </blockquote></mx-reply>Oops! Is that something I can help with, or would you like to take that up?</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Jan 18 2023 10:08:29 GMT-0800 (Pacific Standard Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">So, if you're going to be keeping an eye on this proposal, next step would be bug <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1811056">https://bugzilla.mozilla.org/show_bug.cgi?id=1811056</a> -- if you could take care of that, I can tehn email to get fuzzing started; then in a few weeks we can jump to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1811057">https://bugzilla.mozilla.org/show_bug.cgi?id=1811057</a> </td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Jan 18 2023 10:09:39 GMT-0800 (Pacific Standard Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@asingh:igalia.com">Aditi</span>&gt;</div></td><td class="msg-cell">Okay, thanks!  👍️</td></tr>

</tbody></table></div></div></div>
</body></html>