<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-03-29</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-03-29<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-03-28" class="nav-link"><span>prev</span></a>
<a href="2023-03-30" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Mar 29 2023 04:37:03 GMT-0700 (Pacific Daylight Time)">11:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@caleb.distributive:mozilla.org">caleb.distributive</span>&gt;</div></td><td class="msg-cell">Hey I'm embedding spidermonkey, how would one go about using the API to create a JSFunction with a ...rest parameter? Currently I'm using js::NewFunctionWithReserved, but that seems to only be able to set a static number of arguments</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Mar 29 2023 04:38:27 GMT-0700 (Pacific Daylight Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">caleb.distributive</span>: rest parameters are not supported in native functions</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Mar 29 2023 04:38:46 GMT-0700 (Pacific Daylight Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">You can access every parameter passed to your functions via CallArgs</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Mar 29 2023 04:38:55 GMT-0700 (Pacific Daylight Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@caleb.distributive:mozilla.org">caleb.distributive</span>&gt;</div></td><td class="msg-cell">gotcha, thanks</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Mar 29 2023 07:22:14 GMT-0700 (Pacific Daylight Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell"><p>Is there a way to get a more meaningful backtrace from gdb?</p>
<pre><code>(gdb) enable unwinder .* SpiderMonkey
1 unwinder enabled
(gdb) where
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#0  0x0000156f82fc716c in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#1  0x00007fffffffbe40 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#2  0x0000156f82f77d89 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#3  0x0000000000000063 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#4  0x00002728c1404e68 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#5  0xfff9800000000000 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#6  0xfffb2728c1406f88 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#7  0xfffb354fb9a76160 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#8  0xfffe2728c1406c08 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#9  0x00007fffffffbec0 in  ()
Python Exception &lt;class 'TypeError'&gt;: 'NoneType' object is not subscriptable
#10 0x00007ffff7630100 in  ()
#11 0x0000000000000000 in  ()
</code></pre>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Mar 29 2023 08:16:13 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">it never really worked from any random places, it can recover the stacks once you exit Jitted code, but fails as it does not know how to identify the top of the stack, in its current implementation.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Mar 29 2023 08:16:31 GMT-0700 (Pacific Daylight Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">the problem is knowing the stack-depth based on the current PC.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Mar 29 2023 08:20:32 GMT-0700 (Pacific Daylight Time)">15:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: In this case it's from some unreachable code I added in, so top of the stack is <a href="https://searchfox.org/mozilla-central/source/js/src/jit/VMFunctions.cpp#2859">https://searchfox.org/mozilla-central/source/js/src/jit/VMFunctions.cpp#2859</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Mar 29 2023 08:22:19 GMT-0700 (Pacific Daylight Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">which does not set the JitActivation top of frame.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Mar 29 2023 08:22:49 GMT-0700 (Pacific Daylight Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I guess this could be fixed easily, but then there is no guarantee on the the correctness of the top frame.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Mar 29 2023 09:57:34 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">wow, I never realized how important the progress bar was on jit-tests until it disappeared (and yes, I've rebased it back into existence now)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Mar 29 2023 16:31:32 GMT-0700 (Pacific Daylight Time)">23:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Ugh. I've been trying to do make a "simple" change to cache hash values, which caused string corruption. So I bisected and removed all of the patch that does nothing but allocate a little more unused space in string data, and I now have a single test failure that really really looks like a miscompilation of the rope flattening hairball. It only fails when optimizing, and the optimizer has great fun disentangling the goto maze and eliminating most of the state variables. To the point that the control flow when stepping doesn't resemble the unoptimized flow at all.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Mar 29 2023 16:31:42 GMT-0700 (Pacific Daylight Time)">23:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I don't have enough hair left to be pulling it out.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Mar 29 2023 16:32:18 GMT-0700 (Pacific Daylight Time)">23:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">my money is on some nasty aliasing bug.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Mar 29 2023 16:32:52 GMT-0700 (Pacific Daylight Time)">23:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(when I say "miscompilation", I mean as compared to what I <em>want</em> to happen; I'm not blaming the compiler.)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Mar 29 2023 16:34:20 GMT-0700 (Pacific Daylight Time)">23:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">maybe I'll add some printfs, or something else that forces the state to be materialized. I'm guessing adding too much will just make the problem go away, but maybe I can get it back to roughly the intended control flow at least?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Mar 29 2023 16:35:39 GMT-0700 (Pacific Daylight Time)">23:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">this is already compiled with <code>-fno-strict-aliasing</code></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Mar 29 2023 16:36:25 GMT-0700 (Pacific Daylight Time)">23:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but that didn't help with the last aliasing bug I ran into</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Mar 29 2023 16:37:17 GMT-0700 (Pacific Daylight Time)">23:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: Do you want to put up a patch for other people to squint at?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Mar 29 2023 16:37:23 GMT-0700 (Pacific Daylight Time)">23:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">No guarantees that I'm any good at squinting</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Mar 29 2023 16:38:36 GMT-0700 (Pacific Daylight Time)">23:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">that's a good thought. It would be worth the exercise of minimizing the triggering change.</td></tr>

</tbody></table></div></div></div>
</body></html>