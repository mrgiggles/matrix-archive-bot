<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-06-21</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-06-21<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-06-20" class="nav-link"><span>prev</span></a>
<a href="2024-06-24" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Jun 21 2024 06:09:03 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">I just realized, because of being backed out for wpt test failures :/, that I need to change JSStructuredCloneReader (<a href="https://searchfox.org/mozilla-central/source/js/src/vm/StructuredClone.cpp#2584">https://searchfox.org/mozilla-central/source/js/src/vm/StructuredClone.cpp#2584</a>) to support Float16... what I'm not sure about is if this then requires new versioning, we currently have a bool <code>v1Read</code>... does this now need to become an enum, and only support Float16 in a <code>v3</code> of the format?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Jun 21 2024 06:12:37 GMT-0700 (Pacific Daylight Time)">13:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">v1 and v2 are old versions and we only have to support deserializing of these formats</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Jun 21 2024 06:13:01 GMT-0700 (Pacific Daylight Time)">13:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">current FF versions will use <code>SCTAG_TYPED_ARRAY_OBJECT</code></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Jun 21 2024 06:18:27 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">changing <code>Scalar::BigUint64</code> to <code>Scalar::Float16</code> in <a href="https://searchfox.org/mozilla-central/rev/cb1060f7b4581e6c2d30f1accc84c7d807132d82/js/src/vm/StructuredClone.cpp#2584">this if-statement</a> should be fine I think</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Jun 21 2024 06:20:31 GMT-0700 (Pacific Daylight Time)">13:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">Thanks! that definitely works, I just wanted to make sure I wasn't breaking anything elsewhere.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Jun 21 2024 06:23:04 GMT-0700 (Pacific Daylight Time)">13:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">no that's fine. I added v3 to support large typed arrays and it just changed how arrayType/nelems are stored compared to v2</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Jun 21 2024 06:25:11 GMT-0700 (Pacific Daylight Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">there are no v2 buffers we care about with arrayType == Float16. A fuzzer could create one, but that would still do the right thing</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Jun 21 2024 07:51:42 GMT-0700 (Pacific Daylight Time)">14:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">What jandem said. We just need to maintain backwards compatibility â€” as in, we must continue to be able to deserialize all valid existing serialized data. It is fine to now start supporting additional things as long as the existing stored data continues to be deserialized correctly, and it's even fine to completely change how some data type is stored as long as it gets a new tag number and the old tag is still handled the same way. There are some <a href="https://searchfox.org/mozilla-central/rev/cb1060f7b4581e6c2d30f1accc84c7d807132d82/js/public/StructuredClone.h#51-82">nuances described in the comment</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Jun 21 2024 08:44:56 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">Hi all, just want to confirm is <code>PersistentRooted&lt;T&gt;</code> is indeed RAII and does not need to have <code>reset()</code> called on it explicitly. The comments in (<a href="https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#1374">https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#1374</a>) seem to indicate that is indeed the case.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Jun 21 2024 09:08:52 GMT-0700 (Pacific Daylight Time)">16:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Yes, that's correct. It's just fairly rare to use it in an RAII fashion, because if you're doing RAII, then plain <code>Rooted&lt;T&gt;</code> usually works fine and is a tiny bit faster.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Jun 21 2024 09:24:40 GMT-0700 (Pacific Daylight Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">Thanks, in our case we have a a PersistentRooted&lt;T&gt; which is a member of a long living object, but the value is conditionally cleared/reset during the lifetime of the owning object. We had been calling PersistentRooted&lt;T&gt;::reset() explicitly in the destructor of the object, but want to make sure it's okay to just let the PersistentRooted&lt;T&gt; destroyed by the parent obj's destructor implicitly. </td></tr>

</tbody></table></div></div></div>
</body></html>