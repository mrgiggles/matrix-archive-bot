<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-02-08</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-02-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-02-07" class="nav-link"><span>prev</span></a>
<a href="2023-02-09" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Feb 07 2023 16:01:05 GMT-0800 (Pacific Standard Time)">00:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I see smaug, asuth, perry have touched <code>SharedWorkerGlobalScope</code>, which seems related. Maybe ask in <a href="https://matrix.to/#/#dom:mozilla.org">#dom:mozilla.org</a> ?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Feb 07 2023 16:01:55 GMT-0800 (Pacific Standard Time)">00:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(I probably should have prevented those names from pinging people)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Feb 07 2023 16:02:25 GMT-0800 (Pacific Standard Time)">00:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell">From my observation, CustomomReadHandler works in both worker and shared worker cases, but I need to return a nullptr if it's in shared worker. I have no idea how to do it.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Feb 07 2023 16:02:48 GMT-0800 (Pacific Standard Time)">00:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@chunmin:mozilla.org">chunmin</span>&gt;</div></td><td class="msg-cell">ok, thanks! I'll ask on dom team channel to see if someone knows it</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Feb 08 2023 01:28:03 GMT-0800 (Pacific Standard Time)">09:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: you recently mentioned failing mprotects due to an excessive number of mappings; is there a bug related to this occurring in SM? I occasionally see assertion violations due to mprotect failing (during fuzzing); however all samples are flaky and never seem to reproduce</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Feb 08 2023 01:32:13 GMT-0800 (Pacific Standard Time)">09:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: it didn't happen to me, I was suggesting why mprotect may sometimes fail.  <span class="nick-2">nbp</span> was it you who observed this?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Feb 08 2023 01:32:54 GMT-0800 (Pacific Standard Time)">09:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">(I imagine this failure would be related to JIT code mappings; we don't change page permissions otherwise as far as I remember)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Feb 08 2023 02:18:04 GMT-0800 (Pacific Standard Time)">10:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">do we have a bug to implement <a href="https://github.com/tc39/proposal-json-parse-with-source">https://github.com/tc39/proposal-json-parse-with-source</a> ?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Feb 08 2023 02:27:46 GMT-0800 (Pacific Standard Time)">10:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: <span class="nick-4">jonco</span>: I did observed that in the past, around the LifoAlloc protection, when moving off-thread. mprotect would OOM, and was weirdly reported as bad arguments on windows and crashes on Mac.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Feb 08 2023 02:28:33 GMT-0800 (Pacific Standard Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/ds/LifoAlloc.h#182-191">https://searchfox.org/mozilla-central/source/js/src/ds/LifoAlloc.h#182-191</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Feb 08 2023 02:31:28 GMT-0800 (Pacific Standard Time)">10:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">this is similar to the one I saw; from LifoAlloc into mprotect which in turn fails</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Feb 08 2023 02:32:32 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">These are the calls which are making use of it: <a href="https://searchfox.org/mozilla-central/search?q=symbol:_ZN2js9LifoAlloc12setReadWriteEv&amp;redirect=false">https://searchfox.org/mozilla-central/search?q=symbol:_ZN2js9LifoAlloc12setReadWriteEv&amp;redirect=false</a> and <a href="https://searchfox.org/mozilla-central/search?q=symbol:_ZN2js9LifoAlloc11setReadOnlyEv&amp;redirect=false">https://searchfox.org/mozilla-central/search?q=symbol:_ZN2js9LifoAlloc11setReadOnlyEv&amp;redirect=false</a></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Feb 08 2023 02:33:12 GMT-0800 (Pacific Standard Time)">10:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Knowing that these are debug builds, a failure in mprotect is less worrying than a SEGV in the protected pages.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Feb 08 2023 02:34:28 GMT-0800 (Pacific Standard Time)">10:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I guess we could add a configure flag to enable/disable LIFO_CHUNK_PROTECT independently of the DEBUG mode.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Feb 08 2023 02:36:45 GMT-0800 (Pacific Standard Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">the crash I see is a RELEASE_ASSERT here <a href="https://searchfox.org/mozilla-central/source/js/src/gc/Memory.cpp#1029">https://searchfox.org/mozilla-central/source/js/src/gc/Memory.cpp#1029</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Feb 08 2023 02:36:49 GMT-0800 (Pacific Standard Time)">10:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I added this code a while back, hopping to track who might be corrupting our LifoAlloc chunks, after seeing failures in the first pass of IonMonkey running off-thread, while IonBuilder should have generated fully before giving to memory to the other thread.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Feb 08 2023 02:37:42 GMT-0800 (Pacific Standard Time)">10:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">So far the only answer I got is that nobody corrupts our buffers, but our buffers are corrupted :/</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Feb 08 2023 07:27:11 GMT-0800 (Pacific Standard Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">this is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1658310">https://bugzilla.mozilla.org/show_bug.cgi?id=1658310</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Feb 08 2023 08:04:38 GMT-0800 (Pacific Standard Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: That project was motivated by crash reports, right? At that scale, I think there's a very good chance that the answer to "who is corrupting our buffers?" is "cosmic rays and flaky memory"</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Feb 08 2023 08:48:10 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Yes, we had many reports pointing towards LifoAlloc, either from TI to Ion.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Feb 08 2023 08:49:23 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Like seeing use-after-free patterns in the middle of LifoAlloc chunks suggested that somehow, someone might have free a pointer within a LifoAlloc chunk.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Feb 08 2023 08:49:59 GMT-0800 (Pacific Standard Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">At the end … I still do not know but cosmic rays might no longer be an improbable answer.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Feb 08 2023 08:53:21 GMT-0800 (Pacific Standard Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">This is why I rewrote LifoAlloc, to better understand the code and add extra magic numbers, extra assertions, and extra mprotect.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Feb 08 2023 09:38:16 GMT-0800 (Pacific Standard Time)">17:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Are there any detailed documents describing the specifics of how rooting is implemented in Spidermonkey?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Feb 08 2023 09:41:04 GMT-0800 (Pacific Standard Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: there is <a href="https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#34">https://searchfox.org/mozilla-central/source/js/public/RootingAPI.h#34</a> I'm not sure whether is additional documentation (besides the code itself)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Feb 08 2023 09:49:15 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: (and if you haven't been pointed to <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/next/docs/Garbage%20Collection.md">this</a> and <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/next/docs/GC%20Rooting%20Guide.md">this</a> before, they are helpful)</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Feb 08 2023 09:49:47 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(the first one feels like it should actually live in Firefox Source docs) </td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Feb 08 2023 14:11:15 GMT-0800 (Pacific Standard Time)">22:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">my current patch stack is 46 patches. Where did my life go wrong?!!</td></tr>

</tbody></table></div></div></div>
</body></html>