<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-05-28</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-05-28<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-05-27" class="nav-link"><span>prev</span></a>
<a href="2024-05-29" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue May 28 2024 01:34:19 GMT-0700 (Pacific Daylight Time)">08:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Job queue is not for promise, but reaction jobs.  when you do <code>p.then(function f() {}, function g() {})</code>, and when <code>p</code> gets fulfilled/rejected, a corresponding reaction job is created to execute the function <code>f</code> or <code>g</code> and enqueued for the job queue</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue May 28 2024 01:35:42 GMT-0700 (Pacific Daylight Time)">08:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">things in job queue aren't GCed</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue May 28 2024 01:37:48 GMT-0700 (Pacific Daylight Time)">08:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">PromiseObject doesn't have available reserved slot</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue May 28 2024 01:39:00 GMT-0700 (Pacific Daylight Time)">08:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, if you want to run something when a promise gets resolved, you can add a promise reactions with <a href="https://searchfox.org/mozilla-central/rev/893f350260faac2ee6bf2b14c627d55eb2babfb0/js/public/Promise.h#463">JS::AddPromiseReactions</a>, it's almost same as <code>p.then(...)</code></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue May 28 2024 01:39:41 GMT-0700 (Pacific Daylight Time)">08:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: ^</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue May 28 2024 01:47:56 GMT-0700 (Pacific Daylight Time)">08:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you want to access the promise resolution value from the lambda, the reaction receives the value, and you don't need a reference to the promise object</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue May 28 2024 01:49:00 GMT-0700 (Pacific Daylight Time)">08:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the above doesn't fit your case, can you provide the details what you want to do inside the lambda?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue May 28 2024 04:30:29 GMT-0700 (Pacific Daylight Time)">11:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@mbroadst:mozilla.org">mbroadst</span>&gt;</div></td><td class="msg-cell">Hi, I'm exploring what it would take to implement the node.js <a href="https://github.com/nodejs/node-api-headers">js-native-api</a> for SpiderMonkey but am getting a little tripped up out of the gate reading the existing implementation based on v8. Is there a direct analog to a v8::Local in SpiderMonkey? After reading the <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr78/docs/GC%20Rooting%20Guide.md">GC Rooting Guide</a> I thought it might actually be a JS::RootedValue, but v8::Local seems to straddle RootedValue/HandleValue perhaps? If somebody could help me spell <a href="https://github.com/nodejs/node/blob/067ab06f21e901dce5cd5ec36c4aae80abcb11bd/src/js_native_api_v8.cc#L2021-L2037">these implementations</a> correctly for SpiderMonkey I think it would help me get the ball rolling üôè</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue May 28 2024 05:50:59 GMT-0700 (Pacific Daylight Time)">12:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Reading this might help<br><a href="https://github.com/mozilla/spidernode/blob/aafa9e5273f954f272bb4382fc007af14674b4c2/deps/spidershim/docs/StackRooting.md">https://github.com/mozilla/spidernode/blob/aafa9e5273f954f272bb4382fc007af14674b4c2/deps/spidershim/docs/StackRooting.md</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue May 28 2024 06:35:08 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@mbroadst:mozilla.org">mbroadst</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: thank you, that's very useful!</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue May 28 2024 09:07:47 GMT-0700 (Pacific Daylight Time)">16:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: just a heads up -- going to land the counters code today, but I should point out: I removed the CacheIR optimzation. Ultimately it made testing harder, and didn't improve performance too much. Should we desire -something- I'd tackle it in a separate bug</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue May 28 2024 12:50:30 GMT-0700 (Pacific Daylight Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@twisniewski:mozilla.org">twisniewski</span>&gt;</div></td><td class="msg-cell">Hi folks, I just noticed this WebKit commit, and I'm not sure if we support this? (When I run their JSStress test-case in Firefox it seems to hang with a slow-script message): <a href="https://github.com/WebKit/WebKit/commit/4b84428a953560574a27b3881ac06dc43ea42651">https://github.com/WebKit/WebKit/commit/4b84428a953560574a27b3881ac06dc43ea42651</a></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue May 28 2024 14:15:08 GMT-0700 (Pacific Daylight Time)">21:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Yeah, I don't think we support that at the moment -- we have the same bug </td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue May 28 2024 14:15:20 GMT-0700 (Pacific Daylight Time)">21:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(which... why didn't they add a test262 test :S ) </td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue May 28 2024 14:15:36 GMT-0700 (Pacific Daylight Time)">21:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/builtin/RegExp.js#130,157">https://searchfox.org/mozilla-central/source/js/src/builtin/RegExp.js#130,157</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue May 28 2024 14:18:48 GMT-0700 (Pacific Daylight Time)">21:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">hrm. Maybe we haven't done that whole proposal; The proposal says it's at stage 4, but our metabug says it's at stage 3 <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1713657">https://bugzilla.mozilla.org/show_bug.cgi?id=1713657</a> </td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue May 28 2024 14:19:58 GMT-0700 (Pacific Daylight Time)">21:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Oh wait; maybe <span class="nick-9">dminor</span> did do it last year in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1826574">https://bugzilla.mozilla.org/show_bug.cgi?id=1826574</a> and this is just an oversight</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue May 28 2024 14:20:16 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, the v flag is implemented</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue May 28 2024 14:20:42 GMT-0700 (Pacific Daylight Time)">21:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I think it just got missed in matchAll, and I suspect there's a gap in 262 coverage too</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue May 28 2024 14:22:32 GMT-0700 (Pacific Daylight Time)">21:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1899413">https://bugzilla.mozilla.org/show_bug.cgi?id=1899413</a></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue May 28 2024 14:22:37 GMT-0700 (Pacific Daylight Time)">21:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Thanks <span class="nick-12">twisniewski</span> !</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue May 28 2024 14:46:18 GMT-0700 (Pacific Daylight Time)">21:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Have spent an unreasonable amount of time dealing with clang-format, whitespace linting &amp; formatting related bounces today</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue May 28 2024 14:46:21 GMT-0700 (Pacific Daylight Time)">21:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue May 28 2024 15:12:30 GMT-0700 (Pacific Daylight Time)">22:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@twisniewski:mozilla.org">twisniewski</span>&gt;</div></td><td class="msg-cell">Another small <a href="https://github.com/WebKit/WebKit/commit/1ff045b365bb63494783062033d5ef8a0c629cb7">discovery from the webkit commit logs</a>: apparently we're not adding "get" to function-tostrings on DOM properties, see for instance <code>Object.getOwnPropertyDescriptor(Document.prototype, 'readyState').get.toString()</code>. Their commit doesn't reference test262, so that might be another gap in the suite (Chrome adds the get, Safari now does too).</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue May 28 2024 15:14:03 GMT-0700 (Pacific Daylight Time)">22:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@twisniewski:mozilla.org">twisniewski</span>&gt;</div></td><td class="msg-cell">oh wait.. this is familiar.. ha! i already filed this a while ago: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1893492">https://bugzilla.mozilla.org/show_bug.cgi?id=1893492</a></td></tr>

</tbody></table></div></div></div>
</body></html>