<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-10-25</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-10-25<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-10-24" class="nav-link"><span>prev</span></a>
<a href="2023-10-26" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Oct 25 2023 05:22:58 GMT-0700 (Pacific Daylight Time)">12:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@canada_goose:mozilla.org">canadahonk</span>&gt;</div></td><td class="msg-cell">Are there docs anywhere on embedding SM via Wasm(/WASI)? I know there's some downstream repos from the Bytecode Alliance but they seem inactive and not sure if they're still recommended to be used. Thanks!</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Oct 25 2023 05:52:06 GMT-0700 (Pacific Daylight Time)">12:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">canadahonk</span>: this is marked experimental still but might be interesting: <a href="https://github.com/bytecodealliance/componentize-js">https://github.com/bytecodealliance/componentize-js</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Oct 25 2023 05:53:18 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@canada_goose:mozilla.org">canadahonk</span>&gt;</div></td><td class="msg-cell">looks cool, but I was looking for more the engine (interpreter) dynamically, not compiling js to wasm ahead of time (eg can "just" eval from JS on a webpage)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Oct 25 2023 06:00:08 GMT-0700 (Pacific Daylight Time)">13:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">canadahonk</span>: like this? <a href="https://mozilla-spidermonkey.github.io/sm-wasi-demo/">https://mozilla-spidermonkey.github.io/sm-wasi-demo/</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Oct 25 2023 06:00:28 GMT-0700 (Pacific Daylight Time)">13:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@canada_goose:mozilla.org">canadahonk</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-4">canadahonk</span>: like this? <a href="https://mozilla-spidermonkey.github.io/sm-wasi-demo/">https://mozilla-spidermonkey.github.io/sm-wasi-demo/</a></blockquote></mx-reply>yeah!</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Oct 25 2023 06:03:28 GMT-0700 (Pacific Daylight Time)">13:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">this is just a simple js shell demo. We don't have much documentation about this. For more serious use cases we'd ideally have a better environment than the js shell</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Oct 25 2023 06:04:56 GMT-0700 (Pacific Daylight Time)">13:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@canada_goose:mozilla.org">canadahonk</span>&gt;</div></td><td class="msg-cell">could you theoretically expose functions/etc to the js world from the worker? or would you need to fork SM, etc</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Oct 25 2023 06:56:33 GMT-0700 (Pacific Daylight Time)">13:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Wasmer has some stuff on WASI support on top of the rust bindings <a href="https://github.com/wasmerio/mozjs/tree/wasi">https://github.com/wasmerio/mozjs/tree/wasi</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Oct 25 2023 07:41:27 GMT-0700 (Pacific Daylight Time)">14:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell"><p>Hi, I have a basic (or not?) JS question. I'm trying to find out if this <a href="https://github.com/web-platform-tests/wpt/blob/b2a38f9f6f/css/css-highlight-api/HighlightRegistry-iteration-with-modifications.html">wpt</a> is correct. The test creates an iterator for a <code>maplike</code> (there's a similar one which uses <code>setlike</code> fwiw) and assumes that the iterator uses a copy of the data, instead of the original live data. Therefore, any updates to the <code>maplike</code> after creating the iterator are not reflected in the iteration.</p>
<p>Is this the right behavior, and does this align to how iteration of "normal" maps (or sets for that matter) is expected to happen? Geckos implementation for <code>maplike</code> iterates over live data, hence we fail the mentioned wpt.</p>
</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Oct 25 2023 07:50:57 GMT-0700 (Pacific Daylight Time)">14:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Ref <a href="https://webidl.spec.whatwg.org/#es-map-iterator">https://webidl.spec.whatwg.org/#es-map-iterator</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Oct 25 2023 07:52:41 GMT-0700 (Pacific Daylight Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">I'm not sure if that's well-defined</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Oct 25 2023 07:52:58 GMT-0700 (Pacific Daylight Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">In any case, it's not a JS question :)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Oct 25 2023 08:02:57 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In any case, it's not a JS question :)</blockquote></mx-reply>What would be a better place to ask then?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Oct 25 2023 08:04:04 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell">FWIW, when I use the example in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/@@iterator">MDN</a>, it looks like the iterator uses live data, both in Firefox and Chrome.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Oct 25 2023 08:21:59 GMT-0700 (Pacific Daylight Time)">15:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it'd require changes to SpiderMonkey to bridge the two JS worlds. The JS shell also isn't the best fit for that kind of thing. It would be nice to have a better embedding for wasi users that would support this natively</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Oct 25 2023 08:23:26 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@canada_goose:mozilla.org">canadahonk</span>&gt;</div></td><td class="msg-cell">I have an idea to mostly do it without SM support (but quite cursed), so I think I'm okay for now. would be nice though yeah :) (but not important)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Oct 25 2023 08:24:07 GMT-0700 (Pacific Daylight Time)">15:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@canada_goose:mozilla.org">canadahonk</span>&gt;</div></td><td class="msg-cell">(you can likely use stdout/stdin as "IPC" between the two worlds and make interface wrappers)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Oct 25 2023 09:02:07 GMT-0700 (Pacific Daylight Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Ms2ger</span>: well the JS side is a JS question ðŸ™‚ What is the expected behavior for normal maps? And sounds like iteration is "live".</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Oct 25 2023 09:03:24 GMT-0700 (Pacific Daylight Time)">16:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">jjaschke</span>: <a href="https://matrix.to/#/#whatwg:matrix.org">#whatwg:matrix.org</a>  or <a href="https://matrix.to/#/#dom:mozilla.org">#dom:mozilla.org</a> would be then the places to ask questions about webidl.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Oct 25 2023 09:04:50 GMT-0700 (Pacific Daylight Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">and <span class="nick-4">Ms2ger</span> was already asking there</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Oct 25 2023 09:29:19 GMT-0700 (Pacific Daylight Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">that works if you're just passing strings. You can also write to the in-memory file system (that's also how we pass the JS source code you enter on the website)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Oct 25 2023 09:36:36 GMT-0700 (Pacific Daylight Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it's also fun to think about using Wasm GC eventually for certain JS objects shared with the other side</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Oct 25 2023 14:23:39 GMT-0700 (Pacific Daylight Time)">21:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">jjaschke</span>: A JS Map is specified to use live data. See section 24.1.5.1 of the spec <a href="https://tc39.es/ecma262/#sec-map-iterator-objects">here</a>, and particularly part 2.d.iii.5: "NOTE: The number of elements in entries may have increased while execution of this abstract operation was paused by Yield." The same also appears to be true for Set objects. You can't iterate over a WeakMap or a WeakSet.</td></tr>

</tbody></table></div></div></div>
</body></html>