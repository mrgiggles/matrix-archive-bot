<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-10-06</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-10-06<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-10-05" class="nav-link"><span>prev</span></a>
<a href="2023-10-10" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Oct 06 2023 01:24:17 GMT-0700 (Pacific Daylight Time)">08:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: FWIW, tweaking JSGC_ZONE_ALLOC_DELAY_KB alone doesn't <a href="https://treeherder.mozilla.org/perfherder/compare?originalProject=try&amp;originalRevision=92365de399a42815bf290fb288291f28ed004dbc&amp;newProject=try&amp;newRevision=c1927014ed79b9890d66c1ae4d8b12eb4708478d&amp;page=1&amp;framework=13">seem</a> to be doing anything too good.  It was useful when I used it with some other changes. I'll keep looking into this</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Oct 06 2023 01:24:45 GMT-0700 (Pacific Daylight Time)">08:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: cool</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Oct 06 2023 01:25:22 GMT-0700 (Pacific Daylight Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">You said before that the nursery was shrinking very quickly after page load. Do you have a profile or something to show this?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Oct 06 2023 01:25:27 GMT-0700 (Pacific Daylight Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Interested to see what's going on here.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Oct 06 2023 01:25:54 GMT-0700 (Pacific Daylight Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">There's a heuristic to shrink the nursery if collections are taking too long but it should be disabled during page load.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Oct 06 2023 05:01:36 GMT-0700 (Pacific Daylight Time)">12:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'm thinking about changing the string's hash calculation, to special case <code>"get "</code> and <code>"set "</code> prefixes, so that it can be calculated from the hash for unprefixed string.  was there similar experiment before?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Oct 06 2023 05:02:24 GMT-0700 (Pacific Daylight Time)">12:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the context is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1850344">bug 1850344</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1848278">bug 1848278</a>, where I'd like to add more permanent atoms, and also to reduce the runtime calculation for accessor names</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Oct 06 2023 05:02:25 GMT-0700 (Pacific Daylight Time)">12:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1850344">https://bugzil.la/1850344</a> — ASSIGNED (arai) — Use permanent atom for startup-related or frequently-used atoms, or all atoms used by bindings</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Oct 06 2023 05:02:26 GMT-0700 (Pacific Daylight Time)">12:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1848278">https://bugzil.la/1848278</a> — ASSIGNED (arai) — Make permanent atom set extensible by embedder</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Oct 06 2023 05:04:30 GMT-0700 (Pacific Daylight Time)">12:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if we add many permanent atoms as static data, including their length and hash, the binary size increase becomes problematic (200kB~400kB), and I'm wondering how the static data can be reduced while also reducing the startup cost</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Oct 06 2023 05:05:21 GMT-0700 (Pacific Daylight Time)">12:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and one possibility is to deduplicate accessor names and unprefixed property name.  the text content can be easily deduplicated, but the hash is not, with the current way</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Oct 06 2023 05:31:36 GMT-0700 (Pacific Daylight Time)">12:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: by "permanent atoms as static data" you mean statically allocated JSAtoms?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Oct 06 2023 05:32:20 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">haven't yet investigated the <code>JSAtom</code> itself as static data, but at least statically calculate the input data for atomization</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Oct 06 2023 05:32:45 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, length and hash, and the same for accessors</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Oct 06 2023 05:33:16 GMT-0700 (Pacific Daylight Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">does the compiler deduplicate when there's the same entry for another interface or do we have to do it ourselves?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Oct 06 2023 05:34:21 GMT-0700 (Pacific Daylight Time)">12:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">the text content could be deduplicated by compiler (maybe with some annotation?).  but so far I haven't seen it happening in my prototype.  the content for unprefixed and prefixed are stored separately</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Oct 06 2023 05:36:55 GMT-0700 (Pacific Daylight Time)">12:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, hash isn't deduplicate-able, and if we add ~10000 entries, 4 bytes for each still has some impact</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Oct 06 2023 05:38:21 GMT-0700 (Pacific Daylight Time)">12:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, I should explain the problem that I'm trying to solve.  it's <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1846110">bug 1846110</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Oct 06 2023 05:38:22 GMT-0700 (Pacific Daylight Time)">12:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1846110">https://bugzil.la/1846110</a> — NEW (nobody) — Too much time spent in CreateInterfaceObjects during sp3</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Oct 06 2023 05:38:36 GMT-0700 (Pacific Daylight Time)">12:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">how many distinct WebIDL accessor names are there in total?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Oct 06 2023 05:39:51 GMT-0700 (Pacific Daylight Time)">12:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">6731 properties + interface names, 3512 of them has getter, 2098 of them has setter</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Oct 06 2023 05:40:56 GMT-0700 (Pacific Daylight Time)">12:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">improving speedometer with this would be nice</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Oct 06 2023 05:41:58 GMT-0700 (Pacific Daylight Time)">12:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and my prototype increases the binary size by 360kB (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1850344#c4">https://bugzilla.mozilla.org/show_bug.cgi?id=1850344#c4</a>)</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Oct 06 2023 05:42:36 GMT-0700 (Pacific Daylight Time)">12:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and now trying to figure out how to compress it</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Oct 06 2023 05:43:33 GMT-0700 (Pacific Daylight Time)">12:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">such like, deduplicate text, omit accessor length and calculate it from unprefixed name, and also change the hash so that it can be calculated from unprefixed name with low cost</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Oct 06 2023 05:44:27 GMT-0700 (Pacific Daylight Time)">12:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">if you store the length separately, maybe we can get rid of the null terminator somehow and store an index into a very large string? not sure if that makes sense</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Oct 06 2023 05:45:06 GMT-0700 (Pacific Daylight Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, using index and no null-terminator sounds promising. I'll try that</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Oct 06 2023 05:45:09 GMT-0700 (Pacific Daylight Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I'm not sure about special-casing the get/set prefix in the string hashing algorithm</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Oct 06 2023 05:45:31 GMT-0700 (Pacific Daylight Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">xpt codegen uses index into large string, but afaik it has null terminator</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Oct 06 2023 05:45:41 GMT-0700 (Pacific Daylight Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">ah</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Oct 06 2023 05:47:24 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I wonder there are some other place that generates accessor name from unprefixed name in hot path</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Oct 06 2023 05:48:07 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if there's, changing the hashing algorithm would be beneficial there as well</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Oct 06 2023 05:48:20 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(some names are substrings of other names like "click" and "onclick", but maybe that's not super common)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Oct 06 2023 05:49:11 GMT-0700 (Pacific Daylight Time)">12:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, I've experimented with deduplicating the property name, and there wasn't much case except for accessor vs unprefixed.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Oct 06 2023 05:49:36 GMT-0700 (Pacific Daylight Time)">12:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">that makes sense</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Oct 06 2023 05:53:55 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hm, there's <a href="https://searchfox.org/mozilla-central/rev/6602bdf9fff5020fbc8e248c963ddddf09a77b1b/js/src/vm/JSFunction.cpp#1791">NameToFunctionName</a> which calculates accessor name from unprefixed name. I wonder if it becomes hot outside of WebIDL CreateInterfaceObject</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Oct 06 2023 05:55:04 GMT-0700 (Pacific Daylight Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">before the bound function rewrite, we <a href="https://searchfox.org/mozilla-esr102/rev/2ac4b481997e2bcf569c91d8bb7ab1e5a0b7b1b0/js/src/vm/JSFunction.cpp#1135">had some code</a> to lazily generate the bound-prefixed name there. I wonder if we could do something like that here</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Oct 06 2023 05:56:07 GMT-0700 (Pacific Daylight Time)">12:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">sounds interesting.  yeah, the accessor function's name won't actually be used in most case</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Oct 06 2023 05:56:30 GMT-0700 (Pacific Daylight Time)">12:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and if that can be lazily generated, we can omit them from static data</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Oct 06 2023 05:56:36 GMT-0700 (Pacific Daylight Time)">12:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(now we allocate them eagerly for bound functions, but we do have <a href="https://searchfox.org/mozilla-central/rev/6602bdf9fff5020fbc8e248c963ddddf09a77b1b/js/src/gc/Zone.h#274-279">a cache</a> for it)</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Oct 06 2023 05:57:30 GMT-0700 (Pacific Daylight Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah for accessors this should be very uncommon.. might be a nice saving</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Oct 06 2023 05:57:45 GMT-0700 (Pacific Daylight Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, I'll look into it.  thanks!</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Oct 06 2023 06:00:13 GMT-0700 (Pacific Daylight Time)">13:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">great. I hope this works</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Oct 06 2023 06:27:47 GMT-0700 (Pacific Daylight Time)">13:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell">Hi, 
Is there any public function in mozjs to parse arithmetic and logical expressions? </td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Oct 06 2023 06:34:48 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">kevin_wang_22</span>: do you want to get AST from it?</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri Oct 06 2023 06:35:21 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">also, what's the requirement there?  do you want to accept only specific syntax?</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri Oct 06 2023 06:36:27 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if there's no restriction and also you want AST, <code>Reflect.parse</code> would fit there.  it's not C++ API tho, you can call it by evaluating JS code</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri Oct 06 2023 06:36:40 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if there's more requirement, can you provide the details?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Oct 06 2023 06:51:11 GMT-0700 (Pacific Daylight Time)">13:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell">The only requirement is: Considering use any other external libraries about Shunting yard algorithm(like muParse), I would like to use the one embedded in mozjs. I will use it to determine some conditions then to active an js script if condition matches </td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Oct 06 2023 07:00:01 GMT-0700 (Pacific Daylight Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, the input is variables + expression, and there's no limitation about the syntax, and there will never be malicious code, and you want to get the result of evaluating the expression, is that correct?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Oct 06 2023 07:00:30 GMT-0700 (Pacific Daylight Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">like, if the feature supports function declaration, the input will never use it?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Oct 06 2023 07:04:21 GMT-0700 (Pacific Daylight Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if that's the case, you can do the following:  1. set those variables as global variable (<code>JS_DefineProperty</code>), 2. evaluate the expression in the global (<code>JS::Evaluate</code>) and get the result from it</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Oct 06 2023 07:08:25 GMT-0700 (Pacific Daylight Time)">14:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell">By using JS::Evaluate, we have to create a jscontext and other components. Is there a c++ functions can just parse the expression without those?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Oct 06 2023 07:09:18 GMT-0700 (Pacific Daylight Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">just to make sure, what do you mean with "parse" ?  does it include evaluating the parsed AST ?</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Oct 06 2023 07:10:06 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's the expected output?  for example, the input is something like <code>conditionA || conditionB</code>, and the expected output is <code>true</code> or <code>false</code> ?</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Oct 06 2023 07:12:06 GMT-0700 (Pacific Daylight Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell">Yes, I think so. For example, expression: "varA + varB * varC &lt; 100", varA, varB, varC has their own values(like, varA=10, varB=20, varC=2). After parsing the expression, it return false(because (10 + 20 * 2 &lt; 100) is false)</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Oct 06 2023 07:12:25 GMT-0700 (Pacific Daylight Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">evaluation is tied to <code>JSContext</code> and global.  you need them to get the evaluation result</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Oct 06 2023 07:14:03 GMT-0700 (Pacific Daylight Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@kevin_wang_22:matrix.org">kevin_wang_22</span>&gt;</div></td><td class="msg-cell">Thank you</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Oct 06 2023 07:22:07 GMT-0700 (Pacific Daylight Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: what do you think of using something like <a href="https://searchfox.org/mozilla-central/rev/6602bdf9fff5020fbc8e248c963ddddf09a77b1b/js/src/gc/GC.cpp#1834-1837">https://searchfox.org/mozilla-central/rev/6602bdf9fff5020fbc8e248c963ddddf09a77b1b/js/src/gc/GC.cpp#1834-1837</a> for those slices which are called from a timer, and not from idle callback? Or perhaps not eagerAllocTrigger but something else</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Oct 06 2023 07:30:00 GMT-0700 (Pacific Daylight Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">I mean, don't trigger a slice if we aren't over some threshold.</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Oct 06 2023 08:14:53 GMT-0700 (Pacific Daylight Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: I think it's a good idea to use fewer timers.  Making this change will mean zones near the GC threshold are collected sooner, and zones not near the threshold are not collected in this way.  I don't think it would be much different from removing the timer altogether.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Oct 06 2023 09:14:34 GMT-0700 (Pacific Daylight Time)">16:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">that is true, it is getting closer to not have a timer at all</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Oct 06 2023 09:32:57 GMT-0700 (Pacific Daylight Time)">16:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">C++ question: if I have a <code>mozilla::Array&lt;T,N&gt; array</code> that I initialize with both some elements of <code>T</code> and some subtypes of <code>T</code>, and subtypes of <code>T</code> have a different amount of storage, I'm implicitly upcasting to the base type of totally breaking my subtype aren't I... (I think this is true as I try to figure out how do offset of.... and I think it just doesn't work.)</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Oct 06 2023 09:43:21 GMT-0700 (Pacific Daylight Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">do you mean array[0] is initialized with T ctor and array[1] is initialized with subclass ctor?</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Oct 06 2023 09:45:55 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Yeah (I am realizing that yesterday in my fighting with this I probably should have caught on to this when I needed copy constructors to be public -- so what's happening is that the array is being created type homogenously from heterogenous intializers by just callling the base class constructor) </td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri Oct 06 2023 09:52:15 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">You could take the JSString approach and put all the required fields for the subclass in the base class</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri Oct 06 2023 09:53:35 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">You could use T* instead of T and allocate separately. Less efficient, of course.</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri Oct 06 2023 09:59:08 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, moving all fields into base class would be simple approach</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Fri Oct 06 2023 10:00:48 GMT-0700 (Pacific Daylight Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">what's T ?</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Fri Oct 06 2023 10:00:51 GMT-0700 (Pacific Daylight Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Ironically, I'm being hoist on my own cleverness previously because I made my derived class be a template with variable size. Oops. Ah well. Glad to know the mistake I made) </td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Fri Oct 06 2023 10:01:15 GMT-0700 (Pacific Daylight Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, variable size...</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Fri Oct 06 2023 10:02:04 GMT-0700 (Pacific Daylight Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Yeah; the whole thing is going to need some rethinking; it's Ok. I'll get there. Have something else to tackle for a bit anyhow</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Fri Oct 06 2023 10:06:14 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the range of the size isn't much wide, you could have a fixed-length buffer in the base class and use union in the subclass to use the buffer for fields with specific type, but not sure if it's easy to handle</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Fri Oct 06 2023 10:07:22 GMT-0700 (Pacific Daylight Time)">17:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">otherwise, using a pointer as element type would be simpler</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Fri Oct 06 2023 10:10:36 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Yeah -- pointer will definitely be where I end up -- just have to figure out lifetime (UniqPtr probably) </td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Fri Oct 06 2023 10:13:15 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Actually -- I likely can do something better because of how this array is composed) </td></tr>

</tbody></table></div></div></div>
</body></html>