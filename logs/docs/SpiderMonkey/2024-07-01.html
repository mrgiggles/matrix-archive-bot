<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-07-01</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-07-01<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-06-28" class="nav-link"><span>prev</span></a>
<a href="2024-07-02" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jul 01 2024 00:49:40 GMT-0700 (Pacific Daylight Time)">07:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@yulia:mozilla.org">yulia | sick</span>&gt;</div></td><td class="msg-cell">Dumb question to validate my understanding of how Bytecode Interpreter and Bytecode Compiler work together: The ByteCode Compiler reuses the code from the interpreter, but sometimes adds additional information. For example: The bytecode Compiler will use the <a href="https://searchfox.org/mozilla-central/source/js/src/jit/BaselineCodeGen.cpp#6248">bytecode Interpreter code for jumptarget</a>, and then <a href="https://searchfox.org/mozilla-central/source/js/src/jit/BaselineCodeGen.cpp#6242">add code coverage to it</a>. Is this right?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jul 01 2024 01:12:55 GMT-0700 (Pacific Daylight Time)">08:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for JumpTarget these are separate implementations for interpreter vs compiler. The interpreter has to do more work at runtime than the compiler. It maintains a pointer to the next IC entry in the BaselineFrame that it updates at each JumpTarget op but the compiler doesn't need to compute this information because it knows it statically when using an IC</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jul 01 2024 01:19:02 GMT-0700 (Pacific Daylight Time)">08:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the code coverage implementation is also different: the compiler can bake in a pointer to the counter and increment it, the interpreter has to do a call</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jul 01 2024 01:32:48 GMT-0700 (Pacific Daylight Time)">08:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">where do we have the jumptarget code for the baseline compiler?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jul 01 2024 01:34:06 GMT-0700 (Pacific Daylight Time)">08:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">really dumb question, basically: how do we know where we are jumping in the baseline compiler? is it in the IC?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jul 01 2024 03:03:07 GMT-0700 (Pacific Daylight Time)">10:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">baseline compiler emits jump targets <a href="https://searchfox.org/mozilla-central/search?q=emit_jumpTarget&amp;path=&amp;case=false&amp;regexp=false">here</a><br>In baseline, the bytecode knows what is the jump PC (target) to jump to, so <a href="https://searchfox.org/mozilla-central/source/js/src/jit/BaselineCodeGen.cpp#1967">we have an indirection</a> which maps PC to Labels (Assembler), which are later resolved when linking.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jul 01 2024 03:30:25 GMT-0700 (Pacific Daylight Time)">10:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">got it, thanks!</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jul 01 2024 07:11:47 GMT-0700 (Pacific Daylight Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: FYI I added JS::Call to the Socorro prefix list and it accidentally affected at least one GC-related thing, JS::CallbackTracer::onEdge, so it may cause some of GC crash signatures to shift around. I can look into making it only affect JS::Call() if that's a problem. (Surely there's some way...)</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jul 01 2024 07:12:24 GMT-0700 (Pacific Daylight Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">eg "OOM | unknown | js::AutoEnterOOMUnsafeRegion::crash_impl | JS::CallbackTracer::onEdge" will now be "OOM | unknown | js::AutoEnterOOMUnsafeRegion::crash_impl | JS::CallbackTracer::onEdge | js::GenericTracerImpl&lt;T&gt;::onObjectEdge" in at least one case</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jul 01 2024 08:10:03 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">mccr8</span>: ok, I'll look out for that</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jul 01 2024 08:11:36 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Bug 1472062 is the only bug I see with a "false prefix" of JS::Call so hopefully it won't be so bad. I guess I'll still look into fixing that.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jul 01 2024 08:11:37 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1472062">https://bugzil.la/1472062</a> — NEW (nobody) — [meta] OOM while evicting the nursery</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jul 01 2024 08:21:16 GMT-0700 (Pacific Daylight Time)">15:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-16">mccr8</span>: ok, I'll look out for that</blockquote></mx-reply>I put up a new pull request to only match JS::Call exactly so hopefully it won't be a problem.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jul 01 2024 15:13:17 GMT-0700 (Pacific Daylight Time)">22:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">hm, <code>deserialize(serialize(new class { x=7; #y=8 }))</code> gives back a plain object <code>{x: 8}</code>. Which seems like it's probably correct per the spec, but I wonder if that is always what we'll want and it would be better to reserve future options by updating the spec to throw a <code>DataCloneError</code>.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jul 01 2024 15:13:53 GMT-0700 (Pacific Daylight Time)">22:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">It very well might be too late, since that would break things that are cloning things with private fields. But private fields haven't been a thing for <em>that</em> long; I'm wondering if it's worth filing a tc39 issue or not.</td></tr>

</tbody></table></div></div></div>
</body></html>