<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2025-04-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2025-04-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-04-17" class="nav-link"><span>prev</span></a>
<a href="2025-04-21" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Apr 18 2025 04:52:44 GMT-0700 (Pacific Daylight Time)">11:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">I see tons of "Error looking up Id(BaseMetricId(4024)): LabeledBaseMetricIsNotDynamic" messages in this profile : <a href="https://share.firefox.dev/3RltZmf">https://share.firefox.dev/3RltZmf</a>
Could it be due to the recent-ish migration of JS:GC metrics to glean?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Apr 18 2025 05:35:54 GMT-0700 (Pacific Daylight Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">we have a contributor implementing a function that check if a given string is a valid javascript identifier: <a href="https://phabricator.services.mozilla.com/D242838#:~:text=function%20isjavascriptidentifier">https://phabricator.services.mozilla.com/D242838#:~:text=function%20isjavascriptidentifier</a>
Do we have something already in SpiderMonkey that does this that we could expose in JS (e.g. on ChromeUtils)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Apr 18 2025 05:43:34 GMT-0700 (Pacific Daylight Time)">12:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">at least the C++ function is here: <a href="https://searchfox.org/mozilla-central/rev/f3c8c63a097b61bb1f01e13629b9514e09395947/js/src/util/Identifier.h#30-31">js::IsIdentifier</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Apr 18 2025 05:44:05 GMT-0700 (Pacific Daylight Time)">12:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">oh, there's public one: <a href="https://searchfox.org/mozilla-central/rev/f3c8c63a097b61bb1f01e13629b9514e09395947/js/src/jsapi.h#911">JS_IsIdentifier</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Apr 18 2025 05:44:20 GMT-0700 (Pacific Daylight Time)">12:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, exposing it to some interface is possible</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Apr 18 2025 05:46:57 GMT-0700 (Pacific Daylight Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell">oh nice</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Apr 18 2025 09:06:54 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell"><p>Hi all, is there a way to limit the nursery size? I'm investigating an error where we are fail to allocate a string from the nursery and end up calling:</p>
<p><code>CellAllocator::RetryNurseryAlloc&lt;true&gt;</code> , resulting in a minorGC call.</p>
<p>Once we get into Nursery::traceRoots(), creating the StoreBuffer fails, so we end up calling oomUnsafe.crash() in the below:</p>
<pre><code>    `    
</code></pre>
<p>StoreBuffer sb(runtime());<br>{<br>AutoEnterOOMUnsafeRegion oomUnsafe;<br>if (!sb.enable()) {<br>oomUnsafe.crash("Nursery::traceRoots");<br>}<br>}`</p>
<p>I suspect that the original nursery allocation failed because we hit the limit of the nursery size, and when we try to perform the minorGC(), we don't have enough memory left over to allocate the two 8K buffers required for the StoreBuffer.</p>
<p>Is there a way to limit the nursery size to try and replicate the scenario above? I'm currently limiting the heap size of the JS engine 10MB, but I still can't reproduce the issue with the reproduction scenario. I'm hoping to try to limit the nursery size to see if it helps in reproducing.</p>
<p>I looked at the JS_GC_ZEAL settings, but nothing seems to fit my use case.</p>
</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Apr 18 2025 10:13:17 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">This is in an embedding? With the shell, I think it's <code>--gc-param=maxNurseryBytes=&lt;N&gt;</code>.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Apr 18 2025 10:13:56 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but from what I see, <code>sb.enable()</code> only does 16KB of allocation. So you must be very close to being out of memory at this point?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Apr 18 2025 12:28:36 GMT-0700 (Pacific Daylight Time)">19:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@santiroche:mozilla.org">santiroche</span>&gt;</div></td><td class="msg-cell">Thanks I'll give it a shot. Yes, we are most likely very close to the memory limit. Ideally we would be able to handle the OOM gracefully instead of calling the crash() function there </td></tr>

</tbody></table></div></div></div>
</body></html>