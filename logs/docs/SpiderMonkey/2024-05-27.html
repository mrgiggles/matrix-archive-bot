<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-05-27</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-05-27<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-05-26" class="nav-link"><span>prev</span></a>
<a href="2024-05-28" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon May 27 2024 00:38:01 GMT-0700 (Pacific Daylight Time)">07:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@mayankleoboy1:mozilla.org">mayankleoboy1</span>&gt;</div></td><td class="msg-cell">In a profile, prefs like  "javascript.options.mem.gc_high_frequency_time_limit_ms: 1000 (Int)" are read <em>after</em> all the js parsing is done. Is that fine? Profile: <a href="https://share.firefox.dev/3Khvpul">https://share.firefox.dev/3Khvpul</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon May 27 2024 07:04:45 GMT-0700 (Pacific Daylight Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: are we missing an <code>inCollectedRegion</code> check <a href="https://searchfox.org/mozilla-central/rev/3609b689a2c2ba7d75c4f047aee1546b86bc51bb/js/src/gc/Nursery.cpp#1892">here</a>?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon May 27 2024 07:05:44 GMT-0700 (Pacific Daylight Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I'm adding code for string buffers and was wondering about this case with semispace</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon May 27 2024 07:06:00 GMT-0700 (Pacific Daylight Time)">14:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">oh UK holiday today, this can wait</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon May 27 2024 07:13:10 GMT-0700 (Pacific Daylight Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: I think it's OK, we don't add new entries to this table during promotion so they should all be in the collected region. I'll take a look tomorrow.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon May 27 2024 07:16:54 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(I was comparing it to <code>MapObject::sweepAfterMinorGC</code> and wondering which one to follow)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon May 27 2024 08:07:58 GMT-0700 (Pacific Daylight Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">emilio</span>: we have some code checking malloced JS string characters are allocated in <code>js::StringBufferArena</code>, a jemalloc arena. I added some code to pass this through in my WIP patch <a href="https://phabricator.services.mozilla.com/D211744">https://phabricator.services.mozilla.com/D211744</a></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon May 27 2024 08:09:05 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">maybe the string buffer arena code should live in MFBT instead of JS and then be used for all StringBuffers</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon May 27 2024 09:35:35 GMT-0700 (Pacific Daylight Time)">16:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: is that a security mitigation of sorts?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon May 27 2024 09:36:33 GMT-0700 (Pacific Daylight Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@emilio:mozilla.org">emilio</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: yeah, if the eventual goal is for gecko buffers to be shareable with JS either JS should relax the restriction of buffers being allocated in the string buffer arena, or we should make gecko allocate them in the string buffer arena</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon May 27 2024 09:44:59 GMT-0700 (Pacific Daylight Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">emilio</span>: yes it was done for security reasons. If we make this change it would fix bug 1052576...</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon May 27 2024 09:45:00 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1052576">https://bugzil.la/1052576</a> — NEW (nobody) — Store nsString string buffers in the data heap</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon May 27 2024 09:49:25 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for StringBuffer it may be less valuable because it stores the refcount as part of the buffer</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon May 27 2024 14:12:17 GMT-0700 (Pacific Daylight Time)">21:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">For anyone curious about Sapling, wrote up experience and Howto here: <a href="https://www.mgaudet.ca/technical/2024/5/27/sapling-amp-a-workflow-for-mozilla-work">https://www.mgaudet.ca/technical/2024/5/27/sapling-amp-a-workflow-for-mozilla-work</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon May 27 2024 15:15:36 GMT-0700 (Pacific Daylight Time)">22:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:matrix.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><p>I have some questions regarding JS::NewPromiseObject, if someone would be so kind as to answer them:</p>
<ol>
<li>Does a promise get added to the job queue automatically when it's created?</li>
<li>When will objects in the job queue get garbage-collected?</li>
<li>Do promise objects have any hidden slots where I can put a reference to some other object?</li>
</ol>
<p>Basically, I'm creating JS promises that invoke a C++ lambda when they resolve, and I want to make sure that the C++ lambda has the same lifetime as the JS promise object.</p>
<p>At the moment, I'm capturing a PersistentRooted inside the lambda.  This ensures the JS promise object stays alive, but it's causing memory leaks.</p>
<p>I want to be able to guarantee that the JS promise can safely reference the lambda, but will still get GC'd</p>
</td></tr>

</tbody></table></div></div></div>
</body></html>