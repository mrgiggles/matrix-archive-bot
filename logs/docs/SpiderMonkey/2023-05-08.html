<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-05-08</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-05-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-05-07" class="nav-link"><span>prev</span></a>
<a href="2023-05-09" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon May 08 2023 01:27:02 GMT-0700 (Pacific Daylight Time)">08:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell"><p>I'm using JS::Evaluate to evaluate some code. It's something very simple like this pseudo-code:</p>
<pre><code>JS::RootedObject global (cx, createGlobal(cx));
JS::Evaluate(cx, "var a = 1; let b = 2");
js::DumpObject(global);
</code></pre>
<p>When I do this, the global object shows variable a, but not variable b. This makes sense, given that b is locally scoped. My question is, where is b stored in the system? And can I access b using Spidermonkey code, even though it is locally scoped?</p>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon May 08 2023 01:29:22 GMT-0700 (Pacific Daylight Time)">08:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">My real situation is a bit more complicated, using an object being sent in through the env-chain rather than the global object, but I think it boils down to the same thing. I'm asking because the local let variable still seems to be accessible in the script, even though it "isn't there".</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon May 08 2023 01:30:41 GMT-0700 (Pacific Daylight Time)">08:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I thought you were looking into <code>JS_GlobalLexicalEnvironment</code> and <code>JS_ExtensibleLexicalEnvironment</code>, right?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon May 08 2023 01:30:45 GMT-0700 (Pacific Daylight Time)">08:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">don't they work?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon May 08 2023 01:46:43 GMT-0700 (Pacific Daylight Time)">08:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">That part worked really nicely. This is something else.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon May 08 2023 01:47:17 GMT-0700 (Pacific Daylight Time)">08:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Unless you mean that I can find a variable created with "let" in the global lexical environment?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon May 08 2023 01:48:23 GMT-0700 (Pacific Daylight Time)">08:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">it should be stored in the lexical environment object</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon May 08 2023 01:48:45 GMT-0700 (Pacific Daylight Time)">08:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">either in the global or the extensible one, depending on the context</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon May 08 2023 01:50:16 GMT-0700 (Pacific Daylight Time)">08:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Yes, it's there!</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon May 08 2023 01:50:33 GMT-0700 (Pacific Daylight Time)">08:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">That's awesome, I thought this was going to be really difficult. Thanks @arai.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon May 08 2023 05:42:45 GMT-0700 (Pacific Daylight Time)">12:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@sdetar:mozilla.org">sdetar</span>&gt;</div></td><td class="msg-cell"><ul>
<li></li>
</ul>
</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon May 08 2023 06:08:25 GMT-0700 (Pacific Daylight Time)">13:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@whimboo:mozilla.org">whimboo</span>&gt;</div></td><td class="msg-cell">Hi. does anyone have an advice how I could return a Promise from within an async method? awaiting for the result of the method should actually not wait for the "inner" promise to be resolved</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon May 08 2023 06:09:00 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@whimboo:mozilla.org">whimboo</span>&gt;</div></td><td class="msg-cell">I would like to avoid having to wrap the promise like <code>return {inner: promise}</code></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon May 08 2023 06:23:08 GMT-0700 (Pacific Daylight Time)">13:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't think there's simple way.  why do you want to keep the inner promise unresolved?  is there any difference you observe with it?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon May 08 2023 06:26:11 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@whimboo:mozilla.org">whimboo</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: for webfdriver bidi we create strong handles for clients that they can refer to at a later time. As such it is possible to resolve the promise a couple of steps later within a eg. script execution step</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon May 08 2023 06:26:29 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@whimboo:mozilla.org">whimboo</span>&gt;</div></td><td class="msg-cell">but the deserialization step should not be blocked by it</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon May 08 2023 06:27:35 GMT-0700 (Pacific Daylight Time)">13:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@whimboo:mozilla.org">whimboo</span>&gt;</div></td><td class="msg-cell">so I'll go ahead with the wrapper then</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon May 08 2023 06:32:55 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, wrapping it with an object or array would be the best way.  other option I can think of is to use out parameter for the inner promise, but it's almost same complexity</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon May 08 2023 06:34:24 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@whimboo:mozilla.org">whimboo</span>&gt;</div></td><td class="msg-cell">hm what is this out parameter exactly?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon May 08 2023 07:48:17 GMT-0700 (Pacific Daylight Time)">14:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>something like this:</p>
<pre><code class="language-js">async function f(out) {
  out.value = promise;
  return true;
}

let out = { value: null };
await f(out);
let promise = out.value;
</code></pre>
</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon May 08 2023 08:32:04 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">"Your flight has changed" says the email, with no diff on what happened. Turns out, one of my flights scheduled arrival times changed by two minutes. 🤦</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon May 08 2023 08:39:46 GMT-0700 (Pacific Daylight Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">For the better?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon May 08 2023 08:44:32 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">My wife went to New Zealand last November, and received exactly that notification—except the change was for two <em>days</em>. Two days earlier, to be precise. It was... exciting.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon May 08 2023 09:09:51 GMT-0700 (Pacific Daylight Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">O.o </td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon May 08 2023 09:10:11 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">See... this is why I had to hand diff the email (and why I was irked it didn't include a diff) </td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon May 08 2023 09:10:43 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> For the better?</blockquote></mx-reply>The flight is 2 minutes longer... so worse? but like... not very much worse.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon May 08 2023 12:43:19 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Tenured objects don’t move right?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon May 08 2023 12:50:18 GMT-0700 (Pacific Daylight Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: They can during a compacting GC</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon May 08 2023 12:50:43 GMT-0700 (Pacific Daylight Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">ah, ok. that's good to know :) </td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon May 08 2023 12:51:06 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Note that we throw away Ion code for compacting GCs, so we can cheat and pretend they don't move for the purposes of Ion</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon May 08 2023 12:51:25 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(But we still have to handle nursery objects)</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon May 08 2023 12:51:49 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">ok, that makes sense. </td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon May 08 2023 13:48:37 GMT-0700 (Pacific Daylight Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aswan:mozilla.org">aswan</span>&gt;</div></td><td class="msg-cell">Hi, not sure if this is an appropriate place for this question, but I'm wondering about how to preload js modules?  I see there's a a <code>&lt;link rel="modulepreload" ...&gt;</code> but that it is not supported by firefox (or safari).  In these browsers (or at least in ff) is <code>&lt;link rel="preload" as="script" ...&gt;</code> effective for preloading a module?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon May 08 2023 13:53:33 GMT-0700 (Pacific Daylight Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">It looks like it is being worked on... <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1425310">https://bugzilla.mozilla.org/show_bug.cgi?id=1425310</a></td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon May 08 2023 13:58:07 GMT-0700 (Pacific Daylight Time)">20:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">aswan</span>: also see <a href="https://developer.chrome.com/blog/modulepreload/#ok-so-why-doesnt-link-relpreload-work-for-modules">https://developer.chrome.com/blog/modulepreload/#ok-so-why-doesnt-link-relpreload-work-for-modules</a></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon May 08 2023 14:01:04 GMT-0700 (Pacific Daylight Time)">21:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aswan:mozilla.org">aswan</span>&gt;</div></td><td class="msg-cell">ooh, thank you for that link!  do i understand correctly that until modulepreload is supported, it's not possible to preload modules?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon May 08 2023 14:03:38 GMT-0700 (Pacific Daylight Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">I think you can use <code>&lt;link rel=preload as=script crossorigin href=foo&gt;&lt;script type=module crossorigin src=foo&gt;</code> and that should put it in cache and there should be a cache hit, but it won't fetch dependencies or parse the script</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon May 08 2023 14:05:14 GMT-0700 (Pacific Daylight Time)">21:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aswan:mozilla.org">aswan</span>&gt;</div></td><td class="msg-cell">cool.  and practically, that probably means sniffing the user agent to decide which tag to use for now?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon May 08 2023 14:07:29 GMT-0700 (Pacific Daylight Time)">21:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">Demo: <a href="https://software.hixie.ch/utilities/js/live-dom-viewer/saved/11639">https://software.hixie.ch/utilities/js/live-dom-viewer/saved/11639</a> - checking devtools network panel in Firefox the second fetch sasy "cached" (after I disable "disable cache"!)</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon May 08 2023 14:08:16 GMT-0700 (Pacific Daylight Time)">21:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">I <em>guess</em> preloading other scripts in the module graph should also work, but haven't tested</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon May 08 2023 14:13:34 GMT-0700 (Pacific Daylight Time)">21:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">UA sniffing doesn't seem great. I was going to suggest <code>rel="preload modulepreload"</code> could work but it seems to not preload anything in safari</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon May 08 2023 14:15:30 GMT-0700 (Pacific Daylight Time)">21:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">But including both <code>&lt;link rel="modulepreload"&gt;</code> and <code>&lt;link rel="preload"&gt;</code> doesn't seem to double-fetch</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon May 08 2023 14:25:05 GMT-0700 (Pacific Daylight Time)">21:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">hey everyone!
is it possible to somehow nuke object from native side, so that it would be inaccessible in js side? (e.g. throw js error when trying to access it)
object itself is created in native side.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon May 08 2023 14:26:07 GMT-0700 (Pacific Daylight Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aswan:mozilla.org">aswan</span>&gt;</div></td><td class="msg-cell">thank you <span class="nick-14">zcorpan</span> this has all been very helpful!</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon May 08 2023 14:26:47 GMT-0700 (Pacific Daylight Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> hey everyone!<br>is it possible to somehow nuke object from native side, so that it would be inaccessible in js side? (e.g. throw js error when trying to access it)<br>object itself is created in native side.</blockquote></mx-reply>Sort of. There is a way to do that for cross compartment wrappers.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon May 08 2023 14:27:18 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">See js::NukeCrossCompartmentWrappers() and the like.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon May 08 2023 14:27:29 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">yea, I remember doing that for my cross-world needs =)<br>but this time it's on the same realm, so there are no wrappers to nuke</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon May 08 2023 14:27:58 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">TheQwertiest</span>: Cross Compartment Wrappers are special proxies where the target can be removd; you could restructure things sucht that your native code only ever exposes a proxy, then 'nuke' by affecting the proxy</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon May 08 2023 14:28:19 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Technically you probably could using brain transplants, but it is rather nasty stuff. We swap CCWs and these cross process object things.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon May 08 2023 14:29:01 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Another topic:) So I've been doing some digging into environment objects. I'm drawing a blank at the moment; maybe someone can help me clear it up (alas, going to post this then go AFK for a bit). Suppose you have some environment chain starting at object A, and you access a variable at A+2 hops. 

Is it possible that the environment A + 2 hops can ever be a different object? (I have some empirical evidence that says yes, but I don't quite understand yet -- I will eventually toss this in a debugger, but maybe there's a simple explanation) </td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon May 08 2023 14:29:07 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Somethingthing something <code>with</code>?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon May 08 2023 14:29:28 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-13">TheQwertiest</span>: Cross Compartment Wrappers are special proxies where the target can be removd; you could restructure things sucht that your native code only ever exposes a proxy, then 'nuke' by affecting the proxy</blockquote></mx-reply>well, I don't want to nuke every proxy, I need to nuke a single object =)</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon May 08 2023 14:30:15 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Right -- but you wrap that object in a proxy, then every handler checks if the permission is denied before doing anything</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon May 08 2023 14:30:42 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">and you only expose to the JS the -proxy- to that object, never the native. Then JS can be denied access always by flipping the switch on the proxy</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon May 08 2023 14:31:34 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">The general way to do this is allocate a new object of the same class, then do JSObject::swap() on it. But this is some of the nastiest code we have so things can go horribly wrong...</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon May 08 2023 14:31:37 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">oh, do you mean manually creating a proxy? (i.e. not craeting a wrapper through WrapValue)</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon May 08 2023 14:31:54 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> oh, do you mean manually creating a proxy? (i.e. not through WrapValue)</blockquote></mx-reply>Yes.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon May 08 2023 14:32:36 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I guess JS_TransplantObject is a slightly higher level interface to it. But yeah look at this comment... <a href="https://searchfox.org/mozilla-central/rev/4e6970cd336f1b642c0be6c9b697b4db5f7b6aeb/js/src/jsapi.cpp#587">https://searchfox.org/mozilla-central/rev/4e6970cd336f1b642c0be6c9b697b4db5f7b6aeb/js/src/jsapi.cpp#587</a></td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon May 08 2023 14:33:01 GMT-0700 (Pacific Daylight Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I think you'd be implementing your own similar thing using swap.</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon May 08 2023 14:33:20 GMT-0700 (Pacific Daylight Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">"Not for beginners or the squeamish." well that sounds rather nice :D</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon May 08 2023 14:33:40 GMT-0700 (Pacific Daylight Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I implemented a new use of swapping for Fission stuff and it took like a month or two.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon May 08 2023 14:33:59 GMT-0700 (Pacific Daylight Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">That was in here. <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1510760">https://bugzilla.mozilla.org/show_bug.cgi?id=1510760</a></td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon May 08 2023 14:34:00 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Yes.</blockquote></mx-reply>hm... this might work, though I'm not sure if the work required is worth it.<br>but thanks anyway =)</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon May 08 2023 14:34:36 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">(since there is only one object in a single scenario that requires it...)</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon May 08 2023 14:34:47 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">(also new regressions kept popping up for like a year)</td></tr>

</tbody></table></div></div></div>
</body></html>