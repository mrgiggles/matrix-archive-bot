<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-02-06</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-02-06<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-02-04" class="nav-link"><span>prev</span></a>
<a href="2023-02-07" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Feb 05 2023 23:11:23 GMT-0800 (Pacific Standard Time)">07:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@sagu:mozilla.org">samson</span>&gt;</div></td><td class="msg-cell">At servo/mozjs we relied on pkg archives that are generated on treeherder build, but unfortunately those tars are removed after few months. Are there any plans on having src tars released on something more permanent like <a href="http://ftp.mozilla.org">ftp.mozilla.org</a>?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Feb 05 2023 23:27:31 GMT-0800 (Pacific Standard Time)">07:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@nchevobbe:mozilla.org">nchevobbe</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>ok i tried <em>gdb</em> and can confirm this is happening due to <code>JS::Evaluate</code>. Specifically, when getting the global object.<br>The top backtrace</p>
<pre><code>JS::Evaluate (cx=cx@entry=0x7fffe7d21100, optionsArg=..., srcBuf=..., rval=rval@entry=...) at ...ff-src/mozilla-unified/js/src/vm/CompilationAndEvaluation.cpp:553
553	  RootedObject globalLexical(cx, &amp;cx-&gt;global()-&gt;lexicalEnvironment());
</code></pre>
<p>and the error logged out</p>
<pre><code>JavaScript error: resource://devtools/server/actors/resources/parent-process-document-event.js, line 93: TypeError: can't access property "innerWindowId", webProgress.browsingContext.currentWindowGlobal is null

</code></pre>
<p>So i think there is no globalThis for the current <code>ctx</code>.</p>
</blockquote></mx-reply>the devtools error might just be a consequence of the tab crash</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Feb 06 2023 05:54:17 GMT-0800 (Pacific Standard Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: yeah, PostGlobalWriteBarrier isn't ever called</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Feb 06 2023 06:00:49 GMT-0800 (Pacific Standard Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: thanks for checking. Iain's work in this area might change that though, so maybe we can wait for that</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Feb 06 2023 06:57:53 GMT-0800 (Pacific Standard Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">do we store a cached/precomputed hash code along with every JS string?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Feb 06 2023 08:17:43 GMT-0800 (Pacific Standard Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: no. We compute the hash on-demand for non-atoms. (Atoms store their hash.) For many strings, it's never computed. But it can also get computed many times for the same string.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Feb 06 2023 08:18:58 GMT-0800 (Pacific Standard Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">almost any string that gets tenured will have its hash computed at least once, for deduplication.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Feb 06 2023 08:19:20 GMT-0800 (Pacific Standard Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it would be a good experiment to try, of always storing the hash once it has been computed.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Feb 06 2023 08:20:07 GMT-0800 (Pacific Standard Time)">16:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">It costs some memory. A midway point would be to store the hash for strings that have enough slop bytes in their jemalloc allocation to fit the hash.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Feb 06 2023 08:24:07 GMT-0800 (Pacific Standard Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">filed bug 1815266</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Feb 06 2023 08:24:09 GMT-0800 (Pacific Standard Time)">16:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1815266">https://bugzil.la/1815266</a> â€” NEW (nobody) â€” Experiment: cache string hash values</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Feb 06 2023 08:29:45 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: okay, good to know. There was a claim that all JS engines have space in their JSStrings for a pre-computed hash and I didn't think that was true for us</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Feb 06 2023 08:51:17 GMT-0800 (Pacific Standard Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell">Has anyone here used V8's turbolizer much?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Feb 06 2023 08:52:37 GMT-0800 (Pacific Standard Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I've found my immersion blender works better. It comes out creamier.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Feb 06 2023 08:52:39 GMT-0800 (Pacific Standard Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(sorry)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Feb 06 2023 08:57:20 GMT-0800 (Pacific Standard Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@jrmuizel:mozilla.org">jrmuizel</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: my experience so far hasn't been that pleasant so I'm not surprised ðŸ™‚</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Feb 06 2023 10:51:31 GMT-0800 (Pacific Standard Time)">18:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> At servo/mozjs we relied on pkg archives that are generated on treeherder build, but unfortunately those tars are removed after few months. Are there any plans on having src tars released on something more permanent like <a href="http://ftp.mozilla.org">ftp.mozilla.org</a>?</blockquote></mx-reply>Unfortunately JS only source packages are not in a great shape. Current advice is to use <a href="http://ftp.mozilla.org">ftp.mozilla.org</a> and just grab the full firefox package. (see <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr102/docs/Building%20SpiderMonkey.md">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr102/docs/Building%20SpiderMonkey.md</a> for notes on this)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Feb 06 2023 15:22:52 GMT-0800 (Pacific Standard Time)">23:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">samson</span>: for historical versions, you could use old release tags eg FIREFOX_102_6_0esr_BUILD1 and make the package yourself: <code>hg up -r FIREFOX_102_6_0esr_BUILD1; python js/src/<a href="http://make-source-package.py">make-source-package.py</a></code> . Not great, I know, but it's pretty much what the <a href="https://searchfox.org/mozilla-central/rev/4fcb729dc98138af00570c0a378fbff90a167d79/taskcluster/scripts/builder/build-sm-package.sh#11">CI script does</a></td></tr>

</tbody></table></div></div></div>
</body></html>