<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-04-20</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-04-20<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-04-18" class="nav-link"><span>prev</span></a>
<a href="2020-04-21" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Apr 19 2020 18:06:23 GMT-0700 (Pacific Daylight Time)">01:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Have there ever been any discussions about removing SpiderMonkey's "guessed name" logic for anonymous functions, e.g. <code>fn/&lt;</code> as the name of an anonymous declared inside of a function called <code>fn</code>, now that ES6 has defined more cases where functions get inferred names?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Apr 19 2020 23:27:26 GMT-0700 (Pacific Daylight Time)">06:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">loganfsmyth</span>: FWIW V8 decided to keep some of its own, different logic for that, with the understanding that this was important for developer experience; there was a bunch of discussion that led to this decision. I think there are important cases where ES6 doesn't end up guessing a name.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sun Apr 19 2020 23:50:05 GMT-0700 (Pacific Daylight Time)">06:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-16">loganfsmyth</span>: FWIW V8 decided to keep some of its own, different logic for that, with the understanding that this was important for developer experience; there was a bunch of discussion that led to this decision. I think there are important cases where ES6 doesn't end up guessing a name.</blockquote></mx-reply>oh yeah? I'd be curious to know what cases V8 shows in stack traces that aren't covered by ES6 inferred names. I'm mostly coming at this from the devtools side, but it seems like it would be confusing if devtools showed a trace with naming that diverged from what the string trace shows</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sun Apr 19 2020 23:50:44 GMT-0700 (Pacific Daylight Time)">06:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">but I also haven't really put a <em>ton</em> of time into it, I just saw that it seemed like V8 leaves things anonymous much more often, at least when looking at stack trace strings</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sun Apr 19 2020 23:55:20 GMT-0700 (Pacific Daylight Time)">06:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">oh, maybe this changed later, I am not sure</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sun Apr 19 2020 23:55:41 GMT-0700 (Pacific Daylight Time)">06:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">sorry I don't remember the cases offhand</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Apr 20 2020 05:05:07 GMT-0700 (Pacific Daylight Time)">12:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">the spidermonkey heuristics are unfortunately not even self-consistent. There are differences depending on if function was initially syntax parsed or not</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Apr 20 2020 05:06:59 GMT-0700 (Pacific Daylight Time)">12:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I probably need to do something about the name resolver this week for the Stencil project too, so I'm open to changing the mechnism</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Apr 20 2020 06:03:27 GMT-0700 (Pacific Daylight Time)">13:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span> cool, thanks!</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Apr 20 2020 06:05:06 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: For what it's worth, in the devtools UI we literally chop off everything starting at the <code>/&lt;</code> right now, which is what prompted these questions. honestly it seems like the URL + line/column is probably enough now that many more functions have inferred names due to ES6's changes?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Apr 20 2020 06:05:42 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">good to know</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Apr 20 2020 06:06:16 GMT-0700 (Pacific Daylight Time)">13:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">chopping off starting at <code>/&lt;</code> is just confusing because you get 2 functions with what looks like the same name, so ideally I think it would be nicer for devtools to just treat things as anonymous</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Apr 20 2020 06:06:19 GMT-0700 (Pacific Daylight Time)">13:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1616196">https://bugzilla.mozilla.org/show_bug.cgi?id=1616196</a> for context</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Apr 20 2020 06:08:23 GMT-0700 (Pacific Daylight Time)">13:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">oh interesting</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Apr 20 2020 06:08:44 GMT-0700 (Pacific Daylight Time)">13:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">dropping guessed names entirely would be great</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Apr 20 2020 06:08:59 GMT-0700 (Pacific Daylight Time)">13:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: no problem!</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Apr 20 2020 06:09:49 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">they also mess with code-coverage. which I think would benefit from it's own synthesize name along the lines of <code>anonymous-123:1</code> with lineno/column</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Apr 20 2020 09:37:58 GMT-0700 (Pacific Daylight Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I'm very confused about <code>Debugger.script.sourceLength</code> when it comes to dynamically allocated functions.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Apr 20 2020 09:38:14 GMT-0700 (Pacific Daylight Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">We have tests that ensure... <em>a</em> behaviour, but I don't understand it.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Apr 20 2020 09:39:18 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">for <code>new Function('x', 'x*x')</code> we get a sourceLength of 32 somehow</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Apr 20 2020 09:40:04 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Here's the script I'm using to play with this (based on <code>Script-source-Start-04.js</code>)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Apr 20 2020 09:40:21 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><pre><code>let g = newGlobal({newCompartment: true});
let dbg = new Debugger(g);

var count = 0;
function test(string, range) {
  dbg.onNewScript =
      function(script) {
    ++count;

    print(
        '\'' + script.source.text + '\' &lt;' + string.length + '&gt; (' +
        script.sourceStart + ', ' + script.sourceLength + ')' +
        ((count % 2 == 0) ? '  eval' : '  top'));
  }

      g.eval(string);
}

test('eval(\'2 * 3\')', [0, 5]);
test('new Function(\'2 * 3\')', [0, 31]);
test('new Function(\'x\', \'x * x\')', [0, 32]);
assertEq(count, 6);

</code></pre>
</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Apr 20 2020 09:40:59 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><p>which produces the following output</p>
<pre><code>'eval('2 * 3')' &lt;13&gt; (0, 13)  top
'2 * 3' &lt;13&gt; (0, 5)  eval
'new Function('2 * 3')' &lt;21&gt; (0, 21)  top
'2 * 3' &lt;21&gt; (0, 31)  eval
'new Function('x', 'x * x')' &lt;26&gt; (0, 26)  top
'x * x' &lt;26&gt; (0, 32)  eval
</code></pre>
<p>(Where the numbers in parens are the sourceStart,sourceLength pair)</p>
</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Apr 20 2020 09:42:36 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">The <code>eval</code> case makes perfect sense to me; top level script has the range I expect; contents also have the sensible range. The top level ranges make sense for <code>new Function</code> too, which is perfectly fine (it's just another eval range in this script).</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Apr 20 2020 09:47:30 GMT-0700 (Pacific Daylight Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If I enter <code>new Function('x', 'x * x')</code> in the shell, I get something like <code>(function anonymous(x) {x * x})</code> (with some weird newlines in the middle)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Apr 20 2020 09:48:16 GMT-0700 (Pacific Daylight Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which is ~32 characters long, if you fudge the newlines a bit</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Apr 20 2020 09:49:28 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">And <code>new Function('2 * 3')</code> gets <code>(function anonymous() {2 * 3})</code></td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Apr 20 2020 09:49:33 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which is exactly 1 character shorter</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Apr 20 2020 09:49:46 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: ^</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Apr 20 2020 09:52:43 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">O.o </td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Apr 20 2020 09:52:49 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">but </td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Apr 20 2020 09:52:49 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">urk </td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Apr 20 2020 09:53:22 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">script.source.text != the text that the source lengths apply to</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Apr 20 2020 09:53:34 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">instead they apply to the <code>toString</code> text?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Apr 20 2020 09:53:39 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">not confusing -at all- </td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Apr 20 2020 09:54:57 GMT-0700 (Pacific Daylight Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(good catch <span class="nick-4">iain</span> tho)</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Apr 20 2020 09:56:11 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I think this just means the documentation for Debugger.script.sourceLength is wrong. Will open a bug.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Apr 20 2020 10:17:18 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1631510">https://bugzilla.mozilla.org/show_bug.cgi?id=1631510</a></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Apr 20 2020 14:24:06 GMT-0700 (Pacific Daylight Time)">21:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell">hi! how do you folks feel about multiple <code>ArrayBuffer</code> instances pointing to the intersecting ranges of memory in some backing store?</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Apr 20 2020 14:24:12 GMT-0700 (Pacific Daylight Time)">21:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell">is that even possible with our JS engine?</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Apr 20 2020 14:25:16 GMT-0700 (Pacific Daylight Time)">21:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">The data underlying an ArrayBuffer can be one of various sorts, including a user-provided form that <em>could</em> allow intersection, if it were coded up right.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Apr 20 2020 14:26:15 GMT-0700 (Pacific Daylight Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I don't think I <em>necessarily</em> would strongly oppose something like this, but I think you're going to have to have a fairly good reason to expose something that worked this way, that can <em>only</em> work this way.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Apr 20 2020 14:26:58 GMT-0700 (Pacific Daylight Time)">21:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Bug 1529298 made our ArrayBuffer backing-store story actually coherent, so it's not dramatically difficult any more to add new sorts of backing stores.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Apr 20 2020 14:27:00 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1529298">https://bugzil.la/1529298</a> ‚Äî RESOLVED (Waldo) ‚Äî Make ArrayBuffer's handling of kinds and data-ownership sane and simple and understandable</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Apr 20 2020 14:27:04 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell">for the context, we are discussing <a href="https://github.com/gpuweb/gpuweb/pull/708">https://github.com/gpuweb/gpuweb/pull/708</a> which requires that</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Apr 20 2020 14:27:32 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I guess the question is if IonMonkey considers the memory space as aliasing</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon Apr 20 2020 14:27:48 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it's almost like you want different /views/ on an ArrayBuffer. Any chance you could use an ArrayBufferView -- like a typed array or DataView?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon Apr 20 2020 14:27:50 GMT-0700 (Pacific Daylight Time)">21:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell">in our case, the backing store is something our WebGPU implementation provides (i.e. a part of shmem)</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon Apr 20 2020 14:28:00 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">( :-) )</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon Apr 20 2020 14:28:32 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">If memory serves, IonMonkey considers the elements of typed array data to all be aliasing each other, so I don't think IonMonkey would be affected by this.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon Apr 20 2020 14:29:40 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, looks like we don't do anything clever in Ion</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon Apr 20 2020 14:29:56 GMT-0700 (Pacific Daylight Time)">21:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> it's almost like you want different /views/ on an ArrayBuffer. Any chance you could use an ArrayBufferView -- like a typed array or DataView?</blockquote></mx-reply>if we return any of the actual <em>view</em>, the user is technically able to get access to the full <code>ArrayBuffer</code> that backs it, but we don't want them to access anything outside of some bounds</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon Apr 20 2020 14:30:24 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Hrm, <code>AliasSet</code> doesn't actually contain an item clearly for the data of a typed array.  üßê  Not sure offhand which alias type is used for this...</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon Apr 20 2020 14:30:57 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Maybe that's <code>UnboxedElement</code>?  Not sure.</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon Apr 20 2020 14:31:41 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Yeah, looks like it.  <a href="https://searchfox.org/mozilla-central/search?q=symbol:E_%3CT_js%3A%3Ajit%3A%3AAliasSet%3A%3AFlag%3E_UnboxedElement&amp;redirect=false">https://searchfox.org/mozilla-central/search?q=symbol:E_%3CT_js%3A%3Ajit%3A%3AAliasSet%3A%3AFlag%3E_UnboxedElement&amp;redirect=false</a></td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon Apr 20 2020 14:31:50 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh, this is for access restrictions? Bleh, it does feel a little like adding a 3rd layer with mostly the same relationship between the bottom 2 layers as between the top 2.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon Apr 20 2020 14:31:51 GMT-0700 (Pacific Daylight Time)">21:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I'm not sure I'm a fan of the name, but eh.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon Apr 20 2020 14:32:42 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I think we try to support typedobjects with that as well</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon Apr 20 2020 14:32:54 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I guess to avoid that messiness, you'd need to have a way to lock a typed array to its viewed region or something, and that feels even worse</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon Apr 20 2020 14:33:25 GMT-0700 (Pacific Daylight Time)">21:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">ah no atomics?</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon Apr 20 2020 14:34:15 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> oh, this is for access restrictions? Bleh, it does feel a little like adding a 3rd layer with mostly the same relationship between the bottom 2 layers as between the top 2.</blockquote></mx-reply>roughly speaking, we have a full range of [0.. X] of data, non-visible to the user. They say they want to change [a..b] of it, we give them an ArrayBuffer for this part only, once done we can flush this data to the GPU. If they could access the whole [0..X], we'd have to flush everything unnecessarily.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon Apr 20 2020 14:35:25 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: so what's the conclusion to this? All is good and supported? We need to investigate, i.e. I'll file an issue. Or no, please don't do that?</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon Apr 20 2020 14:37:25 GMT-0700 (Pacific Daylight Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">kvark</span>: My conclusion is that the <em>idea</em> of an <code>ArrayBuffer</code> that wraps a memory range, part of which may be wrapped by a separate <code>ArrayBuffer</code>, is conceptually not a problem for our implementation.  Whether <em>your particular use</em> is best and properly satisfied by actually doing this, is a distinct question.</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon Apr 20 2020 14:37:54 GMT-0700 (Pacific Daylight Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">what should happen when you try to structured clone one of these beasties? I think right now we might copy externally backed ABOs, but I need to check.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon Apr 20 2020 14:38:17 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ah, no, they error out</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Mon Apr 20 2020 14:38:25 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Or in other words, I want a whole lot more precise detail about what it is you're trying to do, what your solution is, and let's consider the set of possible approaches to satisfying it to say that what you want is the right way to do it.  <em>Technically</em> this is not an impossibility at all, but that doesn't say we should do it!</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Mon Apr 20 2020 14:38:28 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">so as long as you're using external memory, structured clone is ok</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Mon Apr 20 2020 14:38:52 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: would an issue be appropriate? Or is it easier to discuss here in more detail?</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Mon Apr 20 2020 14:39:03 GMT-0700 (Pacific Daylight Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I believe <span class="nick-3">kvark</span> is trying to decide whether and how hard to push back</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Mon Apr 20 2020 14:39:48 GMT-0700 (Pacific Daylight Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">kvark</span>: Probably a writeup in a bug would be best, to lay it out most concisely and clearly, but I could chat here too.</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Mon Apr 20 2020 14:43:23 GMT-0700 (Pacific Daylight Time)">21:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell">I'll try here, and if we are lost, the parts will be handy to copy out to a bug.<br>So imagine the user wants to update some GPU buffer, which is a chunk of memory they can't access directly. Imagine that we as the implementation have the contents of that data in a shmem. We want to give them a way to modify it, but we also want to only send the data to the GPU that they <em>have</em> modified.<br>So the API in question is about providing them with an <code>ArrayBuffer</code> on demand that sees a sub-range of that whole shmem. The proposal says that the user can request intersecting sub-ranges. It doesn't matter from the user or the API perspective, but I wonder if it matters from yours. Once the user is done messing with these <code>ArrayBuffer</code> objects, we figure out all the sub-ranges that were requested and flush them to the GPU.</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Mon Apr 20 2020 14:45:22 GMT-0700 (Pacific Daylight Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell">If we require the sub-ranges to be non-intersecting, we'd need to add some constraints on the alignment, and also force the code on the content side to keep track of which sub-ranges have been requested, so that we error on a collision. All in all, this is a bit more work, but possible.</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Mon Apr 20 2020 14:54:21 GMT-0700 (Pacific Daylight Time)">21:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@kvark:matrix.org">kvark</span>&gt;</div></td><td class="msg-cell">filed bug 1631616
please let me know if anything needs to be clarified</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Mon Apr 20 2020 14:54:24 GMT-0700 (Pacific Daylight Time)">21:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1631616">https://bugzil.la/1631616</a> ‚Äî NEW (nobody) ‚Äî Exposing multiple ArrayBuffer objects that intersect in their view of an external backing store</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Mon Apr 20 2020 15:16:29 GMT-0700 (Pacific Daylight Time)">22:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">kvark</span>, <span class="nick-12">sfink</span>: Commented.  I think the spec proposal is probably fine from the JS point of view.  But, if you're going to allow these ranges to be unaligned, we do have a small touch of work to do, unless I'm misreading/misremembering our current code.  (Do please double-check me on my comment, <span class="nick-12">sfink</span>!)</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Mon Apr 20 2020 16:09:18 GMT-0700 (Pacific Daylight Time)">23:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@cfallin:mozilla.org">cfallin</span>&gt;</div></td><td class="msg-cell">It's been a little bit since I've built a SpiderMonkey shell and I'm hitting a Python error during configure, namely <code>No module named mozversioncontrol</code>. Tried re-<code>mach bootstrap</code>'ing. Did something change recently or do I just have demons in my setup?</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Mon Apr 20 2020 16:09:35 GMT-0700 (Pacific Daylight Time)">23:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@cfallin:mozilla.org">cfallin</span>&gt;</div></td><td class="msg-cell">(transcript paste here: <a href="https://paste.mozilla.org/KGqWcYxp">https://paste.mozilla.org/KGqWcYxp</a>)</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Mon Apr 20 2020 16:10:01 GMT-0700 (Pacific Daylight Time)">23:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">cfallin</span>: Do you need to rerun <code>autoconf213</code>?</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Mon Apr 20 2020 16:10:35 GMT-0700 (Pacific Daylight Time)">23:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@cfallin:mozilla.org">cfallin</span>&gt;</div></td><td class="msg-cell">... and Waldo saves the day. Thanks much!</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Mon Apr 20 2020 16:16:31 GMT-0700 (Pacific Daylight Time)">23:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">confession: Hooked up the new regexp engine to libFuzzer. Good news: haven't found any non-trivial bugs yet. Bad news: that includes the known bug that I reinserted for testing purposes.</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Mon Apr 20 2020 16:16:33 GMT-0700 (Pacific Daylight Time)">23:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Mon Apr 20 2020 16:47:13 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span></div></td><td class="msg-cell">sighs</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Mon Apr 20 2020 16:47:40 GMT-0700 (Pacific Daylight Time)">23:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Frontend name collection types are a mazy of twisty templates, and it's difficult to see how and where triviality matters in them.</td></tr>

</tbody></table></div></div></div>
</body></html>