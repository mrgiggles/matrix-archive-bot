<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-10-19</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-10-19<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-10-16" class="nav-link"><span>prev</span></a>
<a href="2020-10-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Oct 19 2020 06:16:05 GMT-0700 (Pacific Daylight Time)">13:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">I'm taking a look at JS HTMLDocument (NativeObject), but it has no shape, and therefore no properties, is this normal?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Oct 19 2020 06:24:32 GMT-0700 (Pacific Daylight Time)">13:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Is it a proxy?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Oct 19 2020 06:25:31 GMT-0700 (Pacific Daylight Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">It's the 'wrapper' on a C++ object.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Oct 19 2020 06:26:31 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">I know, I still think it's a proxy</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Oct 19 2020 06:26:44 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">What I'm trying to do is find the link between a C++ mozilla::dom::document, and the JS wrapper around it, but the wrapper doesn't seem to contain any identifier information, so I'm not sure how it knows what it is.  If that makes any sense.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Oct 19 2020 06:28:08 GMT-0700 (Pacific Daylight Time)">13:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">I don't have much time right now, but you could start here: <a href="https://searchfox.org/mozilla-central/source/dom/html/nsHTMLDocument.cpp#138">https://searchfox.org/mozilla-central/source/dom/html/nsHTMLDocument.cpp#138</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Oct 19 2020 06:28:37 GMT-0700 (Pacific Daylight Time)">13:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">I'll have a read, thanks</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Oct 19 2020 06:42:55 GMT-0700 (Pacific Daylight Time)">13:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://paste.mozilla.org/gfGsyL1H">https://paste.mozilla.org/gfGsyL1H</a> If someone can figure this one … All 3 functions are called the same way … calling the same code, and called the same way …</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Oct 19 2020 06:43:35 GMT-0700 (Pacific Daylight Time)">13:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: ^ I am adding the test case … just having some trouble figuring out what goes wrong.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Oct 19 2020 06:46:26 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: curious.. maybe step through it with rr? </td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Oct 19 2020 06:47:06 GMT-0700 (Pacific Daylight Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I am not sure rr would be pleased by the x86 part of this execution, but I should try.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Oct 19 2020 06:47:50 GMT-0700 (Pacific Daylight Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">ah 32 bit. Hm </td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Oct 19 2020 06:53:59 GMT-0700 (Pacific Daylight Time)">13:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">Looking in the about:memory GC verbose output, I can see '00000320653F00C0 [gc.marked] JS Object (HTMLDocument)', how does it know that this object is an 'HTMLDocument'.  Is there a GUID or similar for it?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Oct 19 2020 06:55:28 GMT-0700 (Pacific Daylight Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the JSClass name (something like <code>obj-&gt;group-&gt;clasp-&gt;name</code>)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Oct 19 2020 06:55:57 GMT-0700 (Pacific Daylight Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">Ahh OK, thanks.  I'll check that out</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Oct 19 2020 06:57:21 GMT-0700 (Pacific Daylight Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">haggar</span>: because it's a proxy, it's calling <a href="https://searchfox.org/mozilla-central/source/__GENERATED__/dom/bindings/HTMLDocumentBinding.cpp#798-800">the hook here</a> I think</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Oct 19 2020 06:57:58 GMT-0700 (Pacific Daylight Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">proxy handlers can override the class name</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Oct 19 2020 07:03:07 GMT-0700 (Pacific Daylight Time)">14:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">Gotcha, I'll go take a look at the group-&gt;clasp, thanks</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Oct 19 2020 07:14:27 GMT-0700 (Pacific Daylight Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: it seems to be either the <code>fldl</code> or <code>fstpl</code>: <code>fldl (eax) ; fstpl -0x40(ebp)</code>, reading the memory at <code>eax</code> gives the expected pattern, but doing the same with <code>ebp - 0x40</code> show the nan one.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Oct 19 2020 07:18:52 GMT-0700 (Pacific Daylight Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: is the problem that it's a nan value that gets canonicalized?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Oct 19 2020 07:19:23 GMT-0700 (Pacific Daylight Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">That's what I had thought, but I toogled one bit of the exponent … :/</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Oct 19 2020 07:20:24 GMT-0700 (Pacific Daylight Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">and it might also be related to the FP stack, as this does not do it for the previous one.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Oct 19 2020 07:24:09 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">the funny thing is that the same instruction are executed once more after, but no such truncation happen.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Oct 19 2020 07:25:47 GMT-0700 (Pacific Daylight Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I wonder if I could have a bug in my CPU which overly round to NaN for one FP stack entry :P</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Oct 19 2020 07:56:40 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: I've taken a look at the group-&gt;clasp, and it's empty, so how do I deal with the object, if it's a proxy?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Oct 19 2020 07:57:15 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">haggar</span>: what do you mean by empty? is the <code>clasp-&gt;name</code> an empty string?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Oct 19 2020 07:57:33 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">Well I'm currently working with a memory dump, so..</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Oct 19 2020 07:57:44 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">dt js::nativeobject 320653F00C0<br>xul!js::NativeObject<br>+0x000 headerAndGroup_  : js::gc::CellHeaderWithTenuredGCPointer<a href="js::ObjectGroup">js::ObjectGroup</a></td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Oct 19 2020 07:57:57 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">RESERVED_MASK    : 0x7 [Type: unsigned __int64]<br>FORWARD_BIT      : 0x1 [Type: unsigned _<em>int64]<br>[+0x000] header</em>          : 0x320653de760 [Type: unsigned __int64]<br>3:056&gt; dt jsclass 320653de760<br>xul!JSClass<br>+0x000 name             : 0x00007ff9<code>826b05e8  "o???" +0x008 flags            : 0x653e20d0 +0x010 cOps             : 0x0000019e</code>07f05c00 JSClassOps<br>+0x018 spec             : 0x00000000`40000000 js::ClassSpec<br>+0x020 ext              : (null)<br>+0x028 oOps             : (null)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Oct 19 2020 07:59:55 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">So the value in the header isn't a valid pointer.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Oct 19 2020 08:00:06 GMT-0700 (Pacific Daylight Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">isn't the value at 0x320653de760 an ObjectGroup instead of a JSClass?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Oct 19 2020 08:00:34 GMT-0700 (Pacific Daylight Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">Yes, sorry, let me correct that</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Oct 19 2020 08:01:56 GMT-0700 (Pacific Daylight Time)">15:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">OK, there's a bug in my code, not to worry :)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Oct 19 2020 08:02:00 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@haggar:mozilla.org">haggar</span>&gt;</div></td><td class="msg-cell">Thanks</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Oct 19 2020 08:03:47 GMT-0700 (Pacific Daylight Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: ok, I think I found the issue, I do not call callWithABI with the proper MoveOp for popping the return value, which causes it to remain on the FP&nbsp;stack and to overflow the FP stack (which is quite short)</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Oct 19 2020 08:04:53 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: good find!</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Oct 19 2020 08:06:32 GMT-0700 (Pacific Daylight Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">the FP stack is a pain</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Oct 19 2020 09:56:08 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: You're right that if that code clobbered any slots for let/const/class bindings, it just so happens we would emit bytecode to re-re-clobber those with <code>UninitializedValue</code> later; BUT</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Oct 19 2020 09:56:21 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: more immediately, there are only vars in this scope</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Oct 19 2020 09:56:37 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">so that won't happen to begin with. i'm adding an assertion and a comment to that effect now</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Oct 19 2020 09:56:54 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">or rather, i have, and now i'm running unit tests and biting my nails</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Oct 19 2020 09:57:50 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">(for everyone else: these remarks are about <a href="https://phabricator.services.mozilla.com/D93859#inline-531493">https://phabricator.services.mozilla.com/D93859#inline-531493</a>)</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Oct 19 2020 10:02:07 GMT-0700 (Pacific Daylight Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">this scope being the expression parameter scope? </td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Oct 19 2020 10:02:54 GMT-0700 (Pacific Daylight Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: ah, i see. <em>No</em>, and it's important</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Oct 19 2020 10:03:28 GMT-0700 (Pacific Daylight Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">there's something we call an "extra body var" scope</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Oct 19 2020 10:04:30 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(I feel like I'm executing the socratic method with you, except I've got no idea of what's going on :P) </td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon Oct 19 2020 10:04:57 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">well... and i don't either, which only makes it more socratic</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon Oct 19 2020 10:05:05 GMT-0700 (Pacific Daylight Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">heh </td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon Oct 19 2020 10:05:11 GMT-0700 (Pacific Daylight Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">ok, step 28 of <a href="https://tc39.es/ecma262/#sec-functiondeclarationinstantiation">https://tc39.es/ecma262/#sec-functiondeclarationinstantiation</a></td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon Oct 19 2020 10:05:50 GMT-0700 (Pacific Daylight Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">oi. OK. I follow a bit :) </td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon Oct 19 2020 10:06:31 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">The method where I added new <code>undefined</code>-blitting is <code>EmitterScope::enterFunctionExtraBodyVar</code></td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon Oct 19 2020 10:06:56 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">This scope will exist -wherever- we have expression parameters? </td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon Oct 19 2020 10:07:12 GMT-0700 (Pacific Daylight Time)">17:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(attempting to understand if it's a complete solution) </td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon Oct 19 2020 10:07:51 GMT-0700 (Pacific Daylight Time)">17:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: That I really don't know. It's unclear just how much we differ from the spec.</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon Oct 19 2020 10:10:31 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: OK, it looks like this is the only place where the bit controlling this scope is set: <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#1866">https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#1866</a></td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon Oct 19 2020 10:11:26 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">so it's like <code>parameterExprs &amp;&amp; (bodyVars || bodyDirectEval)</code></td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon Oct 19 2020 10:12:21 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">I think the reason all this is so muddy in my head is that the spec</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon Oct 19 2020 10:12:44 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">kind of treats the <code>var</code> scope and the body-block <code>let/const/class</code> scope as the same, for the purpose of early errors</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon Oct 19 2020 10:12:59 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">but in terms of how it all actually mechanically works at run time, they're clearly distinct</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon Oct 19 2020 10:13:43 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">(<code>bodyVars</code> in my pseudocode also counts function-local <code>function</code>s)</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon Oct 19 2020 10:14:14 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(Sorry -- had to run away; having home maintenence done at the moment). </td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon Oct 19 2020 10:14:57 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">(it's ok, you're autopunished by my unchecked bloviation :-P )</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon Oct 19 2020 10:17:39 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Ok. So; we have an extra function var scope, this is where corresponds to the environment where direct eval created bindings would go. As well, if you have a parameter expression, that same scope is used, to avoid function bindings leaking into parameters. 

The slots corresponding to this scope are the ones you're resetting to Undefined, to avoid leaking the contents of those slots after we've finished evaluating the parameters. </td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon Oct 19 2020 10:18:12 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">these slots are then the only set that are shared in a frame; so the only ones we need to worry about resetting </td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon Oct 19 2020 11:24:12 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">Waldo</span>: hopefully I didn't miss anything too critical in the reviews. At least there is a full cycle to catch leaks :)</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Mon Oct 19 2020 11:29:27 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: OK, I uploaded a patch with a bit more in the comments. You mentioned also possibly commenting on when slots are initialized to <code>undefined</code></td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Mon Oct 19 2020 11:30:20 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: I think that is best seen as a property of the "spec" of the bytecode language, or whatever we call that contract that function script stencils are supposed to follow</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Mon Oct 19 2020 11:30:43 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">rather than something that happens on a particular line of code, as that varies from one execution engine to the next</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Mon Oct 19 2020 11:32:36 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: for the interpreter, it happens here <a href="https://searchfox.org/mozilla-central/source/js/src/vm/Stack-inl.h#261,264">https://searchfox.org/mozilla-central/source/js/src/vm/Stack-inl.h#261,264</a></td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Mon Oct 19 2020 11:34:16 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: anyway, will comment whatever helps, feel free to throw it back to me again</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Mon Oct 19 2020 11:34:21 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">afk for a bit</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Mon Oct 19 2020 11:35:04 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">btw I still have a few odds and ends, and dump functions, from this generator stuff that I want to get into phabricator before starting on private methods</td></tr>

</tbody></table></div></div></div>
</body></html>