<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-04-02</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-04-02<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-04-01" class="nav-link"><span>prev</span></a>
<a href="2020-04-03" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Apr 01 2020 17:51:16 GMT-0700 (Pacific Daylight Time)">00:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: not necessarily, or at least I once implemented that for weakmap stuff. But jonco pointed out some simplifications, and at the end of fixing things up I didn't need it anymore.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Apr 02 2020 00:32:51 GMT-0700 (Pacific Daylight Time)">07:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Is there any expected interaction between a return-false w/o pending exception termination and XPCOM? For instance <a href="https://searchfox.org/mozilla-central/rev/7fba7adfcd695343236de0c12e8d384c9b7cd237/js/xpconnect/src/XPCWrappedNative.cpp#1175">https://searchfox.org/mozilla-central/rev/7fba7adfcd695343236de0c12e8d384c9b7cd237/js/xpconnect/src/XPCWrappedNative.cpp#1175</a> Is there an <code>nsresult</code> value that represents termination, or a way to propagate termination outward, or is it expected that any called function should create a pending exception in the case where there is an error but no pending exception? Or is this case just not expected to ever really happen to begin with?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Apr 02 2020 00:37:27 GMT-0700 (Pacific Daylight Time)">07:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I was recently debugging an issue where code was unexpectedly terminated, but the termination was swallowed making it harder to track down. The code assumes that all <code>return false;</code> errors will have set a pending exception, and so when there isn't a pending exception, the error condition is swallowed. I don't expect to actually terminate like this in non-buggy code, but it made me curious if there was a way to at least more nicely surface a termination instead of swallowing it.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Apr 02 2020 00:39:12 GMT-0700 (Pacific Daylight Time)">07:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">loganfsmyth</span>: XPCOM is not required to set a pending exception</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Apr 02 2020 00:39:33 GMT-0700 (Pacific Daylight Time)">07:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">In fact, the code that you linked to handles setting it:</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Apr 02 2020 00:39:41 GMT-0700 (Pacific Daylight Time)">07:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><pre><code class="language-c++">  if (NS_FAILED(mInvokeResult)) {
    ThrowBadResult(mInvokeResult, mCallContext);
</code></pre>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Apr 02 2020 00:40:25 GMT-0700 (Pacific Daylight Time)">07:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Sorry I didn't quite know how much information to include</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Apr 02 2020 00:40:56 GMT-0700 (Pacific Daylight Time)">07:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">this is a case there the code in <code>Invoke</code> itself then calls back into JS. If that JS code is terminated, what should <code>Invoke</code> do?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Apr 02 2020 00:41:17 GMT-0700 (Pacific Daylight Time)">07:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">should it set a pending exception? Should it return a specific <code>nsresult</code>?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Apr 02 2020 00:41:34 GMT-0700 (Pacific Daylight Time)">07:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Oh, hmm</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Apr 02 2020 00:42:13 GMT-0700 (Pacific Daylight Time)">07:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">or is the answer that termination is never expected in this context</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Apr 02 2020 00:42:39 GMT-0700 (Pacific Daylight Time)">07:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">So you've got approximately <code>CallMethodHelper::Invoke() ‚Üí some xpcom method ‚Üí JS::Call</code> where <code>JS::Call</code> returns false without a pending exception?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Apr 02 2020 00:43:22 GMT-0700 (Pacific Daylight Time)">07:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Apr 02 2020 00:43:48 GMT-0700 (Pacific Daylight Time)">07:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">That's not quite as obvious :)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Apr 02 2020 00:44:14 GMT-0700 (Pacific Daylight Time)">07:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Potentially <code>NS_ERROR_UNCATCHABLE_EXCEPTION</code></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Apr 02 2020 00:45:27 GMT-0700 (Pacific Daylight Time)">07:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Yeah, that should work</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Apr 02 2020 00:45:47 GMT-0700 (Pacific Daylight Time)">07:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">as I said, the termination was accidental and unexpected so this is not a path real code is expected to hit, it just happened to make debugging a separate issue more complicated</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Apr 02 2020 00:46:11 GMT-0700 (Pacific Daylight Time)">07:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">trying to decide if I should at least throw together a patch to make the error more obvious in the future</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Apr 02 2020 00:46:12 GMT-0700 (Pacific Daylight Time)">07:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">That would go into the code I quoted before, and then get handled in <a href="https://searchfox.org/mozilla-central/source/dom/bindings/Exceptions.cpp#109">https://searchfox.org/mozilla-central/source/dom/bindings/Exceptions.cpp#109</a> will handle it</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Apr 02 2020 00:47:07 GMT-0700 (Pacific Daylight Time)">07:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Whether we're expecting all xpcom that calls into js to take that into account... I don't know</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Apr 02 2020 00:47:35 GMT-0700 (Pacific Daylight Time)">07:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">I would have asked bz, not sure who'd know now... <span class="nick-16">mccr8</span>, maybe?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Apr 02 2020 00:48:39 GMT-0700 (Pacific Daylight Time)">07:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Okie doke. Yeah the issue is here: <a href="https://searchfox.org/mozilla-central/rev/7fba7adfcd695343236de0c12e8d384c9b7cd237/js/xpconnect/loader/mozJSSubScriptLoader.cpp#490">https://searchfox.org/mozilla-central/rev/7fba7adfcd695343236de0c12e8d384c9b7cd237/js/xpconnect/loader/mozJSSubScriptLoader.cpp#490</a> Due to a Debugger bug we were in some cases actually terminating the script loaded by <code>loadSubScript</code> but then since that uniformly returns <code>NS_OK</code> it depends heavily on there being a pending exception, otherwise the termination is swallowed</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Apr 02 2020 00:49:44 GMT-0700 (Pacific Daylight Time)">07:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">so the script I was trying to load was just silently never actually loading</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Apr 02 2020 00:50:29 GMT-0700 (Pacific Daylight Time)">07:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">bholley</span> has blame, but not sure how recently he's been around in that code, either</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Apr 02 2020 00:51:52 GMT-0700 (Pacific Daylight Time)">07:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">okie doke. I'm heading out soon but when I find time to come back to this I'll see what I can do</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Apr 02 2020 00:52:08 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">üëçÔ∏è</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Apr 02 2020 00:52:22 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">(Do you often end up hitting such obscure issues? :))</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Apr 02 2020 00:52:50 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I hope not hahah</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Apr 02 2020 00:53:23 GMT-0700 (Pacific Daylight Time)">07:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">only when the debugger is debugging itself on accident</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Apr 02 2020 02:35:14 GMT-0700 (Pacific Daylight Time)">09:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">who debugs the debuggers?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Apr 02 2020 03:47:04 GMT-0700 (Pacific Daylight Time)">10:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">is there a way to get information on what the event loop is doing?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Apr 02 2020 05:07:22 GMT-0700 (Pacific Daylight Time)">12:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: <span class="nick-12">sfink</span>  fwiw, I believe Apple's concerns are something like, not that it would block on the main thread, but rather that it's an API that is only useful in the context of never returning to the event loop, which is a story they are not sold on yet. So maybe there's broader things about how Wasm would be used, that would be good to discuss with them.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Apr 02 2020 05:08:04 GMT-0700 (Pacific Daylight Time)">12:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">(I think we're all on the same page about the interoperability concern, that this exposes GC timing in a tighter way, but, well, that's just part of the tradeoff.)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Apr 02 2020 05:19:48 GMT-0700 (Pacific Daylight Time)">12:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">lth</span>: You've written a detailed explanation of the motivation of cleanupSome. Tomorrow, in TC39, we expect to hear from Apple about why they'd like cleanupSome to be split into a separate Stage 2 proposal. I'm wondering, should we publish your explanation to the committee for their consideration?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Apr 02 2020 05:22:00 GMT-0700 (Pacific Daylight Time)">12:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">I don't see anything about splitting cleanupSome into a separate Stage 2 proposal that would inherently mean that w couldn't come back and do the exact same thing later (or prohibited only in the main thread), but I also don't really see how we'd meet the requirements Apple set out in <a href="https://github.com/tc39/proposal-weakrefs/issues/197#issuecomment-607577781">https://github.com/tc39/proposal-weakrefs/issues/197#issuecomment-607577781</a> . I'm wondering how this impacts the acceptability of splitting out cleanupSome from the rest of the WeakRefs proposal.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Apr 02 2020 05:38:41 GMT-0700 (Pacific Daylight Time)">12:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: yulia is handling this on our behalf</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Apr 02 2020 05:39:59 GMT-0700 (Pacific Daylight Time)">12:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: on a completely different topic, do you have an opinion about <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1626363">https://bugzilla.mozilla.org/show_bug.cgi?id=1626363</a>?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Apr 02 2020 05:40:14 GMT-0700 (Pacific Daylight Time)">12:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell">it seems like a rendering issue on a wasm spec that you've created</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Apr 02 2020 05:47:12 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">lth</span>: so, I copy-pasted those weird characters from the Wasm core spec, for consistency</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Apr 02 2020 05:47:33 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: so maybe i should ask binji?</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Apr 02 2020 05:47:33 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">We could use something else, so find-replace is easier</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Apr 02 2020 05:47:49 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">well, maybe <span class="nick-12">Ms2ger [~half-time dedication]</span> would have an opinion?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Apr 02 2020 05:48:06 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">he's the current Wasm JS API editor</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Apr 02 2020 05:48:13 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell">ah good point</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Apr 02 2020 05:48:38 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">I guess users might expect something stronger than NFKC, like removing accent marks, in the find function (I imagine Firefox already does something like this?)</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Apr 02 2020 05:48:39 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">lth</span>: I want to kill those with fire</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Apr 02 2020 05:48:46 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-15" title="@aramine:mozilla.org">nox</span></div></td><td class="msg-cell">is always infuriated when Firefox cares about accents and whatnot when looking for something in a page.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Apr 02 2020 05:49:05 GMT-0700 (Pacific Daylight Time)">12:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">lth</span>: but find-in-page should perhaps still find them</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Apr 02 2020 05:49:18 GMT-0700 (Pacific Daylight Time)">12:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">also it send shivers up my spine to think that someone wants to use NFKC/NFKD normalization, so I second "killing it with fire"</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Apr 02 2020 05:49:41 GMT-0700 (Pacific Daylight Time)">12:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Ah TIL that was fixed recently.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Apr 02 2020 05:50:00 GMT-0700 (Pacific Daylight Time)">12:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">nox</span>: Any idea what sort of normalization that does?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Apr 02 2020 05:50:37 GMT-0700 (Pacific Daylight Time)">12:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">No clue.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Apr 02 2020 05:50:50 GMT-0700 (Pacific Daylight Time)">12:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=202251">https://bugzilla.mozilla.org/show_bug.cgi?id=202251</a> This is where this was fixed</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu Apr 02 2020 05:51:01 GMT-0700 (Pacific Daylight Time)">12:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">I also would love it if the core wasm spec would use actual ascii codepoints when it can, but that's certainly a fight for another day</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu Apr 02 2020 05:51:20 GMT-0700 (Pacific Daylight Time)">12:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@lth:mozilla.org">lth</span>&gt;</div></td><td class="msg-cell">"opened 17 years ago"</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu Apr 02 2020 05:52:24 GMT-0700 (Pacific Daylight Time)">12:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><a href="https://hg.mozilla.org/integration/autoland/rev/828a10a79e71#l3.35">https://hg.mozilla.org/integration/autoland/rev/828a10a79e71#l3.35</a> Looks custom?</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu Apr 02 2020 05:53:01 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">It just calls unorm2_getDecomposition on each char AFAICT.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu Apr 02 2020 05:53:05 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">Ms2ger [~half-time dedication]</span>: Wanna write up a PR for this?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu Apr 02 2020 05:53:21 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: for the jsapi spec? Yeah, will do at some point</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu Apr 02 2020 05:53:42 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: UNORM2_DECOMPOSE&nbsp;Map, and reorder canonically.<br>Same as standard NFD when using an "nfc" instance. Same as standard<br>NFKD when using an "nfkc" instance. For details about standard Unicode<br>normalization forms see <a href="http://www.unicode.org/unicode/reports/tr15/">http://www.unicode.org/unicode/reports/tr15/</a></td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu Apr 02 2020 05:54:37 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@aramine:mozilla.org">nox</span>&gt;</div></td><td class="msg-cell">Ah and the instance is returned by unorm2_getNFDInstance, so standard NFD</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu Apr 02 2020 05:55:28 GMT-0700 (Pacific Daylight Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: it's been on my todo list since July 2018, it can wait a bit more :)</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu Apr 02 2020 07:21:21 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: <span class="nick-11">sdetar</span>: My internet access is pretty sketchy this morning. I'll be at the triage meeting unless it goes out entirely though.</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu Apr 02 2020 07:36:14 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@sdetar:mozilla.org">sdetar</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: No problem, see you in a little bit.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu Apr 02 2020 07:54:58 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-10">yulia</span>: <span class="nick-12">sfink</span>  fwiw, I believe Apple's concerns are something like, not that it would block on the main thread, but rather that it's an API that is only useful in the context of never returning to the event loop, which is a story they are not sold on yet. So maybe there's broader things about how Wasm would be used, that would be good to discuss with them.</blockquote></mx-reply>right, sorry, I made up the whole "block the main thread" thing based on misunderstanding the concern initially, purely because "main thread" was mentioned. I eventually worked my way past that, and ended up in a somewhat similar place as the Apple folks.</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu Apr 02 2020 07:56:21 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm now wondering whether anything similar comes up in the context of Promises, where iirc stuff also happens at the end of the task loop (or whatever it's called). How are Promises used in long-running Workers?</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu Apr 02 2020 07:59:49 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">right, so when you're programming in the way where you need cleanupSome, these things just don't fit together. I think that's their point</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Thu Apr 02 2020 08:01:36 GMT-0700 (Pacific Daylight Time)">15:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: <span class="nick-8">shu</span>: I wonder if the two of you have a moment to chat about compartments</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Thu Apr 02 2020 08:02:05 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">I'm free in an hour</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Thu Apr 02 2020 08:02:08 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">(the new stage-1 proposal)</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Thu Apr 02 2020 08:02:49 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">yeah, I'm definitely interested in chatting abou tthat</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Thu Apr 02 2020 08:02:57 GMT-0700 (Pacific Daylight Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</div></td><td class="msg-cell">also tomorrow would be free any time</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Thu Apr 02 2020 08:04:26 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">I have a meeting now and a meeting in an hour :-\</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Thu Apr 02 2020 08:04:38 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">and it looks like a meeting the hour after that</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Thu Apr 02 2020 08:04:39 GMT-0700 (Pacific Daylight Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: are we having the stencil meeting today?</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Thu Apr 02 2020 08:06:47 GMT-0700 (Pacific Daylight Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: What time zone are you in? I'd be happy to fit this in today if possible, but tomorrow is fine too</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Thu Apr 02 2020 08:09:47 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: not him, but he's in CEST (UTC+2)</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Thu Apr 02 2020 08:10:02 GMT-0700 (Pacific Daylight Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">Thank you!</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Thu Apr 02 2020 10:03:03 GMT-0700 (Pacific Daylight Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: will be 5 minutes late</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Thu Apr 02 2020 10:09:22 GMT-0700 (Pacific Daylight Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/js/src/frontend/ParseContext.cpp#498">https://searchfox.org/mozilla-central/source/js/src/frontend/ParseContext.cpp#498</a></td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Thu Apr 02 2020 10:13:47 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><pre><code>diff --git a/js/src/frontend/Parser.cpp b/js/src/frontend/Parser.cpp
index 88fa5fe0a4ef..b43b78fa8a80 100644
--- a/js/src/frontend/Parser.cpp
+++ b/js/src/frontend/Parser.cpp
@@ -1740,33 +1740,29 @@ bool LazyScriptCreationData::create(JSContext* cx,
                                     FunctionBox* funbox,
                                     HandleScriptSourceObject sourceObject) {
   MOZ_ASSERT(function);
+
+  using ImmutableFlags = ImmutableScriptFlagsEnum;
+  ImmutableScriptFlags immutableFlags = funbox-&gt;immutableFlags();
+
+  // Compute the  flags that frontend doesn't directly compute.
+  immutableFlags.setFlag(ImmutableFlags::ForceStrict, forceStrict);
+  immutableFlags.setFlag(ImmutableFlags::Strict, strict);
+  immutableFlags.setFlag(ImmutableFlags::HasMappedArgsObj,
+                         funbox-&gt;hasMappedArgsObj());
+
   BaseScript* lazy = BaseScript::CreateLazy(
       cx, compilationInfo, function, sourceObject, closedOverBindings,
-      innerFunctionIndexes, funbox-&gt;extent, funbox-&gt;immutableFlags());
+      innerFunctionIndexes, funbox-&gt;extent, immutableFlags);
   if (!lazy) {
     return false;
   }
 
-  // Flags that need to be copied into the JSScript when we do the full
-  // parse.
-  if (forceStrict) {
-    lazy-&gt;setForceStrict();
-  }
-  if (strict) {
-    lazy-&gt;setStrict();
-  }
-
-  // Flags which are computed at this point.
-  if (funbox-&gt;hasMappedArgsObj()) {
-    lazy-&gt;setHasMappedArgsObj();
-  }
-
-  function-&gt;initLazyScript(lazy);
-
   if (fieldInitializers) {
     lazy-&gt;setFieldInitializers(*fieldInitializers);
   }
 
+  function-&gt;initLazyScript(lazy);
+
   return true;
 }
</code></pre>
</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Thu Apr 02 2020 10:31:40 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">anyone else having problems with cloning mozilla-central, and hg getting stuck at downloading "Files" at around 4050/568426 ?</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Thu Apr 02 2020 10:32:25 GMT-0700 (Pacific Daylight Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">I've tried a bunch of stuff - using ssh:// instead of https://, turning off ssh key authentication and just getting the repository with no authentication</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Thu Apr 02 2020 10:33:31 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I clone... effectively never. But his might help you: <a href="https://firefox-source-docs.mozilla.org/contributing/vcs/mercurial_bundles.html?highlight=bundle">https://firefox-source-docs.mozilla.org/contributing/vcs/mercurial_bundles.html?highlight=bundle</a> </td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Thu Apr 02 2020 10:36:45 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell">it turns out that the right fix for that problem is actually just to comment about it on this channel, because it started right up after that</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Thu Apr 02 2020 10:41:50 GMT-0700 (Pacific Daylight Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@bnjbvr:mozilla.org">Benjamin Bouvier</span>&gt;</div></td><td class="msg-cell"><code>hg clone --stream</code> is your friend, too</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Thu Apr 02 2020 10:42:04 GMT-0700 (Pacific Daylight Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@bnjbvr:mozilla.org">Benjamin Bouvier</span>&gt;</div></td><td class="msg-cell">clones never finish on all of my machines, without this flag</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Thu Apr 02 2020 10:55:42 GMT-0700 (Pacific Daylight Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@djvj:mozilla.org">djvj</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">Benjamin Bouvier</span>: thanks!  I'll try to remember that</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Thu Apr 02 2020 12:24:50 GMT-0700 (Pacific Daylight Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@ryanvm:mozilla.org">RyanVM</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: not gonna lie, that irregexp change sounds a bit scary to land in a soft freeze :)</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Thu Apr 02 2020 12:25:51 GMT-0700 (Pacific Daylight Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">RyanVM</span>: disabled  by default no worries</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Thu Apr 02 2020 12:26:20 GMT-0700 (Pacific Daylight Time)">19:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@ryanvm:mozilla.org">RyanVM</span>&gt;</div></td><td class="msg-cell">oh, I misunderstood then, I thought the latest patches were flipping the switch</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Thu Apr 02 2020 12:27:39 GMT-0700 (Pacific Daylight Time)">19:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">caroline</span>: Are you alright we me pushing the JSScript::Create patches? They pass tests locally for me</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Thu Apr 02 2020 12:27:53 GMT-0700 (Pacific Daylight Time)">19:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@ryanvm:mozilla.org">RyanVM</span>&gt;</div></td><td class="msg-cell">IIUC, we're enabling syntax parsing with irregexp now but are still using the older fork for everything after that?</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Thu Apr 02 2020 12:29:50 GMT-0700 (Pacific Daylight Time)">19:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@caroline:mozilla.org">caroline</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: theyre currently running on try</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Thu Apr 02 2020 12:30:07 GMT-0700 (Pacific Daylight Time)">19:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@caroline:mozilla.org">caroline</span>&gt;</div></td><td class="msg-cell">but only new patch is the reordering</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Thu Apr 02 2020 12:30:13 GMT-0700 (Pacific Daylight Time)">19:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@caroline:mozilla.org">caroline</span>&gt;</div></td><td class="msg-cell">they should be fine</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Thu Apr 02 2020 12:31:24 GMT-0700 (Pacific Daylight Time)">19:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">‚òÉÔ∏é cool</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Thu Apr 02 2020 12:36:02 GMT-0700 (Pacific Daylight Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: So Bug 1607854 is ready to go, right? It isn't the WIP thing you meantioned earlier?</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Thu Apr 02 2020 12:36:04 GMT-0700 (Pacific Daylight Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1607854">https://bugzil.la/1607854</a> ‚Äî ASSIGNED (mgaudet) ‚Äî Defer allocation of JSScript to just before JSScript::fullyInitFromEmitter</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Thu Apr 02 2020 12:37:00 GMT-0700 (Pacific Daylight Time)">19:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: state is: It needs review feedback, and I expect to make changes based on that, but I want to go ahead with this, so please review it</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Thu Apr 02 2020 12:37:27 GMT-0700 (Pacific Daylight Time)">19:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: which is perhaps cutting hairs, but slightly different than "ready to go"</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Thu Apr 02 2020 12:40:27 GMT-0700 (Pacific Daylight Time)">19:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: sounds good</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Thu Apr 02 2020 12:42:13 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">RyanVM</span>: Sorry, my commit message is confusing. None of this code is part of the build unless you compile with ENABLE_NEW_REGEXP</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Thu Apr 02 2020 12:42:30 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@ryanvm:mozilla.org">RyanVM</span>&gt;</div></td><td class="msg-cell">oh, that's perfect</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Thu Apr 02 2020 12:42:33 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@ryanvm:mozilla.org">RyanVM</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Thu Apr 02 2020 13:39:43 GMT-0700 (Pacific Daylight Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: around?</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Thu Apr 02 2020 13:39:55 GMT-0700 (Pacific Daylight Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ye</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Thu Apr 02 2020 13:39:56 GMT-0700 (Pacific Daylight Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">p</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Thu Apr 02 2020 13:40:19 GMT-0700 (Pacific Daylight Time)">20:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I want to rant about some regexp optimizations, and then see if you validate my desire to burn them to the ground</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Thu Apr 02 2020 13:40:35 GMT-0700 (Pacific Daylight Time)">20:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">haha</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Thu Apr 02 2020 13:40:40 GMT-0700 (Pacific Daylight Time)">20:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Do you know about lazily updating RegExpStatics?</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Thu Apr 02 2020 13:40:51 GMT-0700 (Pacific Daylight Time)">20:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I do not</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Thu Apr 02 2020 13:41:44 GMT-0700 (Pacific Daylight Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So there's a bunch of non-standard properties of the RegExp object like $1 and $_, which were borrowed from perl</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Thu Apr 02 2020 13:42:00 GMT-0700 (Pacific Daylight Time)">20:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">üòë</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Thu Apr 02 2020 13:42:10 GMT-0700 (Pacific Daylight Time)">20:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which refer to the last regexp match that has been done</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Thu Apr 02 2020 13:42:23 GMT-0700 (Pacific Daylight Time)">20:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I know about RegExpStatics!</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Thu Apr 02 2020 13:42:36 GMT-0700 (Pacific Daylight Time)">20:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">They are trash.</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Thu Apr 02 2020 13:43:02 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">To be clear, this isn't, like, <code>re = /abc/; re.test("abc123"); re["$1"]</code>, it's RegExp["$1"]</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Thu Apr 02 2020 13:43:25 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">but whyyy</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Thu Apr 02 2020 13:43:32 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Problem one: we have to update these after each match</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Thu Apr 02 2020 13:45:38 GMT-0700 (Pacific Daylight Time)">20:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Problem two: somebody noticed that if you have <code>/.*abc.*/.test("some long string")</code>, then you can just strip the leading and trailing <code>.*</code></td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Thu Apr 02 2020 13:46:33 GMT-0700 (Pacific Daylight Time)">20:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But only in the case of <code>test</code> (which just returns a boolean)</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Thu Apr 02 2020 13:46:47 GMT-0700 (Pacific Daylight Time)">20:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If you need matches, then we can't strip the regexp, because of the difference between greedy and non-greedy repetition</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Thu Apr 02 2020 13:47:25 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But that's okay, we'll only do it if this is for a <code>test</code></td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Thu Apr 02 2020 13:47:33 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">is <code>/(.*)*X/.test("some long string")</code> still a perf disaster?</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Thu Apr 02 2020 13:47:34 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Except! We have RegExpStatics!</td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Thu Apr 02 2020 13:48:24 GMT-0700 (Pacific Daylight Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">(I think the issue is that we already wrap regexps in .*'s before executing them, because by default they aren't anchored to the ends of the string)</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Thu Apr 02 2020 13:48:50 GMT-0700 (Pacific Daylight Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Even for a test, we might need the value of RegExp["$1"]</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Thu Apr 02 2020 13:48:57 GMT-0700 (Pacific Daylight Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But most of the time you don't</td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Thu Apr 02 2020 13:49:15 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I don't like where this story is going..</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Thu Apr 02 2020 13:49:29 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So what we do is we set a flag in RegExpStatics: <a href="https://searchfox.org/mozilla-central/source/js/src/vm/RegExpStatics.h#42">https://searchfox.org/mozilla-central/source/js/src/vm/RegExpStatics.h#42</a></td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Thu Apr 02 2020 13:49:39 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">And then we store the input and source</td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Thu Apr 02 2020 13:49:51 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">And if anybody queries the RegExpStatics, we re-run the entire regexp</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Thu Apr 02 2020 13:49:56 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">If I could go back in time and change JS from the get-go, making () non-capturing is definitely fairly high on the list of changes to make.  Probably not as high as removing <code>with</code>, but probably the highest RegExp-related item on the list.</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Thu Apr 02 2020 13:50:55 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Extra fun: to make sure we don't mix up these two runs, we compile completely separate pieces of jitcode</td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Thu Apr 02 2020 13:51:47 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which is why each RegExpShared has room for 4 compilations: MatchOnly vs Normal, and Latin1 vs TwoByte</td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Thu Apr 02 2020 13:52:01 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">All to get rid of the extra <code>.*</code></td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Thu Apr 02 2020 13:52:08 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">oh boy</td></tr>
  <tr class="msg" id="L138"><td class="ts-cell"><a class="ts" href="#L138" alt="Thu Apr 02 2020 13:53:27 GMT-0700 (Pacific Daylight Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I would like to stop doing this</td></tr>
  <tr class="msg" id="L139"><td class="ts-cell"><a class="ts" href="#L139" alt="Thu Apr 02 2020 13:53:45 GMT-0700 (Pacific Daylight Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I want to get rid of MatchOnly and lazily updated RegExpStatics</td></tr>
  <tr class="msg" id="L140"><td class="ts-cell"><a class="ts" href="#L140" alt="Thu Apr 02 2020 13:54:29 GMT-0700 (Pacific Daylight Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">V8 does not appear to strip leading or trailing <code>.*</code> (or if they do, it's inside the engine somewhere and we would get the benefit automatically)</td></tr>
  <tr class="msg" id="L141"><td class="ts-cell"><a class="ts" href="#L141" alt="Thu Apr 02 2020 13:54:49 GMT-0700 (Pacific Daylight Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">that sounds reasonable</td></tr>
  <tr class="msg" id="L142"><td class="ts-cell"><a class="ts" href="#L142" alt="Thu Apr 02 2020 13:55:03 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Somehow, Chrome remains usable</td></tr>
  <tr class="msg" id="L143"><td class="ts-cell"><a class="ts" href="#L143" alt="Thu Apr 02 2020 13:57:03 GMT-0700 (Pacific Daylight Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay, rant completed</td></tr>
  <tr class="msg" id="L144"><td class="ts-cell"><a class="ts" href="#L144" alt="Thu Apr 02 2020 13:57:05 GMT-0700 (Pacific Daylight Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I feel better now</td></tr>
  <tr class="msg" id="L145"><td class="ts-cell"><a class="ts" href="#L145" alt="Thu Apr 02 2020 13:57:10 GMT-0700 (Pacific Daylight Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ha</td></tr>
  <tr class="msg" id="L146"><td class="ts-cell"><a class="ts" href="#L146" alt="Thu Apr 02 2020 13:57:27 GMT-0700 (Pacific Daylight Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I have spent all afternoon pulling on strings and horrifying myself at the nonsense I find at the other end</td></tr>
  <tr class="msg" id="L147"><td class="ts-cell"><a class="ts" href="#L147" alt="Thu Apr 02 2020 13:58:42 GMT-0700 (Pacific Daylight Time)">20:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">they don't have a match only mode?</td></tr>
  <tr class="msg" id="L148"><td class="ts-cell"><a class="ts" href="#L148" alt="Thu Apr 02 2020 13:58:56 GMT-0700 (Pacific Daylight Time)">20:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Nope!</td></tr>
  <tr class="msg" id="L149"><td class="ts-cell"><a class="ts" href="#L149" alt="Thu Apr 02 2020 14:00:18 GMT-0700 (Pacific Daylight Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The engine returns matches as indices into the string</td></tr>
  <tr class="msg" id="L150"><td class="ts-cell"><a class="ts" href="#L150" alt="Thu Apr 02 2020 14:00:31 GMT-0700 (Pacific Daylight Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Which is information you basically need to track anyway for backreferences</td></tr>
  <tr class="msg" id="L151"><td class="ts-cell"><a class="ts" href="#L151" alt="Thu Apr 02 2020 14:01:37 GMT-0700 (Pacific Daylight Time)">21:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So the only things we get out of our match only mode are a)  lazy update nonsense, and b) avoiding having to copy a handful of integers</td></tr>
  <tr class="msg" id="L152"><td class="ts-cell"><a class="ts" href="#L152" alt="Thu Apr 02 2020 14:02:36 GMT-0700 (Pacific Daylight Time)">21:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Until today, I had assumed that our motivation was just b)</td></tr>
  <tr class="msg" id="L153"><td class="ts-cell"><a class="ts" href="#L153" alt="Thu Apr 02 2020 14:03:07 GMT-0700 (Pacific Daylight Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">can't we also move regexp instructions outside a loop</td></tr>
  <tr class="msg" id="L154"><td class="ts-cell"><a class="ts" href="#L154" alt="Thu Apr 02 2020 14:04:52 GMT-0700 (Pacific Daylight Time)">21:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Hmmm</td></tr>
  <tr class="msg" id="L155"><td class="ts-cell"><a class="ts" href="#L155" alt="Thu Apr 02 2020 14:04:57 GMT-0700 (Pacific Daylight Time)">21:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">You might know more than me about that one</td></tr>
  <tr class="msg" id="L156"><td class="ts-cell"><a class="ts" href="#L156" alt="Thu Apr 02 2020 14:05:02 GMT-0700 (Pacific Daylight Time)">21:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Go on?</td></tr>
  <tr class="msg" id="L157"><td class="ts-cell"><a class="ts" href="#L157" alt="Thu Apr 02 2020 14:06:00 GMT-0700 (Pacific Daylight Time)">21:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">nvm I think we might still be able to do that actually</td></tr>
  <tr class="msg" id="L158"><td class="ts-cell"><a class="ts" href="#L158" alt="Thu Apr 02 2020 14:06:09 GMT-0700 (Pacific Daylight Time)">21:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Okay, cool</td></tr>
  <tr class="msg" id="L159"><td class="ts-cell"><a class="ts" href="#L159" alt="Thu Apr 02 2020 14:06:24 GMT-0700 (Pacific Daylight Time)">21:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">That is what I was leaning towards</td></tr>
  <tr class="msg" id="L160"><td class="ts-cell"><a class="ts" href="#L160" alt="Thu Apr 02 2020 14:06:48 GMT-0700 (Pacific Daylight Time)">21:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Because executing a regexp in the engine is a pure function of the inputs</td></tr>
  <tr class="msg" id="L161"><td class="ts-cell"><a class="ts" href="#L161" alt="Thu Apr 02 2020 14:07:06 GMT-0700 (Pacific Daylight Time)">21:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">And it's up to us to modify any state using the output</td></tr>
  <tr class="msg" id="L162"><td class="ts-cell"><a class="ts" href="#L162" alt="Thu Apr 02 2020 14:07:43 GMT-0700 (Pacific Daylight Time)">21:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So I <em>think</em> it shouldn't matter whether the engine itself has a match only mode, because we still know the difference between RegExpTester and RegExpMatcher</td></tr>
  <tr class="msg" id="L163"><td class="ts-cell"><a class="ts" href="#L163" alt="Thu Apr 02 2020 14:09:25 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">But please point out if there are any flaws in my logic</td></tr>
  <tr class="msg" id="L164"><td class="ts-cell"><a class="ts" href="#L164" alt="Thu Apr 02 2020 14:11:07 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Executing a regexp is pure, up to changes to statics.  It is probably possible to split regexp operations into a changes-to-statics part that can't be hoisted, and a pure part that can be.</td></tr>
  <tr class="msg" id="L165"><td class="ts-cell"><a class="ts" href="#L165" alt="Thu Apr 02 2020 14:11:35 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Tho I guess hoisting only happens if you have constant inputs, so maybe it's not necessary.</td></tr>
  <tr class="msg" id="L166"><td class="ts-cell"><a class="ts" href="#L166" alt="Thu Apr 02 2020 14:34:19 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Uggggggggggh</td></tr>
  <tr class="msg" id="L167"><td class="ts-cell"><a class="ts" href="#L167" alt="Thu Apr 02 2020 14:35:32 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">The other place we take advantage of lazily updating regexp statics is in Ion</td></tr>
  <tr class="msg" id="L168"><td class="ts-cell"><a class="ts" href="#L168" alt="Thu Apr 02 2020 14:35:32 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Where we <em>always</em> make it lazy, even if it's a match or a search</td></tr>
  <tr class="msg" id="L169"><td class="ts-cell"><a class="ts" href="#L169" alt="Thu Apr 02 2020 15:12:52 GMT-0700 (Pacific Daylight Time)">22:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Neat. I think I can relazify generators and async functions</td></tr>
  <tr class="msg" id="L170"><td class="ts-cell"><a class="ts" href="#L170" alt="Thu Apr 02 2020 16:15:48 GMT-0700 (Pacific Daylight Time)">23:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: does stripping the <code>.*</code> speed anything up? In theory, <code>/.*abc.*/</code> can be converted into a DFA that does one transition per input byte/char/unit/grapheme/cluster/meal, and so should not be any faster or slower than <code>/abc/</code> -- even with greediness factored in. (Well, it can terminate earlier, which could be a big difference on a long input string.) And in practice, I thought irregexp was supposed to be rather good at noticing things like that.</td></tr>

</tbody></table></div></div></div>
</body></html>