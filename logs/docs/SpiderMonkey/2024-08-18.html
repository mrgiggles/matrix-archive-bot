<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-08-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-08-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-08-16" class="nav-link"><span>prev</span></a>
<a href="2024-08-19" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Aug 18 2024 10:55:48 GMT-0700 (Pacific Daylight Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">does running <code>./mach jit-test</code> put some additional flags which wouldnt be available when we run the same script via <code>./mach run</code>? if so where can i find those additional params?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Aug 18 2024 12:22:19 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">debadree25</span>: there are 2 things added by <code>./mach jit-test</code>.  one is <a href="https://searchfox.org/mozilla-central/source/js/src/tests/lib/jittests.py#395-397">constants for directory</a>, specified by <code>-e</code> arguments.  for <code>load(libdir + "asserts.js");</code> etc. The other is <a href="https://searchfox.org/mozilla-central/source/js/src/tests/lib/tests.py#13-31">JIT flags</a>, this controls JIT behavior and some others.   Also, you can pass <code>--show-cmd</code> to <code>./mach jit-test</code> to see the actual command used for running the test</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sun Aug 18 2024 12:23:34 GMT-0700 (Pacific Daylight Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">passing <code>--jitflags=all</code> runs the test 6 times, for each JIT flag combinations</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sun Aug 18 2024 12:26:55 GMT-0700 (Pacific Daylight Time)">19:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">ahah got it! thank you!!</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sun Aug 18 2024 12:31:25 GMT-0700 (Pacific Daylight Time)">19:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">debadree25</span>: You can pass -s to see the exact command line for each test, or -S to only see it for failing tests.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sun Aug 18 2024 12:39:37 GMT-0700 (Pacific Daylight Time)">19:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">debadree25</span>: You can pass -s to see the exact command line for each test, or -S to only see it for failing tests.</blockquote></mx-reply>ah the failing tests command is helpful!</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sun Aug 18 2024 12:40:47 GMT-0700 (Pacific Daylight Time)">19:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">i had another question does the baseline interpreter immidiately start generating code right after the interpreter has finished its job? and the code is just kept aside until the function is hot enough?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sun Aug 18 2024 12:42:46 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">There is a per-script warm-up counter that is incremented when we enter a function or reach the top of a loop. When that counter hits <a href="https://searchfox.org/mozilla-central/source/js/src/jit/JitOptions.cpp#189">10</a>, we transition from the C++ interpreter to the baseline interpreter.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sun Aug 18 2024 12:44:34 GMT-0700 (Pacific Daylight Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">We don't generate any code for a script when it runs in the baseline interpreter. That doesn't happen until the baseline compiler (warmup count <a href="https://searchfox.org/mozilla-central/source/js/src/jit/JitOptions.cpp#200">100</a>). We delay because we do have to allocate some memory for inline caches, which is a waste of time for code that will only run once or twice.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sun Aug 18 2024 12:55:25 GMT-0700 (Pacific Daylight Time)">19:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">oh ok now it strikes me Interpreter generates bytecode -&gt; the baseline interpreter has machine level instructions relevant for each bytecode but still executes them 1 by 1 -&gt; baseline compiler/jit uses the same code as the baseline interpreter but it now compile everything and it includes incline caches -&gt; finally we have warp which has more advanced stuff</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sun Aug 18 2024 12:55:27 GMT-0700 (Pacific Daylight Time)">19:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">right?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sun Aug 18 2024 13:01:05 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Pretty close. The parser generates bytecode, not the interpreter. (Roughly speaking, code in js/frontend). The C++ interpreter (in js/vm/Interpreter.cpp) and the baseline interpreter can both run the bytecode directly by interpreting bytecodes one by one. We start using inline caches in the baseline interpreter, not the baseline compiler.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sun Aug 18 2024 13:06:11 GMT-0700 (Pacific Daylight Time)">20:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Pretty close. The parser generates bytecode, not the interpreter. (Roughly speaking, code in js/frontend). The C++ interpreter (in js/vm/Interpreter.cpp) and the baseline interpreter can both run the bytecode directly by interpreting bytecodes one by one. We start using inline caches in the baseline interpreter, not the baseline compiler.</blockquote></mx-reply>got it! yes parser generates mixed it up ðŸ˜…ðŸ˜…</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sun Aug 18 2024 13:07:55 GMT-0700 (Pacific Daylight Time)">20:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">one maybe final question<br>
so after baseline compiler -&gt; there is warp builder which generates a MIR based on data gathered by CacheIR -&gt; this MIR is then finally processed by Ion compiler and that is what does the final optimisations?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sun Aug 18 2024 13:08:56 GMT-0700 (Pacific Daylight Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Yeah, basically right. WarpBuilder also uses the original bytecode, not just CacheIR.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sun Aug 18 2024 13:12:51 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@debadree25:mozilla.org">debadree25</span>&gt;</div></td><td class="msg-cell">got it! thank you so much for answering ðŸ˜„</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sun Aug 18 2024 15:27:27 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kurokage09:mozilla.org">kurokage09</span>&gt;</div></td><td class="msg-cell">Hello, I am new to SpiderMonkey and wanted to embed SpiderMonkey in my OpenGL application. I followed the instructions to build it on my machine (Windows 64 bit) and it seems like everything was a success. However, I cannot seem to get a start point as to where are my libraries (.lib) and binaries (.dll) and the source files (.h/.cpp/.hpp) so that I can include them in my VS solution and start learning about how the SpiderMonkey API.. any help would be much appreciated. Thanks :)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sun Aug 18 2024 15:29:28 GMT-0700 (Pacific Daylight Time)">22:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">kurokage09</span>: did you follow this document <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr115/docs/Building%20SpiderMonkey.md#building-spidermonkey">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr115/docs/Building%20SpiderMonkey.md#building-spidermonkey</a> , or something else?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sun Aug 18 2024 15:31:40 GMT-0700 (Pacific Daylight Time)">22:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kurokage09:mozilla.org">kurokage09</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-5">kurokage09</span>: did you follow this document <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr115/docs/Building%20SpiderMonkey.md#building-spidermonkey">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr115/docs/Building%20SpiderMonkey.md#building-spidermonkey</a> , or something else?</blockquote></mx-reply><p>Oh, I did not follow that one I followed the one that was present on the website:</p>
<p><a href="https://firefox-source-docs.mozilla.org/setup/windows_build.html#building-firefox-on-windows">https://firefox-source-docs.mozilla.org/setup/windows_build.html#building-firefox-on-windows</a></p>
<p>Now that I read it, it says building Firefox for Windows, but I selected SpiderMonkey engine when there was a selection in the command prompt..</p>
<p>I'll try to follow the document in the link that you have provided and let you know if there are any issues. Thanks :)</p>
</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Sun Aug 18 2024 15:35:07 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(they're almost same thing, except for the command being different)  the <a href="https://firefox-source-docs.mozilla.org/setup/windows_build.html#building-firefox-on-windows">https://firefox-source-docs.mozilla.org/setup/windows_build.html#building-firefox-on-windows</a> covers the workflow for developing the Firefox or SpiderMonkey itself.   <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples</a> this repository is an example for embedding SpiderMonkey into other application</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Sun Aug 18 2024 15:35:59 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">on Windows, I think, you'll need to specify <code>--prefix</code> option to the <code>configure</code> command</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Sun Aug 18 2024 15:36:49 GMT-0700 (Pacific Daylight Time)">22:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">after <code>make install</code>, headers and libraries are installed into the specified directory, and you can add those directories to the workspace/solution's setting</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Sun Aug 18 2024 15:37:06 GMT-0700 (Pacific Daylight Time)">22:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kurokage09:mozilla.org">kurokage09</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> (they're almost same thing, except for the command being different)  the <a href="https://firefox-source-docs.mozilla.org/setup/windows_build.html#building-firefox-on-windows">https://firefox-source-docs.mozilla.org/setup/windows_build.html#building-firefox-on-windows</a> covers the workflow for developing the Firefox or SpiderMonkey itself.   <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples</a> this repository is an example for embedding SpiderMonkey into other application</blockquote></mx-reply>Ohhh, thanks for the clarification.. Also, I see this document says we have to use 'make' command.. I was wondering would it build using the MSVC compiler or the mingw-gcc compiler? Since my project is being built using the MSVC compiler I was wondering if it would generate .lib or .a files</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Sun Aug 18 2024 15:41:56 GMT-0700 (Pacific Daylight Time)">22:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you've already built with <code>./mach</code> commands above, all necessary tools should be installed into <code>~/.mozbuild</code> directory, including make and clang.  I think you can use them for compiling. I'm not sure about compatibility with MSVC, but at least there are some issues with MSVC right now where SpiderMonkey cannot be built with it</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Sun Aug 18 2024 15:45:11 GMT-0700 (Pacific Daylight Time)">22:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kurokage09:mozilla.org">kurokage09</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if you've already built with <code>./mach</code> commands above, all necessary tools should be installed into <code>~/.mozbuild</code> directory, including make and clang.  I think you can use them for compiling. I'm not sure about compatibility with MSVC, but at least there are some issues with MSVC right now where SpiderMonkey cannot be built with it</blockquote></mx-reply>Hmm.. so does this mean I would have difficulties integrating SpiderMonkey in my Visual Studio project?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Sun Aug 18 2024 15:45:57 GMT-0700 (Pacific Daylight Time)">22:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Also, according to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1768634">bug 1768634</a>, the issue also happens when building your project (after building SpiderMonkey itself with clang), and you might need to apply some workaround to make the header compatible with MSVC's compiler/preprocessor</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Sun Aug 18 2024 15:49:20 GMT-0700 (Pacific Daylight Time)">22:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">unfortunately, yes. currently building with MSVC is not tested (only gcc and clang are fully supported), and there will be some issues due to incompatibilities.   If these issues can be fixed with not-too-invasive way, patches are welcome</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Sun Aug 18 2024 15:50:36 GMT-0700 (Pacific Daylight Time)">22:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><a href="https://firefox-source-docs.mozilla.org/code-quality/coding-style/using_cxx_in_firefox_code.html">https://firefox-source-docs.mozilla.org/code-quality/coding-style/using_cxx_in_firefox_code.html</a> describes the compiler requirement</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Sun Aug 18 2024 16:03:56 GMT-0700 (Pacific Daylight Time)">23:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kurokage09:mozilla.org">kurokage09</span>&gt;</div></td><td class="msg-cell">Oh, that's a lot of information for sure. Unfortunately, my project is made on Visual Studio so I don't think it would be a best idea as of now for going ahead with the build.. I opted for SpiderMonkey since V8 is just bloated when it comes to building it from scratch. Thanks anyways :), I'll look forward to SpiderMonkey in the future if it rolls out a MSVC compatible version</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Sun Aug 18 2024 16:48:37 GMT-0700 (Pacific Daylight Time)">23:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sfink:mozilla.org">sfink|covid</span>&gt;</div></td><td class="msg-cell">SpiderMonkey tries to work in the configuration where you build SpiderMonkey with clang, but build your own project with MSVC. Only "tries to work" because sometimes the headers become incompatible with MSVC, which will cause it to break when building your project that is including SpiderMonkey header files, and we don't have a continuous integration job that tests this since it isn't used by Firefox. But we want it to work, and will certainly accept fixes and sometimes attempt fixes when we know it's broken.</td></tr>

</tbody></table></div></div></div>
</body></html>