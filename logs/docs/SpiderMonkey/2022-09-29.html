<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-09-29</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-09-29<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-09-28" class="nav-link"><span>prev</span></a>
<a href="2022-09-30" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Sep 29 2022 04:44:16 GMT-0700 (Pacific Daylight Time)">11:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">When using an external underlying source for a <code>ReadableStream</code>, is it possible to return a <code>Promise</code> or something like that? so that the data gets loaded asynchronously<br>I'm trying to do a <code>fetch</code>-like API currently</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Sep 29 2022 06:44:44 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> When using an external underlying source for a <code>ReadableStream</code>, is it possible to return a <code>Promise</code> or something like that? so that the data gets loaded asynchronously<br>I'm trying to do a <code>fetch</code>-like API currently</blockquote></mx-reply><p>So it's been a while since I've looked at that code, if I recall correctly, it should be async by default (in the sense that requestData doesn't itself provide the data, and then you've got ReadableStreamUpdateDataAvailableFromSource which can trigger the write in the buffer)</p>
<p>Having said that, I have to caution you a bit: The SpiderMonkey implementation of ReadableStreams is not long for this world. For firefox we actually have totally replaced the Streams API with an implementation built in the DOM code, and we're planning on removing the JS Streams implementation in the next few releases.</p>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Sep 29 2022 06:45:47 GMT-0700 (Pacific Daylight Time)">13:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I know at least one other embedder is going to be investigating if they can consume the DOM streams implementation over the next half year or so, but it's not clear when that will be done or how consumable that will be for other embedders.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Sep 29 2022 06:50:19 GMT-0700 (Pacific Daylight Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Another option worth investigating for streams support, IMO, would be Deno's implementation, currently located <a href="https://github.com/denoland/deno/blob/15ea624790f2f96ba9d852f34d114d6c8329245a/ext/web/06_streams.js">here</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Sep 29 2022 07:09:10 GMT-0700 (Pacific Daylight Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>For firefox we actually have totally replaced the Streams API with an implementation built in the DOM code, and we're planning on removing the JS Streams implementation in the next few releases.</p>
</blockquote>
<p>Oh, I had no idea. Well... I really don't want to implement streams on my own, but I guess I'll need to, <em>sigh</em></p></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Sep 29 2022 08:47:06 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <blockquote>
<p>For firefox we actually have totally replaced the Streams API with an implementation built in the DOM code, and we're planning on removing the JS Streams implementation in the next few releases.</p>
</blockquote>
<p>Oh, I had no idea. Well... I really don't want to implement streams on my own, but I guess I'll need to, <em>sigh</em></p></blockquote></mx-reply>Yeah, it's unfortunate. The JS Streams implementation was too brittle and had diverged from the official spec</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Sep 29 2022 08:48:16 GMT-0700 (Pacific Daylight Time)">15:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I'd really suggest that instead of implementing yourself you figure out a JS polyfill -- <a href="https://github.com/MattiasBuelens/web-streams-polyfill">https://github.com/MattiasBuelens/web-streams-polyfill</a> comes from one the spec authors, and should be adaptable to your needs with hopefully not too much effort.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Sep 29 2022 08:49:21 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">While a JS polyfill can work, that's far from ideal to work with when using native code</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Sep 29 2022 08:50:21 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Yeah :( </td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Sep 29 2022 08:51:50 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">So having done this myself, I'd argue that if you've got good primitives, implementing just the ReadableStreams portion of the Streams spec isn't awful. However, pain will vary depending on primitives. e.g. when I did the DOM streams implementation I was able to lean on WebIDL bindings generation to take care of much of the awkward conversion and type-checking code that would be a pain to build through jsapi </td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Sep 29 2022 08:52:11 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">It's nevertheless, a good chunk of work. </td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Sep 29 2022 08:52:45 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I can't use WebIDL directly, but I do have a bunch of convenience things for creating native functions, with conversions and type-checking dealt with</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Sep 29 2022 08:54:14 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">On the plus side: The spec is relatively clearly written (in particular ReadableStreams; the hairiest bit is implementing <code>ReadableStream.prototype.tee</code>)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Sep 29 2022 08:55:21 GMT-0700 (Pacific Daylight Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: (having said that... if you don't care for web-compat, I personally have a suspicion that you could build a simpler streaming data-processing model than Streams, which is... heavily engineered)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Sep 29 2022 08:57:08 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I don't necessarily care about web-compat, but I'd prefer if I had it</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Sep 29 2022 08:58:04 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: Sorry. I wish we had a better answer here. We're hoping in the medium term (2-3 years) we will, but that's of no use to you today.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Sep 29 2022 08:58:56 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">At my current pace, it'll be a couple years before I need to deal with streams, so maybe there'll be something better 😆</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Sep 29 2022 08:59:25 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">🤞</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Sep 29 2022 09:05:28 GMT-0700 (Pacific Daylight Time)">16:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">At least I can still implement the rest of <code>Response</code>, which is what most people actually use</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Sep 29 2022 09:05:43 GMT-0700 (Pacific Daylight Time)">16:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">only thing I can't is <code>Response.body</code></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Sep 29 2022 15:46:30 GMT-0700 (Pacific Daylight Time)">22:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">iain</span>: hey there, are you able to share a timeline estimate of the Atomics.waitAsync implementation? emscripten would like to use it for something and is wondering about general availability</td></tr>

</tbody></table></div></div></div>
</body></html>