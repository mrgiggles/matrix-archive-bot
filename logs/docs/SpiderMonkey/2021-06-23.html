<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-06-23</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-06-23<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-06-22" class="nav-link"><span>prev</span></a>
<a href="2021-06-24" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Jun 23 2021 03:01:07 GMT-0700 (Pacific Daylight Time)">10:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">What does <a href="https://searchfox.org/mozilla-central/source/js/public/CompileOptions.h#410">https://searchfox.org/mozilla-central/source/js/public/CompileOptions.h#410</a> do?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Jun 23 2021 03:02:13 GMT-0700 (Pacific Daylight Time)">10:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">oh, I see, I guess we don't do full parse normally, but just a faster check</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Jun 23 2021 03:17:15 GMT-0700 (Pacific Daylight Time)">10:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yes, we perform only syntax check for inner function in most case.  those functions are compiled again when it's called at first time.  we use the forceFullParse option for some chrome-priv code and self-hosted JS, for cache efficiency etc</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Jun 23 2021 08:45:29 GMT-0700 (Pacific Daylight Time)">15:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: <span class="nick-10">jandem</span> if you're watching the internal meeting we can delay the GC meeting until after that</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Jun 23 2021 08:46:17 GMT-0700 (Pacific Daylight Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I am, but it looks like it'll go on for another 45min. I'm ok doing the GC meeting now and watching the rest of this meeting recorded. (Or not; we'll see.)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jun 23 2021 08:47:02 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">I was thinking about skipping this week</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jun 23 2021 08:47:21 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: ok let's do that</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jun 23 2021 08:47:59 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: sure</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jun 23 2021 09:38:40 GMT-0700 (Pacific Daylight Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: Should I be able to start a tsan build of the browser without it dying immediately with data race warnings?  I'm wondering if there are some special options I need to pass.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jun 23 2021 09:39:08 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">you should be able to, but depending on your linux distro, there might be missing suppressions for certain external OS libs</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jun 23 2021 09:39:16 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">what are you seeing?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jun 23 2021 09:41:20 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: seems to be graphics drivers, but I've seen one in XPCOM too</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jun 23 2021 09:41:46 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">graphics driver could be a missing called_from_lib suppression</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jun 23 2021 09:41:51 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">can you send me both?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jun 23 2021 09:44:51 GMT-0700 (Pacific Daylight Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">sure</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jun 23 2021 09:45:17 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">embedding spidermonkey in java, is this a thing? <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/issues/39">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/issues/39</a></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jun 23 2021 09:45:49 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: I'm assuming it's something I'm doing wrong because this works in CI as far as I know</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jun 23 2021 09:47:30 GMT-0700 (Pacific Daylight Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">will take a look in a sec</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jun 23 2021 09:48:14 GMT-0700 (Pacific Daylight Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: probably just different graphics drivers. Like decoder said, the ignore lists are a big issue when you run on a slightly different system. It looks like you are missing __driDriverGetExtensions_zink</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jun 23 2021 09:48:20 GMT-0700 (Pacific Daylight Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: not that I know of, I guess this might be old rhino users, who are looking for an update.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jun 23 2021 09:48:37 GMT-0700 (Pacific Daylight Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I'm not sure what the best way is to extend the builtin ignore lists</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jun 23 2021 09:48:55 GMT-0700 (Pacific Daylight Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: the first race is likely missing a suppression for swrast_dri.so. ill make you some instructions on how to confirm this easily (no rebuild required)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jun 23 2021 09:49:06 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">the second one I dont know. it could be a result of disabling e10s</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jun 23 2021 09:49:52 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Offhand, running with webrender but without e10s seems a little sketchy. Doesn't it require the GPU process?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jun 23 2021 09:50:02 GMT-0700 (Pacific Daylight Time)">16:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">(the stack looks like webrender at least)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jun 23 2021 09:50:46 GMT-0700 (Pacific Daylight Time)">16:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I was just poking around to see if it made a difference</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jun 23 2021 09:51:09 GMT-0700 (Pacific Daylight Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">how do I add to the ignore lists?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jun 23 2021 09:51:18 GMT-0700 (Pacific Daylight Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: I don't think it's possible with current spidermonkey, is that correct?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jun 23 2021 09:52:27 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: the diffuclt part is to handle the marking properly, and Rust found a way by making vectors which are registered against the GC. So I guess this would be doable, but probably not easy.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jun 23 2021 09:54:17 GMT-0700 (Pacific Daylight Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: will let you know in a sec (still in meeting)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Jun 23 2021 09:54:31 GMT-0700 (Pacific Daylight Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: cool, no rush</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Jun 23 2021 09:55:00 GMT-0700 (Pacific Daylight Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Hmm maybe we don't run TSan with WebRender by default? I don't see WebRender in the name of the TSan job, but maybe we <em>only</em> run it with WR.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Jun 23 2021 09:56:45 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: can you try creating a file "ignore.txt" with this content:</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Jun 23 2021 09:56:49 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><pre><code>called_from_lib:radeonsi_dri.so
called_from_lib:swrast_dri.so
</code></pre>
</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Jun 23 2021 09:57:10 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">and then launch with TSAN_OPTIONS="suppressions=/full/path/to/ignore.txt" ?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Jun 23 2021 09:57:16 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">it should be merged with the builtin list</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Jun 23 2021 09:57:30 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">mccr8</span>: is webrender default now?  I didn't change anything related to that.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Jun 23 2021 09:58:12 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">For Mochitest etc job, WebRender jobs have something in the name that indicates it, but TSan is new enough that they might just default to it.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Jun 23 2021 09:59:50 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: I get thousands of '==483813==FATAL: ThreadSanitizer: failed to intercept abort'</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Jun 23 2021 10:00:12 GMT-0700 (Pacific Daylight Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-13">ptomato</span>: the diffuclt part is to handle the marking properly, and Rust found a way by making vectors which are registered against the GC. So I guess this would be doable, but probably not easy.</blockquote></mx-reply>Curious why a custom header + <a href="http://swig.org/">swig</a> and a JNI library wouldn't work; ugly perhaps, but I don't see much in the way of conceptual barrier</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Jun 23 2021 10:00:13 GMT-0700 (Pacific Daylight Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: oh nm, typo</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Jun 23 2021 10:01:04 GMT-0700 (Pacific Daylight Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: the problem for Rust was to handle Rooted types, thus marking the stack.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Jun 23 2021 10:01:33 GMT-0700 (Pacific Daylight Time)">17:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: 'ThreadSanitizer: failed to parse suppressions'</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Jun 23 2021 10:02:06 GMT-0700 (Pacific Daylight Time)">17:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">but if you have a JavaJSObject that's exposed to Java, which holds onto a PersistentRooted lets say... everything just works. It's not the fastest thing, but I don't see a barrier to it working</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Jun 23 2021 10:03:51 GMT-0700 (Pacific Daylight Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(I am making an assumption here, because it's been a hecking long time since I've programmed with JNI, that you can register a finalizer for a JNI represented object to cleanup the root) </td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Jun 23 2021 10:06:13 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: That's how Rust works.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Jun 23 2021 10:06:40 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Oh man. Finalizers in JNI are just as bad as regular Java finalizers; Eeep. Whilst still possible to do something sensible, it'd be gross </td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Jun 23 2021 10:08:23 GMT-0700 (Pacific Daylight Time)">17:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: if you allow JS objects to have references back to the Java heap you can get cycles that won't be cleaned up</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Jun 23 2021 10:08:49 GMT-0700 (Pacific Daylight Time)">17:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">But by doing so, you have to admit that you have to wrap every function call to the JS engine to work with the persistent rooted vector.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Jun 23 2021 10:10:16 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">mgaudet</span>: if you allow JS objects to have references back to the Java heap you can get cycles that won't be cleaned up</blockquote></mx-reply>That's true: I hadn't thought about that being a possibility; I'd been thinking you'd be just manipulating SM from the outside (eval-in-context etc)</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Jun 23 2021 10:10:39 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I replied in the GH issue: Hard, lots of engineering, probably better served by GraalJS or Nashorn</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Jun 23 2021 10:15:14 GMT-0700 (Pacific Daylight Time)">17:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: Ah, that was more user error.  Now I get: library '/usr/lib/x86_64-linux-gnu/dri/swrast_dri.so' that was matched against called_from_lib suppression 'swrast_dri.so' is unloaded</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Jun 23 2021 10:15:52 GMT-0700 (Pacific Daylight Time)">17:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I'll try adding just that function to the ignore file</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Jun 23 2021 10:18:18 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">thats really annoying :(</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Jun 23 2021 10:18:41 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">tsan doesnt support suppressing dsos when they are unloaded</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Jun 23 2021 10:19:00 GMT-0700 (Pacific Daylight Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">yea, you might be able to use race:swrast_dri.so instead</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Jun 23 2021 10:21:17 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I replied in the GH issue: Hard, lots of engineering, probably better served by GraalJS or Nashorn</blockquote></mx-reply>thanks!</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Jun 23 2021 10:21:23 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">I noticed rhino is still alive: <a href="https://github.com/mozilla/rhino">https://github.com/mozilla/rhino</a></td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed Jun 23 2021 10:22:46 GMT-0700 (Pacific Daylight Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: I'm making progress - race:__driDriverGetExtensions_zink seems to work</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed Jun 23 2021 10:22:46 GMT-0700 (Pacific Daylight Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I noticed rhino is still alive: <a href="https://github.com/mozilla/rhino">https://github.com/mozilla/rhino</a></blockquote></mx-reply>woah. Who maintains it?</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed Jun 23 2021 10:23:22 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: now I get as far as a browser window that says 'Gah. Your tab just crashed' :)</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Wed Jun 23 2021 10:23:56 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">with new races? or still variations of the ones we saw earlier?</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Wed Jun 23 2021 10:24:30 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: yes, mozilla::ThreadEventQueue::SetObserver</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Wed Jun 23 2021 10:24:53 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">can you show me the full race report?</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Wed Jun 23 2021 10:31:58 GMT-0700 (Pacific Daylight Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: thanks, it seems to be working with that race suppressed</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Wed Jun 23 2021 10:32:54 GMT-0700 (Pacific Daylight Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">hm.. weird</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Wed Jun 23 2021 10:32:58 GMT-0700 (Pacific Daylight Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">I wonder if we have that on file</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Wed Jun 23 2021 10:34:17 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">decoder</span>: yeah it's surprising that wouldn't show up elsewhere... how many 'cores' do the test VMs have?</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Wed Jun 23 2021 10:34:41 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">kriswright</span>: could you check if we have the xpcom data race on file that <span class="nick-4">jonco</span> posted above?</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Wed Jun 23 2021 10:34:44 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">thx</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Wed Jun 23 2021 10:34:45 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I think TSAN only reports races that actually happen right?</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Wed Jun 23 2021 10:35:18 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think TSAN only reports races that actually happen right?</blockquote></mx-reply>if by "actually happen" you mean that you need multiple cores, then the answer is no</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Wed Jun 23 2021 10:35:29 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kriswright:mozilla.org">kriswright</span>&gt;</div></td><td class="msg-cell">Oh fun <code>ThreadEventQueue</code> again. This looks like one of the scheduler races, one moment and I’ll see if this is in my bug list</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Wed Jun 23 2021 10:35:34 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">TSan reports any memory accesses from multiple threads that lack the necessary syncronization inbetween</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Wed Jun 23 2021 10:35:48 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">they dont actually need to access at the same time or even from different cores</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Wed Jun 23 2021 10:35:58 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">ah right, yes</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Wed Jun 23 2021 10:40:06 GMT-0700 (Pacific Daylight Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kriswright:mozilla.org">kriswright</span>&gt;</div></td><td class="msg-cell">This could be related to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1716999">https://bugzilla.mozilla.org/show_bug.cgi?id=1716999</a></td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Wed Jun 23 2021 10:40:49 GMT-0700 (Pacific Daylight Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kriswright:mozilla.org">kriswright</span>&gt;</div></td><td class="msg-cell">I’m no expert in the TaskController code though, may be worth roping :bas in for an explanation</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Wed Jun 23 2021 10:41:41 GMT-0700 (Pacific Daylight Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">yea, please do :)</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Wed Jun 23 2021 10:42:04 GMT-0700 (Pacific Daylight Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">if we cant resolve it quickly, also please add a suppression for it, as it seems to block startup sometimes</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Wed Jun 23 2021 10:42:25 GMT-0700 (Pacific Daylight Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">kriswright</span>: yeah, that looks like the same race but happening during shutdown</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Wed Jun 23 2021 10:43:18 GMT-0700 (Pacific Daylight Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kriswright:mozilla.org">kriswright</span>&gt;</div></td><td class="msg-cell">That’s the fun of new threading mechanisms, means new data races :P</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Wed Jun 23 2021 10:57:05 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kriswright:mozilla.org">kriswright</span>&gt;</div></td><td class="msg-cell">Alright, I added some comments based on my observations and tacked the new stack trace onto the bug, NI'd bas to see if I'm on track there. Maybe the observer-managing code just needs to hold a lock.</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Wed Jun 23 2021 10:57:25 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kriswright:mozilla.org">kriswright</span>&gt;</div></td><td class="msg-cell">(If that's the case, I'll put it on my list of things to do this week :P)</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Wed Jun 23 2021 11:14:27 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@decoder:mozilla.org">decoder</span>&gt;</div></td><td class="msg-cell">thanks <span class="nick-5">kriswright</span> :)</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Wed Jun 23 2021 13:36:43 GMT-0700 (Pacific Daylight Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">Hi folks, long time no see :) I'm interested in running some perf tests against SpiderMonkey, are there any docs around what the team already runs for things like AWFY?</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Wed Jun 23 2021 13:41:21 GMT-0700 (Pacific Daylight Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">so, these days AFAIK are we fast yet is mostly a front end to perfherder; so the jobs are all queued up on taskcluster, and gathered by perfherder</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Wed Jun 23 2021 13:41:54 GMT-0700 (Pacific Daylight Time)">20:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">aside from digging through taskcluster configs, is there something more specific you're trying to accomplish?</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Wed Jun 23 2021 13:43:14 GMT-0700 (Pacific Daylight Time)">20:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">For pure jsshell, I think octane is still the simplest smoke-test we use. People will then write microbenchmarks for their work, and then we go to the browser and run things like Speedometer</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Wed Jun 23 2021 13:44:26 GMT-0700 (Pacific Daylight Time)">20:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: sure, so I'm testing what sort of performance impact <code>FJCVTZS</code> has on arm64. My test setup is to build JS with that instruction enabled on an M1, run some perf tests, look at scores and verify that yes, in fact, I can run perf tests okay. Then I'd try building with the instruction disabled, rinse repeat.</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Wed Jun 23 2021 13:45:33 GMT-0700 (Pacific Daylight Time)">20:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: yeah I might end up just doing a full build, I was hoping to isolate just the engine for a lower-noise comparison. Do you have any idea what the most basic "run octane with jsshell" command would be?</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Wed Jun 23 2021 13:46:37 GMT-0700 (Pacific Daylight Time)">20:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><code>~/projects/<a href="http://gecko.dev/js/src/octane$">gecko.dev/js/src/octane$</a> ../../../obj-chk-spidermonkey/dist/bin/js run.js</code></td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Wed Jun 23 2021 13:47:11 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">\o/ lemme give that a shot, thanks a ton!</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Wed Jun 23 2021 13:47:13 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(you seem to need to be in that octane directory to run)</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Wed Jun 23 2021 13:47:25 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">oh good pointer</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Wed Jun 23 2021 13:47:54 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, octane should be where the impact is most noticable</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Wed Jun 23 2021 13:48:05 GMT-0700 (Pacific Daylight Time)">20:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(weird double math stuff)</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Wed Jun 23 2021 13:49:21 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">Eric Rahm</span>: we also do our spidermonkey shell builds with mach these days <a href="https://firefox-source-docs.mozilla.org/js/build.html">https://firefox-source-docs.mozilla.org/js/build.html</a></td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Wed Jun 23 2021 13:49:29 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">I'm probably going to write up something about this (there's not much out there other than an offhand comment in JSC bug), so if y'all have thoughts on an interesting benchmark I'd love to hear it</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Wed Jun 23 2021 13:49:58 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: oh yeah I got that far! Also filed <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1717905">https://bugzilla.mozilla.org/show_bug.cgi?id=1717905</a></td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Wed Jun 23 2021 13:49:59 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">cool</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Wed Jun 23 2021 13:50:23 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ha</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Wed Jun 23 2021 13:50:48 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">Desktop bootstrap + js mozbuild worked fine</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Wed Jun 23 2021 13:51:10 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I think my comment would mostly be: Results on Octane will not be reflective of normal web performance ;) </td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Wed Jun 23 2021 13:51:37 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell"><p>Don't actually know how to interpret this, but it works. Thanks so much ted!</p>
<pre><code>➜  octane ../../../obj-opt-aarch64-apple-darwin20.5.0/dist/bin/js run.js
Richards: 13415
DeltaBlue: 16133
Crypto: 23058
RayTrace: 38293
EarleyBoyer: 39631
RegExp: 11717
Splay: 22617
SplayLatency: 30436
NavierStokes: 21284
PdfJS: 36764
Mandreel: 23285
MandreelLatency: 56650
Gameboy: 101309
CodeLoad: 51888
Box2D: 56220
zlib: 95093
Typescript: 54281
----
Score (version 9): 33761
</code></pre>
</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Wed Jun 23 2021 13:51:55 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">IIRC octane is scores, so higher-is-better</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Wed Jun 23 2021 13:52:00 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I think they are "runs per second" <em>waves hands</em></td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Wed Jun 23 2021 13:52:35 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">with the final score probably being a geomean?</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Wed Jun 23 2021 13:53:11 GMT-0700 (Pacific Daylight Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">That's usually what perfherder did...</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Wed Jun 23 2021 13:53:47 GMT-0700 (Pacific Daylight Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell"><a href="https://searchfox.org/mozilla-central/source/testing/jsshell/benchmark.py#322">https://searchfox.org/mozilla-central/source/testing/jsshell/benchmark.py#322</a></td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Wed Jun 23 2021 13:54:14 GMT-0700 (Pacific Daylight Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">heck yeah, two versions octane in tree :P</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Wed Jun 23 2021 13:55:09 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">geomean * 100 it looks like <a href="https://searchfox.org/mozilla-central/source/js/src/octane/base.js#168-169">https://searchfox.org/mozilla-central/source/js/src/octane/base.js#168-169</a></td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Wed Jun 23 2021 13:56:13 GMT-0700 (Pacific Daylight Time)">20:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(I'll definitely be curious to see the results here tho) </td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Wed Jun 23 2021 13:57:07 GMT-0700 (Pacific Daylight Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell">Sweet, I'll report back!</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Wed Jun 23 2021 13:57:44 GMT-0700 (Pacific Daylight Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(unrelated) Our friends at Igalia added a tier-3 CI job for building spidermonkey to WASI/WASM. <a href="https://treeherder.mozilla.org/jobs?repo=mozilla-central&amp;tier=3&amp;searchStr=wasi">https://treeherder.mozilla.org/jobs?repo=mozilla-central&amp;tier=3&amp;searchStr=wasi</a>  No tests yet, but does check that the build works which is pretty cool. 🙂</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Wed Jun 23 2021 13:58:06 GMT-0700 (Pacific Daylight Time)">20:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@eroc:mozilla.org">Eric Rahm</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: If you have thoughts on good "real world" tests (in browser is fine) for JS perf I'd be interested in running those too. I guess Speedometer 2 or something?</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Wed Jun 23 2021 14:00:16 GMT-0700 (Pacific Daylight Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Speedometer is likely the best candidate we have right now that's comparatively easy to run. </td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Wed Jun 23 2021 14:41:26 GMT-0700 (Pacific Daylight Time)">21:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><p>hey everyone!<br>a small question: is it possible to somehow store data in JSScript, execute said script (e.g. inside another script), and retrieve that data when called from the method that is defined in said script?</p>
<p>in other words:</p>
<p>Script1 (has data_1)</p>
<pre><code>function retrieve_data() {
  // ??? magically extract data stored in this script and return it
}
</code></pre>
<p>Script2 (has data_2)</p>
<pre><code>IncludeScript('Script1');

console.log(retrieve_data()); // should return data_1
</code></pre>
<p>scripts are executed via <code>CloneAndExecuteScript</code></p>
</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Wed Jun 23 2021 14:44:29 GMT-0700 (Pacific Daylight Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><p>Or maybe more correct questions would be:</p>
<ul>
<li>Does JSScript continue to exist after CloneAndExecuteScript execution?</li>
<li>If it does, is it possible to retrieve corresponding JSScript from inside the script?</li>
<li>If it does not, are there any alternative ways to achieve the scenario described above?</li>
</ul>
</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Wed Jun 23 2021 14:56:16 GMT-0700 (Pacific Daylight Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@kriswright:mozilla.org">kriswright</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: I added <code>mozilla::ThreadEventQueue::SetObserver</code> to the TSan suppressions, so you can try building with rev D118640 to silence the warning until a fix for bug 1716999 is introduced. I looked closer at it and it feels like the process of fixing the observer code is going to be nontrivial, so we may just want a suppression for now. Is it actively causing frequent crashes/hangs or mostly tsan failures?</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Wed Jun 23 2021 14:56:17 GMT-0700 (Pacific Daylight Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1716999">https://bugzil.la/1716999</a> — ASSIGNED (KrisWright) — Intermittent SUMMARY: ThreadSanitizer: data race /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:939:7 in EnsureMainThreadTasksScheduled</td></tr>

</tbody></table></div></div></div>
</body></html>