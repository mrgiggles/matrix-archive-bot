<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-11-14</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-11-14<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-11-13" class="nav-link"><span>prev</span></a>
<a href="2020-11-16" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Nov 13 2020 17:17:04 GMT-0800 (Pacific Standard Time)">01:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Tier not-1 at some level I don't remember necessarily then. ðŸ™‚</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Nov 13 2020 22:45:57 GMT-0800 (Pacific Standard Time)">06:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: I'll update you with the final patches I'm using, I under the assumption that you're not using JS_STANDALONE at mozilla</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Nov 13 2020 22:47:00 GMT-0800 (Pacific Standard Time)">06:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I'm actually fighting the jsrust library now ðŸ˜› . From what I can tell, rust static libraries can't be "absorbed" into other static libraries</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Nov 13 2020 22:47:23 GMT-0800 (Pacific Standard Time)">06:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">so the standalone static js cannot contain it directly, and we'd need to link both</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Nov 13 2020 22:47:47 GMT-0800 (Pacific Standard Time)">06:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Which would be entirely fine <em>except</em> that static libraries don't appear to do in dist/bin, nor those there appear to be any way to do that</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Nov 13 2020 22:49:21 GMT-0800 (Pacific Standard Time)">06:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">(I could be mistaken on that, as I'm basically just reading the python and printf-ing a few things, but the rust-not-expandable thing seems very hard to change, as from what I can tell the .o files aren't known until crate does its job, which is later in the compilation process)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Nov 13 2020 22:49:55 GMT-0800 (Pacific Standard Time)">06:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">However it ought te be possible to use AR to merge these symbols back into the binary and/or to at least provide the static library to dist/bin, but I've been a little lost on that</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Nov 13 2020 22:50:34 GMT-0800 (Pacific Standard Time)">06:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">(with all the above being said, I did manage to compile and link 0 A.D. against SM78, helped by the migration guide on GitHub, and it's working fine, so we'll find a way ðŸ™‚)</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Nov 13 2020 22:52:18 GMT-0800 (Pacific Standard Time)">06:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">(for reference we're on SM45 now, so there's been a few changes to make. I'll also run some perf tests and let you know)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Nov 13 2020 22:59:53 GMT-0800 (Pacific Standard Time)">06:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">TBH my biggest hurdle so far is that recompiling spidermonkey takes 30 minutes and so trial-and-error is slow at best</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sat Nov 14 2020 00:57:05 GMT-0800 (Pacific Standard Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">30 <em>minutes</em>?  Are you on a really old computer, or with very little RAM?  Did you disable parallel compilation?  Are you not compiling it in unified mode, with a bunch of files concatenated into a translation unit so that only ~60-odd C++ compilations occur?  I don't remember it taking more than half a dozen minutes or so for me to compile SpiderMonkey, tho that number would jump if you compiled with optimizations enabled (which hardly seems necessary til you have a build that works in other regards).</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sat Nov 14 2020 00:58:17 GMT-0800 (Pacific Standard Time)">08:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">TBH it could be more like 15-20, but I'm on a 2015MBP with only 8GB ram, and yeah compiling at 03 (which I agree I should actually compile the debug version, that didn't occur to me actually)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sat Nov 14 2020 00:58:44 GMT-0800 (Pacific Standard Time)">08:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Would you happen to know off-hand if there indeed is/isn't a way to symlink static libs into distance/bin ?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sat Nov 14 2020 00:59:02 GMT-0800 (Pacific Standard Time)">08:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">That, I most definitely would not know offhand.  :-)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sat Nov 14 2020 00:59:51 GMT-0800 (Pacific Standard Time)">08:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">8GB RAM could be close to a desirable limit, not sure on that particular point.  (I've had 16 or 32 for probably the last five years at least.)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sat Nov 14 2020 01:00:10 GMT-0800 (Pacific Standard Time)">09:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">(it seems like there is not because static libraries are never a final target in regular firefox builds, from what I can tell)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sat Nov 14 2020 01:00:11 GMT-0800 (Pacific Standard Time)">09:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">Of course if you're doing anything else too memory-intensive, 8GB would be correspondingly less adequate.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sat Nov 14 2020 01:01:16 GMT-0800 (Pacific Standard Time)">09:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">There are some oddities in the build configuration though, such as the rust library only being actually built if the js shell is enabled, but I'll fold those in the aforementioned patch</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sat Nov 14 2020 01:04:00 GMT-0800 (Pacific Standard Time)">09:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">The Rust library bit, it's conceivable is done that way so that jsapi-tests can compile faster.  A Firefox build with JS shell and tests enabled will link SpiderMonkey three times -- once for Firefox, once for the shell, once for the jsapi-tests binary -- and so the exception might be a time-saver.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Sat Nov 14 2020 01:05:30 GMT-0800 (Pacific Standard Time)">09:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">We do want SpiderMonkey to be directly in libxul in shipping Firefox, that's pretty much non-negotiable (tho on Window I think at times -- not sure now -- SpiderMonkey's been in a separate library).  The other two, are somewhat more convenience, tho ideally, all else equal, they'd be identical to Firefox.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Sat Nov 14 2020 01:05:56 GMT-0800 (Pacific Standard Time)">09:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I should also say build-fu is not my strong suit and if someone else here were to contradict me, you should almost certainly trust them and not me.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Sat Nov 14 2020 01:07:34 GMT-0800 (Pacific Standard Time)">09:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I'm also wondering if I could patch the build to not compile wasm, since we're not really using it, but that might tie in to code and not actually work</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Sat Nov 14 2020 01:15:23 GMT-0800 (Pacific Standard Time)">09:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">I doubt we have wasm terribly build-segregated to make that possible, and my suspicion would be we wouldn't want to.  Keeping the no-wasm compilation setup working would be a tax that we probably wouldn't want to pay.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Sat Nov 14 2020 01:46:11 GMT-0800 (Pacific Standard Time)">09:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@obsu:mozilla.org">obsu</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">wraitii</span>: using ccache helps reduce time when recompiling ("ac_add_options --enable-ccache=ccache")</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Sat Nov 14 2020 01:55:57 GMT-0800 (Pacific Standard Time)">09:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">good point</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Sat Nov 14 2020 01:56:36 GMT-0800 (Pacific Standard Time)">09:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">I think I have the answer to my question: config/makefiles/target_binaries.mk lists something for SHARED_LIBRARY but not for STATIC_LIBRARY, and that appears to be what ultimately triggers the install/symlinking</td></tr>

</tbody></table></div></div></div>
</body></html>