<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-03-08</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-03-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-03-07" class="nav-link"><span>prev</span></a>
<a href="2023-03-09" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Mar 08 2023 02:13:01 GMT-0800 (Pacific Standard Time)">10:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">compartments live always in a single zone?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Mar 08 2023 02:17:18 GMT-0800 (Pacific Standard Time)">10:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Mar 08 2023 02:20:04 GMT-0800 (Pacific Standard Time)">10:20</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-4" title="@smaug:mozilla.org">smaug</span></div></td><td class="msg-cell">is just pondering what all weird setups he could try ðŸ™‚  But ok, not putting iframes into their own zones</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Mar 08 2023 02:20:31 GMT-0800 (Pacific Standard Time)">10:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/Garbage%20Collection.md">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/Garbage%20Collection.md</a> Here's some info on the semantics of compartments and zones</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Mar 08 2023 02:21:45 GMT-0800 (Pacific Standard Time)">10:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah for iframes it's nice that they share a zone with the top-level document because it lets us share more strings and shape data for example</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Mar 08 2023 02:22:46 GMT-0800 (Pacific Standard Time)">10:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">true, though in sp3 iframes are not sharing much with the top level page, and each iframe load tends to load new js framework</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Mar 08 2023 02:22:57 GMT-0800 (Pacific Standard Time)">10:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">so sharing might not be that effective, maybe</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Mar 08 2023 02:24:57 GMT-0800 (Pacific Standard Time)">10:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">maybe, but it's good for the typical website with N iframes with similar ads, or pages that pass data between globals</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Mar 08 2023 02:25:16 GMT-0800 (Pacific Standard Time)">10:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">yup</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Mar 08 2023 02:25:23 GMT-0800 (Pacific Standard Time)">10:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">What I'm really trying to do is to squeeze those couple of ALLOC_TRIGGERs out from the measured time. We do run slices all the time, and mostly during idle time, but those couple ones happen at bad time.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Mar 08 2023 02:27:01 GMT-0800 (Pacific Standard Time)">10:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah. Jon is on PTO today but he was also looking at GCs in idle time on speedometer, maybe he has some ideas</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Mar 08 2023 02:28:18 GMT-0800 (Pacific Standard Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">ok. I was just taking a break from reviewing and looked again this GC thing ðŸ™‚ </td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Mar 08 2023 02:29:39 GMT-0800 (Pacific Standard Time)">10:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: maybe we can increase the alloc threshold and see how that affects the score?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Mar 08 2023 02:32:05 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">I'm not even sure if we end up large heap</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Mar 08 2023 02:33:04 GMT-0800 (Pacific Standard Time)">10:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">maybe I could try tweaking growth factor. Or let Jon to try this out.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Mar 08 2023 04:25:44 GMT-0800 (Pacific Standard Time)">12:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">mccr8</span>: I think we're not very good at collecting the globals for the iframes while sp3 is running, about:memory says many of them are detached. After the benchmark has finished, everything seems to be collected and memory usage drops to very reasonable levels. I should take a look at some cc/cc graphs created while running the test.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Mar 08 2023 07:21:41 GMT-0800 (Pacific Standard Time)">15:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Yeah there might be something interesting there.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Mar 08 2023 08:16:28 GMT-0800 (Pacific Standard Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Anyone know the status of tail calls in wasm? <span class="nick-14">yury</span> ?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Mar 08 2023 08:25:58 GMT-0800 (Pacific Standard Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yury:mozilla.org">yury</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Ms2ger</span>: it is in progress. I have WIP in the bug if you want to provide a feedback</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Mar 08 2023 08:26:27 GMT-0800 (Pacific Standard Time)">16:26</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-14" title="@yury:mozilla.org">yury</span></div></td><td class="msg-cell">is trying to add more design docs atm</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Mar 08 2023 08:27:12 GMT-0800 (Pacific Standard Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">We were just reviewing if we'd move the spec to phase 5, but it seems like not right now</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Mar 08 2023 10:13:55 GMT-0800 (Pacific Standard Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@wes:mozilla.org">wes</span>&gt;</div></td><td class="msg-cell">I remember the original SpiderNode from 2012.  I see there was another crack at this, "SpiderShim", in 2019.  In both cases, it looked like grafting the v8 onto jsapi.  Does anybody know of any effort ever made to implement N-API for jsapi?  (N-API, node-api, is an ABI-stable native interface which looks an awful lot like JSClass * to me, probably by modelling JS Proxy)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Mar 08 2023 12:18:44 GMT-0800 (Pacific Standard Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">Hi, I'm trying to build spidermonkey with intl support for WASI, but am currently getting some build errors on that</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Mar 08 2023 12:19:03 GMT-0800 (Pacific Standard Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">wondering if someone might be able to help me work through some of these</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Mar 08 2023 12:20:05 GMT-0800 (Pacific Standard Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell"><p>in particular, I'm getting -</p>
<pre><code> 1:15.39 wasm-ld: warning: function signature mismatch: _ZN7mozilla4intl8Calendar23LegacyIdentifierToBcp47EPKci
 1:15.39 &gt;&gt;&gt; defined as () -&gt; void in ../build/libjs_static.a(Unified_cpp_js_src5.o)
 1:15.39 &gt;&gt;&gt; defined as (i32, i32, i32) -&gt; void in ../build/libjs_static.a(Unified_cpp_intl_components0.o)
</code></pre>
</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Mar 08 2023 12:22:20 GMT-0800 (Pacific Standard Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">This is particularly important for us as apparently this is the only way to support unicode property escapes in regexes as well, which users are now very much expecting to work</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Mar 08 2023 14:20:33 GMT-0800 (Pacific Standard Time)">22:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">guybedford</span>: That's an odd error. My only guess is that somewhere in SM has a forward declaration of Calendar::LegacyIdentifierToBcp47 that is confusing the wasm linker, but from a quick search I could not find any.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Mar 08 2023 14:21:40 GMT-0800 (Pacific Standard Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I see there are some WASI patches in <a href="https://searchfox.org/mozilla-central/source/intl/icu-patches/bug-1706949-wasi-workaround.diff">https://searchfox.org/mozilla-central/source/intl/icu-patches/bug-1706949-wasi-workaround.diff</a></td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Mar 08 2023 14:21:47 GMT-0800 (Pacific Standard Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">so that this was working at some point... is it tested?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Mar 08 2023 14:21:52 GMT-0800 (Pacific Standard Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">or perhaps the patches got out of sync?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Mar 08 2023 14:23:35 GMT-0800 (Pacific Standard Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I couldn't find any forward declarations in the patches for these functions though specifically</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Mar 08 2023 14:40:00 GMT-0800 (Pacific Standard Time)">22:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Any idea why JS Scripts would have tons of baseshape_global properties pointing to same global in CC graph?</td></tr>

</tbody></table></div></div></div>
</body></html>