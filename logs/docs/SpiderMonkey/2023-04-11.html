<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-04-11</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-04-11<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-04-10" class="nav-link"><span>prev</span></a>
<a href="2023-04-12" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Apr 10 2023 19:06:35 GMT-0700 (Pacific Daylight Time)">02:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Is there any real difference between rooting directly on the stack and being traced on the heap? I guess mostly in the performance sense?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Apr 10 2023 21:02:40 GMT-0700 (Pacific Daylight Time)">04:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">You generally don't have much of a choice between one or the other. If you're manipulating something, you have to root it. (Well, unless you stop using it before doing anything that could possibly GC.) It doesn't matter if you can prove it'll get traced on the heap, because it's not just about liveness: you need the thing you're working with to get updated if it gets moved.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Apr 10 2023 21:03:12 GMT-0700 (Pacific Daylight Time)">04:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I don't know much about the Rust embedding. Things might appear to be different there, if some of it is getting managed under the hood?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Apr 11 2023 05:42:30 GMT-0700 (Pacific Daylight Time)">12:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Is there any function like <code>JS::IsPlainObject(JSObject*)</code>? I.e. a function that identifies if an object doesn't belong to any other specialized class.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Apr 11 2023 05:44:05 GMT-0700 (Pacific Daylight Time)">12:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Alternatively, I could do <code>JS::GetClass() == &amp;ObjectClass</code>. But in that case, where would I find the <code>ObjectClass</code> variable?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Apr 11 2023 07:21:53 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: jsfriendapi.h has <code>js::ObjectClassPtr</code>, but adding <code>JS::IsPlainObject</code> would be better... There's also <code>JS::GetBuiltinClass</code>, but that can also return <code>ESClass::Object</code> for proxies/wrappers</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Apr 11 2023 07:29:59 GMT-0700 (Pacific Daylight Time)">14:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Thanks jandem, <code>JS::GetClass(ob) == js::ObjectClassPtr</code> is working well.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Apr 11 2023 08:24:34 GMT-0700 (Pacific Daylight Time)">15:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">One wonders why you'd want to ask that question, though :)</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Apr 11 2023 08:26:42 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> One wonders why you'd want to ask that question, though :)</blockquote></mx-reply>I have several custom JSClasses, and I want to determine if a given object does not belong to any of them.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Apr 11 2023 08:30:42 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell"><code>JS::GetClass(ob) == js::ObjectClassPtr</code> will return false for typed arrays, for example (if I'm reading this correctly) - is that what you intend?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Apr 11 2023 08:53:57 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">it'll return false for regular arrays too</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Apr 11 2023 08:54:33 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(and cross-compartment wrappers to plain objects)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Apr 11 2023 08:56:39 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I think <code>JS::GetBuiltinClass</code> would fix the latter</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Apr 11 2023 08:58:02 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Checking against your own classes explicitly seems more robust (though if you have CCWs, you'll need to think about what you want with those)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Apr 11 2023 09:25:54 GMT-0700 (Pacific Daylight Time)">16:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@lgoodacre:matrix.org">liam_g</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <code>JS::GetClass(ob) == js::ObjectClassPtr</code> will return false for typed arrays, for example (if I'm reading this correctly) - is that what you intend?</blockquote></mx-reply>Yup, that's what I intend.</td></tr>

</tbody></table></div></div></div>
</body></html>