<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-05-22</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-05-22<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-05-19" class="nav-link"><span>prev</span></a>
<a href="2023-05-23" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon May 22 2023 03:15:49 GMT-0700 (Pacific Daylight Time)">10:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: regarding X-only, do you have a scenario in mind where this feature would make the life of adversaries significantly harder? at the end of the day, an (in-process) JIT always requires some writable pages which are later made executable. the v8 folks even intend to keep JIT-pages rwx all the time due (1) little/no security advantage of transitioning from rw- to r-x (2) at some non-negligible  performance cost due to repeatedly calling <code>mprotect</code></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon May 22 2023 04:25:28 GMT-0700 (Pacific Daylight Time)">11:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: The problem of Jit spraying is that an adversary can inject instructions into executable pages. However, to make use of it, the attacker should know the address of it.<br>Instead of doing constant blinding, I was thinking of making the position of immediate constants random.<br>Combined with X-only memory, this reduces the success of making a valid jump by half, for each immediate constant.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon May 22 2023 04:26:37 GMT-0700 (Pacific Daylight Time)">11:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">When we have an immediate constant which is not under our control, we generate (noop+const) or (const+noop), one of the tricky part might be to ensure that noop crashes if ever jump into.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon May 22 2023 05:30:36 GMT-0700 (Pacific Daylight Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">nbp</span>: the root-cause of vulnerabilities gives adversaries a first-order primitive (e.g., limited OOB read/write), which in turn may be escalated to stronger second-order primitives (e.g., rw-access to the entire address space). violating CFI by jumping into the middle of the instruction stream is one of the last steps of a content-compromise. at this point (freely jumping into the middle of the instruction stream), the exploitation primitives are super powerful and X-only seems rather unlikely to tip the balance in favor of defenders. e.g., with interactive rw access to the address space, one can write to pages which will be X-only in the future. this essentially allows to emit any shell-code one pleases. alternatively, adversaries can craft a ROP/JOP payload that generically achieves code execution within content. considering the amount of code within libxul, the number of ROP/JOP chainable gadgets is vast.<br>reducing the number of bugs or, even better, eliminating a bug class altogether may be much better value for money. in the context of jit-compilation, this is could be something like the heap-sandbox as adversaries can no longer escalate jit-bugs to an interactive rw access to the entire address space. for stronger CFI, Intel IBT (<a href="https://lwn.net/Articles/889475/">https://lwn.net/Articles/889475/</a>) and ARM BTI might be worth looking into. as these are relatively new technologies, their defensive value remains to be seen</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon May 22 2023 05:36:56 GMT-0700 (Pacific Daylight Time)">12:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wraitii:mozilla.org">wraitii</span>&gt;</div></td><td class="msg-cell">Hello everyone, I'm looking into Upgrading 0 A.D. from 91 to SM 102. I'm running into an odd issue. We are JS::Execute-ing some code, and I get an assertion error in <code>NearestEnclosingExtensibleLexicalEnvironment</code> that there is no env (inside a <code>GlobalOrEvalDeclInstantiation</code>). The cause, as far as I can tell, is that we <code>JS_DeepFreeze</code> a global variable. There doesn't seem to be anything else wrong or special. Any clue what might have caused this to break now?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon May 22 2023 06:05:01 GMT-0700 (Pacific Daylight Time)">13:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>:  You could add #spidermonkey-reviewers to <a href="https://firefox-source-docs.mozilla.org/contributing/reviews.html">https://firefox-source-docs.mozilla.org/contributing/reviews.html</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon May 22 2023 06:09:02 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">l11d</span>: My understanding was that to jump to some JIT code one needed only a stack overflow, to read the return addresses and replace them, and having written some code in a known location within executable pages.<br>Thus I am not sure about the second-order being necessary as you describe it.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon May 22 2023 06:15:42 GMT-0700 (Pacific Daylight Time)">13:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: good idea. I'll look into it</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon May 22 2023 06:18:03 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">regarding the scenario you have in mind: are you concerned about an adversary with a linear stack-based buffer overflow in non-jitted code that later jumps to shell-code inside jitted code? backward-edge protection (essentially, preventing return address overrides) is something that hardware-assisted shadow-stacks provide (like Intel CET). this does require (1) compiler-support and (2) JIT-support.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon May 22 2023 06:20:49 GMT-0700 (Pacific Daylight Time)">13:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">which we do not have yet.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon May 22 2023 06:21:16 GMT-0700 (Pacific Daylight Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">also our JIT kind of rely on this capability for implementing bailouts.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon May 22 2023 07:09:54 GMT-0700 (Pacific Daylight Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">
I don't know how bailouts are implemented in detail. longjmp/setjmp work though (with CET), maybe bailouts are not so different?
coming back to the scenario mentioned above: (1) leak the address of jit-code and (2) override a stack-stored address/function pointer with the leaked address. if this would be some linear overflow it should be caught by stack-cookies (unless one also can leak the stack-cookie). if the adversary has the ability to write at chosen offsets (hence bypassing the stack-cookie) this becomes quite difficult to defend against. while directly jumping to jitted code might not be possible with X-only, it seems unlikely that there won't be a viable exploitation path. the life of adversaries got more difficult only once (to figure out how to build a nice ROP/JOP or escalate to a more powerful primitive) but you have to both invest into the feature and need to continuously maintain it</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon May 22 2023 07:19:26 GMT-0700 (Pacific Daylight Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Welcome to the world of defensive security. The adversary has to find one flaw, we have to close all of them. In the mean time we can just make the life harder.</td></tr>

</tbody></table></div></div></div>
</body></html>