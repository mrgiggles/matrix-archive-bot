<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-10-05</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-10-05<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-10-04" class="nav-link"><span>prev</span></a>
<a href="2022-10-06" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Oct 04 2022 18:09:01 GMT-0700 (Pacific Daylight Time)">01:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">AVX-512 definitely hasn't been deprecated.<br>Intel: Ice Lake onwards fixed throttling and it is quite a bit more power efficient<br>AMD: Just added with Zen 4 but little throttling and better efficiency</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Oct 05 2022 05:54:32 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: Does Baseline / Baseline-interpreter supports with statements? (see <a href="https://bugzil.la/793345">Bug 793345</a> &amp; <a href="https://bugzil.la/1647276">Bug 1647276</a>)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Oct 05 2022 05:54:34 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/793345">https://bugzil.la/793345</a> — REOPENED (nobody) — Code executed with Debugger.executeInGlobalWithBindings (Scratchpad or Webconsole) runs 10x - 80x slower than the same code in a script tag</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Oct 05 2022 05:54:35 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1647276">https://bugzil.la/1647276</a> — NEW (nobody) — Performance issue when using JavaScript within the Console</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Oct 05 2022 08:15:44 GMT-0700 (Pacific Daylight Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The with statements are supported in Baseline, but are still env chain lookups that are pretty slow. The executeInGlobalWithBindings forces global lookups (including "undefined") to be env chain lookups in the same way.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Oct 05 2022 08:17:34 GMT-0700 (Pacific Daylight Time)">15:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">One theoretical thing we could do is make a concrete environment for those debugger bindings that the parser can see so that it can differentiate between debugger binding and global binding.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Oct 05 2022 08:20:06 GMT-0700 (Pacific Daylight Time)">15:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The debugger evaluation stuff is always a bit tricky since it never technically follows ecmascript so we are off well defined paths once we start injecting scopes. With IonBuilder removed and a bunch of debugger simplification work over the years, it is probably more attainable to try and address this finally </td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Oct 05 2022 08:28:40 GMT-0700 (Pacific Daylight Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Maybe there is something which can be done in the parser.
IIRC in the past the parser was aware of the scope chain, and these problem might have appeared when switching to stencil then.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Oct 05 2022 08:39:36 GMT-0700 (Pacific Daylight Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@allstarschh:mozilla.org">@allstarschh</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>, <span class="nick-11">sdetar</span> : just sent a mail about I cannot join the gc meeting later</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Oct 05 2022 08:51:44 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, looks like we're skipping the meeting today</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Oct 05 2022 11:56:28 GMT-0700 (Pacific Daylight Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">I'm looking for some more information about how to use functions/classes defined in js/Promise.h and js/Result.h.

Does anyone know of documentation and/or examples of them being used?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Oct 05 2022 12:21:37 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><p>I'd also like to know if anyone knows the best way to store a reference to a class's prorotype object.  Currently, I have something like this:</p>
<pre><code>static bool DefineClass(JSContext* ctx, JS::HandleObject global) {
        // Create the class prototype
        JS::RootedObject protoObj(ctx, JS_InitClass(
                                           // Context, handle, parent_proto
                                           ctx, global, nullptr,
                                           // Class
                                           &amp;SelfType::ClassDef,
                                           // Constructor
                                           ConstructorJsCallback, 0,
                                           // Class properties / methods
                                           SelfType::ClassProperties, SelfType::ClassMethods,
                                           // Static properties / methods
                                           SelfType::StaticProperties, SelfType::StaticMethods));
        if (!protoObj) {
            return false;
        }

        return true;
    }
</code></pre>
</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Oct 05 2022 12:21:57 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">I'm not sure how I can maintain some reference to protoObj for later use.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Oct 05 2022 12:50:54 GMT-0700 (Pacific Daylight Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">It is unfortunately an old issue. In the parser it shows up as a non-syntactic-global scope and we don't actually have the debugger bindings visible to the parser. If I understand correctly, this was related to "non-syntactic" scripts and our ability to transform to/from a non-syntactic global by cloning the script. Now that we have removed the ability to clone existing script, a bunch of the concerns around incompatible environment chain lengths are gone.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Oct 05 2022 13:02:22 GMT-0700 (Pacific Daylight Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: Storing the reference for prototype is similar to storing references to any other type of object within your embedding. In short, you always need to trace/root to your values. The <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/GC%20Rooting%20Guide.md">Rooting Guide</a> has some good notes. For the specific case of a handful of user-defined classes, I'd start with a <code>PersistentRooted</code> and then optimize it later if I had too many</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Oct 05 2022 13:02:47 GMT-0700 (Pacific Daylight Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm not sure how I can maintain some reference to protoObj for later use.</blockquote></mx-reply>in addition to what tcampbell said, I believe JS_InitClass defines a global property with the name of the class, so you can find it that way. you can also give your global object a reserved slot and store the prototype there</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Oct 05 2022 13:03:51 GMT-0700 (Pacific Daylight Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-15">kfjvj</span>: Storing the reference for prototype is similar to storing references to any other type of object within your embedding. In short, you always need to trace/root to your values. The <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr91/docs/GC%20Rooting%20Guide.md">Rooting Guide</a> has some good notes. For the specific case of a handful of user-defined classes, I'd start with a <code>PersistentRooted</code> and then optimize it later if I had too many</blockquote></mx-reply>I saw PersistentRooted mentioned in the rooting guide, but it seemed to advise against using it.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Oct 05 2022 13:04:32 GMT-0700 (Pacific Daylight Time)">20:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">PersistentRooted is slow if you have lots of them and create and destroy them often.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Oct 05 2022 13:05:01 GMT-0700 (Pacific Daylight Time)">20:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> PersistentRooted is slow if you have lots of them and create and destroy them often.</blockquote></mx-reply>They'll be static variables.  One for each class I define.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Oct 05 2022 13:05:35 GMT-0700 (Pacific Daylight Time)">20:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">If you had many classes, you could also use a PersistentRooted to a GCVector (or hashtable) to your data.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Oct 05 2022 13:07:24 GMT-0700 (Pacific Daylight Time)">20:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">You always need at least <em>some</em> roots. Either a handful of PersistentRooted, stashing things on the Global as ptomato describes, or using CustomAutoRooters like gecko does (though these are probably more problematic than a persistentrooted).</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Oct 05 2022 13:08:59 GMT-0700 (Pacific Daylight Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">The case we discourage PersistentRooted is if you had some custom C++ type that you made many of and then shoved a PersistentRooted in for simplicity. That would prevent the GC from traversing the graph incrementally and the full list of roots would need to be frequently revisited.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Oct 05 2022 13:09:43 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Essentially, what I have in mind is that there is a static variable for each class that I define.  When I call that class's static DefineClass function, it should set the PersistentRooted prototype static variable to the prototype it created.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Oct 05 2022 13:10:37 GMT-0700 (Pacific Daylight Time)">20:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">The reason I want to do this is that I want to be able to invoke a particular class's constructor from C++.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Oct 05 2022 13:11:54 GMT-0700 (Pacific Daylight Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">that sounds reasonable at a glance</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Oct 05 2022 13:12:28 GMT-0700 (Pacific Daylight Time)">20:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">However, I'm worried about the lifetime of these static variables, and how to deal with multiple JSContexts and threads</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Oct 05 2022 13:14:36 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">These objects are only valid for a single thread</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Oct 05 2022 13:15:20 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">I forget.  Is there at most one JsContext per thread?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Oct 05 2022 13:15:39 GMT-0700 (Pacific Daylight Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Generally JSContext is 1:1 with a thread.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Oct 05 2022 13:16:02 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(There are a few odd uses of JSContext on other threads <em>inside</em> spidermonkey, but we are phasing them out)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Oct 05 2022 13:16:52 GMT-0700 (Pacific Daylight Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">In the browser case when you use Web Workers, we have a differing context/thread for each worker, and then they communicate they use <code>postMessage</code> to serialize/deserialize data into a byte-array that crosses threads.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Oct 05 2022 13:17:12 GMT-0700 (Pacific Daylight Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Also, this is kind of related: What happens if I attempt to call DefineClass twice for the same class? </td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Oct 05 2022 13:17:46 GMT-0700 (Pacific Daylight Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">That is, JS_InitClass</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Oct 05 2022 13:21:31 GMT-0700 (Pacific Daylight Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">if you did it twice on the same Global, it would probably just make a new one an replace the property on the Global of the same name.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Oct 05 2022 13:21:55 GMT-0700 (Pacific Daylight Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">OK, so it doesn't fail or return null if there's already a class defined</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Oct 05 2022 13:22:09 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Which would probably just confuse you, since things like <code>instanceof</code> would get confused.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Oct 05 2022 13:23:17 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">JS_InitClass can be thought of as creating a new constructor/prototype object, and then setting a property on the Global to point to the contstructor. There isn't anything magic about a C++ defined class.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Oct 05 2022 13:23:46 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">In the same way with JS you could write <code>function makeFooClass() { return class Foo { }; }</code></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Oct 05 2022 13:23:53 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Yeah.  I'm working on adding JS wrappers to a very large C++ API, and trying to map the C++ structs we have.  So I have to keep track of this mapping between C++ types and their JS equivalents.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Oct 05 2022 13:24:33 GMT-0700 (Pacific Daylight Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">You could assert in your helper function that the Global does not have a property with the same name already. Probably worthwhile in your case. Especially if names are the same as some standard JS class and you want to detect that.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Oct 05 2022 13:30:10 GMT-0700 (Pacific Daylight Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">That's a good point.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Oct 05 2022 13:30:24 GMT-0700 (Pacific Daylight Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Anyway, thanks very much for you help.  I will attempt to use this information.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Oct 05 2022 15:22:22 GMT-0700 (Pacific Daylight Time)">22:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: re: PersistentRooted. It's true that we discourage its use because of the potential for memory leaks. But as <span class="nick-15">tcampbell</span> said, that's really only a problem if you're putting a PersistentRooted into a place that (1) has a non-static lifetime, and (2) can be pointed back to from anything in JS. It's because if it points to anything, then the global will almost certainly be reachable, and then if the struct or object holding the PersistentRooted is reachable in any way from the global, then you have yourself an uncollectable cycle entraining everything reachable from the global. Your case sounds like a great use of PersistentRooted.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Oct 05 2022 15:23:06 GMT-0700 (Pacific Daylight Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">as for performance, it's a linked list traversal during a GC, and a doubly-linked list insertion/deletion when it's created/destroyed. Not the best for the cache, but pretty minor in the larger scheme.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Oct 05 2022 15:23:14 GMT-0700 (Pacific Daylight Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ah right, accidental cycles. that is a stronger reason</td></tr>

</tbody></table></div></div></div>
</body></html>