<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-09-28</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-09-28<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-09-27" class="nav-link"><span>prev</span></a>
<a href="2021-09-29" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Sep 28 2021 02:19:47 GMT-0700 (Pacific Daylight Time)">09:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@theduke:matrix.org">theduke</span>&gt;</div></td><td class="msg-cell">Hey. Is there a web version of Spidermonkey API docs somewhere? All I could find are apparently old, outdated mirrors like <a href="http://man.hubwiz.com/docset/JavaScript.docset/Contents/Resources/Documents/developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference.html">this</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Sep 28 2021 02:21:52 GMT-0700 (Pacific Daylight Time)">09:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@greg.:mozilla.org">greg</span>&gt;</div></td><td class="msg-cell"><a href="https://spidermonkey.dev/docs/">https://spidermonkey.dev/docs/</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Sep 28 2021 07:24:52 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Good morning!  I have more questions about embedding and the JSAPI

I'm getting a regression when I'm porting code from JS1.8.5 to JS60 (maybe eventually a more current LTS version.

I'm calling the exact same code to get a UTF8 string from a JS::Value (or jsval) and getting a different result back.

I'm calling JS_EncodeString which drops a byte from the 2 byte sequence in JS60, which means I can't decode it properly.

JS60 returns  "\t// crs_desc:This cours\351 uses writing as a tool for inquiry and"

JS1.8.5 returns "\t// crs_desc:This cours\303\251 uses writing as a tool for inquiry and"

In JS1.8.5 it returns non ASCII characters as 2 byte sequences. In JS60 it converts the two byte sequence to a single 8-bit ascii character.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Sep 28 2021 07:26:29 GMT-0700 (Pacific Daylight Time)">14:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Yeah I guess ctrl-return doesn't survive formatting in this chat.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Sep 28 2021 07:27:28 GMT-0700 (Pacific Daylight Time)">14:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Is there a way to get JS_EncodeString - or analog NOT to convert 2 byte UTF8 characters to 8 bit ascii?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Sep 28 2021 07:27:44 GMT-0700 (Pacific Daylight Time)">14:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">it's making our code to convert strings to 7 bit ascii barf</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Sep 28 2021 07:29:52 GMT-0700 (Pacific Daylight Time)">14:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Maybe <code>JS_EncodeStringToUTF8</code> would work?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Sep 28 2021 07:34:13 GMT-0700 (Pacific Daylight Time)">14:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">I'll give it a go.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Sep 28 2021 07:36:54 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Seems like <code>JS_EncodeString</code> in ESR60 was returning Latin1 data</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Sep 28 2021 07:38:01 GMT-0700 (Pacific Daylight Time)">14:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">That's the thing, our code was expecting UTF8 and JS_EncodeString in JS60 returns 8 bit ASCII</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Sep 28 2021 07:38:35 GMT-0700 (Pacific Daylight Time)">14:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">All this internationalization stuff still makes my head spin a bit.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Sep 28 2021 07:39:09 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Since I started programming in 1983 before, apparently, any country besides the USA mattered to computing.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Sep 28 2021 07:40:32 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">ah <a href="https://hg.mozilla.org/integration/mozilla-inbound/rev/6676e8fedcb3">https://hg.mozilla.org/integration/mozilla-inbound/rev/6676e8fedcb3</a></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Sep 28 2021 07:42:42 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">yeah, functions with "encode" without explicit encoding name mostly meant Latin1</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Sep 28 2021 09:38:54 GMT-0700 (Pacific Daylight Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">pbz</span>: is migrating it to the user activation API too much work? That might make all this a lot easier</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Sep 28 2021 09:42:02 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">ðŸ”¥</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Sep 28 2021 09:42:34 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'll look into it</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Sep 28 2021 10:52:03 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">pbz</span>: can you assign the result of <code>document.requestStorageAccess().then(...)</code> to some variable?  it looks like the user-interaction flag's machinery doesn't work if the promise is optimized out</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Sep 28 2021 10:52:15 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">(so, the condition for the optimization is wrong :/</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Sep 28 2021 10:53:10 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if the return value of <code>Promise#then</code> isn't used, we optimize it out, but the user-interaction code seems to use the result promise internally</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Sep 28 2021 10:53:28 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, we should check the flag and skip the optimization if it has non-default value</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Sep 28 2021 10:57:57 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">filed bug 1732953</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Sep 28 2021 10:57:59 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1732953">https://bugzil.la/1732953</a> â€” ASSIGNED (arai) â€” user-interaction flag isn't inherited if the result promise is optimized out</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Sep 28 2021 13:36:47 GMT-0700 (Pacific Daylight Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><p>Hey everyone!<br>It's been three year since I've started working on my SM embedding and I'm starting to forget basic things =)</p>
<p>So, a few small JS questions:</p>
<ul>
<li>I have a single JSContext and multiple Global objects. Each Global has associated message loop that enqueues JS events for said Global. The question: can these Global/message loop pairs be considered as separate HTML event loops? Or are they considered to be the same HTML event loop because they share the same JSContext?</li>
<li>If they can be considered as separate HTML event loops, is it possible to make <code>js::RunJobs</code> execute only jobs from the specific global? So that I can respect mictrotask's <code>after-a-task-and-not-nested</code> execution timing in each of the corresponding loops.</li>
</ul>
</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Sep 28 2021 13:39:17 GMT-0700 (Pacific Daylight Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">PS: By HTML event loop I mean this: <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops">https://html.spec.whatwg.org/multipage/webappapis.html#event-loops</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Sep 28 2021 14:30:15 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">You are... well off the beaten path. 

To your first question, I have no idea. 

To your second question... is this something you could implement as part of your implementation of JobQueue (I presume you have your own implementation here). Maybe? 

Sorry for not having more answers</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Sep 28 2021 14:50:02 GMT-0700 (Pacific Daylight Time)">21:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: You learn a surprisingly large amount by just... pushing ahead. Slowly piecing together what the various DOM integration with Streams are going to look like... (was surprised to discover I'll apparently need to have ReadableByteStreamController built for this work too) </td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Sep 28 2021 14:50:05 GMT-0700 (Pacific Daylight Time)">21:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Sep 28 2021 14:55:17 GMT-0700 (Pacific Daylight Time)">21:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>To your second question... is this something you could implement as part of your implementation of JobQueue (I presume you have your own implementation here). Maybe?</p>
</blockquote>
<p>Nope, not yet =) I'm using built-in <code>js::RunJobs</code>, but it executes the 'jobs' ('microtasks' in HTML terms?) from all the globals. I was hoping that there is another built-in something that I could use (without having to do any work myself xD)</p>
</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Sep 28 2021 15:00:23 GMT-0700 (Pacific Daylight Time)">22:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Pretty sure <code>js::RunJobs</code> is more or less a toy. Firefox has it's only implementation anyway</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Sep 28 2021 15:00:24 GMT-0700 (Pacific Daylight Time)">22:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">probably not; the only 'off-the-shelf' one is for the JS shell</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Sep 28 2021 15:26:27 GMT-0700 (Pacific Daylight Time)">22:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">darn, now I have to code... :D</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Sep 28 2021 15:26:32 GMT-0700 (Pacific Daylight Time)">22:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@theqwertiest:mozilla.org">TheQwertiest</span>&gt;</div></td><td class="msg-cell">thanks anyway =)</td></tr>

</tbody></table></div></div></div>
</body></html>