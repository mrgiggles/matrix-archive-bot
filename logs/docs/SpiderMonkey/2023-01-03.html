<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-01-03</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-01-03<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-01-02" class="nav-link"><span>prev</span></a>
<a href="2023-01-04" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jan 02 2023 21:41:03 GMT-0800 (Pacific Standard Time)">05:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><p>from reading <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr102/docs/GC%20Rooting%20Guide.md#gc-thing-pointers-on-the-heap">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr102/docs/GC%20Rooting%20Guide.md#gc-thing-pointers-on-the-heap</a>, my impression is that if I have a</p>
<pre><code class="language-rs">struct A { obj: Heap&lt;*mut JSObject&gt; }
</code></pre>
<p>which is stored in the reserved slot 0 of my instance, I just need to add a trace method to <code>A</code> that calls <code>a.obj.trace()</code></p></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jan 02 2023 21:41:39 GMT-0800 (Pacific Standard Time)">05:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Is that correct, or am I missing something? </td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jan 02 2023 23:16:40 GMT-0800 (Pacific Standard Time)">07:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">you need to add a trace method to the JSClass that has the reserved slot, yeah</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jan 02 2023 23:17:45 GMT-0800 (Pacific Standard Time)">07:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">if you store the object in a reserved slot, you don't need to trace it yourself</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jan 02 2023 23:53:16 GMT-0800 (Pacific Standard Time)">07:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Are there any methods for serialization in Spidermonkey other than JSON? I've got the JSON methods working, but I'm running into the familiar problems with Sets, Symbols and other custom objects, which don't work with JSON. I could use replacers &amp; revivers, but it feels like a bit of a rabbit hole. I'm wondering if there's any more robust solutions built in?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jan 02 2023 23:54:51 GMT-0800 (Pacific Standard Time)">07:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Or even some external adaptors like MessagePack adapted to Spidermonkey?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jan 02 2023 23:59:18 GMT-0800 (Pacific Standard Time)">07:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if you store the object in a reserved slot, you don't need to trace it yourself</blockquote></mx-reply>I saw that, but given how my api works, I can't do that directly</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jan 03 2023 00:26:42 GMT-0800 (Pacific Standard Time)">08:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: we have APIs for <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">structured cloning</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jan 03 2023 00:28:03 GMT-0800 (Pacific Standard Time)">08:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">symbols don't work I think but Sets should</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jan 03 2023 00:28:29 GMT-0800 (Pacific Standard Time)">08:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I'm trying to save to file though</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jan 03 2023 00:28:45 GMT-0800 (Pacific Standard Time)">08:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Either text, or binary.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jan 03 2023 00:29:10 GMT-0800 (Pacific Standard Time)">08:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell"><blockquote>you need to add a trace method to the JSClass that has the reserved slot, yeah</blockquote><br>Would Rust mangling method names matter at all? I saw mozjs has <a href="https://doc.servo.org/mozjs/rust/trait.Trace.html">https://doc.servo.org/mozjs/rust/trait.Trace.html</a></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jan 03 2023 00:32:14 GMT-0800 (Pacific Standard Time)">08:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: that's possible with structured cloning, we use that for IndexedDB for example. See <a href="https://searchfox.org/mozilla-central/rev/abf6758ed833c203f84703aa2e3e3d317571b1e9/js/public/StructuredClone.h#142-155">here</a></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jan 03 2023 00:33:16 GMT-0800 (Pacific Standard Time)">08:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Great, I'll take a look. Thanks for the tip.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jan 03 2023 00:40:27 GMT-0800 (Pacific Standard Time)">08:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: we have some testing functions for this in the shell, <a href="https://mozilla-spidermonkey.github.io/sm-wasi-demo/?branch=mozilla-central&amp;source=let%20data%20%3D%20serialize(new%20Set(%5B%22foo%22%2C%201%2C%20%7B%7D%5D)%2C%20undefined%2C%20%7Bscope%3A%20%22DifferentProcess%22%7D)%3B%0Aprint(%22bytes%3A%20%22%20%2B%20new%20Uint8Array(data.arraybuffer).toString())%3B%0Aprint(deserialize(data))%3B%0A">here's</a> an example of serializing a Set</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jan 03 2023 00:43:03 GMT-0800 (Pacific Standard Time)">08:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: I'm not sure. Aren't you using callbacks or class hooks elsewhere already?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jan 03 2023 00:46:37 GMT-0800 (Pacific Standard Time)">08:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">well yes, but this one seems to rely on such a method existing? I don't know about the details</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jan 03 2023 04:25:11 GMT-0800 (Pacific Standard Time)">12:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell"><p>OK, I've been working on the StructuredCloning stuff all afternoon, and I think I'm getting the hang of it. I have one simple question and one not-so-simple question.</p>
<p>Simple question: in the <code>WriteStructuredCloneOp()</code> callback, I'm using <code>JS_WriteUint32Pair()</code> to tag the specialized object, and then adding a unique string (luckily my objects already have this in place). The first arg of <code>JS_WriteUint32Pair()</code>is the pointer to the writer, and the second one is the tag (which must be larger than <code>JS_SCTAG_USER</code>). So what's the third argument? Is it safe to make it 0?</p>
</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jan 03 2023 04:30:08 GMT-0800 (Pacific Standard Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Not so simple question: the object I'm working with is a JSProxy, called Cell. When I call <code>JSAutoStructuredCloneBuffer::write()</code>, the <code>WriteStructuredCloneOp</code> callback is called, and I can identify that Cell. But the Cell has other Cells as children, and the <code>::write()</code> function isn't getting called recursively, so it just tags the root Cell and then finishes. When I tried the equivalent function with JSON, it went all the way and identified all of the Cell's children, which is what I need here. So how do I get <code>JSAutoStructuredCloneBuffer::write()</code> to act recursively?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jan 03 2023 05:09:57 GMT-0800 (Pacific Standard Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">liam_g</span>: the third argument can be 0, but you can also use it to write a relevant uint32 value for your object. it's passed as "data" argument when you deserialize</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jan 03 2023 05:19:07 GMT-0800 (Pacific Standard Time)">13:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">for the recursion, I think you'd want a <code>JS_WriteObject</code> API very similar to <code>JS_WriteTypedArray</code> but I don't think we have this yet. Hm</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jan 03 2023 05:21:44 GMT-0800 (Pacific Standard Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">It's not <code>JS_ObjectNotWritten</code>, is it?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jan 03 2023 05:23:50 GMT-0800 (Pacific Standard Time)">13:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">no I think that's for when the callback decides to serialize the object as something else</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jan 03 2023 05:25:52 GMT-0800 (Pacific Standard Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">depending on your use case, one option could be to copy your object graph before serializing to replace Cells with simple objects that are supported </td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jan 03 2023 05:27:24 GMT-0800 (Pacific Standard Time)">13:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">How would I copy it without using StructuredClone though?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jan 03 2023 05:32:22 GMT-0800 (Pacific Standard Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah that's probably annoying</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Jan 03 2023 05:33:18 GMT-0800 (Pacific Standard Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">Is an implementation of <code>JS_WriteObject</code> in the works?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Jan 03 2023 05:34:50 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">if you can easily test spidermonkey changes locally, maybe you can try to add it (based on <code>JS_WriteTypedArray</code>) and see if it works</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Jan 03 2023 05:40:22 GMT-0800 (Pacific Standard Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I've been too scared to rebuild Spidermonkey 😆. Took me weeks the first time. But looking at <code>JS_WriteTypedArray</code> does make the function look trivial.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Jan 03 2023 05:41:44 GMT-0800 (Pacific Standard Time)">13:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell">I'll try giving it a shot.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Jan 03 2023 09:00:14 GMT-0800 (Pacific Standard Time)">17:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><p>I have a jit-test that's failing when run with <code>--wasm-compiler=baseline</code> (but not other wasm-compiler options). It also fails in the same way when my MOZCONFIG contains <code>ac_add_options --disable-jit</code>, I think for the same reason.</p>
<p>From what I can tell so far, the <code>CompilationStencil.asmJS</code> field is somehow set to <code>nullptr</code> when <code>--wasm-compiler=baseline</code> is used. Does anyone have any pointers where I should look to track this down?</p>
</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Jan 03 2023 09:06:31 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>: we only support asm.js compilation when wasm-compiler includes ion. so if you only enable baseline, that will disable asm.js. ditto for disable-jit too</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Jan 03 2023 09:06:51 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">what sort of test is this? does it need wasm-compiler=baseline?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Jan 03 2023 09:48:10 GMT-0800 (Pacific Standard Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">uh oh. I recently refactored some stuff around that. It is possible that the checks for having an available asmjs compiler are out of sync</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Jan 03 2023 09:49:07 GMT-0800 (Pacific Standard Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1805856">https://bugzilla.mozilla.org/show_bug.cgi?id=1805856</a> . You might be able to revert that <span class="nick-7">Bryan Thrall [:bthrall]</span> and see if that is problem</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Jan 03 2023 09:56:40 GMT-0800 (Pacific Standard Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> uh oh. I recently refactored some stuff around that. It is possible that the checks for having an available asmjs compiler are out of sync</blockquote></mx-reply>I backed out the changes for bug 1805856 and my test still failed, so I think you are free from blame here 🙂</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Jan 03 2023 09:56:41 GMT-0800 (Pacific Standard Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1805856">https://bugzil.la/1805856</a> — RESOLVED (tcampbell) — Avoid reading wasm options from JSContext while parsing asm.js</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Jan 03 2023 09:57:05 GMT-0800 (Pacific Standard Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ah interesting...</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Jan 03 2023 09:58:50 GMT-0800 (Pacific Standard Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> what sort of test is this? does it need wasm-compiler=baseline?</blockquote></mx-reply>The test is expecting <code>compileToStencilXDR()</code> to throw an exception because encoding asm.js is not supported; the test is failing because wasm-compiler=baseline does not throw the exception. Other wasm-compiler settings do throw the exception as expected.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Jan 03 2023 09:59:08 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">lol, that is a bad test</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Jan 03 2023 09:59:19 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">asm.js has a fallback path, so if there is no optimizer, it just makes JS which can use XDR fine.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Jan 03 2023 10:00:32 GMT-0800 (Pacific Standard Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">Oh? Do tell!</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Jan 03 2023 10:00:35 GMT-0800 (Pacific Standard Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">You can add a check of <code>isAsmJSCompilationAvailable()</code> somewhere in the JS test case</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Jan 03 2023 10:01:50 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(The original design of asm.js was it was actually legal JS to anyone who didn't know what asm.js was. The <code>"use asm"</code> marker is just a string literal that is a no-op)</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Jan 03 2023 10:13:06 GMT-0800 (Pacific Standard Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">That resolves my problem, then: I added <code>skip-if: !isAsmJSCompilationAvailable()</code> to the test case.<br>Thanks!</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Jan 03 2023 10:17:42 GMT-0800 (Pacific Standard Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>: if there are parts of test case that are still interesting, you can also add the check to the guard the special subtests only</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Jan 03 2023 12:08:26 GMT-0800 (Pacific Standard Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">In the mozjs C++ code, are there any C++ exceptions used?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Jan 03 2023 12:11:20 GMT-0800 (Pacific Standard Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: No.</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Jan 03 2023 12:11:38 GMT-0800 (Pacific Standard Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-15">kfjvj</span>: No.</blockquote></mx-reply>Thanks.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Jan 03 2023 12:17:31 GMT-0800 (Pacific Standard Time)">20:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: no. We compile with <code>-fno-exceptions</code>.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Jan 03 2023 12:19:31 GMT-0800 (Pacific Standard Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">OK.  I'm trying to find a way to do some more detailed error handling than is possible with just the bool return values of most Jsapi functions.  I was initially using exceptions, but it is generally not a favored solution with my team.

I was looking at js/Result.h, but I'm not entirely sure what features that would add.</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Jan 03 2023 12:28:41 GMT-0800 (Pacific Standard Time)">20:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Are there any good examples of code that show how to properly use result?</td></tr>

</tbody></table></div></div></div>
</body></html>