<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2021-12-17</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2021-12-17<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-12-16" class="nav-link"><span>prev</span></a>
<a href="2021-12-18" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Dec 16 2021 17:56:42 GMT-0800 (Pacific Standard Time)">01:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Sounds good; if you've got an up to-date try push after your changes I'm OK with landing this week -- I'm gone after tomorrow</blockquote></mx-reply>Here! <a href="https://treeherder.mozilla.org/jobs?repo=try&amp;revision=b5b40f354a2d6db1039227af9791b2ac0be39af0&amp;selectedTaskRun=McrgzqYGQ6--dPRnq_FNDQ.0">https://treeherder.mozilla.org/jobs?repo=try&amp;revision=b5b40f354a2d6db1039227af9791b2ac0be39af0&amp;selectedTaskRun=McrgzqYGQ6--dPRnq_FNDQ.0</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Dec 16 2021 18:15:45 GMT-0800 (Pacific Standard Time)">02:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">sfink</span>: if you want a real answer, <a href="https://translate.google.com/?sl=auto&amp;tl=zh-CN&amp;text=dragon&amp;op=translate">https://translate.google.com/?sl=auto&amp;tl=zh-CN&amp;text=dragon&amp;op=translate</a></blockquote></mx-reply>Yes, "Loong" pronunce like chinese word "龙", which is a legendary creature and totem of Chinese nation. Besides, FWIW, although it is translated to "Dragon", they are totally two different thing, it's kind of an early mistranslation.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Dec 16 2021 18:16:36 GMT-0800 (Pacific Standard Time)">02:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Ah, thanks for the clarification!</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Dec 16 2021 18:18:14 GMT-0800 (Pacific Standard Time)">02:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell">My pleasure.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Dec 16 2021 22:13:07 GMT-0800 (Pacific Standard Time)">06:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">wow, I didn't know they're different thing.  I was thinking they're variant</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Dec 16 2021 22:30:33 GMT-0800 (Pacific Standard Time)">06:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@zjiaz:mozilla.org">zjiaz</span>&gt;</div></td><td class="msg-cell">No, they are different things from different culture. Maybe the translators didn't want to creat a new word and concept, so they just put them all together? Here is an article about this topic: <a href="https://www.globaltimes.cn/content/1161814.shtml">Chinese scholars debate alternative English translation 'loong' for China’s ‘dragon’</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Dec 16 2021 22:34:55 GMT-0800 (Pacific Standard Time)">06:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thank you :)  actually I'm Japanese and I was thinking both are 龍.  so I guess there's yet another mis-translation or something</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Dec 16 2021 22:53:49 GMT-0800 (Pacific Standard Time)">06:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">What's the relation between <code>AllowGC::{NoGC,CanGC}</code> and <code>ReportOutOfMemory</code>/<code>cx-&gt;recoverFromOutOfMemory()</code> ?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Dec 16 2021 22:57:43 GMT-0800 (Pacific Standard Time)">06:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">looks like, <code>CanGC</code> =&gt; <code>ReportOutOfMemory</code> is called on failure.  <code>NoGC</code> =&gt; <code>cx-&gt;recoverFromOutOfMemory()</code> is called if <code>ReportOutOfMemoty</code> is called on failure, at least in atom/string handling.  but I don't see clear relation between them</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Dec 16 2021 22:58:20 GMT-0800 (Pacific Standard Time)">06:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Does the <code>AllowGC</code> enum also implies something about pending exception?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Dec 16 2021 23:02:12 GMT-0800 (Pacific Standard Time)">07:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">filed bug 1746572</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Dec 16 2021 23:02:13 GMT-0800 (Pacific Standard Time)">07:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1746572">https://bugzil.la/1746572</a> — NEW (nobody) — Add documentation comment for AllowGC enum</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Dec 16 2021 23:41:19 GMT-0800 (Pacific Standard Time)">07:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: I think we call with NoGC when we want to try to allocate an object, but we don't have everything rooted, so if we can't allocate without triggering a GC, then we want the allocation to fail cleanly so that we can use a slow path</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Dec 16 2021 23:41:41 GMT-0800 (Pacific Standard Time)">07:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">For example, this code is used in a callWithABI: <a href="https://searchfox.org/mozilla-central/source/js/src/jit/VMFunctions.cpp#1988-1991">https://searchfox.org/mozilla-central/source/js/src/jit/VMFunctions.cpp#1988-1991</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Dec 16 2021 23:43:04 GMT-0800 (Pacific Standard Time)">07:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So we don't report OOM if it fails, because it doesn't mean we're out of memory, it just means we need to GC</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Dec 16 2021 23:45:45 GMT-0800 (Pacific Standard Time)">07:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">thanks.  so, in case of "we need to GC", the function returns without pending exception.  what about other failure?  is the function allowed/supposed to return with pending exception for other cases?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Dec 16 2021 23:46:43 GMT-0800 (Pacific Standard Time)">07:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Hmm, good question. I think we only use this pattern when failing to allocate is the only possible failure, but I'm not 100% sure</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Dec 16 2021 23:47:12 GMT-0800 (Pacific Standard Time)">07:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">Okay, I'll check each consumer of the enum</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Dec 16 2021 23:47:31 GMT-0800 (Pacific Standard Time)">07:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">It looks like recoverFromOutOfMemory asserts that we're not throwing anything else: <a href="https://searchfox.org/mozilla-central/source/js/src/vm/JSContext.cpp#690">https://searchfox.org/mozilla-central/source/js/src/vm/JSContext.cpp#690</a></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Dec 16 2021 23:48:03 GMT-0800 (Pacific Standard Time)">07:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">good to know :)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Dec 17 2021 01:12:28 GMT-0800 (Pacific Standard Time)">09:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">hmm, looks like some methods do follow the pattern, but some others don't</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Dec 17 2021 01:37:19 GMT-0800 (Pacific Standard Time)">09:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in string allocation, "allocation overflow" can be thrown regardless of AllowGC</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Dec 17 2021 01:44:22 GMT-0800 (Pacific Standard Time)">09:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">filed bug 1746594</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Dec 17 2021 01:44:23 GMT-0800 (Pacific Standard Time)">09:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1746594">https://bugzil.la/1746594</a> — ASSIGNED (arai) — Inconsistent pending exception with AllowGC::NoGC</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Dec 17 2021 02:05:31 GMT-0800 (Pacific Standard Time)">10:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">do we have someone who has a bit of time this morning to look over a pr over groupBy? I added a few tests for the contributors but i can't review it myself</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Dec 17 2021 02:06:21 GMT-0800 (Pacific Standard Time)">10:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is it m-c patch?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Dec 17 2021 02:07:47 GMT-0800 (Pacific Standard Time)">10:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Dec 17 2021 02:10:53 GMT-0800 (Pacific Standard Time)">10:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">bug 1739648, right?  if so, I'll take a look</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Dec 17 2021 02:10:54 GMT-0800 (Pacific Standard Time)">10:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1739648">https://bugzil.la/1739648</a> — NEW (sigurdsets) — Implement Array grouping proposal</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Dec 17 2021 02:11:16 GMT-0800 (Pacific Standard Time)">10:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">thank you arai</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Dec 17 2021 02:15:58 GMT-0800 (Pacific Standard Time)">10:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">yulia | back Jan. 3</span>: err, maybe I'm missing the context. do you need review for all patches there, or only the last one?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Dec 17 2021 02:16:18 GMT-0800 (Pacific Standard Time)">10:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">Only the last one -- but since i mentored this, it may be helpful if you look over all of them?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Dec 17 2021 02:16:40 GMT-0800 (Pacific Standard Time)">10:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">There are a few nits with the patches but it is the end of the semester (we had students do spidermonkey as a course)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Dec 17 2021 02:17:14 GMT-0800 (Pacific Standard Time)">10:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay :)</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Dec 17 2021 03:10:36 GMT-0800 (Pacific Standard Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">uh, sorry, I couldn't finish it during morning :P   still reviewing.  maybe 10 minutes more</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Dec 17 2021 04:26:18 GMT-0800 (Pacific Standard Time)">12:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">no problem, this is really great</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Dec 17 2021 06:21:36 GMT-0800 (Pacific Standard Time)">14:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">yulia | back Jan. 3</span>: hi, I have question about the plan there.  are you going to apply all fix in the last patch, instead of fixing other 4 patches (or letting the author fix them)?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Dec 17 2021 06:22:08 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">speaking with the authors now!</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Dec 17 2021 06:22:15 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay :)</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Dec 17 2021 06:22:21 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">but i have a patch that fixes everything if they don't have timme</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Dec 17 2021 06:22:33 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">ill push that actually... if you could have a look -- i may have added more mistakes</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Dec 17 2021 06:22:38 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">😬</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Dec 17 2021 06:22:44 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">this is what i get for working on my day off</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Dec 17 2021 06:24:24 GMT-0800 (Pacific Standard Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay, I'll wait for their answer.  actually I already have pending review comments.  so once the fix comes, I can finish reviewing quickly</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Dec 17 2021 06:26:59 GMT-0800 (Pacific Standard Time)">14:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">btw, good to see that students working on SpiderMonkey in their class :)</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri Dec 17 2021 07:03:30 GMT-0800 (Pacific Standard Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: they want to make the fix themselves (and actually got it right unlike me :D) so they will push a patch. I will have them review your comments as they push it</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri Dec 17 2021 07:03:38 GMT-0800 (Pacific Standard Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@yulia:mozilla.org">yulia | back Jan. 3</span>&gt;</div></td><td class="msg-cell">so ill abandon my revision and pass on the comments</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri Dec 17 2021 07:04:10 GMT-0800 (Pacific Standard Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">Does anyone have tips for implementing <code>setTimeout</code>/<code>setInterval</code>?</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Dec 17 2021 07:04:14 GMT-0800 (Pacific Standard Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">okay :)</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Dec 17 2021 07:07:24 GMT-0800 (Pacific Standard Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Redfire</span>: I thought you already have task queue?  then, using the same task queue would be the best</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Dec 17 2021 07:08:41 GMT-0800 (Pacific Standard Time)">15:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so that it ensures there's no concurrent execution in the same JS context</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Dec 17 2021 07:09:05 GMT-0800 (Pacific Standard Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I assumed as such, but I'm not sure how to do it.<br>Aren't timeouts and promises supposed to have a difference due to microtask/macrotask or something? (I definitely need to brush up on my event loop knowledge)</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Dec 17 2021 07:10:40 GMT-0800 (Pacific Standard Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if you're going to exactly follow the HTML spec, timer uses task instead of microtask, so there can be difference  <a href="https://html.spec.whatwg.org/#timer-initialisation-steps">https://html.spec.whatwg.org/#timer-initialisation-steps</a></td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Dec 17 2021 07:10:59 GMT-0800 (Pacific Standard Time)">15:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">in term of when to execute</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Dec 17 2021 07:13:34 GMT-0800 (Pacific Standard Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I don't know much about the task dispatch. people in <a href="https://matrix.to/#/#dom:mozilla.org">#dom:mozilla.org</a> or <a href="https://matrix.to/#/#domcore:mozilla.org">#domcore:mozilla.org</a> would know better</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Dec 17 2021 08:29:46 GMT-0800 (Pacific Standard Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I was just testing it out in node, and it seems a <code>setInterval</code> that isn't cleared blocks the finishing of a script, but not in the REPL 🤔</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Dec 17 2021 08:37:25 GMT-0800 (Pacific Standard Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">If its blocking, I can definitely cheat it by using the same function to execute both the timeouts &amp; intervals, and the promises.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Dec 17 2021 09:17:48 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">zjiaz</span>: thank you! I've long been curious about the connection between what I think of as "dragons" vs "Chinese dragons". It's a little annoying, in that if someone asks "was there a dragon in that movie?" I will have to say something like "yes, sort of, but it was a Chinese dragon not a Western dragon" and have to talk about the difference.</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Dec 17 2021 09:19:47 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">as a Westerner and native English speaker, I'm guessing that the transliterations "long" or "loong" wouldn't get picked up very well. They don't fit in the language very well. But I already think of "Chinese dragon" as a different thing from "dragon", so my vote would just be to raise awareness of that difference.</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Dec 17 2021 09:19:50 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(not that I have a vote)</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Dec 17 2021 09:20:58 GMT-0800 (Pacific Standard Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">sometimes I'll use "river dragon", "water dragon", or "cloud dragon" for Chinese dragon too. But I don't think any of that is generally agreed upon.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Dec 17 2021 09:23:05 GMT-0800 (Pacific Standard Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell"><a href="https://en.wikipedia.org/wiki/Komodo_dragon">https://en.wikipedia.org/wiki/Komodo_dragon</a> The only kind of dragon which is still alive, AFAIK.</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Dec 17 2021 10:00:31 GMT-0800 (Pacific Standard Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: so... I am finding in my review of the innocuous bug 1746515 that I messed up in my review of <code>ArrayBufferCopyData</code>, and so I think I'm going to be a jerk and request changes in it that may or may not influence how this new API works.</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Dec 17 2021 10:00:33 GMT-0800 (Pacific Standard Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1746515">https://bugzil.la/1746515</a> — NEW (mgaudet) — Implement CloneArrayBuffer specification algorithm</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Dec 17 2021 10:00:47 GMT-0800 (Pacific Standard Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'll post the comment, then you can call me mean names here. ;-)</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri Dec 17 2021 10:06:30 GMT-0800 (Pacific Standard Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Done. That was a mean review. I feel bad. Must do penance.</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri Dec 17 2021 10:12:09 GMT-0800 (Pacific Standard Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">my hypothetical security problem isn't currently possible because it's only used as a self-hosted intrinsic right now, but it still seems like a sharp and pointy thing to have lying around</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri Dec 17 2021 10:44:39 GMT-0800 (Pacific Standard Time)">18:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: No worries. I will cope :)</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Fri Dec 17 2021 11:19:38 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Here's a fun question: Using JS78
We evaluate multiple scripts in our program all the time, and we had an option to not reuse the same Context/Global.
The first time we instantiate an interpreter it works.
The second time it blows up with a MOZ_RELEASE_ASSERT fail at the top of js::NewContext</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Fri Dec 17 2021 11:20:17 GMT-0800 (Pacific Standard Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">i.e. MOZ_RELEASE_ASSERT(!TlsContext.get());</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Fri Dec 17 2021 11:22:13 GMT-0800 (Pacific Standard Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">So in essence we have one SpiderMonkey instance alread -- i.e. a global and context -- and the second time we call JS_NewContext it fails that assertion.</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Fri Dec 17 2021 11:23:42 GMT-0800 (Pacific Standard Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">is the first JSContext destroyed ?</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Fri Dec 17 2021 11:23:51 GMT-0800 (Pacific Standard Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">no</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Fri Dec 17 2021 11:24:04 GMT-0800 (Pacific Standard Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">I guess that's the answer right there.</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Fri Dec 17 2021 11:24:14 GMT-0800 (Pacific Standard Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">there's only one true context?</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Fri Dec 17 2021 11:25:34 GMT-0800 (Pacific Standard Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">there can be only one JSContext per thread</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Fri Dec 17 2021 11:30:06 GMT-0800 (Pacific Standard Time)">19:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">OK</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Fri Dec 17 2021 11:30:17 GMT-0800 (Pacific Standard Time)">19:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">but you can have &gt; 1 global object right?</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Fri Dec 17 2021 11:32:43 GMT-0800 (Pacific Standard Time)">19:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: I don't think dotQueueingStrategySize on the global is enough to hide it.</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Fri Dec 17 2021 11:33:00 GMT-0800 (Pacific Standard Time)">19:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">TIL that C++20 allows empty type members to do reasonable things <a href="https://en.cppreference.com/w/cpp/language/attributes/no_unique_address">https://en.cppreference.com/w/cpp/language/attributes/no_unique_address</a></td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Fri Dec 17 2021 11:39:15 GMT-0800 (Pacific Standard Time)">19:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh wow, I would've guessed that would be too hairy to fix</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Fri Dec 17 2021 11:41:37 GMT-0800 (Pacific Standard Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ugly, ugly c++ question: I want to use placement new to "update" the type of a chunk of memory, possibly to what it already was. So <code>new (&amp;myobj) MyObject</code>. But that reruns the constructors of <code>MyObject</code>, where what I want is a fancy no-op that tells C++ the actual type of that chunk of memory. Is there a non-UB way of doing that without running constructors?</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Fri Dec 17 2021 11:42:36 GMT-0800 (Pacific Standard Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the problem I'm running into is that a base class contains an <code>Atomic&lt;int&gt;</code> field, which has a constructor that initializes it to zero. So when re-blessing my object, it zeroes out that field.</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Fri Dec 17 2021 11:44:00 GMT-0800 (Pacific Standard Time)">19:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oops, I'm late</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Fri Dec 17 2021 11:47:43 GMT-0800 (Pacific Standard Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">chaircrusher</span>: Yes, you can have multiple global objects per thread</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Fri Dec 17 2021 11:47:54 GMT-0800 (Pacific Standard Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">👍️</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Fri Dec 17 2021 12:11:40 GMT-0800 (Pacific Standard Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">mgaudet</span>: I don't think dotQueueingStrategySize on the global is enough to hide it.</blockquote></mx-reply>Oh? What's the concern?</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Fri Dec 17 2021 12:14:46 GMT-0800 (Pacific Standard Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">OK is there a way in the C++ api to destroy a GlobalObject?</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Fri Dec 17 2021 12:20:49 GMT-0800 (Pacific Standard Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">Or more particularly, I need to get rid of a GlobalObject pointed to by a JS::PersistentRooted -- so in essence destroy a JS_Object</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Fri Dec 17 2021 12:22:50 GMT-0800 (Pacific Standard Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Oh? What's the concern?</blockquote></mx-reply>(maybe best to post on the revision, as I'm going to be gone until 2022 in a couple hours)</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Fri Dec 17 2021 12:24:48 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">So I could do a reset on a PersistenRooted holding a GlobalObject and it will eventually be GC'ed?</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Fri Dec 17 2021 12:29:07 GMT-0800 (Pacific Standard Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Oh? What's the concern?</blockquote></mx-reply>can't you just do <code>globalThis[".dotSomething"]</code></td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Fri Dec 17 2021 12:30:03 GMT-0800 (Pacific Standard Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Oh... yes. Whoops. I pulled the dot trick from various binding tricks. Which won't work on the global. </td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Fri Dec 17 2021 12:30:19 GMT-0800 (Pacific Standard Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><em>sigh</em>. Any suggestions?</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Fri Dec 17 2021 12:31:27 GMT-0800 (Pacific Standard Time)">20:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I have been thinking, I think this sort of behavior is sort of novel outside the JS engine</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Fri Dec 17 2021 12:31:55 GMT-0800 (Pacific Standard Time)">20:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: one thing with your patch is we probably want <code>new (p) MyObject</code> instead of <code>new (p) MyObject()</code> to get the default thing. EDIT</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Fri Dec 17 2021 12:32:11 GMT-0800 (Pacific Standard Time)">20:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I've been looking at spec, and I'm pretty sure what we want is generally UB</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Fri Dec 17 2021 12:33:00 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><pre><code>int x = p-&gt;x;
return new (p) X(x);
</code></pre>
<p>does generally seem to optimize very easily into a no-op</p>
</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Fri Dec 17 2021 12:33:11 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">sfink</span>: one thing with your patch is we probably want <code>new (p) MyObject</code> instead of <code>new (p) MyObject</code> to get the default thing.</blockquote></mx-reply>Those are the same thing... right?</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Fri Dec 17 2021 12:33:13 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">but technically, the <code>p</code> lifetime is dead</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Fri Dec 17 2021 12:33:21 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: nope!</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Fri Dec 17 2021 12:33:47 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: They look identical to me. Typo?</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Fri Dec 17 2021 12:33:53 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: something like <a href="https://searchfox.org/mozilla-central/source/dom/base/nsGlobalWindowInner.h#1413">https://searchfox.org/mozilla-central/source/dom/base/nsGlobalWindowInner.h#1413</a>  maybe, but it doesn't work with workers</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Fri Dec 17 2021 12:34:25 GMT-0800 (Pacific Standard Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Ah, there we go</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Fri Dec 17 2021 12:34:32 GMT-0800 (Pacific Standard Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: sneaky edit :P</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Fri Dec 17 2021 12:34:53 GMT-0800 (Pacific Standard Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">actually I think everything inherits from nsIGlobalObject, so maybe we could add something to that</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Fri Dec 17 2021 12:35:14 GMT-0800 (Pacific Standard Time)">20:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Existing pointers that are of type <code>void*</code> get to remain valid even if you rebuild the object. If you rebuild with the exact type, then <code>T*</code> pointers can be reused iff there are no <code>const</code> members, otherwise you need to <code>std::launder</code> the pointer first.. sigh</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Fri Dec 17 2021 12:36:23 GMT-0800 (Pacific Standard Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> actually I think everything inherits from nsIGlobalObject, so maybe we could add something to that</blockquote></mx-reply>😬</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Fri Dec 17 2021 12:39:17 GMT-0800 (Pacific Standard Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">this would be a perfect question for bz 😢</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Fri Dec 17 2021 12:39:56 GMT-0800 (Pacific Standard Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">(I'm struggling to find a perfectly valid C++ way to do our BaseScript/JSScript or JSString/../.. casts and keep running into our trick of putting storage in the base type and using Derived* to indicate "this is a Base* but I've check some invariants". In other cases like <code>ScriptWarmUpData</code> we have a robust solution, but that replaces the pointer types with a special wrapper-pointer which has crappier ergonomics..)</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Fri Dec 17 2021 12:53:05 GMT-0800 (Pacific Standard Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell"><p>OK I think I have a more basic reformulation of my question about freeing objects pointed to by JS::PersistentRooted.</p>
<p>I have a global variable (which is actually a Global Object, but I don't think it's limited to tht case)</p>
<pre><code>
JS::PersistentRooted&lt;JSObject&gt; jsglobal;

</code></pre>
<p>I want that global to go away, as it needs to be replaced.<br>Will this release the object for GC?</p>
<pre><code>jsglobal.reset();
jsglobal.init(context);
jsglobal = JS_NewGlobalObject(context. ...);
</code></pre>
</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Fri Dec 17 2021 12:55:32 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">chaircrusher</span>: I think it should; so long as the global <em>and nothing that refers to the global</em> is still alive/rooted, it should get GC'd eventually.</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Fri Dec 17 2021 12:55:58 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">That would be the case.</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Fri Dec 17 2021 12:56:01 GMT-0800 (Pacific Standard Time)">20:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(the caveat being that I seem to recall there's a few ways globals can be referred to, so you have to be a bit careful there) </td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Fri Dec 17 2021 12:57:06 GMT-0800 (Pacific Standard Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@chaircrusher:mozilla.org">chaircrusher</span>&gt;</div></td><td class="msg-cell">I think I'm fine on that.  we just set up the global with all our JSNative functions and objects, and don't touch it otherwise.
There are just situations where we want to purge the whole interpreter instance and start over.</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Fri Dec 17 2021 12:59:10 GMT-0800 (Pacific Standard Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">I think that should be fine then :) </td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Fri Dec 17 2021 13:36:46 GMT-0800 (Pacific Standard Time)">21:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">tcampbell</span>: I don't think <code>new (ptr) Class</code> in place of <code>new (ptr) Class()</code> is going to help. From what I read, there's only a difference for builtin things. (So <code>new (ptr) int</code> will not zero initialize, but <code>new (ptr) int()</code> will.) Any nonprimitive will still run the constructor.</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Fri Dec 17 2021 13:36:59 GMT-0800 (Pacific Standard Time)">21:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">which makes sense; constructors kind of define what a valid instance is.</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Fri Dec 17 2021 13:37:14 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">yeah, if the constructor is <code>= default</code> they do have different results</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Fri Dec 17 2021 13:37:33 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I was playing with manually copying the fields and the compilers seem to optimize it to a no-op as we want</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Fri Dec 17 2021 13:37:50 GMT-0800 (Pacific Standard Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and I haven't tried, but I'm skeptical that <code>new (ptr) Cell</code> is going to be optimized away, because the field is an <code>Atomic</code></td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Fri Dec 17 2021 13:38:03 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">and I guess I'm assuming that you can't just drop writes to <code>Atomic</code>s</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Fri Dec 17 2021 13:38:32 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ah, I see what you mean</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Fri Dec 17 2021 13:38:51 GMT-0800 (Pacific Standard Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">the UB that I wasn't able to work around is that existing Base* pointers become invalid</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Fri Dec 17 2021 13:39:12 GMT-0800 (Pacific Standard Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh, I hadn't thought of that</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Fri Dec 17 2021 13:39:18 GMT-0800 (Pacific Standard Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><a href="https://eel.is/c++draft/basic.life#example-1">https://eel.is/c++draft/basic.life#example-1</a></td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Fri Dec 17 2021 13:40:03 GMT-0800 (Pacific Standard Time)">21:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">if they are <code>void*</code> then identity can be reused, but not for specific types without re-casting from void* or laundering or something</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Fri Dec 17 2021 13:43:26 GMT-0800 (Pacific Standard Time)">21:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">and at that point I got stumped</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Fri Dec 17 2021 13:44:22 GMT-0800 (Pacific Standard Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">why does the validity of <code>pb</code> matter in that example for the assignment to <code>q</code>? I thought you had to dereference before you could hit UB. Oh, wait, hm... I guess it's kind of like a pointer well past the end of an array or something; there is no valid value for the pointer's "numeric" value?</td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Fri Dec 17 2021 13:44:53 GMT-0800 (Pacific Standard Time)">21:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">(not that it's relevant here, just wondering)</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Fri Dec 17 2021 13:45:10 GMT-0800 (Pacific Standard Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">not sure either</td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Fri Dec 17 2021 13:45:49 GMT-0800 (Pacific Standard Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I guess because you could always placement-new all over using that address?</td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Fri Dec 17 2021 13:46:51 GMT-0800 (Pacific Standard Time)">21:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><pre><code class="language-cpp">B* xx = new D1;
B* yy = new (xx) D2;
...
B* zz = new (xx) D1;
</code></pre>
<p>(Not that this feels particularly helpful..)</p>
</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Fri Dec 17 2021 14:04:56 GMT-0800 (Pacific Standard Time)">22:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Huh. <a href="https://foxyeah.com/z/5Gj54b">https://foxyeah.com/z/5Gj54b</a> seems to be showing that the assignment via the placement new <em>is</em> compiled out, even though plain assignments are not. So maybe there's hope here after all...</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Fri Dec 17 2021 14:32:00 GMT-0800 (Pacific Standard Time)">22:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: I have run out of year -- Remainder of my patches for DOM Streams (cleanups, new test cases, some more fixes, etc) will have to wait until 2022. Happy Holidays All! </td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Fri Dec 17 2021 14:32:03 GMT-0800 (Pacific Standard Time)">22:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Fri Dec 17 2021 14:51:23 GMT-0800 (Pacific Standard Time)">22:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ok, I think I'd better fall back on landing something trivially simple for now. I seem to have gotten myself to a place where I'm seriously considering fixing UB by applying different UB. I should be working on other stuff anyway.</td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Fri Dec 17 2021 15:33:47 GMT-0800 (Pacific Standard Time)">23:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">argh. I guess <code>js -e 1</code> is <em>not</em> actually a complete test.</td></tr>
  <tr class="msg" id="L138"><td class="ts-cell"><a class="ts" href="#L138" alt="Fri Dec 17 2021 15:36:18 GMT-0800 (Pacific Standard Time)">23:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">I would consider just applying that compile option to build</td></tr>
  <tr class="msg" id="L139"><td class="ts-cell"><a class="ts" href="#L139" alt="Fri Dec 17 2021 15:41:06 GMT-0800 (Pacific Standard Time)">23:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, that's the right thing for now. I'll also put up a safe subset of the patches for review. (They use placement new on fresh allocations.)</td></tr>
  <tr class="msg" id="L140"><td class="ts-cell"><a class="ts" href="#L140" alt="Fri Dec 17 2021 15:48:14 GMT-0800 (Pacific Standard Time)">23:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">sounds good</td></tr>

</tbody></table></div></div></div>
</body></html>