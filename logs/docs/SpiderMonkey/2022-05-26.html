<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-05-26</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-05-26<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-05-25" class="nav-link"><span>prev</span></a>
<a href="2022-05-27" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed May 25 2022 17:45:25 GMT-0700 (Pacific Daylight Time)">00:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Spent way too long debugging a ShadowRealm module import error that turned out to be "File Not Found" (oops). Filed a spec bug in the end, as I think the spec is wrong. <a href="https://github.com/tc39/proposal-shadowrealm/issues/363">https://github.com/tc39/proposal-shadowrealm/issues/363</a> </td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed May 25 2022 17:45:27 GMT-0700 (Pacific Daylight Time)">00:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu May 26 2022 06:10:47 GMT-0700 (Pacific Daylight Time)">13:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">my understanding was that ESMification was to happen during the ESR 102 timeline, so dropping importModule() from the next ESR is confusing to me <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1771112">https://bugzilla.mozilla.org/show_bug.cgi?id=1771112</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu May 26 2022 06:12:12 GMT-0700 (Pacific Daylight Time)">13:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">what's the plan for out-of-tree code that needs to transition to ESM modules, but needs to work across ESR and Firefox during that transition?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu May 26 2022 06:18:36 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">zombie</span>: We're not currently planning to support ESM modules in the ESR 102 release. This is to avoid having a half finished solution in ESR or otherwise having to backport all changes to the ESR.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu May 26 2022 06:19:19 GMT-0700 (Pacific Daylight Time)">13:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">That said, I wasn't aware of a requirement for code to work on both ESR and current Firefox.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu May 26 2022 06:21:41 GMT-0700 (Pacific Daylight Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">Was this your expectation?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu May 26 2022 06:25:11 GMT-0700 (Pacific Daylight Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">I'm not sure if there are other use cases for out-of-tree code that need to be supported, but at least for privileged extensions (that don't ship with firefox): they use internal JSMs, and usually try to support the current ESR along with Firefox</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu May 26 2022 06:26:51 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">addons.m.o doesn't currently have a good way to target different extension branches at different firefox/esr versions</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu May 26 2022 06:31:19 GMT-0700 (Pacific Daylight Time)">13:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">I think our main use case is internal code.  If there is out of tree code that needs to support multiple versions that will need to wait until all versions they target support the new feature.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu May 26 2022 06:32:13 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span> you have been more involved in the requirements for this, is that right? ^</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu May 26 2022 06:32:14 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">until ESM-ification finishes, the <code>ChromeUtils.import</code> with old .jsm keeps working even if the module is ESM-ified</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu May 26 2022 06:32:44 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">bug 1766761</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu May 26 2022 06:32:46 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1766761">https://bugzil.la/1766761</a> ‚Äî RESOLVED (arai) ‚Äî Provide a shim for ESM-ified modules</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu May 26 2022 06:33:31 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">aha, I've seen mentions of that, but didn't have a chance to investigate how it would work</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu May 26 2022 06:33:36 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, no change is necessary for out-of-tree consumer</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu May 26 2022 06:33:53 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: good point, yes the original code will keep working</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu May 26 2022 06:34:02 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">once all (or almost) modules are ESM-ified, out-of-tree code can be migrated to new API</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu May 26 2022 06:34:11 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">and once that's all done, the shim will be removed</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu May 26 2022 06:34:17 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">arai</span>: so is the plan to drop the shim in the next ESR?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu May 26 2022 06:35:02 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">because that will mean the transition for <em>all</em> out of tree code will need to happen at that point, instead of gradually over time</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu May 26 2022 06:36:23 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if ESM-ification finishes before the next ESR after 102, I was about to remove the shim, but if that's problematic, deferring it to next-next ESR is fine</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu May 26 2022 06:37:12 GMT-0700 (Pacific Daylight Time)">13:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">*meant to say "all out of tree code *that needs to support ESR as well"</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu May 26 2022 06:39:44 GMT-0700 (Pacific Daylight Time)">13:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">for privileged extension's case, when is old ESR support dropped?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu May 26 2022 06:40:46 GMT-0700 (Pacific Daylight Time)">13:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">or, what's the range of supported versions in usual case?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu May 26 2022 06:44:18 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">I don't know the details offhand (I can look into it), but it's usually the current ESR</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu May 26 2022 06:46:00 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">also I guess code could be written to feature-detect <code>importModule</code> and branch on that during the transition.  not ideal, but probably manageable for the dozen or so privileged extensions that live outside m-c</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu May 26 2022 06:46:03 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, according to <a href="https://wiki.mozilla.org/Release_Management/Calendar">https://wiki.mozilla.org/Release_Management/Calendar</a> , there will be 3 regular release cycles where there are "2 current ESRs" ?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu May 26 2022 06:48:48 GMT-0700 (Pacific Daylight Time)">13:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'll summarize.  give me some time</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu May 26 2022 06:48:53 GMT-0700 (Pacific Daylight Time)">13:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu May 26 2022 06:50:56 GMT-0700 (Pacific Daylight Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">ok thanks <span class="nick-4">jonco</span> and <span class="nick-15">arai</span>, i think we can come back to this after we're further along with internal transition, things should be clearer then and especially if we have the option of keeping the shim for the next ESR as a last resort</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu May 26 2022 07:01:29 GMT-0700 (Pacific Daylight Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>version 103:</p>
<ul>
<li><code>ChromeUtils.importESM</code> becomes available</li>
<li><code>ChromeUtils.import</code> is available</li>
<li>all system modules are still in JSM</li>
<li>out-of-tree code uses <code>ChromeUtils.import</code></li>
</ul>
<p>point A:</p>
<ul>
<li>some system modules are ESM-ified</li>
<li><code>ChromeUtils.importESM</code> works only for ESM-ified modules</li>
<li>(shim) <code>ChromeUtils.import</code> works for all JSM/ESM, with JSM URL</li>
</ul>
<p>point B:</p>
<ul>
<li>almost all system modules are ESM-ified</li>
<li><code>ChromeUtils.importESM</code> works for almost all system modules</li>
<li>out-of-tree code is ready to migrate to <code>ChromeUtils.importESM</code></li>
</ul>
<p>point C:</p>
<ul>
<li>out-of-tree code migration finishes to <code>ChromeUtils.importESM</code></li>
</ul>
<p>point D:</p>
<ul>
<li>drop shim</li>
<li>any code that uses the shim stops working</li>
</ul>
</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu May 26 2022 07:03:35 GMT-0700 (Pacific Daylight Time)">14:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, the issue is, when the point C and D are</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu May 26 2022 07:05:00 GMT-0700 (Pacific Daylight Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">if there are out-of-tree code that still uses <code>ChromeUtils.import</code>/JSM, that's not yet point C</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu May 26 2022 07:05:27 GMT-0700 (Pacific Daylight Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">then, feature detection for <code>ChromeUtils.importESM</code> doesn't work because that doesn't necessarily mean the system module is ESM-ified</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu May 26 2022 07:05:57 GMT-0700 (Pacific Daylight Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">betwee 103 and point B</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu May 26 2022 07:09:02 GMT-0700 (Pacific Daylight Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">anyway, I'll bring this to module meeting, and we'll have the scheduling document/meeting for points A-D</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu May 26 2022 07:10:23 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">well, it only needs to target ~current firefox version and ESR, so if it needs <code>moduleA</code>, only after it's been converted to esm, it can land a feature-detected branch to use either <code>importESM("moduleA.esm")</code> or <code>import("moduleA.jsm")</code></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu May 26 2022 07:10:57 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">it can happen module-by-module, doesn't need to be all or nothing</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu May 26 2022 07:15:04 GMT-0700 (Pacific Daylight Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">I'll create a document and invite you</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu May 26 2022 07:16:27 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@zombie:mozilla.org">zombie</span>&gt;</div></td><td class="msg-cell">sounds good, thanks</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu May 26 2022 07:42:23 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">sent out the invitation</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu May 26 2022 14:42:42 GMT-0700 (Pacific Daylight Time)">21:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">confession: Just spent ten minutes wonder why my new test wasn't failing: <code>mach jstests</code> != <code>mach jit-test</code> ü§¶‚Äç‚ôÇÔ∏è</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu May 26 2022 14:42:44 GMT-0700 (Pacific Daylight Time)">21:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>

</tbody></table></div></div></div>
</body></html>