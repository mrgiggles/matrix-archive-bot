<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2022-11-03</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2022-11-03<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-11-02" class="nav-link"><span>prev</span></a>
<a href="2022-11-04" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Nov 03 2022 05:31:41 GMT-0700 (Pacific Daylight Time)">12:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell">when SpiderMonkey is embedded in Firefox, what are realms associated with? how common is it for a function to call another function from a different realm?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Nov 03 2022 06:06:26 GMT-0700 (Pacific Daylight Time)">13:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: each iframe has its own global / realm for example</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Nov 03 2022 06:07:41 GMT-0700 (Pacific Daylight Time)">13:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">cross-realm calls are not extremely common (we used to have a single realm per compartment, with cross-compartment wrappers for all cross-realm calls), but we changed it because it does show up on websites</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Nov 03 2022 06:08:29 GMT-0700 (Pacific Daylight Time)">13:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">so it is still fairly common I guess, for certain websites</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Nov 03 2022 06:24:53 GMT-0700 (Pacific Daylight Time)">13:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@rhunt:mozilla.org">Ryan Hunt</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: Ah interesting. I would not have guessed calls between functions in different iframes would show up that often, but the web surprises you. In the wasm context, I was wondering if inserting a wrapper on cross-realm wasm calls would make sense. It would simplify some of our call logic, which would help with tail calls</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 03 2022 06:28:09 GMT-0700 (Pacific Daylight Time)">13:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ryan Hunt</span>: most websites probably don't use them that much, but some do, at least for JS. Calling out to a trampoline or something for cross-realm calls should be fine, but deoptimizing them too much could become a perf cliff at some point</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 03 2022 06:30:31 GMT-0700 (Pacific Daylight Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">(websites sometimes create iframes from JS to use as a kind of sandbox because you get a fresh global)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 03 2022 08:07:50 GMT-0700 (Pacific Daylight Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><p>I'm following the <a href="https://firefox-source-docs.mozilla.org/js/HazardAnalysis/running.html">instructions on running the Rooting Hazard Analysis locally</a>, but I get build failures when I execute <code>./mach hazards build-shell</code>: it can't find <em>prlink.h</em> or <em>prerror.h</em>. I successfully executed <code>./mach hazards bootstrap</code>.</p>
<p>Is there some system dependency I'm missing?</p>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 03 2022 08:13:41 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@ms2ger:igalia.com">Ms2ger 游눌游눌游눌</span>&gt;</div></td><td class="msg-cell">Sounds like nspr, which is in tree (but outside js/)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 03 2022 08:13:48 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@ms2ger:igalia.com">Ms2ger 游눌游눌游눌</span>&gt;</div></td><td class="msg-cell">I don't recall how that's integrated</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 03 2022 08:27:44 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>: you have MOZCONFIG unset? (It should be unset, since the hazard build provides its own. Unless you need specific configuration.) nspr should be built along with the shell.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 03 2022 08:27:52 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">let me go read my own instructions...</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 03 2022 08:30:09 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">they definitely need some updates, but the main commands should still work the same</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Nov 03 2022 08:32:13 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">Thanks! I did have MOZCONFIG set, and things are building more nicely now that I've unset it</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Nov 03 2022 08:34:00 GMT-0700 (Pacific Daylight Time)">15:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">Oops, sorry, that's one major omission in the instructions. It also sounds like I need to add another check that whatever MOZCONFIG is being used is sufficient. It's a messy part of the process, I probably ought to figure out something better.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Nov 03 2022 08:46:58 GMT-0700 (Pacific Daylight Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">Could you in the mean time just suggest unsetting it?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Nov 03 2022 08:53:56 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes, will do</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Nov 03 2022 09:06:28 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><p>Ok, so <code>./mach hazards build-shell</code> works now, and <code>./mach hazards gather --application=js</code> succeeds, but <code>./mach hazards analyze --application=js</code> is failing:</p>
<pre><code class="language-Running">PATH="/home/bryan/.mozbuild/hazard-tools/gcc/bin:/home/bryan/.mozbuild/hazard-tools/sixgill/usr/bin:${PATH}" XDB='/home/bryan/.mozbuild/hazard-tools/sixgill/usr/bin/xdb.so' SOURCE='/home/bryan/src/small-fixes' ANALYZED_OBJDIR='/home/bryan/src/small-fixes/obj-analyzed-js' /home/bryan/src/small-fixes/obj-haz-shell/dist/bin/js /home/bryan/src/small-fixes/js/src/devtools/rootAnalysis/computeGCFunctions.js rawcalls.1.of.16 rawcalls.2.of.16 rawcalls.3.of.16 rawcalls.4.of.16 rawcalls.5.of.16 rawcalls.6.of.16 rawcalls.7.of.16 rawcalls.8.of.16 rawcalls.9.of.16 rawcalls.10.of.16 rawcalls.11.of.16 rawcalls.12.of.16 rawcalls.13.of.16 rawcalls.14.of.16 rawcalls.15.of.16 rawcalls.16.of.16 --outputs callgraph.txt gcFunctions.txt gcFunctions.lst limitedFunctions.lst
Spawned process 2354879
free(): invalid pointer
Renaming callgraph.tmp1 -&gt; callgraph.txt
Error renaming callgraph.tmp1 -&gt; callgraph.txt
Traceback (most recent call last):
  File "/home/bryan/src/small-fixes/js/src/devtools/rootAnalysis/analyze.py", line 494, in &lt;module&gt;
    run_job(step, data)
  File "/home/bryan/src/small-fixes/js/src/devtools/rootAnalysis/analyze.py", line 252, in run_job
    os.rename(temp, final)
FileNotFoundError: [Errno 2] No such file or directory: 'callgraph.tmp1' -&gt; 'callgraph.txt'```
</code></pre>
</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Nov 03 2022 09:06:49 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">whoa</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Nov 03 2022 09:10:27 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm trying to run it locally now. I've never seen it fail in that way.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Nov 03 2022 09:11:33 GMT-0700 (Pacific Daylight Time)">16:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the <code>free(): invalid pointer</code> is ominous.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Nov 03 2022 09:15:44 GMT-0700 (Pacific Daylight Time)">16:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">oh good, I'm getting exactly the same errors locally.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Nov 03 2022 09:19:59 GMT-0700 (Pacific Daylight Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the invalid free is the problem, it's causing everything to abort. It's coming from my jsctypes code. I should really get off of ctypes entirely.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Nov 03 2022 09:31:51 GMT-0700 (Pacific Daylight Time)">16:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Bryan Thrall [:bthrall]</span>: as a quick workaround, you can comment out the <code><a href="http://libc.free">libc.free</a>(...)</code> call on line 344 of <code>js/src/devtools/rootAnalysis/utility.js</code>.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Nov 03 2022 09:32:02 GMT-0700 (Pacific Daylight Time)">16:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell">Thanks!</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Nov 03 2022 09:44:16 GMT-0700 (Pacific Daylight Time)">16:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@redfire75369:mozilla.org">Redfire</span>&gt;</div></td><td class="msg-cell">I think it'd be nice for spidermonkey-embedding-examples to have one with <code>BigInt</code></td></tr>

</tbody></table></div></div></div>
</body></html>