<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2024-03-04</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2024-03-04<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-03-01" class="nav-link"><span>prev</span></a>
<a href="2024-03-05" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search SpiderMonkey">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Mar 04 2024 08:47:10 GMT-0800 (Pacific Standard Time)">16:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <strong>Stupid idea of the day:</strong> JSON.stringify generates an object which looks like an Object written in JS code, so when calling JSON.stringify, instead of computing a string and concatenate tons of small strings, we could make a vector of sub-strings from the original source, and fallback on what we do today if there is no source location matching the property names in the sources.</blockquote></mx-reply>Since if I understand correctly many of the things that show up in the source will be turned into atoms, it seems like this is similar to making a big rope tree with atoms as the leaves. Though obviously your vector would be more efficient than traversing through the 2^(n-1) rope nodes. In both cases, though, we'd need to worry about the consumer flattening the <code>JSON.stringify</code> output.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Mar 04 2024 08:55:45 GMT-0800 (Pacific Standard Time)">16:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I had not thought of it as atoms, but more as dependent strings, but I guess this is a detail.
However, maybe this highlight one thing, which is for repeated calls to stringify, we could reduce the size of frequently seen sequences.
I wonder, when you have a big enough object, how likely is it that there are repeated patterns in it? and how much time can be saved from caching these patterns … (crazy talk still)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Mar 04 2024 09:03:22 GMT-0800 (Pacific Standard Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah, I was thinking of proposing a <strong>Stupider idea of the day</strong>, which would use something like LZSS for a string type. (A string would be a sequence of tokens, where a token is either a character or an &lt;offset,length&gt; backreference to earlier in the string.)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Mar 04 2024 09:03:37 GMT-0800 (Pacific Standard Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">but I guess that's basically creating a compressed string type.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Mar 04 2024 09:30:18 GMT-0800 (Pacific Standard Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">This is roughly what external/dependent strings are about.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Mar 04 2024 09:31:03 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Oh, within the generated string!</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Mar 04 2024 09:31:55 GMT-0800 (Pacific Standard Time)">17:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">That's actually how I was thinking of re-implementing the flattening algorithm for the GenericPrinter class (before looking at the use cases and abandoning the idea)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Mar 04 2024 09:58:46 GMT-0800 (Pacific Standard Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">Anyone ever encountered <code>rr</code> failing to get any debug info out of a 32-bit target?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Mar 04 2024 09:58:55 GMT-0800 (Pacific Standard Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">and any pointers?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Mar 04 2024 10:02:35 GMT-0800 (Pacific Standard Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">sfink</span>: would you have some cycles this week to look over the patch in bug 1882362 so we can start experimenting with nursery size?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Mar 04 2024 10:02:37 GMT-0800 (Pacific Standard Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1882362">https://bugzil.la/1882362</a> — NEW (denispal) — Add GC prefs to the nimbus manifest</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Mar 04 2024 10:03:37 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: Failing how? Did you build it with debug info? I don't remember ever having trouble with 32-bit builds specifically</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Mar 04 2024 10:03:55 GMT-0800 (Pacific Standard Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">mostly it has none; so nothing that needs debug info works</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Mar 04 2024 10:04:11 GMT-0800 (Pacific Standard Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">built with optimize disabled and debug enabled </td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Mar 04 2024 10:05:15 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><p>My x86 mozconfig is just this:</p>
<pre><code>mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/obj-x86
ac_add_options --enable-application=js
ac_add_options --enable-jitspew
ac_add_options --disable-optimize
ac_add_options --enable-debug
ac_add_options --target=i686-pc-linux
</code></pre>
</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Mar 04 2024 10:05:42 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">this is a browser build alas </td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Mar 04 2024 10:05:50 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">Ah!</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Mar 04 2024 10:06:01 GMT-0800 (Pacific Standard Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">I'm not sure I've ever built a 32-bit browser</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Mar 04 2024 10:06:59 GMT-0800 (Pacific Standard Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-12">sfink</span>: would you have some cycles this week to look over the patch in bug 1882362 so we can start experimenting with nursery size?</blockquote></mx-reply>Oh right, sorry, will look at that now.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Mar 04 2024 10:07:24 GMT-0800 (Pacific Standard Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell">thanks!</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Mar 04 2024 10:09:14 GMT-0800 (Pacific Standard Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">(ultimately I think I have my answer here, but would be nice to have one day( </td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Mar 04 2024 10:09:37 GMT-0800 (Pacific Standard Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">denispal</span>: r=me</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Mar 04 2024 10:49:51 GMT-0800 (Pacific Standard Time)">18:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@silonp:matrix.org">silonp</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> a PersistentRootedObject points to an object. When a GC happens, it will mark that object to keep it alive. It doesn't own the object or use reference counting</blockquote></mx-reply>This might be a problem in my code (most probably), but when I force the GC after each iteration (JS_GC), the global object is not garbage collected (finalizer of the private data @ slot 0 is triggered only with JSContext destruction).</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Mar 04 2024 11:46:34 GMT-0800 (Pacific Standard Time)">19:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell"><p>Out of curiosity is there something I could do to figure out what might be causing 6.3 gigs of class data to be allocated for the JSM global in one of my content processes?</p>
<pre><code>7,113.23 MB (100.0%) -- explicit
├──6,520.56 MB (91.67%) -- js-non-window
│  ├──6,418.01 MB (90.23%) -- zones
│  │  ├──6,413.22 MB (90.16%) -- zone(0x100b6a000)
│  │  │  ├──6,332.26 MB (89.02%) -- realm([System Principal], shared JSM global)
│  │  │  │  ├──6,331.83 MB (89.01%) -- classes
│  │  │  │  │  ├──1,824.25 MB (25.65%) -- class(Map)/objects
│  │  │  │  │  │  ├──1,459.41 MB (20.52%) -- malloc-heap
│  │  │  │  │  │  │  ├──1,459.41 MB (20.52%) ── misc
│  │  │  │  │  │  │  └──────0.00 MB (00.00%) ── slots
│  │  │  │  │  │  └────364.85 MB (05.13%) ── gc-heap
│  │  │  │  │  ├──1,460.20 MB (20.53%) -- class(Function)/objects
│  │  │  │  │  │  ├──1,460.15 MB (20.53%) ── gc-heap
│  │  │  │  │  │  └──────0.05 MB (00.00%) ── malloc-heap/slots
│  │  │  │  │  ├────886.28 MB (12.46%) -- class(Object)/objects
│  │  │  │  │  │    ├──677.69 MB (09.53%) ── gc-heap
│  │  │  │  │  │    └──208.59 MB (02.93%) -- malloc-heap
│  │  │  │  │  │       ├──208.58 MB (02.93%) ── slots
│  │  │  │  │  │       └────0.01 MB (00.00%) ── elements/normal
│  │  │  │  │  ├────857.15 MB (12.05%) -- class(Set)/objects
│  │  │  │  │  │    ├──674.71 MB (09.49%) ── malloc-heap/misc
│  │  │  │  │  │    └──182.44 MB (02.56%) ── gc-heap
│  │  │  │  │  ├────651.63 MB (09.16%) ── class(Call)/objects/gc-heap
│  │  │  │  │  ├────469.23 MB (06.60%) -- class(LexicalEnvironment)/objects
│  │  │  │  │  │    ├──469.23 MB (06.60%) ── gc-heap
│  │  │  │  │  │    └────0.00 MB (00.00%) ── malloc-heap/slots
│  │  │  │  │  ├────182.77 MB (02.57%) -- class(Array)/objects
│  │  │  │  │  │    ├──182.76 MB (02.57%) ── gc-heap
│  │  │  │  │  │    └────0.01 MB (00.00%) ++ malloc-heap
│  │  │  │  │  └──────0.32 MB (00.00%) ++ (6 tiny)
│  │  │  │  └──────0.44 MB (00.01%) ++ (3 tiny)
│  │  │  ├─────71.32 MB (01.00%) ── gc-heap-arena-admin
│  │  │  └──────9.64 MB (00.14%) ++ (15 tiny)
│  │  └──────4.78 MB (00.07%) ++ (13 tiny)
│  └────102.55 MB (01.44%) ++ (3 tiny)
</code></pre>
</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Mar 04 2024 11:48:37 GMT-0800 (Pacific Standard Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">(I can't remember if this is just "we allocated a ton of objects" or if this means that the actual JSClass instances are somehow using 6.3 gigs, if it's just a ton of objects, it's probably just some annoying memory leak problem with some system js recording too much)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Mar 04 2024 11:57:30 GMT-0800 (Pacific Standard Time)">19:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I think that means you have 1.82GB of objects whose JSClass is named "Map", and that includes 1.46GB stored in the malloc heap (and the rest are the objects themselves that are stored in the GC heap).</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Mar 04 2024 11:58:28 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">385MB worth of GC data sounds like a lot of individual objects. Maps, in particular, don't store very much other than the object headers themselves in the GC heap (somebody please tell me if I'm wrong).</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Mar 04 2024 11:58:33 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think that means you have 1.82GB of objects whose JSClass is named "Map", and that includes 1.46GB stored in the malloc heap (and the rest are the objects themselves that are stored in the GC heap).</blockquote></mx-reply>ok, so it's the actual objects, not the JSClass object?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Mar 04 2024 11:58:42 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Mar 04 2024 11:58:57 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">ok, that's a touch less surprising, even if it's still clearly gone haywire</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Mar 04 2024 11:58:59 GMT-0800 (Pacific Standard Time)">19:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the JSClass is a single, fixed-size struct</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Mar 04 2024 11:59:30 GMT-0800 (Pacific Standard Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">Yeah, I was worried we had somehow allocated a ton of them lol</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Mar 04 2024 11:59:44 GMT-0800 (Pacific Standard Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I think 1.46GB of Function objects means lots and lots of closures (?)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Mar 04 2024 12:00:19 GMT-0800 (Pacific Standard Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">Yeah, that seems likely. I imagine those closures may have each captured some Map objects.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Mar 04 2024 12:00:25 GMT-0800 (Pacific Standard Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Mar 04 2024 12:00:59 GMT-0800 (Pacific Standard Time)">20:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">(this is my searchfox content process, I really can't imagine why we'd be using so much system JS for that)</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Mar 04 2024 12:05:13 GMT-0800 (Pacific Standard Time)">20:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">yes, it does not seem good</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Mar 04 2024 12:08:12 GMT-0800 (Pacific Standard Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">mccr8 might have some magic that would use the GC heap dump and track down what those Functions are</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Mar 04 2024 12:09:25 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I just tried a dumb approach: I did "Save GC &amp; CC logs" in about:memory (why are these called logs and not dumps?), then looked at the largest one and ran <code>grep Function gc-edges.941568.1709582570.log | perl -lne 'print $1 if / Function (.*)/' | sort | uniq -c | sort -n</code></td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Mar 04 2024 12:09:41 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">the last 5 lines:</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon Mar 04 2024 12:09:46 GMT-0800 (Pacific Standard Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><pre><code>   7850 MozBrowser/\&lt;
  11210 \_create/\&lt;
  11811 editableItem/\&lt;
  53570 setter
  81366 getter
</code></pre>
</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon Mar 04 2024 12:10:56 GMT-0800 (Pacific Standard Time)">20:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I was hoping that mass-duplicated closures would show up. And maybe they did? I don't remember how to decode autogenerated function names.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon Mar 04 2024 12:11:03 GMT-0800 (Pacific Standard Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">I do have <a href="http://census.py">census.py</a> which is supposed to analyze a few general things like functions. I dunno if the log from a heap that big will complete in a reasonable time though. <a href="https://github.com/amccreight/heapgraph/blob/master/g/census.py">https://github.com/amccreight/heapgraph/blob/master/g/census.py</a></td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon Mar 04 2024 12:13:16 GMT-0800 (Pacific Standard Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm thinking the <code>editableItem/\&lt;</code> one probably corresponds to the <a href="https://searchfox.org/mozilla-central/source/devtools/client/shared/inplace-editor.js#203-209">devtools code here</a>?</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon Mar 04 2024 12:13:43 GMT-0800 (Pacific Standard Time)">20:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">which is indeed a closure capturing <code>element</code>, at least</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon Mar 04 2024 12:31:00 GMT-0800 (Pacific Standard Time)">20:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nika:mozilla.org">nika</span>&gt;</div></td><td class="msg-cell">Unfortunately I just accidentally closed my firefox instance so I don't have that 7gig process around to inspect anymore</td></tr>

</tbody></table></div></div></div>
</body></html>