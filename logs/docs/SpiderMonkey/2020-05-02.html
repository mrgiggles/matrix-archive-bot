<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-05-02</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-05-02<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-05-01" class="nav-link"><span>prev</span></a>
<a href="2020-05-04" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sat May 02 2020 01:25:16 GMT-0700 (Pacific Daylight Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><p>Hello, I've been playing recently with changing javascript (what would it take it fix WAT) on <a href="https://code.google.com/archive/p/quad-wheel/">https://code.google.com/archive/p/quad-wheel/</a> and it was fun, so I checked out spidermonkey and it is 10000 bigger (at least), yet interpreter is nice and clear <a href="https://searchfox.org/mozilla-central/source/js/src/vm/Interpreter.cpp">https://searchfox.org/mozilla-central/source/js/src/vm/Interpreter.cpp</a><br>My build platform is WSL1 alpine (looks like a wrong choice), rustc 1.44.0-beta allows proc-macro, I use clang and I'm stuck</p>
<blockquote>
<p>fatal error: 'type_traits' file not found<br><a href="https://gist.github.com/sergeykish/fa230478da4c15880eac33b6ca2cc326">https://gist.github.com/sergeykish/fa230478da4c15880eac33b6ca2cc326</a><br>Could you please help?</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sat May 02 2020 01:42:28 GMT-0700 (Pacific Daylight Time)">08:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">It builds if I added "-I/usr/include/c++/9.2.0" "-I/usr/include/c++/9.2.0/x86_64-alpine-linux-musl" - for &lt;type_traits&gt; and "bits/c++config.h" (fixed)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sat May 02 2020 02:02:41 GMT-0700 (Pacific Daylight Time)">09:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">And now I've got<br>error: failed to run custom build command for <code>baldrdash v0.1.0 (/home/sergeykish/spidermonkey/js/src/wasm/cranelift)</code><br>thread 'main' panicked at 'Unable to find libclang: "the <code>libclang</code> shared library at /usr/lib/<a href="http://libclang.so">libclang.so</a>.9 could not be opened: Dynamic loading not supported"'<br>Well, it is musl, no dynamic loading here...</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sat May 02 2020 02:03:12 GMT-0700 (Pacific Daylight Time)">09:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">though it somehow builds <a href="https://git.alpinelinux.org/aports/tree/community/firefox">https://git.alpinelinux.org/aports/tree/community/firefox</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sat May 02 2020 02:07:24 GMT-0700 (Pacific Daylight Time)">09:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">Can I disable cranelift?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sat May 02 2020 02:10:29 GMT-0700 (Pacific Daylight Time)">09:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">sure --disable-cranelift</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sat May 02 2020 02:12:36 GMT-0700 (Pacific Daylight Time)">09:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: sorry, I don't know where to apply flag, it's not <code>./configure</code> and not <code>./mach</code>,</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sat May 02 2020 02:13:25 GMT-0700 (Pacific Daylight Time)">09:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">cd js/src; autoconf2.13; mkdir dbg-obj; cd dbg-obj; ../configure --disable-cranelift; make</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sat May 02 2020 02:14:39 GMT-0700 (Pacific Daylight Time)">09:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">aha, thank you</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sat May 02 2020 02:15:34 GMT-0700 (Pacific Daylight Time)">09:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">In <code>./mach build</code> I see<br>0:02.64 Adding configure options from /home/sergeykish/.mozconfig-debug<br>0:02.64   --enable-application=js<br>0:02.64   --disable-optimize<br>0:02.64   --enable-debug<br>It should work too, right?<br>ac_add_options --disable-cranelift</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sat May 02 2020 02:16:16 GMT-0700 (Pacific Daylight Time)">09:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">ah yes probably</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sat May 02 2020 02:17:00 GMT-0700 (Pacific Daylight Time)">09:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">worked! thank you</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sat May 02 2020 02:18:06 GMT-0700 (Pacific Daylight Time)">09:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: I'm a little bit afraid to move further from official steps, will check your way later</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sat May 02 2020 02:18:30 GMT-0700 (Pacific Daylight Time)">09:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">no that is fine, keep doing that</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sat May 02 2020 02:19:15 GMT-0700 (Pacific Daylight Time)">09:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@fscheidl:matrix.org">fscheidl</span>&gt;</div></td><td class="msg-cell">Hi there! I am trying to build the JS shell from source on macOS 10.14.6 and am following the instructions on <a href="https://firefox-source-docs.mozilla.org/js/build.html">https://firefox-source-docs.mozilla.org/js/build.html</a> Unfortunately, I seem to be facing some issues here at the linking stage. I have icu4c version 66 installed (via homebrew), if that's in any way relevant. Could someone direct me to get a successful build out of that?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sat May 02 2020 02:36:28 GMT-0700 (Pacific Daylight Time)">09:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Did you run mach bootstrap?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sat May 02 2020 02:36:50 GMT-0700 (Pacific Daylight Time)">09:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Otherwise I don't know anything about macos to really help</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sat May 02 2020 02:41:11 GMT-0700 (Pacific Daylight Time)">09:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@fscheidl:matrix.org">fscheidl</span>&gt;</div></td><td class="msg-cell">Yep, didn't change anything unfortunately. Thanks for the answer though!</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sat May 02 2020 03:03:54 GMT-0700 (Pacific Daylight Time)">10:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">fscheidl</span>: what's your mozconfig?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Sat May 02 2020 03:06:39 GMT-0700 (Pacific Daylight Time)">10:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@fscheidl:matrix.org">fscheidl</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-10">jandem</span>:</p>
<p>"ac_add_options --enable-application=js<br>ac_add_options --enable-optimize<br>ac_add_options --disable-debug</p>
<p>mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/obj-opt-@CONFIG_GUESS@"</p>
</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Sat May 02 2020 03:11:03 GMT-0700 (Pacific Daylight Time)">10:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">fscheidl</span>: my build finished and I have no "icu" package installed. I see <code>intl/icu</code> in tree, is it same as <code>icu4c</code>?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Sat May 02 2020 03:11:36 GMT-0700 (Pacific Daylight Time)">10:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@fscheidl:matrix.org">fscheidl</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">sergeykish</span>: icu4c was just a guess by me, probably not needed.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Sat May 02 2020 03:11:54 GMT-0700 (Pacific Daylight Time)">10:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">yeah icu is in tree</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Sat May 02 2020 03:14:08 GMT-0700 (Pacific Daylight Time)">10:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@fscheidl:matrix.org">fscheidl</span>&gt;</div></td><td class="msg-cell">Just removed the last line mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/obj-opt-@CONFIG_GUESS@". Build finished successfully. Huh!</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Sat May 02 2020 03:14:48 GMT-0700 (Pacific Daylight Time)">10:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">did you do a build before? maybe some stale files in the object dir</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Sat May 02 2020 03:14:55 GMT-0700 (Pacific Daylight Time)">10:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">good it works now though</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Sat May 02 2020 03:15:10 GMT-0700 (Pacific Daylight Time)">10:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@fscheidl:matrix.org">fscheidl</span>&gt;</div></td><td class="msg-cell">the one before was the first and failed attempt</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Sat May 02 2020 03:23:18 GMT-0700 (Pacific Daylight Time)">10:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">We know it took a while, but your build finally finished successfully!
To take your build for a test drive, run: |mach run|
$ ./mach run
 0:01.08 /home/sergeykish/spidermonkey/obj-x86_64-pc-linux-musl/dist/bin/js
$ ./obj-x86_64-pc-linux-musl/dist/bin/js
Segmentation fault (core dumped)
$ gdb ./obj-x86_64-pc-linux-musl/dist/bin/js
...
run
bt
#0  0x00007fffff66d54e in __once_proxy () from /usr/lib/libstdc++.so.6
#1  0x0000000009e45c84 in __pthread_once_full ()
#2  0xaaaaaaaaaaaaaaaa in ?? ()
#3  0x0000000009e45c03 in pthread_mutexattr_settype ()
#4  0x000000000b3352f8 in icu_66::(anonymous namespace)::initCondition ()
#5  0x0000000000000000 in ?? ()
that's unexpected, any ideas?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Sat May 02 2020 03:49:03 GMT-0700 (Pacific Daylight Time)">10:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">sergeykish</span>: not really. Maybe try --without-intl-api for now?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Sat May 02 2020 03:55:52 GMT-0700 (Pacific Daylight Time)">10:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">Just traced to<br>js/src/vm/Initialization.cpp, line 174<br>// Explicitly set the data directory to its default value, but only when we're<br>// sure that we use our in-tree ICU copy. See bug 1527879 and ICU bug<br>// report <a href="https://unicode-org.atlassian.net/browse/ICU-20491">https://unicode-org.atlassian.net/browse/ICU-20491</a>.<br>u_setDataDirectory("")</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Sat May 02 2020 03:55:54 GMT-0700 (Pacific Daylight Time)">10:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1527879">https://bugzil.la/1527879</a> — RESOLVED (anba) — localeCompare is very slow due to a lot of main thread I/O</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Sat May 02 2020 03:56:11 GMT-0700 (Pacific Daylight Time)">10:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: I'll try</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Sat May 02 2020 03:56:38 GMT-0700 (Pacific Daylight Time)">10:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">so you aren't using in tree ICU?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Sat May 02 2020 03:59:37 GMT-0700 (Pacific Daylight Time)">10:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">in tree</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Sat May 02 2020 04:34:44 GMT-0700 (Pacific Daylight Time)">11:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: thank you! it works now</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Sat May 02 2020 04:40:30 GMT-0700 (Pacific Daylight Time)">11:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">ptomato</span>: ++</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Sat May 02 2020 05:19:12 GMT-0700 (Pacific Daylight Time)">12:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">ah, ./mach build faster</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Sat May 02 2020 05:28:05 GMT-0700 (Pacific Daylight Time)">12:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">How can I force execution in interpreter?
(gdb) b js/src/vm/Interpreter.cpp:1416
(gdb) run
js&gt; {} + []
0
And nothing...
Where is it executed? JIT?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Sat May 02 2020 05:29:06 GMT-0700 (Pacific Daylight Time)">12:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">I'll try --disable-jit</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Sat May 02 2020 05:37:56 GMT-0700 (Pacific Daylight Time)">12:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">And a lot of errors <a href="https://gist.github.com/sergeykish/b46e7bb66411f42d5826b534928494e2">https://gist.github.com/sergeykish/b46e7bb66411f42d5826b534928494e2</a>
js/src/jit/LIR.h:1961:17: error: static_cast from 'js::jit::LNode *' to 'js::jit::LDivOrModConstantI *', which are not related by inheritance, is not allowed
 0:26.75 LIR_OPCODE_LIST(LIROP)
 0:26.78 ~~~~~~~~~~~~~~~~^~~~~~</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Sat May 02 2020 05:44:55 GMT-0700 (Pacific Daylight Time)">12:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">mhm --disable-jit might be broken</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Sat May 02 2020 05:46:33 GMT-0700 (Pacific Daylight Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">Should I add to tracker? Fix or remove...</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Sat May 02 2020 05:46:52 GMT-0700 (Pacific Daylight Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">I can test it later</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Sat May 02 2020 05:47:45 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">At least I have not seen <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1257185">https://bugzilla.mozilla.org/show_bug.cgi?id=1257185</a></td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Sat May 02 2020 05:48:38 GMT-0700 (Pacific Daylight Time)">12:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">There are some shell flags when running like --no-blinterp --no-baseline --no-ion</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Sat May 02 2020 05:51:12 GMT-0700 (Pacific Daylight Time)">12:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">I don't get, but if you can look it would be awesome</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Sat May 02 2020 05:53:13 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">Meantime, am I correct that code executed by JIT? Is there an easy way to disable it (temporary)</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Sat May 02 2020 05:54:29 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">I mean it was hit one time</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Sat May 02 2020 05:54:57 GMT-0700 (Pacific Daylight Time)">12:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">sergeykish</span>: see my previous message for flags for disabling the baseline interpreter etc.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Sat May 02 2020 05:55:48 GMT-0700 (Pacific Daylight Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">oh</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Sat May 02 2020 05:57:02 GMT-0700 (Pacific Daylight Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">there are no such keywords in js/moz.configure... I'll add them all and see</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Sat May 02 2020 05:58:03 GMT-0700 (Pacific Daylight Time)">12:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">sergeykish</span>: shell flag! not build flag</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Sat May 02 2020 05:58:23 GMT-0700 (Pacific Daylight Time)">12:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">i.e ./js --no-blinterp</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Sat May 02 2020 05:59:48 GMT-0700 (Pacific Daylight Time)">12:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: now I got it</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Sat May 02 2020 06:01:38 GMT-0700 (Pacific Daylight Time)">13:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">no changes</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Sat May 02 2020 06:03:19 GMT-0700 (Pacific Daylight Time)">13:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">I've got a list
obj-x86_64-pc-linux-musl/dist/bin/js --help</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Sat May 02 2020 06:47:00 GMT-0700 (Pacific Daylight Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">Ok, it is kind of strange<br><code>"" + []</code> hits<br><code>"" + 1</code> does not<br>flags --no-ion --no-asmjs --no-baseline --no-blinterp changes nothing</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Sat May 02 2020 06:49:32 GMT-0700 (Pacific Daylight Time)">13:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">On top of that <code>return false</code> from AddOperation makes it return 0</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Sat May 02 2020 06:51:34 GMT-0700 (Pacific Daylight Time)">13:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">It is constant expansion!<br><code>foo = ""; foo + 1</code> hits</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Sat May 02 2020 07:09:21 GMT-0700 (Pacific Daylight Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@evilpie:mozilla.org">evilpie</span>&gt;</div></td><td class="msg-cell">Oh yeah we do constant folding for some very simple expressions in the parser</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Sat May 02 2020 07:18:08 GMT-0700 (Pacific Daylight Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">That, and <code>./mach build faster</code> does not update <code>./obj-x86_64-pc-linux-musl/dist/bin/js</code></td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Sat May 02 2020 07:26:57 GMT-0700 (Pacific Daylight Time)">14:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><code>build faster</code> is only for firefox frontend/UI work. It doesn't build C++. Only the js/css, etc</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Sat May 02 2020 07:30:52 GMT-0700 (Pacific Daylight Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">ah, thanks</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Sat May 02 2020 07:32:02 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">how can I skip these?
 1:03.64 js/src/gdb/gdb-tests
 1:03.75 js/src/jsapi-tests/jsapi-tests
 1:55.51 js/src/build/spidermonkey_checks.stub
 2:13.13 TEST-PASS | check_spidermonkey_style.py | ok
 2:13.49 TEST-PASS | check_macroassembler_style.py | ok
 2:13.66 TEST-PASS | check_js_opcode.py | ok</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Sat May 02 2020 07:32:50 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><code>ac_add_options --disable-tests</code></td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Sat May 02 2020 07:33:34 GMT-0700 (Pacific Daylight Time)">14:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">also throw in <code>ac_add_options --disable-cranelift</code> <code>ac_add_options --disable-binast</code> for faster builds</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Sat May 02 2020 07:35:11 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">I'll try, <code>cranelift</code> already disabled - build failed on musl</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Sat May 02 2020 07:35:26 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">ha. strange</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Sat May 02 2020 07:35:52 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">evilpie</span>: looks like non-unified no-jit builds fail, but unified no-jit is fine</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Sat May 02 2020 08:39:20 GMT-0700 (Pacific Daylight Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"> 0:18.80   JS_ReportError(cx, "is not a number");
 0:18.80   ^~~~~~~~~~~~~~
 0:18.80   JS_ReportErrorUTF8
MDN outdated? <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_ReportError">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/JSAPI_reference/JS_ReportError</a></td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Sat May 02 2020 08:42:39 GMT-0700 (Pacific Daylight Time)">15:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">yes, JSAPI reference on MDN is years out of date ... unfortunately, the best available documentation is to search JS header files on <a href="http://searchfox.org">searchfox.org</a></td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Sat May 02 2020 08:44:39 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">there's also a cookbook here: <a href="https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr68/examples/cookbook.cpp">https://github.com/mozilla-spidermonkey/spidermonkey-embedding-examples/blob/esr68/examples/cookbook.cpp</a></td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Sat May 02 2020 08:46:24 GMT-0700 (Pacific Daylight Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">that's helpful</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Sat May 02 2020 08:49:35 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@ptomato:gnome.org">ptomato</span>&gt;</div></td><td class="msg-cell">(note that the cookbook is based on the ESR version so may still be slightly out of date)</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Sat May 02 2020 08:50:34 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">ok, it's 100% better than working through code trying to find examples</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Sat May 02 2020 08:52:41 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">I've just painfully got through ReportInNotObjectError &gt; JS_ReportErrorNumberASCII &gt; JS_ReportErrorUTF8</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Sat May 02 2020 08:54:20 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">Yet, I've dreamed about these results for so long
js&gt; [] + {}
typein:1:1 Error: \1 + \2 is not allowed
js&gt; [] - 1
typein:2:1 Error: is not a number
These should have been in "use strict"</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Sat May 02 2020 08:59:43 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">Is it possible to put updated library into Firefox distribution? So I can skip building it</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Sat May 02 2020 09:00:57 GMT-0700 (Pacific Daylight Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@tcampbell:mozilla.org">tcampbell</span>&gt;</div></td><td class="msg-cell">Unfortunately no. Spidermonkey is statically linked into <code>xul.dll</code> and that is the slow part to recompile.</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Sat May 02 2020 09:02:26 GMT-0700 (Pacific Daylight Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell">ok</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Sat May 02 2020 10:33:52 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell">Are there any other places the JS shell can create a new runtime other than <a href="https://searchfox.org/mozilla-central/source/js/src/shell/js.cpp#4145,11725">https://searchfox.org/mozilla-central/source/js/src/shell/js.cpp#4145,11725</a> ?</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Sat May 02 2020 10:43:27 GMT-0700 (Pacific Daylight Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">that should cover it. Main thread and evalInWorker </td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Sat May 02 2020 10:47:20 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@denispal:mozilla.org">denispal</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">jandem</span>: ty</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Sat May 02 2020 12:47:57 GMT-0700 (Pacific Daylight Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><p>I have not mentioned - to build spidermonkey on Alpine (musl) I had to patch</p>
<pre><code>diff -r 0f9c5a59e45d memory/build/Mutex.h
--- a/memory/build/Mutex.h      Fri May 01 14:28:41 2020 +0000
+++ b/memory/build/Mutex.h      Sat May 02 22:45:33 2020 +0300
@@ -42,7 +42,7 @@
     if (pthread_mutexattr_init(&amp;attr) != 0) {
       return false;
     }
-    pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_ADAPTIVE_NP);
+    pthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_NORMAL);
     if (pthread_mutex_init(&amp;mMutex, &amp;attr) != 0) {
       pthread_mutexattr_destroy(&amp;attr);
       return false;
@@ -102,8 +102,6 @@

 #  if defined(XP_DARWIN)
 #    define STATIC_MUTEX_INIT OS_SPINLOCK_INIT
-#  elif defined(XP_LINUX) &amp;&amp; !defined(ANDROID)
-#    define STATIC_MUTEX_INIT PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 #  else
 #    define STATIC_MUTEX_INIT PTHREAD_MUTEX_INITIALIZER
 #  endif
</code></pre>
</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Sat May 02 2020 12:51:21 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@sergeykish:mozilla.org">sergeykish</span>&gt;</div></td><td class="msg-cell"><p>Is it broken on android or it can be</p>
<pre><code>elif defined(PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP)
  define STATIC_MUTEX_INIT PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
</code></pre>
</td></tr>

</tbody></table></div></div></div>
</body></html>