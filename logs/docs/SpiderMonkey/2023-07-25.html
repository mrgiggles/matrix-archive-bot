<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2023-07-25</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2023-07-25<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-07-24" class="nav-link"><span>prev</span></a>
<a href="2023-07-26" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jul 24 2023 19:58:07 GMT-0700 (Pacific Daylight Time)">02:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@liam_g:mozilla.org">liam_g</span>&gt;</div></td><td class="msg-cell"><p>Here's an important note from the embedder's guide:</p>
<p>But note that <code>JS::PersistentRooted</code> in a struct or class is a rather<br>dangerous thing to use ‚Äî it will keep a GC thing alive, and most GC<br>things end up keeping their global alive, so if your class/struct is<br>reachable in any way from that global, then nothing will ever be cleaned<br>up by the GC.</p>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jul 24 2023 23:30:35 GMT-0700 (Pacific Daylight Time)">06:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">interesting news for our JIT backends today: Intel APX will increase the number of registers from 16 to 32 and add more 3-operand (and conditional) instructions: <a href="https://www.phoronix.com/news/Intel-APX">https://www.phoronix.com/news/Intel-APX</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jul 24 2023 23:31:21 GMT-0700 (Pacific Daylight Time)">06:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">"a new 64-bit absolute direct jump instruction" sounds useful too</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jul 25 2023 03:49:20 GMT-0700 (Pacific Daylight Time)">10:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">Well ‚Ä¶ <a href="https://en.wikipedia.org/wiki/X86">x86-64 started in 2001</a> ‚Ä¶ and we still <a href="https://www.mozilla.org/fr/firefox/all/#product-desktop-release">provide x86 builds</a> as of today.<br>So, who is ready for a third x86 backend? üòÅ</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jul 25 2023 03:51:31 GMT-0700 (Pacific Daylight Time)">10:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Well ‚Ä¶ <a href="https://en.wikipedia.org/wiki/X86">x86-64 started in 2001</a> ‚Ä¶ and we still <a href="https://www.mozilla.org/fr/firefox/all/#product-desktop-release">provide x86 builds</a> as of today.<br>So, who is ready for a third x86 backend? üòÅ</blockquote></mx-reply>"Compiler enabling is straightforward" ü§ì</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jul 25 2023 05:32:57 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@l11d:mozilla.org">l11d</span>&gt;</div></td><td class="msg-cell">is it possible to do a PGO-build for spidermonkey only (instead of the full browser)?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jul 25 2023 05:46:17 GMT-0700 (Pacific Daylight Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">I am not aware of such a thing.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jul 25 2023 05:46:56 GMT-0700 (Pacific Daylight Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@nbp:mozilla.org">nbp</span>&gt;</div></td><td class="msg-cell">It might be possible to generate pgo info from the browser, and then later compile a pgo-build of spidermonkey.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jul 25 2023 06:56:57 GMT-0700 (Pacific Daylight Time)">13:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">Does PGO help spidermonkey that much? Back in the day PGO was disabled entirely on Windows for SpiderMonkey due to compiler issues. üòÑ</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jul 25 2023 07:05:42 GMT-0700 (Pacific Daylight Time)">14:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">it depends a lot on the workload. If we spend most time in JIT/Wasm code PGO doesn't help much but that's not very common outside of certain benchmarks</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jul 25 2023 07:16:12 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell">but yeah MSVC's PGO used to be pretty buggy, like when it miscompiled our NaN-canonicalization code resulting in security issues (bug 977538)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jul 25 2023 07:16:14 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/977538">https://bugzil.la/977538</a> ‚Äî VERIFIED (jandem) ‚Äî MSVC with PGO still miscompiles/nops CanonicalizeNaN</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jul 25 2023 08:47:08 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Is there a preferred way to "catch" a JS exception from C++ code?  The best I can come up with right now is to check for pending exception and clear it.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jul 25 2023 08:53:42 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@bthrall:mozilla.org">Bryan Thrall [:bthrall]</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: that is the expected way to do it.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jul 25 2023 08:54:19 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Any pitfalls I should watch out for?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jul 25 2023 09:26:49 GMT-0700 (Pacific Daylight Time)">16:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">If you've set up interrupt handling, terminating execution in the interrupt handler results in returning false/nullptr with no pending exception. (This is how the slow-script dialog in Firefox works.)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jul 25 2023 10:04:44 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> If you've set up interrupt handling, terminating execution in the interrupt handler results in returning false/nullptr with no pending exception. (This is how the slow-script dialog in Firefox works.)</blockquote></mx-reply>I don't believe we have set that up.  As a side-note, is there any documentation on interrupt handling?  Is it part of your API, or are you talking about some external interrupt?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jul 25 2023 10:08:19 GMT-0700 (Pacific Daylight Time)">17:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">kfjvj</span>: See <a href="https://searchfox.org/mozilla-central/source/js/public/Interrupt.h#17-40">here</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jul 25 2023 10:29:41 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">Another question: Does anyone know of a situation where a module is imported into JS, but that module isn't actually defined in another JS file?  Like a situation where some API is built into the JS engine but is imported by a script.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jul 25 2023 10:30:52 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">We're binding a huge C++ API to JS, and I want to be able to do something like <code>import {foo} from "a.b.c"</code>, where "a.b.c" isn't a JS file, but a namespace in our built-in API</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jul 25 2023 10:34:22 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">not directly.  there are bug 1426690 and bug 1722802 for the API</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jul 25 2023 10:34:24 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1426690">https://bugzil.la/1426690</a> ‚Äî NEW (nobody) ‚Äî Add support for defining ES6 modules via JSAPI</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jul 25 2023 10:34:24 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1722802">https://bugzil.la/1722802</a> ‚Äî UNCONFIRMED (nobody) ‚Äî Add JSAPI functions to create JS modules w/ custom exports</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jul 25 2023 10:36:38 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell"><p>similar thing had been done by adding a thin wrapper module script around native function. so, a module script that exports a result of the native function.  (it was JSM tho, technically the same thing can be done with ESM) <a href="https://searchfox.org/mozilla-esr102/rev/d2f5f3fdc3faf117b3ffe62ba2f327f8bf337ef7/toolkit/modules/Services.jsm#7">https://searchfox.org/mozilla-esr102/rev/d2f5f3fdc3faf117b3ffe62ba2f327f8bf337ef7/toolkit/modules/Services.jsm#7</a></p>
<pre><code class="language-js">var Services = Cu.createServicesCache();
</code></pre>
</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jul 25 2023 10:46:47 GMT-0700 (Pacific Daylight Time)">17:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@arai:mozilla.org">arai</span>&gt;</div></td><td class="msg-cell">so, something like <code>export const foo = native_function_that_returns_foo();</code>,  or simply <code>export const foo = native_foo;</code></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jul 25 2023 11:00:21 GMT-0700 (Pacific Daylight Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@kfjvj:mozilla.org">kfjvj</span>&gt;</div></td><td class="msg-cell">thanks</td></tr>

</tbody></table></div></div></div>
</body></html>