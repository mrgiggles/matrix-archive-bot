<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>SpiderMonkey on 2020-07-28</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "SpiderMonkey";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">SpiderMonkey<br>2020-07-28<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-07-27" class="nav-link"><span>prev</span></a>
<a href="2020-07-29" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jul 27 2020 22:34:42 GMT-0700 (Pacific Daylight Time)">05:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jandem:mozilla.org">jandem</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">djvj</span>: correct. ParseTasks can also use cx-&gt;runtime() to get the runtime while they're active</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jul 28 2020 01:22:38 GMT-0700 (Pacific Daylight Time)">08:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-16">loganfsmyth</span>: generally speaking, we've been trying to minimize the number of other things accessed in finalizers. It causes various problems. But in this particular example, foreground-finalized objects <em>are</em> guaranteed to be finalized before scripts. This is assuming they're in the same zone sweep group, which I suspect is enforced for Debuggee stuff already?</blockquote></mx-reply><span class="nick-16">loganfsmyth</span>: the ordering constraints end up being hard to reason about and obey correctly, which is why we've moved to the current sweepAll style approach where sweeping happens before anything gets finalized</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jul 28 2020 01:26:32 GMT-0700 (Pacific Daylight Time)">08:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">(There are some ordering constrains between the different kinds of GC things, but not between GC things of the same kind.  There are some constraints between GC things in different zones, depending on whether CCWs exist between them.  But this has been a rich source of bugs and it's better not to go there)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jul 28 2020 05:07:25 GMT-0700 (Pacific Daylight Time)">12:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">confession: have the frontend part of top level await working afaict, moving on to the vm part</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jul 28 2020 06:28:45 GMT-0700 (Pacific Daylight Time)">13:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">Hi. I'm hoping someone can help me. I'm trying to use the Debugger API in my embedding. I'm using ESR76. I found that I was getting an assertion in  Promise.cpp in function JS::AutoDebuggerJobQueueInterruption::init
 MOZ_ASSERT(cx-&gt;jobQueue);
After a bit of investigation I found that I could call
js::UseInternalJobQueues(cx);
and that fixed the assert. However I'm now getting a different assert in jsfriendapi.cpp in function js::PrepareScriptEnvironmentAndInvoke
 MOZ_RELEASE_ASSERT(
      cx-&gt;runtime()-&gt;scriptEnvironmentPreparer,
      "Embedding needs to set a scriptEnvironmentPreparer callback");
and I don't know what I need to do to resolve/fix that. Can anybody help/advise? Many thanks...</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jul 28 2020 06:35:50 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">I think I might have found something in the shell. It looks like a class EnvironmentPreparer has been defined and this might be what I need. However I don't understand what this is trying to do... Am I on the right track here?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jul 28 2020 06:44:57 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span></div></td><td class="msg-cell">tries to remember what that was for</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jul 28 2020 06:47:37 GMT-0700 (Pacific Daylight Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">It mostly exists for a bunch of browser-side setup when running user script, if I understand correctly</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jul 28 2020 06:48:16 GMT-0700 (Pacific Daylight Time)">13:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Copying the one from the shell should be fine, I think</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jul 28 2020 06:49:00 GMT-0700 (Pacific Daylight Time)">13:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@ms2ger:igalia.com">Ms2ger [~half-time dedication]</span>&gt;</div></td><td class="msg-cell">Dunno if the exception stuff is required</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jul 28 2020 06:50:08 GMT-0700 (Pacific Daylight Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">Thanks. I'm in the middle of trying that so I'll see shortly! :-)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jul 28 2020 07:10:21 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@miles:mozilla.org">miles</span>&gt;</div></td><td class="msg-cell">Copying the implementation from the shell worked. I commented out the exception stuff too for the moment... Thanks.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jul 28 2020 08:26:43 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">miles</span>: Out of curiosity, what are you using the Debugger to do? It's never been clear how many users it has outside of Firefox itself</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jul 28 2020 09:00:26 GMT-0700 (Pacific Daylight Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@sfink:mozilla.org">sfink|afk</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: an offthread parse is angry at me in the extensible string patch because I'm accessing the zone to get a <code>ZoneAllocator</code> in order to call <code>addCellMemory()</code>. Is it safe to use <code>zoneFromAnyThread</code> from there? It's <code>TokenStreamSpecific::getStringOrTemplateToken() -&gt; ... -&gt; AllocateNewAtom -&gt; ... -&gt; morphAtomizedStringIntoAtom -&gt; Cell::zone() -&gt; ZoneAllocator::addCellMemory</code></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jul 28 2020 09:01:32 GMT-0700 (Pacific Daylight Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@sfink:mozilla.org">sfink|afk</span>&gt;</div></td><td class="msg-cell">oops, missed the actual call site: <code>... -&gt; morphAtomizedStringIntoAtom -&gt; AddCellMemory -&gt; Cell::zone() -&gt; ...</code></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jul 28 2020 09:01:41 GMT-0700 (Pacific Daylight Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@sfink:mozilla.org">sfink|afk</span>&gt;</div></td><td class="msg-cell">and now I'm afk for real</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jul 28 2020 09:28:39 GMT-0700 (Pacific Daylight Time)">16:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">sfink|afk</span>: I guess this is because it's the atoms zone and that's not owned by the helper thread</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jul 28 2020 09:29:26 GMT-0700 (Pacific Daylight Time)">16:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">addCellMemory is fine to use from helper threads (this needs to happen for off-thread parsing already)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jul 28 2020 09:30:04 GMT-0700 (Pacific Daylight Time)">16:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jonco:mozilla.org">jonco</span>&gt;</div></td><td class="msg-cell">so using zoneFromAnyThread is OK</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jul 28 2020 09:57:57 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: I'm trying to help <span class="nick-16">avandolder</span> figure out this question: how do we mark the bindings that contain the private names as closed-over?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jul 28 2020 09:58:20 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span> <span class="nick-16">avandolder</span>: one approach is to make an initializer function that stamps all private methods onto the instance. That synthetic function would use the bindings (in the sence of <code>noteUsedName</code>), which would mark them as closed-over.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jul 28 2020 09:59:07 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: Is there any reason currently that we shouldn't use a single initializer function for all nonstatic fields?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jul 28 2020 09:59:39 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: At the time we implemented it, we expected decorators to come along and cause those initializer functions to be exposed to script as separate actual function objects</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jul 28 2020 10:08:44 GMT-0700 (Pacific Daylight Time)">17:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@avandolder:mozilla.org">avandolder</span>&gt;</div></td><td class="msg-cell">I'm not really familiar with synthetic functions, but I had been considering whether something along that line would be possible</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jul 28 2020 10:21:56 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">jonco</span>: thanks. I did a grep for 'zone()' in frontend/, and it was barely used, so I wanted to be sure</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jul 28 2020 10:37:22 GMT-0700 (Pacific Daylight Time)">17:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">avandolder</span>: I think the closest things we have right now are (1) field initializer functions themselves; (2) constructors, when fields are present and no <code>constructor()</code> is explicitly defined</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Jul 28 2020 10:50:16 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">avandolder</span>: <code>synthesizeConstructor</code> implements (2) <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#7457">https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#7457</a></td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Jul 28 2020 10:52:27 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">That is, we actually generate a fake AST for the autogenerated constructor, when needed (== •user didn't provide a <code>constructor()</code> and •class contains at least one nonstatic field)</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Jul 28 2020 10:53:34 GMT-0700 (Pacific Daylight Time)">17:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">that check is implemented here. <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#7190-7191">https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#7190-7191</a> (when there are no fields, we can use a shared self-hosted constructor and save a few bytes)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Jul 28 2020 10:56:08 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@avandolder:mozilla.org">avandolder</span>&gt;</div></td><td class="msg-cell">right, I had gone in and changed that already. took a little bit to figure out how to check for private methods from a <code>NodeListType</code> but I figured something out</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Jul 28 2020 10:56:58 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">jorendorff</span>: I'll admit: I don't entirely understand the question</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Jul 28 2020 10:57:30 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">avandolder</span>: Right, but I meant that as an example of a case where we kind of ... macro-generate AST nodes as a way of creating a function body out of nothing</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Jul 28 2020 10:57:39 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">it's not clear to me why the used names tracker doesn't already just do the right thing; but I haven't been looking at the methods code so I don't entirely understand why they're special.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Jul 28 2020 10:58:13 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">mgaudet</span>: ok, hmm, i think I can explain that but i need a minute</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Jul 28 2020 10:58:36 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mgaudet:mozilla.org">mgaudet</span>&gt;</div></td><td class="msg-cell">No rush; I'm about to run for baby's (and my) lunch</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Jul 28 2020 10:59:50 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">avandolder</span>: We do a similar thing—create AST nodes out of thin air in the parser—when we parse field initializers. <a href="https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#7719-7829">https://searchfox.org/mozilla-central/source/js/src/frontend/Parser.cpp#7719-7829</a></td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Jul 28 2020 11:00:35 GMT-0700 (Pacific Daylight Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">these are the extra AST nodes needed to turn <code>x = foo();</code> into <code>(function () { this.x = foo(); })</code>.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Jul 28 2020 11:01:45 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jorendorff:mozilla.org">jorendorff</span>&gt;</div></td><td class="msg-cell">lunch sounds like a good idea</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Jul 28 2020 11:03:27 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@avandolder:mozilla.org">avandolder</span>&gt;</div></td><td class="msg-cell">Alright, i'll look into that. it might be the more straightforward approach</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Jul 28 2020 11:14:06 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">ugh. I should be paying attention to release notes before they go out. The "weakly held references" section of Fx79 is deceptive with respect to WeakMap.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Jul 28 2020 11:15:30 GMT-0700 (Pacific Daylight Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">warning people away from <code>WeakRef</code> because it's "advanced", or as in the release notes, "garbage collectors are complicated", also rubs me the wrong way. People who like to think of themselves as advanced or power users will be <em>more</em> likely to want to use them.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Jul 28 2020 11:16:16 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">I'm not sure what better terminology would be. "Unstable" is kinda right, but that means a different sort of instability (spec instability) in this context.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Jul 28 2020 11:17:24 GMT-0700 (Pacific Daylight Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">"the exact behavior is not portable across JS engines or versions of JS engines", perhaps.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Jul 28 2020 11:23:49 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@mccr8:mozilla.org">mccr8</span>&gt;</div></td><td class="msg-cell">"strong references, weakly held"</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Jul 28 2020 11:31:38 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@sfink:mozilla.org">sfink</span>&gt;</div></td><td class="msg-cell">heh</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Jul 28 2020 14:28:24 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@gkw:mozilla.org">gkw</span>&gt;</div></td><td class="msg-cell"><span class="nick-3">cfallin</span>: I'm not sure if bug 1655848 is related to the other one - perhaps you'd like to take a look? I'll try to get more info if you need it</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Jul 28 2020 14:28:25 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell"><a href="https://bugzil.la/1655848">https://bugzil.la/1655848</a></td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Jul 28 2020 15:46:44 GMT-0700 (Pacific Daylight Time)">22:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-4">jonco</span>: What's the logic behind <a href="https://searchfox.org/mozilla-central/rev/d9f92154813fbd4a528453c33886dc3a74f27abb/js/src/gc/GC.cpp#4797">https://searchfox.org/mozilla-central/rev/d9f92154813fbd4a528453c33886dc3a74f27abb/js/src/gc/GC.cpp#4797</a> ? That means</p>
<pre><code>var g = newGlobal({ newCompartment: true });
g.eval(`
  var obj = {};
  var ref = new WeakRef(obj);
  Promise.resolve().then(() =&gt; {
    print(obj);
    print(ref.deref());
  });
`);
nukeCCW(g.ref);
</code></pre>
<p>prints</p>
<pre><code>[object Object]
undefined
</code></pre>
<p>even though the object is still live?</p>
</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Jul 28 2020 15:50:00 GMT-0700 (Pacific Daylight Time)">22:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@waldo:mozilla.org">Waldo</span>&gt;</div></td><td class="msg-cell">confession: Randomly stumbled into a clang bug working on patchwork, reproduces with my local clang builds...then doesn't reproduce with current clang tip.  😒</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Jul 28 2020 15:50:03 GMT-0700 (Pacific Daylight Time)">22:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@botzilla:mozilla.org">botzilla</span>&gt;</div></td><td class="msg-cell">Seen! Your update will eventually appear on <a href="https://robotzilla.github.io/histoire">https://robotzilla.github.io/histoire</a></td></tr>

</tbody></table></div></div></div>
</body></html>